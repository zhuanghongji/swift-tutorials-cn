<!doctype html>
<html lang="zh-hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-metal-shading-language-specification/synchronization-and-simd-group-functions/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">同步和 SIMD-group 功能 | Swift 悍刀行</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions"><meta data-rh="true" name="docusaurus_locale" content="zh-hans"><meta data-rh="true" name="docsearch:language" content="zh-hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="同步和 SIMD-group 功能 | Swift 悍刀行"><meta data-rh="true" name="description" content="你可以在以下位置使用同步和 SIMD-group 功能："><meta data-rh="true" property="og:description" content="你可以在以下位置使用同步和 SIMD-group 功能："><link data-rh="true" rel="icon" href="/swift-tutorials-cn/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions"><link data-rh="true" rel="alternate" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions" hreflang="zh-hans"><link data-rh="true" rel="alternate" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/swift-tutorials-cn/blog/rss.xml" title="Swift 悍刀行 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/swift-tutorials-cn/blog/atom.xml" title="Swift 悍刀行 Atom Feed"><link rel="stylesheet" href="/swift-tutorials-cn/assets/css/styles.2fe221d4.css">
<link rel="preload" href="/swift-tutorials-cn/assets/js/runtime~main.e8a3ce7b.js" as="script">
<link rel="preload" href="/swift-tutorials-cn/assets/js/main.521b0f3d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/swift-tutorials-cn/"><div class="navbar__logo"><img src="/swift-tutorials-cn/img/logo.svg" alt="Swift 悍刀行" class="themedImage_ToTc themedImage--light_HNdA"><img src="/swift-tutorials-cn/img/logo.svg" alt="Swift 悍刀行" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Swift 悍刀行</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swift/welcome/about">Swift</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swiftui/essentials/about">SwiftUI</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swift-data/essentials/about">SwiftData</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Media</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/audio-toolbox/esseentials/about">Audio Toolbox</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/avf-audio/esseentials/about">AVFAudio</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/av-foundation/esseentials/about">AVFoundation</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Frameworks</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/core-graphics/overview">Core Graphics</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/charts/essentials/about">Charts</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metal/overview">Metal</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metalkit/overview">MetalKit</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Books</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metal-programming-guide/introdution">Metal Programming Guide</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">Metal Shading Language Specification 3.1</a></li></ul></div><a href="https://github.com/zhuanghongji/swift-tutorials-cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Metal Shading Language 规范</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">前言</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">前言</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/purpose-of-this-document">介绍</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/purpose-of-this-document">本文档的目的</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/organization-of-this-specification">本规范的组织</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/references">参考文献</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/metal-and-cpp14">Metal 和 C++14</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/compiler-and-preprocessor">编译器和预处理器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/metal-coordinate-systems">Metal 坐标系</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-data-types">数据类型</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-data-types">标量数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/vector-data-types">向量数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/matrix-data-types">矩阵数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/simd-group-matrix-data-types">SIMD 组矩阵数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/alignment-of-data-types">数据类型的对齐</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/atomic-data-types">原子数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/pixel-data-types">像素数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/buffers">缓冲区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/textures">纹理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/samplers">采样器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/imageblocks">图像块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/aggregate-types">聚合类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/argument-buffers">参数缓冲区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/uniform-type">统一类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/visible-function-table">可见函数表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/function-group-attribute">功能组属性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/ray-tracing-types">光线追踪类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/interpolant-type">插值类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/mesh-shader-types">网格着色器类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/type-conversions-and-re-interpreting-data">类型转换和重新解释数据</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/implicit-type-conversions">隐式类型转换</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-and-vector-operators">运算符</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-and-vector-operators">标量和向量运算符</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/matrix-operators">矩阵运算符</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/device-address-space">地址空间</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/device-address-space">设备地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/constant-address-space">常量地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/thread-address-space">线程地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/threadgroup-address-space">线程组地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/threadgroup-imageblock-address-space">threadgroup_imageblock 地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/ray-data-address-space">ray_data 地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/object-data-address-space">object_data 地址空间</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/functions">函数与变量声明</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/functions">函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables">函数参数和变量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/storage-class-specifiers">存储类说明符</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/sampling-and-interpolation-attributes">采样和插值属性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/per-fragment-function-versus-per-sample-function">每片段函数与每样本函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/imageblock-attributes">图像块属性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/graphics-function-signature-matching">图形功能 - 签名匹配</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/program-scope-function-constants">程序作用域函数常量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/program-scope-global-built-ins">程序范围全局内置函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/per-primitive-viewport-and-scissor-rectangle-index-selection">每个图元视口和剪刀矩形索引选择</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/additional-restrictions">附加限制</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/namespace-and-header-files">Metal 标准库</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/namespace-and-header-files">命名空间和头文件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/common-functions">常用函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/integer-functions">整数函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/relational-functions">关系函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/math-functions">数学函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/matrix-functions">矩阵函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/simd-group-matrix-functions">SIMD-group 矩阵函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/geometric-functions">几何函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions">同步和 SIMD-group 功能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/graphics-functions">图形函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/pull-model-interpolation">拉模型插值</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/texture-functions">纹理函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/imageblock-functions">图像块函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/pack-and-unpack-functions">打包和解包函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/atomic-functions">原子函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/encoding-commands-for-indirect-command-buffers">间接命令缓冲区的编码命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/variable-rasterization-rate">可变光栅化率</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/ray-tracing-functions">光线追踪函数</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/inf-nan-and-denormalized-numbers">数值符合性</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/inf-nan-and-denormalized-numbers">INF、NaN 和非规范化数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/rounding-mode">舍入模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/floating-point-exceptions">浮点异常</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/relative-error-as-ulps">作为 ULP 的相对误差</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/edge-case-behavior-in-flush-to-zero-mode">清零模式下的边缘情况行为</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/conversion-rules-for-floating-point-and-integer-types">浮点型和整数型的转换规则</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/texture-addressing-and-conversion-rules">纹理寻址和转换规则</a></li></ul></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/swift-tutorials-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Metal Shading Language 规范</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Metal 标准库</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">同步和 SIMD-group 功能</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>同步和 SIMD-group 功能</h1><div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_S0QG"><p>该文档目前仅完成 Google 翻译，需进一步校对和润色。</p></div></div></div><div style="padding-left:1rem;padding-right:1rem;padding-top:1.5rem;padding-bottom:0.5rem;border-radius:0.5rem;background-color:#333333"><p>原文：<a href="https://developer.apple.com/metal/Metal-Shading-Language-Specification.pdf">Metal Shading Language Specification - Version 3.1</a></p><blockquote>6.9 Synchronization and SIMD-group Functions</blockquote></div><br><p>你可以在以下位置使用同步和 SIMD-group 功能：</p><ul><li><code>kernel</code> 函数</li><li><code>fragment</code> 函数</li><li>内核或片段函数调用的 <code>visible</code> 函数</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="线程组和-simd-group-同步函数">线程组和 SIMD-group 同步函数<a href="#线程组和-simd-group-同步函数" class="hash-link" aria-label="线程组和 SIMD-group 同步函数的直接链接" title="线程组和 SIMD-group 同步函数的直接链接">​</a></h2><p>头文件 <code>&lt;metal_compute&gt;</code> 定义了表 6.12 中的同步函数，其中列出了它支持的线程组和 SIMD-group 同步函数。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 6.12 - Synchronization compute function in the Metal standard library</strong></div><br><center style="max-width:90%"><table><thead><th>Built-in Threadgroup Function</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">void threadgroup_barrier(mem_flags flags)</td><td style="white-space:pre-line;min-width:10rem;color:white">All threads in a threadgroup executing the kernel, fragment, mesh, or object need to execute this function before any thread can continue execution beyond the threadgroup_barrier.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">void simdgroup_barrier(mem_flags flags) 
macOS: Since Metal 2. 
iOS: Since Metal 1.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">All threads in a SIMD-group executing the kernel, fragment, mesh, or object need to execute this function before any thread can continue execution beyond the simdgroup_barrier.</td></tr></tbody></table></center><br></div><p><em>barrier 函数</em>（<code>threadgroup_barrier</code> 或 <code>simdgroup_barrier</code>）充当执行和内存屏障。执行内核的线程组（或 SIMD-group）中的所有线程都需要遇到 <code>threadgroup_barrier</code>（或 <code>simdgroup_barrier</code>）函数。</p><p>如果 <code>threadgroup_barrier</code>（或 <code>simdgroup_barrier</code>）位于条件语句内，并且任何线程进入条件语句并执行屏障函数，则线程组（或 SIMD-group）中的所有线程都需要输入条件并执行屏障函数。</p><p>如果 <code>threadgroup_barrier</code>（或 <code>simdgroup_barrier</code>）位于循环内，则对于循环的每次迭代，线程组（或 SIMD-group）中的所有线程都需要在任何线程继续执行超出屏障函数之前执行屏障函数。</p><p><code>threadgroup_barrier</code>（或 <code>simdgroup_barrier</code>）函数还可以对内存栅栏进行排队（用于读取和写入），以确保对线程组或设备内存的内存操作的正确顺序。</p><p>表 6.13 描述了 <code>threadgroup_barrier</code> 和 <code>simdgroup_barrier</code> 的 <code>mem_flags</code> 参数的位字段值。<code>mem_flags</code> 参数确保线程组或 <code>simdgroup</code>（对于 <code>threadgroup_barrier</code> 或 <code>simdgroup_barrier</code>）中的线程之间的内存顺序正确。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 6.13 - Memory flag enumeration values for barrier functions</strong></div><br><center style="max-width:90%"><table><thead><th>mem_flags</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">mem_none</td><td style="white-space:pre-line;min-width:10rem;color:white">The flag sets threadgroup_barrier or simdgroup_barrier to only act as an execution barrier and doesn’t apply a Memory fence.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">mem_device</td><td style="white-space:pre-line;min-width:10rem;color:white">The flag ensures the GPU correctly orders the memory operations to device memory for threads in the threadgroup or simdgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">mem_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">The flag ensures the GPU correctly orders the memory operations to threadgroup memory for threads in a threadgroup or simdgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">mem_texture 
macOS: Since Metal 1.2. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">The flag ensures the GPU correctly orders the memory operations to texture memory for threads in a threadgroup or simdgroup for a texture with the read_write access qualifier.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">mem_threadgroup_imageblock</td><td style="white-space:pre-line;min-width:10rem;color:white">The flag ensures the GPU correctly orders the memory operations to threadgroup imageblock memory for threads in a threadgroup or simdgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">mem_object_data</td><td style="white-space:pre-line;min-width:10rem;color:white">The flag ensures the GPU correctly orders the memory operations to object_data memory for threads in the threadgroup or simdgroup.</td></tr></tbody></table></center><br></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="simd-group-函数">SIMD-group 函数<a href="#simd-group-函数" class="hash-link" aria-label="SIMD-group 函数的直接链接" title="SIMD-group 函数的直接链接">​</a></h2><p>头文件 <code>&lt;metal_simdgroup&gt;</code> 定义内核和片段函数的 SIMD-group 函数。macOS 支持 Metal 2 及更高版本中的 SIMD-group 函数，iOS 支持大多数</p><p>SIMD-group 在 Metal 2.2 及更高版本中起作用。表 6. 14 和表 6. 15 列出了 SIMD-group 函数及其在 iOS 和 macOS 中的可用性。请参阅 <strong>Metal Feature Set Tables</strong> 以确定哪些 GPU 支持每个表。</p><p>SIMD-group 函数允许 SIMD-group 中的线程（请参阅第 4.4.1 节）共享数据，而无需使用线程组内存或需要任何同步操作（例如屏障）。</p><p><em>active</em> 线程是正在执行的线程。<em>非活动</em> 线程是 <em>未</em> 执行的线程。例如，由于流控制或任务没有足够的工作来填充组，线程可能不处于活动状态。线程只需从 SIMD-group 中的另一个活动线程读取数据。</p><p>辅助线程也可以是 <em>active</em> 和 <em>inactive</em>。例如，如果辅助线程完成执行，它将变为非活动辅助线程。SIMD-group 函数的辅助线程可以是活动的或非活动的。使用 <code>simd_is_helper_thread()</code> （参见表 6. 14 ）检查线程是否为辅助线程。</p><p>表 6.14 使用占位符 <code>T</code> 表示任何整数或浮点类型的标量或向量，但以下情况除外：</p><ul><li><code>bool</code></li><li><code>void</code></li><li><code>size_t</code></li><li><code>ptrdiff_t</code></li></ul><p>对于按位运算，<code>Ti</code> 需要是整数标量或向量。</p><p>有关使用 SIMD-group 函数的示例，请参阅表后的 6.9.2.1。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 6.14 - SIMD-group permute functions in the Metal standard library</strong></div><br><center style="max-width:90%"><table><thead><th>Built-in SIMD-group Functions</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">simd_vote 
simd_active_threads_mask() 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns a simd_vote mask that represents the active threads.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">This function is equivalent to simd_ballot (true)and sets the bits that represent active threads to 1, and inactive Threads to 0.</td><td style="white-space:pre-line;min-width:10rem;color:white">bool simd_all(bool expr) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Returns true if all active threads evaluate expr to true.</td><td style="white-space:pre-line;min-width:10rem;color:white">bool simd_any(bool expr) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Returns true if at least one active thread evaluates Expr to true.</td><td style="white-space:pre-line;min-width:10rem;color:white">simd_vote simd_ballot (bool expr) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Returns a wrapper type — see the simd_vote example — around a bitmask of the evaluation of the Boolean expression for all active threads in the SIMD-group for which expr is true. The function sets the bits that correspond to inactive threads to 0.</td><td style="white-space:pre-line;min-width:10rem;color:white">T simd_broadcast(T data, ushort broadcast_lane_id) 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Broadcasts data from the thread whose SIMD lane ID is equal to broadcast_lane_id. 

The specification doesn’t define the behavior when broadcast_lane_id isn’t a valid SIMD lane ID or isn’t the same for all threads in a SIMD-group.</td><td style="white-space:pre-line;min-width:10rem;color:white">T simd_broadcast_first(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Broadcasts data from the first active thread — the active thread with the smallest index — in the SIMD-group to all active threads.</td><td style="white-space:pre-line;min-width:10rem;color:white">bool simd_is_first() 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Returns true if the current thread is the first active thread — the active thread with the smallest index — in the current SIMD-group; otherwise false.</td><td style="white-space:pre-line;min-width:10rem;color:white">T simd_shuffle(T data, ushort simd_lane_id) 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Returns data from the thread whose SIMD lane ID is simd_lane_id. The simd_lane_id needs to be a valid SIMD lane ID but doesn’t have to be the same for all threads in the SIMD-group.</td><td style="white-space:pre-line;min-width:10rem;color:white">T simd_shuffle_and_fill_down(T data, T filling_data, ushort delta) 
All OS: Since Metal 2.4.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Returns data or filling_data from the thread whose SIMD lane ID is the sum of the caller’s SIMD lane ID and delta. 

If the sum is greater than the SIMD-group size, the function copies values from the lower delta lanes of filling_data into the upper delta lanes of data. 

The value for delta needs to be the same for all threads in a SIMD-group.</td><td style="white-space:pre-line;min-width:10rem;color:white">T simd_shuffle_and_fill_down(T data, T filling_data, ushort delta, ushort modulo) 
All OS: Since Metal 2.4.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Returns data or filling_data for each vector from the thread whose SIMD lane ID is the sum of the caller’s SIMD lane ID and delta. 

If the sum is greater than modulo, the function copies values from the lower delta lanes of filling_data into the upper delta lanes of data.</td><td style="white-space:pre-line;min-width:10rem;color:white">The value of delta needs to be the same for all threads in a SIMD-group. The modulo parameter defines the vector width that splits the SIMD-group into separate vectors.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_shuffle_and_fill_up(T data, T filling_data, ushort delta) 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data or filling_data from the thread whose SIMD lane ID is the difference from the caller’s SIMD lane ID minus delta. If the difference is negative, the operation copies values from the upper delta lanes of filling_data to the lower delta lanes of data. 

The value of delta needs to be the same for all threads in a SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_shuffle_and_fill_up(T data, T filling_data, ushort delta, ushort modulo) 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data or filling_data for each vector from the thread whose SIMD lane ID is the difference from the caller’s SIMD lane ID minus delta. 

If the difference is negative, the operation copies values from the upper delta lanes of filling_data to the lower delta lanes of data. 

The value of delta needs to be the same for all threads in a SIMD-group. 

The modulo parameter defines the vector width that splits the SIMD-group into separate vectors.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_shuffle_down(T data, ushort delta) 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose SIMD lane ID is the sum of caller’s SIMD lane ID and delta. 

The value for delta needs to be the same for all threads in the SIMD-group. 

This function doesn’t modify the upper delta lanes of data because it doesn’t wrap values around the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_shuffle_rotate_down(T data, ushort delta) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose SIMD lane ID is the sum of caller’s SIMD lane ID and delta. 

The value for delta needs to be the same for all threads in the SIMD-group. 

This function wraps values around the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_shuffle_rotate_up(T data, ushort delta) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose SIMD lane ID is the difference from the caller’s SIMD lane ID minus delta. 

The value of delta needs to be the same for all threads in a SIMD-group. This function wraps values around the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_shuffle_up(T data, ushort delta) 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose SIMD lane ID is the difference from the caller’s SIMD lane ID minus delta. 

The value of delta needs to be the same for all threads in a SIMD-group. 

This function doesn’t modify the lower delta lanes of data because it doesn’t wrap values around the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Ti simd_shuffle_xor(Ti value, ushort mask) 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose SIMD lane ID is equal to the bitwise XOR (^) of the caller’s SIMD lane ID and mask. The value of mask needs to be the same for all threads in a SIMD-group.</td></tr></tbody></table></center><br></div><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 6.15 - SIMD-group reduction functions in the Metal standard library</strong></div><br><center style="max-width:90%"><table><thead><th>Built-in SIMD-group Functions</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Ti simd_and(Ti data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the bitwise AND (&amp;) of data across all active threads in the SIMD-group and broadcasts the result to all active threads in the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">bool simd_is_helper_thread() 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns true if the current thread is a helper thread; otherwise, false. You needs to call this function from a fragment function or another function that your fragment function calls; otherwise, it may trigger a compile-time error.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_max(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data with the highest value from across all active threads in the SIMD-group and broadcasts that value to all active threads in the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_min(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data with the lowest value from across all active threads in the SIMD-group and broadcasts that value to all active threads in the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Ti simd_or(Ti data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the bitwise OR (|) of data across all active threads in the SIMD-group and broadcasts the result to all active threads in the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_prefix_exclusive_product (T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">For a given thread, returns the product of the input values in data for all active threads with a lower index in the SIMD-group. The first thread in the group, returns T(1).</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_prefix_exclusive_sum (T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">For a given thread, returns the sum of the input values in data for all active threads with a lower index in the SIMD-group. The first thread in the group, returns T(0).</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_prefix_inclusive_product (T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">For a given thread, returns the product of the input values in data for all active threads with a lower or the same index in the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_prefix_inclusive_sum (T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">For a given thread, returns the sum of the input values in data for all active threads with a lower or the same index in the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_product(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the product of the input values in data across all active threads in the SIMD-group and broadcasts the result to all active threads in the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T simd_sum(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the sum of the input values in data across all active threads in the SIMD-group and broadcasts the result to all active threads in the SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Ti simd_xor(Ti data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the bitwise XOR (^) of data across all active threads in the SIMD-group and broadcasts the result to all active threads in the SIMD-group.</td></tr></tbody></table></center><br></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例">示例<a href="#示例" class="hash-link" aria-label="示例的直接链接" title="示例的直接链接">​</a></h3><p>为了演示随机播放功能，请从该 SIMD-group 的初始状态开始：</p><table><thead><tr><th>SIMD Lane ID</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th></tr></thead><tbody><tr><td>data</td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>i</td><td>j</td><td>K</td><td>l</td><td>m</td><td>n</td><td>o</td><td>p</td></tr></tbody></table><p><code>simd_shuffle_up()</code> 函数将每个 SIMD-group 向上移动 <code>delta</code> 线程。例如，当 <code>delta</code> 值为 2 时，函数：</p><ul><li>将 SIMD 通道 ID 下移两位</li><li>将下面的两个通道标记为无效</li></ul><table><thead><tr><th>Computed SIMD Lane ID</th><th>-2</th><th>-1</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th></tr></thead><tbody><tr><td>valid</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr><tr><td>data</td><td>a</td><td>b</td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>i</td><td>j</td><td>K</td><td>l</td><td>m</td><td>n</td></tr></tbody></table><p><code>simd_shuffle_up()</code> 函数是一种非包装操作，不会影响较低的 <code>delta</code> 通道。</p><p>类似地，<code>simd_shuffle_down()</code> 函数将每个 SIMD-group 向下移动 <code>delta</code> 线程。从相同的初始 SIMD-group 状态开始，<code>delta</code> 值为 <code>2</code> ，该函数：</p><ul><li>将 SIMD 通道 ID 向上移动两位</li><li>将上面的两个通道标记为无效</li></ul><table><thead><tr><th>Computed SIMD Lane ID</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th></tr></thead><tbody><tr><td>valid</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td><td>0</td></tr><tr><td>data</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>i</td><td>j</td><td>k</td><td>l</td><td>m</td><td>n</td><td>o</td><td>p</td><td>o</td><td>p</td></tr></tbody></table><p><code>simd_shuffle_down()</code> 函数是一种非包装操作，不会影响上 <code>delta</code> 通道。</p><p>为了演示 shuffle-and-fill 函数，启动该 SIMD-group 的初始状态：</p><table><thead><tr><th>SIMD Lane ID</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th></tr></thead><tbody><tr><td>data</td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>s</td><td>t</td><td>u</td><td>v</td><td>w</td><td>x</td><td>y</td><td>z</td></tr><tr><td>filling</td><td>fa</td><td>fb</td><td>fc</td><td>fd</td><td>fe</td><td>ff</td><td>fg</td><td>fh</td><td>fs</td><td>ft</td><td>fu</td><td>fv</td><td>fw</td><td>fx</td><td>fy</td><td>fz</td></tr></tbody></table><p><code>simd_shuffle_and_fill_up()</code> 函数通过增量线程向上移动每个 SIMD-group（类似于 <code>simd_shuffle_up()</code>），并通过包装 SIMD 通道 ID 将上 <code>filling</code> 通道的值分配给下 <code>data</code> 通道。例如，当 <code>delta</code> 值为 <code>2</code> 时，函数：</p><ul><li>将 SIMD 通道 ID 下移两位</li><li>将上面两个 <code>filling</code> 通道分配给下面两个 <code>data</code> 通道</li></ul><table><thead><tr><th>Computed SIMD Lane ID</th><th>-2</th><th>-1</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th></tr></thead><tbody><tr><td>data</td><td>fy</td><td>fz</td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>s</td><td>t</td><td>u</td><td>v</td><td>w</td><td>x</td></tr></tbody></table><p>带有 <code>modulo</code> 参数的 <code>simd_shuffle_and_fill_up()</code> 函数将 SIMD-group 拆分为向量，每个向量 with size <code>modulo</code>，并按 <code>delta</code> 线程移位每个向量。例如，<code>modulo</code> 值为 <code>8</code> 且 <code>delta</code> 值为 <code>2</code> 时，函数：</p><ul><li>将 SIMD 通道 ID 下移两位</li><li>将 <code>filling</code> 中每个向量的上面两个通道分配给数据中每个向量的下面两个通道</li></ul><table><thead><tr><th>Computed SIMD Lane ID</th><th>-2</th><th>-1</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>-2</th><th>-1</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr></thead><tbody><tr><td>data</td><td>fg</td><td>fh</td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>fy</td><td>fz</td><td>s</td><td>t</td><td>u</td><td>v</td><td>w</td><td>x</td></tr></tbody></table><p><code>simd_shuffle_and_fill_down()</code> 函数通过 <code>delta</code> 线程向下移动每个 SIMD-group（类似于 <code>simd_shuffle_down()</code>），并通过包装 SIMD 通道 ID 将低 <code>filling</code> 通道中的值分配给较高 <code>data</code> 通道。例如，当 <code>delta</code> 值为 <code>2</code> 时，函数：</p><ul><li>将 SIMD 通道 ID 上移两位</li><li>将下面两个 <code>filling</code> 通道分配给上面两个 <code>data</code> 通道</li></ul><table><thead><tr><th>Computed SIMD Lane ID</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th></tr></thead><tbody><tr><td>data</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>s</td><td>t</td><td>u</td><td>v</td><td>w</td><td>x</td><td>y</td><td>z</td><td>fa</td><td>fb</td></tr></tbody></table><p>带有 <code>modulo</code> 参数的 <code>simd_shuffle_and_fill_down()</code> 函数将 SIMD-group 拆分为向量，每个向量 with size <code>modulo</code>，并按 <code>delta</code> 线程移位每个向量。例如，模值为 <code>8</code> 且 <code>delta</code> 值为 <code>2</code> 时，函数：</p><ul><li>将 SIMD 通道 ID 向上移动两位</li><li>将 <code>filling</code> 中每个向量的下两个泳道分配给 <code>data</code> 中每个向量的上两个泳道</li></ul><table><thead><tr><th>Computed SIMD Lane ID</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th></tr></thead><tbody><tr><td>data</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>fa</td><td>fb</td><td>u</td><td>v</td><td>w</td><td>x</td><td>y</td><td>z</td><td>fs</td><td>ft</td></tr></tbody></table><p>下面是如何使用这些 SIMD 函数执行归约操作的示例：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kernel </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">reduce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> device </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">input </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   device atomic_int </span><span class="token operator">*</span><span class="token plain">output </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   threadgroup </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">ldata </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">threadgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   uint gid </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">thread_position_in_grid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   uint lid </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">thread_position_in_threadgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   uint lsize </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">threads_per_threadgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   uint simd_size </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">threads_per_simdgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   uint simd_lane_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">thread_index_in_simdgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   uint simd_group_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">simdgroup_index_in_threadgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Perform the first level of reduction.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Read from device memory, write to threadgroup memory. int val = input[gid] + input[gid + lsize];</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">uint s</span><span class="token operator">=</span><span class="token plain">lsize</span><span class="token operator">/</span><span class="token plain">simd_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> s</span><span class="token operator">&gt;</span><span class="token plain">simd_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> s</span><span class="token operator">/=</span><span class="token plain">simd_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Perform per-SIMD partial reduction.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">uint offset</span><span class="token operator">=</span><span class="token plain">simd_size</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> offset</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> offset</span><span class="token operator">/=</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">simd_shuffle_down</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> offset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Write per-SIMD partial reduction value to threadgroup memory.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">simd_lane_id </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ldata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">simd_group_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Wait for all partial reductions to complete.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">threadgroup_barrier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">mem_flags</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">mem_threadgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lid </span><span class="token operator">&lt;</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> ldata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">lid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Perform final per-SIMD partial reduction to calculate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// the threadgroup partial reduction result.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">uint offset </span><span class="token operator">=</span><span class="token plain"> simd_size </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> offset </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> offset </span><span class="token operator">/=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">simd_shuffle_down</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> offset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Atomically update the reduction result.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lid </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">atomic_fetch_add_explicit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              memory_order_relaxed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>simd_active_threads_mask</code> 和 <code>simd_ballot</code> 函数使用 <code>simd_vote</code> 包装类型（见下文），它可以显式转换为其由 <code>vote_t</code> 表示的基础类型。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">simd_vote</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">explicit</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">simd_vote</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">vote_t v </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">explicit</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">operator</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">vote_t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Returns true if all bits corresponding to threads in the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// SIMD-group are set.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// You can use all() with the return value of simd_ballot(expr)   // to determine if all threads Are active.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Returns true if any bit corresponding to a valid thread in   // the SIMD-group is set.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// You can use any() with the return value of simd_ballot(expr)   // to determine if at least one thread is active.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// bit i in v represents the &#x27;vote&#x27; for the thread in the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// SIMD-group at index i</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">uint64_t</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>请注意，<code>simd_all(expr)</code> 与 <code>simd_ballot(expr).all()</code> 不同：</p><ul><li>如果所有 <em>active</em> 线程将 <code>expr</code> 计算为 <code>true</code>，则 <code>simd_all(expr)</code> 返回 <code>true</code>。</li><li>如果所有线程 <em>were</em> 都处于活动状态并且将 <code>expr</code> 计算为 <code>true</code>，则 <code>simd_ballot(expr).all()</code> 返回 <code>true</code>。（<code>simd_vote::all()</code> 不会查看哪些线程处于活动状态。）</li></ul><p>相同的逻辑适用于 <code>simd_any</code>、<code>simd_vote::any()</code> 以及第 6.9.3 节中列出的等效四元函数。</p><p>在 SIMD-group 中线程少于 64 个的硬件上，<code>simd_vote</code> 中最高位的值未定义。特别是，由于你可以初始化这些位，因此不要假设最高位设置为 0。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quad-group-函数">Quad-group 函数<a href="#quad-group-函数" class="hash-link" aria-label="Quad-group 函数的直接链接" title="Quad-group 函数的直接链接">​</a></h2><p>macOS：自 Metal 2.1 起支持 Quad-group 函数。</p><p>iOS：自 Metal 2 起支持一些 Quad-group 函数，包括 <code>quad_broadcast</code>、<code>quad_shuffle</code>、<code>quad_shuffle_up</code>、<code>quad_shuffle_down</code> 和 <code>quad_shuffle_xor</code>。</p><p>Quad-group 函数是一个 SIMD-group 函数（参见第 6.9.2 节），执行宽度为 4。 <em>active</em> 和 <em>inactive</em> 线程术语与第 6.9.2 节中的相同。</p><p>辅助线程仅执行以计算片段着色器中 Quad-group 的梯度，然后变为非活动状态。</p><p>内核和片段函数可以调用表 6.16 和表 6.17 中列出的 quad-group 函数。线程只能从 quad-group 中的另一个活动线程读取数据。请参阅 &quot;Metal Feature Set Tables&quot; 以确定哪些 GPU 支持每个表。</p><p>表 6.16 和表 6.17 的占位符 <code>T</code> 表示任何整数或浮点类型的标量或向量，但以下情况除外：</p><ul><li><code>bool</code></li><li><code>void</code></li><li><code>size_t</code></li><li><code>ptrdiff_t</code></li></ul><p>对于按位运算，<code>T</code> 需要是整数标量或向量。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 6.16 - Quad-group permute functions in the Metal standard library</strong></div><br><center style="max-width:90%"><table><thead><th>Built-in Quad-group Functions</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">quad_vote quad_ballot (bool expr) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns a wrapper type — see the quad_vote example — around a bitmask of the evaluation of the Boolean expression for all active threads in the quad-group for which expr is true. 

The function sets the bits that correspond to inactive threads to 0.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_broadcast(T data, ushort broadcast_lane_id) 
macOS: Since Metal 2. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Broadcasts data from the thread whose quad lane ID is broadcast_lane_id. The value for broadcast_lane_id needs to be a valid quad lane ID that’s the same for all threads in a quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_broadcast_first(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Broadcasts data from the first active thread — the active thread with the smallest index — in the quad-group to all active threads.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle(T data, ushort quad_lane_id) 
macOS: Since Metal 2. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose quad lane ID is the sum of the caller’s quad lane ID and delta. 

The value for quad_lane_id needs to be a valid land ID and may differ from other threads in the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle_and_fill_down(T data, T filling_data, ushort delta) 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data or filling_data from the thread whose quad lane ID is the sum of the caller’s quad lane ID and delta. 
If the sum is greater than the quad-group size, the function copies values from the lower delta lanes of filling_data into the upper delta lanes of data. The value for delta needs to be the same for all threads in a quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle_and_fill_down(T data, T filling_data, ushort delta, ushort modulo) 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data or filling_data for each vector, from the thread whose quad lane ID is the sum of caller’s quad lane ID and delta. If the sum is greater than the quad-group size, the function copies values from the lower delta lanes of filling_data into the upper delta lanes of data. 

The value of delta needs to be the same for all threads in a quad-group. The modulo parameter defines the vector width that splits the quad-group into separate vectors.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle_and_fill_up(T data, T filling_data, ushort delta) 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data or filling_data from the thread whose quad lane ID is the difference from the caller’s quad lane ID minus delta. If the difference is negative, the operation copies values from the upper delta lanes of filling_data to the lower delta lanes of data. 

If the difference is negative, the function shuffles data from filling_data into the lower delta lanes. The value of delta needs to be the same for all threads in a quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle_and_fill_up(T data, T filling_data, ushort delta, ushort modulo) 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data or filling_data for each vector from the thread whose quad lane ID is the difference from the caller’s quad lane ID minus delta. 

If the difference is negative, the operation copies values from the upper delta lanes of filling_data to the lower delta lanes of data. 

The value of delta needs to be the same for all threads in a quad-group. 

The modulo parameter defines the width that splits the quad-group into separate vectors.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle_down(T data, ushort delta) 
macOS: Since Metal 2. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose quad lane ID is the sum of the caller’s quad lane ID and delta. 

The value for delta needs to be the same for all threads in a quad-group. 

The function doesn’t modify the upper delta lanes of data because it doesn’t wrap values around the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle_rotate_down(T data, ushort delta) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose quad lane ID is the sum of the caller’s quad lane ID and delta. 

The value for delta needs to be the same for all threads in a quad-group. 

This function wraps values around the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle_rotate_up(T data, ushort delta) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose quad lane ID is the difference from the caller’s quad lane ID minus delta. 
The value for delta needs to be the same for all threads in a quad-group. 
This function wraps values around the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle_up(T data, ushort delta) 
macOS: Since Metal 2. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from thread whose quad lane ID is the difference from the caller’s quad lane ID minus delta. 

The value for delta needs to be the same for all threads in a quad-group. 

This function doesn’t modify the lower delta lanes of data because it doesn’t wrap values around the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_shuffle_xor(T value, ushort mask) 
macOS: Since Metal 2. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data from the thread whose quad lane ID is a bitwise XOR (^) of the caller’s quad lane ID and mask. The value of mask needs to be the same for all threads in a quad-group.</td></tr></tbody></table></center><br></div><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 6.17 - Quad-group reduction functions in the Metal standard library</strong></div><br><center style="max-width:90%"><table><thead><th>Built-in Quad-group Functions</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">quad_vote quad_active_threads_mask() 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns a quad_vote mask that represents the active threads. 

The function is equivalent to quad_ballot(true) and sets the bits that represent active threads to 1 and inactive threads to 0.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">bool quad_all(bool expr) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns true if all active threads evaluate expr to true.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_and(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the bitwise AND (&amp;) of data across all active threads in the quad-group and broadcasts the result to all active threads in the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">bool quad_any(bool expr) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns true if at least one active thread evaluates expr to true.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">bool quad_is_first() 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns true if the current thread is the first active thread — the active thread with the smallest index — in the current quad-group; otherwise false.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">bool quad_is_helper_thread() 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns true if the current thread is a helper thread; otherwise, false. You needs to call this function from a fragment function or another function that your fragment function calls; otherwise, it may trigger a compile-time error.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_max(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data with the highest value from across all active threads in the quad-group and broadcasts that value to all active threads in the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_min(T data) 
macOS: Since Metal 2.1.
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns data with the lowest value from across all active threads in the quad-group and broadcasts that value to all active threads in the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_or(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the bitwise OR (|) of data across all active threads in the quad-group and broadcasts the result to all active threads in the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_prefix_exclusive_product (T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">For a given thread, returns the product of the input values in data for all active threads with a lower index in the quad-group. For the first thread in the group, return T(1).</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_prefix_exclusive_sum (T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">For a given thread, returns the sum of the input values in data for all active threads with a lower index in the quad-group. For the first thread in the group, return T(0).</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_prefix_inclusive_product (T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">For a given thread, returns the product of the input values in data for all active threads with a lower or the same index in the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_prefix_inclusive_sum (T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">For a given thread, returns the sum of the input values in data for all active threads with a lower or the same index in the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_product(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the product of the input values in data across all active threads in the quad-group and broadcasts the result to all active threads in the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_sum(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the sum of the input values in data across all active threads in the quad-group and broadcasts the result to all active threads in the quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">T quad_xor(T data) 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">Returns the bitwise XOR (^) of data across all active threads in the quad-group and broadcasts the result to all active threads in the quad-group.</td></tr></tbody></table></center><br></div><p>在 kernel 函数中，四边形除以 SIMD-group。在片段函数中，通道 ID 表示 2 x 2 四边形中的片段位置：</p><ul><li>泳道 ID 0 是左上像素</li><li>泳道 ID 1 是右上像素</li><li>泳道 ID 2 是左下像素</li><li>泳道 ID 3 是右下像素</li></ul><p>为了演示随机播放功能，请从该 quad-group 的初始状态开始：</p><table><thead><tr><th>Quad Lane ID</th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td>data</td><td>a</td><td>b</td><td>c</td><td>d</td></tr></tbody></table><p><code>quad_shuffle_up()</code> 函数将每个 Quad-group 向上移动 <code>delta</code> 线程。例如，当 <code>delta</code> 值为 <code>2</code> 时，函数：</p><ul><li>将四通道 ID 下移两位</li><li>将下面的两个通道标记为无效</li></ul><table><thead><tr><th>Quad Lane ID</th><th>2</th><th>-1</th><th>0</th><th>1</th></tr></thead><tbody><tr><td>valid</td><td>0</td><td>0</td><td>1</td><td>1</td></tr><tr><td>data</td><td>a</td><td>b</td><td>a</td><td>b</td></tr></tbody></table><p><code>quad_shuffle_up()</code> 函数是一个非包装操作，不会影响较低的 <code>delta</code> 通道。</p><p>类似地，<code>quad_shuffle_down()</code> 函数将每个 Quad-group 向下移动 <code>delta</code> 线程。从相同的初始 Quad-group 状态开始，<code>delta</code> 为 <code>2</code> ，函数：</p><ul><li>将四通道 ID 向上移动两位</li><li>将上面的两个通道标记为无效</li></ul><table><thead><tr><th>Computed Quad Lane ID</th><th>2</th><th>3</th><th>4</th><th>5</th></tr></thead><tbody><tr><td>valid</td><td>1</td><td>1</td><td>0</td><td>0</td></tr><tr><td>data</td><td>c</td><td>d</td><td>c</td><td>d</td></tr></tbody></table><p><code>quad_shuffle_down()</code> 函数是一个非包装操作，不会影响上部 <code>delta</code> 通道。</p><p>为了演示 shuffle-and-fill 函数，启动该 quad-group 的初始状态：</p><table><thead><tr><th>Computed Quad Lane ID</th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td>data</td><td>a</td><td>b</td><td>c</td><td>d</td></tr><tr><td>filling</td><td>fa</td><td>fb</td><td>fc</td><td>fd</td></tr></tbody></table><p><code>quad_shuffle_and_fill_up()</code> 函数通过 <code>delta</code> 线程向上移动每个 quad-group — <code>类似于 quad_shuffle_up()</code> — 并从上层分配值通过 <code>filling</code> 四通道 ID 将通道填充到较低的 <code>data</code> 通道。例如，当 <code>delta</code> 值为 <code>2</code> 时，函数：</p><ul><li>将四车道 ID 向下移动两位</li><li>将上两道 <code>filling</code> 分配给下两道 <code>data</code></li></ul><table><thead><tr><th>Computed Quad Lane ID</th><th>2</th><th>-1</th><th>0</th><th>1</th></tr></thead><tbody><tr><td>data</td><td>fc</td><td>fd</td><td>a</td><td>b</td></tr></tbody></table><p>带有模参数的 quad_shuffle_and_fill_up()函数将 quad-group 分割成向量，每个向量的大小都以模为模，并按增量线程移位每个向量。例如，模值为 2 且增量值为 1 时，该函数：</p><ul><li>将四通道 ID 下移一位 - 将填充中每个向量的上通道分配给数据中每个向量的下通道</li></ul><p><code>计算的四通道 ID - 1 0 - 1 0</code></p><p><code>数据 fb a fd c</code></p><p><code>quad_shuffle_and_fill_down()</code> 函数通过增量线程将每个 Quad-group 向下移动（类似于 <code>quad_shuffle_down()</code>），并通过包装四通道 ID 将较低 <code>filling</code> 通道中的值分配给较高 <code>data</code> 通道。例如，当 <code>delta</code> 值为 <code>2</code> 时，函数：</p><ul><li>将四通道 ID 向上移动两位</li><li>将下面两个 <code>filling</code> 通道分配给上面两个 <code>data</code> 通道</li></ul><table><thead><tr><th>Computed Quad Lane ID</th><th>2</th><th>3</th><th>4</th><th>5</th></tr></thead><tbody><tr><td>data</td><td>c</td><td>d</td><td>fa</td><td>fb</td></tr></tbody></table><p>带有模参数的 <code>quad_shuffle_and_fill_down()</code> 函数将 quad-group 分割成向量，每个向量 with size <code>modulo</code>，并按 <code>delta</code> 线程移位每个向量。例如，<code>modulo</code> 为 <code>2</code> 且 <code>delta</code> 值为 <code>1</code> 时，该函数：</p><ul><li>将四通道 ID 上移一位</li><li>将 <code>filling</code> 中每个向量的下通道分配给 <code>data</code> 中每个向量的上通道</li></ul><table><thead><tr><th>Computed Quad Lane ID</th><th>1</th><th>2</th><th>1</th><th>2</th></tr></thead><tbody><tr><td>data</td><td>b</td><td>fa</td><td>d</td><td>fc</td></tr></tbody></table><p><code>quad_ballot</code> 函数使用 <code>quad_vote</code> 包装类型，可以显式转换为其基础类型。（在以下示例中，请注意使用 <code>vote_t</code> 来表示基础类型 <code>XXX</code>。）</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">quad_vote</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">typedef</span><span class="token plain"> XXX vote_t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">explicit</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">quad_vote</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">vote_t v </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">explicit</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">operator</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">vote_t</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Returns true if all bits corresponding to threads in the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// quad-group (the four bottom bits) are set.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Returns true if any bit corresponding to a thread in the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// quad-Group is set.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>quad_vote</code> 构造函数屏蔽了顶部位（即，底部四个位除外）。因此，当投射到 <code>vote_t</code> 时，非底部四位保证不会被设置。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zhuanghongji/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions/index.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2023-10-31T08:31:31.000Z">2023年10月31日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/swift-tutorials-cn/docs/metal-shading-language-specification/geometric-functions"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">几何函数</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/swift-tutorials-cn/docs/metal-shading-language-specification/graphics-functions"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">图形函数</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#线程组和-simd-group-同步函数" class="table-of-contents__link toc-highlight">线程组和 SIMD-group 同步函数</a></li><li><a href="#simd-group-函数" class="table-of-contents__link toc-highlight">SIMD-group 函数</a><ul><li><a href="#示例" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#quad-group-函数" class="table-of-contents__link toc-highlight">Quad-group 函数</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://developer.apple.com/xcode/swiftui/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI Overview</a></li><li class="footer__item"><a href="https://developer.apple.com/documentation/swiftui/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI Documentation</a></li><li class="footer__item"><a href="https://developer.apple.com/videos/swiftui-ui-frameworks" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI &amp; UI Frameworks Videos</a></li><li class="footer__item"><a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/" target="_blank" rel="noopener noreferrer" class="footer__link-item">The Swift Programming Language</a></li></ul></div><div class="col footer__col"><div class="footer__title">参考</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.fatbobman.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Fatbob Man</a></li><li class="footer__item"><a href="https://designcode.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Design Code</a></li><li class="footer__item"><a href="https://www.swiftanytime.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Swift Anytime</a></li><li class="footer__item"><a href="https://www.hackingwithswift.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Hacking With Swift</a></li></ul></div><div class="col footer__col"><div class="footer__title">探索</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/@Kavsoft" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kavsoft</a></li><li class="footer__item"><a href="https://www.youtube.com/@ChaoCode" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chao Code</a></li><li class="footer__item"><a href="https://www.youtube.com/@iOSAcademy" target="_blank" rel="noopener noreferrer" class="footer__link-item">iOS Academy</a></li><li class="footer__item"><a href="https://www.youtube.com/@XCA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Xcoding with Alfian</a></li></ul></div><div class="col footer__col"><div class="footer__title">发现</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/swift-tutorials-cn/sponsor-me">Sponsor Me</a></li><li class="footer__item"><a class="footer__link-item" href="/swift-tutorials-cn/sponsor-list">Sponsor List</a></li><li class="footer__item"><a href="https://twitter.com/ajizhhans" target="_blank" rel="noopener noreferrer" class="footer__link-item">Follow Twitter</a></li><li class="footer__item"><a href="https://github.com/zhuanghongji" target="_blank" rel="noopener noreferrer" class="footer__link-item">Follow GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ZHUANGHONGJI<br><a style="font-size: 12px;color: white;" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0) License</a></div></div></div></footer></div>
<script src="/swift-tutorials-cn/assets/js/runtime~main.e8a3ce7b.js"></script>
<script src="/swift-tutorials-cn/assets/js/main.521b0f3d.js"></script>
</body>
</html>