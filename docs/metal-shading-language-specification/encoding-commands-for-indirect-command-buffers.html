<!doctype html>
<html lang="zh-hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-metal-shading-language-specification/encoding-commands-for-indirect-command-buffers/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">间接命令缓冲区的编码命令 | Swift 悍刀行</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/encoding-commands-for-indirect-command-buffers"><meta data-rh="true" name="docusaurus_locale" content="zh-hans"><meta data-rh="true" name="docsearch:language" content="zh-hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="间接命令缓冲区的编码命令 | Swift 悍刀行"><meta data-rh="true" name="description" content="间接命令缓冲区 (ICB) 支持将 Metal 命令编码到 Metal 缓冲区中以供重复使用。稍后，你可以将这些编码的命令提交给 CPU 或 GPU 执行。渲染和计算命令的 ICB 使用 command_buffer 类型将命令编码到 ICB 对象中（在 Metal 框架中由 MTLIndirectCommandBuffer 表示）："><meta data-rh="true" property="og:description" content="间接命令缓冲区 (ICB) 支持将 Metal 命令编码到 Metal 缓冲区中以供重复使用。稍后，你可以将这些编码的命令提交给 CPU 或 GPU 执行。渲染和计算命令的 ICB 使用 command_buffer 类型将命令编码到 ICB 对象中（在 Metal 框架中由 MTLIndirectCommandBuffer 表示）："><link data-rh="true" rel="icon" href="/swift-tutorials-cn/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/encoding-commands-for-indirect-command-buffers"><link data-rh="true" rel="alternate" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/encoding-commands-for-indirect-command-buffers" hreflang="zh-hans"><link data-rh="true" rel="alternate" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/encoding-commands-for-indirect-command-buffers" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/swift-tutorials-cn/blog/rss.xml" title="Swift 悍刀行 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/swift-tutorials-cn/blog/atom.xml" title="Swift 悍刀行 Atom Feed"><link rel="stylesheet" href="/swift-tutorials-cn/assets/css/styles.a7cf13f8.css">
<link rel="preload" href="/swift-tutorials-cn/assets/js/runtime~main.5bdca63d.js" as="script">
<link rel="preload" href="/swift-tutorials-cn/assets/js/main.0cbf57d5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/swift-tutorials-cn/"><div class="navbar__logo"><img src="/swift-tutorials-cn/img/logo.svg" alt="Swift 悍刀行" class="themedImage_ToTc themedImage--light_HNdA"><img src="/swift-tutorials-cn/img/logo.svg" alt="Swift 悍刀行" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Swift 悍刀行</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swift/welcome/about">Swift</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swiftui/essentials/about">SwiftUI</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swiftcharts/essentials/about">SwiftCharts</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swiftdata/essentials/about">SwiftData</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Frameworks</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/core-graphics/overview">Core Graphics</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metal/overview">Metal</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metalkit/overview">MetalKit</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Books</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metal-programming-guide/introdution">Metal Programming Guide</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">Metal Shading Language Specification 3.1</a></li></ul></div><a href="https://github.com/zhuanghongji/swift-tutorials-cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Metal Shading Language 规范</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">前言</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">前言</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/purpose-of-this-document">介绍</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/purpose-of-this-document">本文档的目的</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/organization-of-this-specification">本规范的组织</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/references">参考文献</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/metal-and-cpp14">Metal 和 C++14</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/compiler-and-preprocessor">编译器和预处理器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/metal-coordinate-systems">Metal 坐标系</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-data-types">数据类型</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-data-types">标量数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/vector-data-types">向量数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/matrix-data-types">矩阵数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/simd-group-matrix-data-types">SIMD 组矩阵数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/alignment-of-data-types">数据类型的对齐</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/atomic-data-types">原子数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/pixel-data-types">像素数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/buffers">缓冲区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/textures">纹理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/samplers">采样器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/imageblocks">图像块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/aggregate-types">聚合类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/argument-buffers">参数缓冲区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/uniform-type">统一类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/visible-function-table">可见函数表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/function-group-attribute">功能组属性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/ray-tracing-types">光线追踪类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/interpolant-type">插值类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/mesh-shader-types">网格着色器类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/type-conversions-and-re-interpreting-data">类型转换和重新解释数据</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/implicit-type-conversions">隐式类型转换</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-and-vector-operators">运算符</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-and-vector-operators">标量和向量运算符</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/matrix-operators">矩阵运算符</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/device-address-space">地址空间</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/device-address-space">设备地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/constant-address-space">常量地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/thread-address-space">线程地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/threadgroup-address-space">线程组地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/threadgroup-imageblock-address-space">threadgroup_imageblock 地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/ray-data-address-space">ray_data 地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/object-data-address-space">object_data 地址空间</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/functions">函数与变量声明</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/functions">函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables">函数参数和变量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/storage-class-specifiers">存储类说明符</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/sampling-and-interpolation-attributes">采样和插值属性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/per-fragment-function-versus-per-sample-function">每片段函数与每样本函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/imageblock-attributes">图像块属性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/graphics-function-signature-matching">图形功能 - 签名匹配</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/program-scope-function-constants">程序作用域函数常量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/program-scope-global-built-ins">程序范围全局内置函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/per-primitive-viewport-and-scissor-rectangle-index-selection">每个图元视口和剪刀矩形索引选择</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/additional-restrictions">附加限制</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/namespace-and-header-files">Metal 标准库</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/namespace-and-header-files">命名空间和头文件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/common-functions">常用函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/integer-functions">整数函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/relational-functions">关系函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/math-functions">数学函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/matrix-functions">矩阵函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/simd-group-matrix-functions">SIMD 组矩阵函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/geometric-functions">几何函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions">同步和 SIMD 组功能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/graphics-functions">图形函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/pull-model-interpolation">拉模型插值</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/texture-functions">纹理函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/imageblock-functions">图像块函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/pack-and-unpack-functions">打包和解包函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/atomic-functions">原子函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/encoding-commands-for-indirect-command-buffers">间接命令缓冲区的编码命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/variable-rasterization-rate">可变光栅化率</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/ray-tracing-functions">光线追踪函数</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/inf-nan-and-denormalized-numbers">数值符合性</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/inf-nan-and-denormalized-numbers">INF、NaN 和非规范化数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/rounding-mode">舍入模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/floating-point-exceptions">浮点异常</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/relative-error-as-ulps">作为 ULP 的相对误差</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/edge-case-behavior-in-flush-to-zero-mode">清零模式下的边缘情况行为</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/conversion-rules-for-floating-point-and-integer-types">浮点型和整数型的转换规则</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/texture-addressing-and-conversion-rules">纹理寻址和转换规则</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/swift-tutorials-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Metal Shading Language 规范</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Metal 标准库</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">间接命令缓冲区的编码命令</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>间接命令缓冲区的编码命令</h1><div style="padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;border-radius:0.5rem;background-color:#333333">原文：6.16 Encoding Commands for Indirect Command Buffers</div><br><p>间接命令缓冲区 (ICB) 支持将 Metal 命令编码到 Metal 缓冲区中以供重复使用。稍后，你可以将这些编码的命令提交给 CPU 或 GPU 执行。渲染和计算命令的 ICB 使用 command_buffer 类型将命令编码到 ICB 对象中（在 Metal 框架中由 MTLIndirectCommandBuffer 表示）：</p><p>结构体 command_buffer {</p><p>size_t size() 常量；</p><p>};</p><p>ICB 可以包含渲染或计算命令，但不能同时包含两者。从渲染编码器执行计算命令是非法的。从计算编码器执行渲染命令也是如此。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6161-在间接命令缓冲区中编码渲染命令">6.16.1 在间接命令缓冲区中编码渲染命令<a href="#6161-在间接命令缓冲区中编码渲染命令" class="hash-link" aria-label="6.16.1 在间接命令缓冲区中编码渲染命令的直接链接" title="6.16.1 在间接命令缓冲区中编码渲染命令的直接链接">​</a></h2><p>所有操作系统：自 Metal 2.1 起支持渲染命令的间接命令缓冲区。</p><p>ICB 允许将绘制命令编码到 Metal 缓冲区中，以便随后在 GPU 上执行。</p><p>在着色语言函数中，使用 command_buffer 类型将 ICB 的命令编码到 Metal 缓冲区对象中，该对象提供对 render_command 结构的索引访问。</p><p>结构参数 {</p><p>命令缓冲区 cmd_buffer；</p><p>};</p><p>内核无效生产者（设备参数&amp;args，</p><p>ushort cmd_idx [<!-- -->[网格中的线程位置]<!-- -->])</p><p>{</p><p>render_command cmd(args.cmd_buffer, cmd_idx);</p><p>...</p><p>}</p><p>render_command 可以对任何绘制命令类型进行编码。以下 render_command 的公共接口在头文件 中定义。要将 render_pipeline_state 对象传递给着色器，请使用参数缓冲区。在参数缓冲区内，管道状态可以作为标量或数组传递。</p><p>set_render_pipeline_state(...) 和渲染管道状态自 Metal 2.1 起在 macOS 上可用，自 Metal 2.2 起在 iOS 上可用。</p><p>枚举类 primitive_type {点，线，line_strip，三角形，triangle_strip};</p><p>struct render_command { public: 显式 render_command(command_buffer icb, unsigned cmd_index);无效 set_render_pipeline_state(render_pipeline_state pipeline_state);</p><p>template &lt;typename T ...&gt; void set_vertex_buffer(device T <em>buffer, uint index); template &lt;typename T ...&gt; void set_vertex_buffer(constant T </em>buffer, uint index);</p><p>// Metal 3.1：支持传递顶点步幅 template void set_vertex_buffer(device T <em>buffer, size_t stride, uint index); template void set_vertex_buffer(constant T </em>buffer, size_t stride, uint index);</p><p>template &lt;typename T ...&gt; void set_fragment_buffer(device T <em>buffer, uint index); template &lt;typename T ...&gt; void set_fragment_buffer(constant T </em>buffer, uint index);</p><p>void draw_primitives(primitive_type type, uint vertex_start, uint vertex_count, uint instance_count, uint base_instance);</p><p>// 基于 index_buffer 重载 draw_indexed_primitives void draw_indexed_primitives(primitive_type type, uint index_count, device ushort <!-- -->*<!-- -->index_buffer,</p><p>uint 实例计数、uint 基础顶点、uint 基础实例）；</p><p>void draw_indexed_primitives(primitive_type type, uint index_count, device uint <!-- -->*<!-- -->index_buffer, uint instance_count, uint base_vertex, uint base_instance);</p><p>voiddraw_indexed_primitives(primitive_type 类型，uintindex_count，常量 ushort<!-- -->*<!-- -->index_buffer，uintinstance_count，uintbase_vertex，uintbase_instance);</p><p>voiddraw_indexed_primitives(primitive_type 类型，uintindex_count，常量 uint<!-- -->*<!-- -->index_buffer，uintinstance_count，uintbase_vertex，uintbase_instance);</p><p>// 基于 patch_index_buffer 和 // tessellation_factor_buffer 重载 draw_patches void draw_patches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, uint instance_count, uint base_instance, const device MTLQuadTessellationFactorsHalf </em>tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_patches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, uint instance_count, uint base_instance, const device MTLTriangleTessellationFactorsHalf </em>tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_patches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <!-- -->*<!-- -->patch_index_buffer,</p><p>uint instance_count，uint base_instance，常量 MTLQuadTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer，uint instance_stride = 0);</p><p>void draw_patches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, uint instance_count, uint base_instance, 常量 MTLTriangleTessellationFactorsHalf </em>tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_patches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, uint instance_count, uint base_instance, const device MTLQuadTessellationFactorsHalf </em>tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_patches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, uint instance_count, uint base_instance, const device MTLTriangleTessellationFactorsHalf </em>tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_patches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, uint instance_count, uint base_instance, 常量 MTLQuadTessellationFactorsHalf </em>tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_patches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, uint instance_count, uint base_instance, 常量 MTLTriangleTessellationFactorsHalf </em>tessellation_factor_buffer, uint instance_stride = 0);</p><p>// 基于 patch_index_buffer 重载 draw_indexed_pa​​tches，</p><p>// control_point_index_buffer 和 tessellation_factor_buffer</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, const device void </em>control_point_index_buffer, uint instance_count, uint base_instance, const device MTLQuadTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, const device void </em>control_point_index_buffer, uint instance_count, uint base_instance, const device MTLTriangleTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, const device void </em>control_point_index_buffer, uint instance_count, uint base_instance, 常量 MTLQuadTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, const device void </em>control_point_index_buffer, uint instance_count, uint base_instance, 常量 MTLTriangleTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, 常量 void </em>control_point_index_buffer, uint instance_count, uint base_instance, const device MTLQuadTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points,</p><p>uint patch_start，uint patch_count，常量设备 uint <em>patch_index_buffer，常量 void </em>control_point_index_buffer，uint instance_count，uint base_instance，常量设备 MTLTriangleTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer，uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, 常量 void </em>control_point_index_buffer, uint instance_count, uint base_instance, 常量 MTLQuadTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, const device uint <em>patch_index_buffer, 常量 void </em>control_point_index_buffer, uint instance_count, uint base_instance, 常量 MTLTriangleTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, const device void </em>control_point_index_buffer, uint instance_count, uint base_instance, const device MTLQuadTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, const device void </em>control_point_index_buffer, uint instance_count, uint base_instance, const device MTLTriangleTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, const device void </em>control_point_index_buffer,</p><p>uint instance_count，uint base_instance，常量 MTLQuadTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer，uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, const device void </em>control_point_index_buffer, uint instance_count, uint base_instance, 常量 MTLTriangleTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, 常量 void </em>control_point_index_buffer, uint instance_count, uint base_instance, const device MTLQuadTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, 常量 void </em>control_point_index_buffer, uint instance_count, uint base_instance, const device MTLTriangleTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, 常量 void </em>control_point_index_buffer, uint instance_count, uint base_instance, 常量 MTLQuadTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>void draw_indexed_pa​​tches(uint number_of_patch_control_points, uint patch_start, uint patch_count, 常量 uint <em>patch_index_buffer, 常量 void </em>control_point_index_buffer, uint instance_count, uint base_instance, 常量 MTLTriangleTessellationFactorsHalf <!-- -->*<!-- -->tessellation_factor_buffer, uint instance_stride = 0);</p><p>// 重置整个命令。在 reset()之后，如果没有进一步修改，执行该命令将不会执行任何操作。无效重置（）；</p><p>// 将 <code>source</code> 命令的内容复制到此命令中。无效 copy_command（render_command 源）； };</p><p>当访问 command_buffer 时，Metal 不会检查访问是否在范围内。如果访问超出缓冲区的容量，则行为未定义。</p><p>render_command 中公开的方法镜像了 MTLIndirectRenderCommand 的接口，并且与 MTLRenderCommandEncoder 类似。与 MTLRenderCommandEncoder 的显着差异是：</p><ul><li>对 render_command 中的 draw<!-- -->*<!-- --> 方法的调用对命令所采取的操作进行编码。如果多次调用，则只有最后一次调用有效。- 曲面细分参数直接在 render_command::draw_patches 和 render_command::draw_indexed_pa​​tches 中传递。其他调用不会设置曲面细分参数。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6162-在间接命令缓冲区中编码计算命令">6.16.2 在间接命令缓冲区中编码计算命令<a href="#6162-在间接命令缓冲区中编码计算命令" class="hash-link" aria-label="6.16.2 在间接命令缓冲区中编码计算命令的直接链接" title="6.16.2 在间接命令缓冲区中编码计算命令的直接链接">​</a></h2><p>iOS：自 Metal 2.2 起支持计算命令的间接命令缓冲区。</p><p>macOS：自 Metal 2.3 起支持计算命令的间接命令缓冲区。</p><p>ICB 允许将调度命令编码到 Metal 缓冲区中，以便随后在 GPU 上执行。</p><p>在着色语言函数中，使用 command_buffer 类型将 ICB 的命令编码到 Metal 缓冲区对象中，该对象提供对 compute_command 结构的索引访问。</p><p>结构体参数 { command_buffer cmd_buffer; }; [<!-- -->[kernel]<!-- -->] void Producer（设备参数 &amp;args，ushort cmd_idx [<!-- -->[thread_position_in_grid]<!-- -->]）{compute_command cmd（args.cmd_buffer，cmd_idx）; ... }</p><p>compute_command 可以对任何调度命令类型进行编码。头文件中定义了 compute_command 的以下公共接口。compute_pipeline_state 类型表示计算管道状态，只能是</p><p>通过参数缓冲区传递给着色器。在参数缓冲区内，管道状态可以作为标量或数组传递。</p><p>structcompute_command { public: 显式 compute_command(command_buffer icb, unsigned cmd_index);</p><p>无效 set_compute_pipeline_state（compute_pipeline_state 管道）；</p><p>template &lt;typename T ...&gt; void set_kernel_buffer(device T <em>buffer, uint index); template &lt;typename T ...&gt; void set_kernel_buffer(constant T </em>buffer, uint index);</p><p>// Metal 3.1：支持传递内核步长模板 void set_kernel_buffer(device T <em>buffer, size_t stride, uint index); template void set_kernel_buffer(constant T </em>buffer, size_t stride, uint index);</p><p>无效 set_barrier();无效 clear_barrier();</p><p>无效并发<!-- -->_<!-- -->dispatch_threadgroups（uint3 threadgroups_per_grid，uint3threads_per_threadgroup）;无效并发<!-- -->_<!-- -->dispatch_threads（uint3threads_per_grid，uint3threads_per_threadgroup）；</p><p>void set_threadgroup_memory_length(uint 长度, uint 索引); void set_stage_in_region(uint3 原点，uint3 大小);</p><p>// 重置整个命令。在 reset()之后，如果没有进一步修改，执行该命令将不会执行任何操作。无效重置（）；</p><p>// 将 <code>source</code> 命令的内容复制到此命令中。void copy_command(compute_command 源); };</p><p>当访问 command_buffer 时，Metal 不会检查访问是否在范围内。如果访问超出缓冲区的容量，则行为未定义。</p><p>compute_command 中公开的方法镜像了 MTLIndirectComputeCommand 的接口，并且与 MTLComputeCommandEncoder 类似。</p><p>在 ICB 中，调度始终是并发的。对 compute_command 中的 concurrent_dispatch<!-- -->*<!-- --> 方法的调用对命令所采取的操作进行编码。如果多次调用，则只有最后一次调用有效。</p><p>应用程序负责在需要的地方设置障碍。ICB 中编码的屏障不会影响父编码器。</p><p>在将 command_buffer 作为参数传递给着色器之前，CPU 可能已经初始化了 command_buffer 内的各个命令。如果 CPU 尚未初始化命令，则必须在使用该命令之前重置该命令。</p><p><strong>6.16.3 复制间接命令缓冲区的命令</strong></p><p>通过 operator=复制命令结构（render_command 或 compute_command）不会复制命令的内容，而只会使目标命令指向与源命令相同的缓冲区和索引。要复制命令的内容，请调用第 6.16.1 和 6.16.2 节中列出的 copy_command 函数。</p><p>仅支持在指向兼容命令缓冲区的命令之间进行复制。仅当两个命令缓冲区具有匹配的 ICB 描述符（MTLIndirectCommandBufferDescriptor 对象）时，它们才是兼容的。命令本身还必须引用缓冲区内的有效索引。以下示例说明使用 copy_command 将渲染命令的内容从 cmd0 复制到 cmd1：</p><p>结构体参数 { command_buffer cmd_buffer; render_pipeline_state pipeline_state_0; render_pipeline_state pipeline_state_1; };</p><p>[<!-- -->[kernel]<!-- -->] void Producer(设备参数 &amp;args) { render_command cmd0(args.cmd_buffer, 0); render_command cmd1(args.cmd_buffer, 1); cmd0.set_render_pipeline_state(args.pipeline_state_0);</p><p>// 使索引 1 处的命令指向索引 0 处的命令。cmd1 = cmd0;</p><p>// 更改缓冲区中索引 0 处的命令的管道状态。cmd1.set_render_pipeline_state(args.pipeline_state_0);</p><p>// 缓冲区中索引 1 处的命令尚未修改。cmd1 = render_command(args.cmd_buffer, 1);</p><p>// 将索引 0 处的命令内容复制到索引 1 处的命令。cmd1.copy_command(cmd0); }</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zhuanghongji/swift-tutorials-cn/docs/metal-shading-language-specification/encoding-commands-for-indirect-command-buffers/index.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2023-08-28T00:28:04.000Z">2023年8月28日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/swift-tutorials-cn/docs/metal-shading-language-specification/atomic-functions"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">原子函数</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/swift-tutorials-cn/docs/metal-shading-language-specification/variable-rasterization-rate"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">可变光栅化率</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#6161-在间接命令缓冲区中编码渲染命令" class="table-of-contents__link toc-highlight">6.16.1 在间接命令缓冲区中编码渲染命令</a></li><li><a href="#6162-在间接命令缓冲区中编码计算命令" class="table-of-contents__link toc-highlight">6.16.2 在间接命令缓冲区中编码计算命令</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://developer.apple.com/xcode/swiftui/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI Overview</a></li><li class="footer__item"><a href="https://developer.apple.com/documentation/swiftui/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI Documentation</a></li><li class="footer__item"><a href="https://developer.apple.com/videos/swiftui-ui-frameworks" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI &amp; UI Frameworks Videos</a></li><li class="footer__item"><a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/" target="_blank" rel="noopener noreferrer" class="footer__link-item">The Swift Programming Language</a></li></ul></div><div class="col footer__col"><div class="footer__title">参考</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.fatbobman.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Fatbob Man</a></li><li class="footer__item"><a href="https://designcode.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Design Code</a></li><li class="footer__item"><a href="https://www.swiftanytime.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Swift Anytime</a></li><li class="footer__item"><a href="https://www.hackingwithswift.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Hacking With Swift</a></li></ul></div><div class="col footer__col"><div class="footer__title">探索</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/@Kavsoft" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kavsoft</a></li><li class="footer__item"><a href="https://www.youtube.com/@ChaoCode" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chao Code</a></li><li class="footer__item"><a href="https://www.youtube.com/@iOSAcademy" target="_blank" rel="noopener noreferrer" class="footer__link-item">iOS Academy</a></li><li class="footer__item"><a href="https://www.youtube.com/@XCA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Xcoding with Alfian</a></li></ul></div><div class="col footer__col"><div class="footer__title">发现</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/swift-tutorials-cn/sponsor-me">Sponsor Me</a></li><li class="footer__item"><a class="footer__link-item" href="/swift-tutorials-cn/sponsor-list">Sponsor List</a></li><li class="footer__item"><a href="https://twitter.com/ajizhhans" target="_blank" rel="noopener noreferrer" class="footer__link-item">Follow Twitter</a></li><li class="footer__item"><a href="https://github.com/zhuanghongji" target="_blank" rel="noopener noreferrer" class="footer__link-item">Follow GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ZHUANGHONGJI<br><a style="font-size: 12px;color: white;" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0) License</a></div></div></div></footer></div>
<script src="/swift-tutorials-cn/assets/js/runtime~main.5bdca63d.js"></script>
<script src="/swift-tutorials-cn/assets/js/main.0cbf57d5.js"></script>
</body>
</html>