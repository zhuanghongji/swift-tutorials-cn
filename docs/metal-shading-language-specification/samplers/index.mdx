# 采样器

<OrigninalPDF title="2.10 Samplers" />

采样器类型标识如何对纹理进行采样。Metal API 允许你创建采样器对象并将其作为参数传递给图形或内核函数。你可以在程序源中而不是在 API 中描述采样器对象。对于这些情况，你只能指定采样器状态的子集：寻址模式、过滤模式、标准化坐标和比较函数。

表 2. 7 列出了支持的采样器状态枚举及其关联值（和默认值）。当采样器在 Metal 程序源中初始化时，你可以指定这些状态。

## 表 2.7。采样器状态枚举值

`枚举有效值描述`

`坐标归一化（默认）像素`

``` 当从纹理采样时，指定纹理坐标是否为标准化值。````

`` 地址重复mirrored_repeat 钳位到边缘（默认）钳位到零钳位到边界`

``` 设置所有纹理坐标的寻址模式。````

`枚举有效值描述`

`s_address t_address r_address`

`` 重复镜像_重复钳位到边缘（默认）钳位到零钳位到边界`

`` 设置单个纹理坐标的寻址模式。````

``` border_color macOS：Metal 1 .2。iOS：Metal 2.3。````

`透明_黑色（默认）不透明_黑色不透明_白色`

``` 指定与 clamp_to_border 寻址模式一起使用的边框颜色。````

`过滤最近（默认）线性`

``` 设置纹理采样的放大和缩小过滤模式。````

`mag_filter 最近（默认）线性`

``` 设置纹理采样的放大过滤模式。````

`min_filter 最接近（默认）线性`

``` 设置纹理采样的缩小过滤模式。````

`mip_filter 无（默认）最接近的线性`

` 设置纹理采样的 mipmap 过滤模式。如果没有，则对纹理进行采样，就好像它具有单个 mip 级别一样。所有样本均从级别 0 读取。`

`compare_func 从不（默认） less less_equal 更大greater_equal 等于 not_equal 始终 `

``` 设置 sample_compare 和 gather_compare 纹理函数使用的比较测试。````

macOS：从 Metal 1.2 开始支持 lamp_to_border 地址模式和 border_color。

iOS：从 Metal 2.3 开始支持 Clip_to_border 地址模式或 border_color。

使用 clamp_to_border，在纹理外部采样仅使用纹理坐标的边框颜色（并且不使用纹理边缘的任何颜色）。如果地址模式为 clamp_to_border，则 border_color 有效。

钳位到零相当于钳位到边界，其边框颜色为透明黑色（0.0，0.0，0.0），并且具有来自纹理的 alpha 分量值。如果 clamp_to_zero 是一个或多个纹理坐标的地址模式，则当边框颜色为 transparent_black 时，其它纹理坐标可以使用 clamp_to_border 的地址模式。否则，行为是未定义的。

如果 coord 设置为 Pixel，则 min_filter 和 mag_filter 值必须相同，mip_filter 值必须为 none，并且地址模式必须为钳位到零、钳位到边界或钳位到边缘。

除了枚举类型之外，你还可以指定采样器的最大各向异性过滤和 LOD（细节级别）范围：

max_anisotropy（整数值）

lod_clamp（浮动最小值，浮动最大值）

以下 Metal 程序源说明了声明采样器的几种方法。（下面代码中出现的 Sampler(n) 属性在第 5.2.1 节中进行了解释。）请注意，程序源中声明的采样器或常量缓冲区不需要这些属性限定符。你必须使用 constexpr 来声明在 MSL 源代码中初始化的采样器。

constexpr 采样器 s(坐标::像素, 地址::clamp_to_zero, 过滤器::线性);

constexpr 采样器 a(coord::归一化);

constexpr 采样器 b(地址::重复);

constexpr 采样器 s(地址::clamp_to_zero, 过滤器::线性, Compare_func::less);

constexpr 采样器 s(地址::clamp_to_zero、过滤器::线性、compare_func::less、max_anisotropy(10)、lod_clamp(0.0f、MAXFLOAT));

kernel void my_kernel(device float4 \*p [[buffer(0)]],texture2d img [[texture(0)]],采样器 smp [[sampler(3)]], ...) {

}
