## 6.5 数学函数

表 6. 4 中的数学函数在头文件 中定义。 T 是标量或半向量或浮点浮点类型之一。 Ti 仅指标量或向量整数类型。

## 表 6.4。 Metal 标准库中的数学函数

`内置数学函数说明`

``` T acos(T x) 计算 x 的反余弦。 ````

``` T acosh(T x) 计算 x 的反双曲余弦。 ````

``2023 - 06 - 02 |版权所有 © 2023 苹果公司 |版权所有。 ````

**内置数学函数说明**

T asin(T x) 计算 x 的反正弦函数。

T asinh(T x) 计算 x 的反双曲正弦。

Tatan(T y_over_x) 计算 x 的反正切。

Tatan2(T y, T x) 计算 y 对 x 的反正切。

Tatanh(T x) 计算 x 的双曲反正切。

T ceil(T x) 使用舍入到正无穷大舍入模式将 x 舍入到整数值。

T copysign(T x, T y) 返回 x，其符号更改为与 y 的符号匹配。

T cos(T x) 计算 x 的余弦。

T cosh(T x) 计算 x 的双曲余弦。

T cospi(T x) 计算 cos(!x)。

T div(T x, T y) 计算 x / y。

T exp(T x) 以 e 为底的指数函数。

T exp2(T x) 以 2 为底的指数函数。

T exp10(T x) 以 10 为底的指数函数。

T fabs(T x) T 绝对值(T x)

``` 计算浮点数的绝对值。 ````

T fdim(T x, T y) x – y 如果 x > y；如果 x <= y，则 +0。

T Floor(T x) 使用舍入到负无穷大舍入模式将 x 舍入到整数值。

T fma(T a, T b, T c) 返回 c 与 a 和 b 的无限精确乘积之和的正确舍入浮点表示形式。中间产品不得四舍五入。边缘情况行为符合 IEEE 754 - 2008 标准。

T fmax(T x, T y) T 最大(T x, T y)

``` 如果 x < y，则返回 y，否则返回 x。如果一个参数为 NaN，则 fmax() 返回另一个参数。如果两个参数均为 NaN，则 fmax() 返回 NaN。如果 x 和 y 是非正规数且 GPU 不支持非正规数，则可能会返回任一值。 ````

``2023 - 06 - 02 |版权所有 © 2023 苹果公司 |版权所有。 ````

**内置数学函数说明**

T fmax3(T x, T y, T z) T max3(T x, T y, T z) 所有操作系统：自 Metal 2.1 起。

``` 返回 fmax(x, fmax(y, z))。 ````

T fmedian3(T x, T y, T z) 所有操作系统：自 Metal 1 起。 T Median3(T x, T y, T z) 所有操作系统：自 Metal 2.1 起。

``` 返回 x、y 和 z 的中间值。 （如果一个或多个值为 NaN，请参阅此表后面的讨论。）````

T fmin(T x, T y) T min(T x, T y)

``` 如果 y < x，则返回 y，否则返回 x。如果一个参数为 NaN，则 fmin() 返回另一个参数。如果两个参数均为 NaN，则 fmin() 返回 NaN。如果 x 和 y 是非正规数且 GPU 不支持非正规数，则可能会返回任一值。 ````

T fmin3(T x, T y, T z) T min3(T x, T y, T z) 所有操作系统：自 Metal 2 .1 起。

``` 返回 fmin(x, fmin(y, z))。 ````

T fmod(T x, T y) 返回 x – y \* trunc(x/y)。

T fract(T x) 返回 x 大于或等于 0 或小于 1 的小数部分。

T frexp(T x, Ti &指数)

``` 从 x 中提取尾数和指数。对于每个分量，返回的尾数是一个浮点数，其大小在区间 [1/2, 1) 或 0 中。 x 的每个分量等于返回的尾数 \* 2exp。 ````

Ti ilogb(T x) 以整数值形式返回指数。

T ldexp(T x, Ti k) 将 x 乘以 2 的 k 次方。

T log(T x) 计算 x 的自然对数。

T log2(T x) 计算 x 以 2 为底的对数。

T log10(T x) 计算 x 以 10 为底的对数。

T modf(T x, T &intval) 分解浮点数。 modf 函数将参数 x 分为整数部分和小数部分，每个部分与参数具有相同的符号。返回小数值。整数值以 intval 形式返回。

T nextafter(T x, T y) 自金属 3. 1.

``` 返回 x 之后 y 方向上的下一个可表示的浮点值。如果 x 等于 y，则返回````

``2023 - 06 - 02 |版权所有 © 2023 苹果公司 |版权所有。 ````

`内置数学函数说明`

`` y。请注意，如果 x 和 y 都表示浮点零值，则结果的符号为 y。如果 x 或 y 为 NaN，则返回 NaN。 ````

``` T pow(T x, T y) 计算 x 的 y 次方。 ````

`T powr(T x, T y) 计算 x 的 y 次方，其中 x >= 0。`

``` T rint(T x) 使用舍入关系到浮点格式的偶数舍入模式，将 x 舍入为整数值。 ````

``` T round(T x) 返回最接近 x 的积分值，将中间情况舍入到远离零的位置。 ````

``` T rsqrt(T x) 计算 x 的倒数平方根。 ````

``` T sin(T x) 计算 x 的正弦值。 ````

``` T sincos(T x, T &cosval) 计算 x 的正弦和余弦。在函数返回值中返回计算出的正弦值，在 cosval 中返回计算出的余弦值。 ````

``` T sinh(T x) 计算 x 的双曲正弦。 ````

``` T sinpi(T x) 计算 sin(!x)。 ````

``` T sqrt(T x) 计算 x 的平方根。 ````

``` T tan(T x) 计算 x 的正切。 ````

``` T tanh(T x) 计算 x 的双曲正切。 ````

``` T tanpi(T x) 计算 tan(!x)。 ````

``` T trunc(T x) 使用向零舍入模式舍入 x 为整数值。 ````

对于 fmedian3，如果所有值均为 NaN，则返回 NaN。否则，将 NaN 视为缺失数据并将其从集合中删除。如果两个值均为 NaN，则返回非 NaN 值。如果其中一个值是 NaN，则该函数可以返回任一非 NaN 值。

对于单精度浮点，Metal 支持表 6. 4 中列出的数学函数的两种变体：精确变体和快速变体。 ffast-math 编译器选项（请参阅第 1.5.3 节）在编译 Metal 源代码时选择适当的变体。此外，metal::precise 和 metal::fast 嵌套命名空间提供了一种显式方法来为单精度浮点选择这些数学函数的快速或精确变体。

例子：

浮动 x；

浮动 a = sin(x); // 使用基于的快速或精确版本的 sin

``2023 - 06 - 02 |版权所有 © 2023 苹果公司 |版权所有。 ````

``` // 是否指定 – ffast-math 作为 // 编译选项。 ````

浮点数 b = fast::sin(x); // 使用 sin() 的快速版本。

浮点数 c = 精确::cos(x); // 使用精确版本的 cos()。

所有操作系统：自 Metal 1.2 起支持表 6. 5 和表 6. 6 中列出的常量。

表 6. 5 列出了具有 float 类型值的可用符号常量，这些常量在单精度浮点数的精度范围内是准确的。

## 表 6.5。单精度浮点数学函数的常量

`常量名称`

` 描述`

`` MAXFLOAT 最大非无限单精度浮点数的值。 ````

``` HUGE_VALF 正浮点常量表达式。 HUGE_VALF 的计算结果为+无穷大。 ````

＃＃＃ 无穷

``` float 类型的常量表达式，表示正无穷大或无符号无穷大。 ````

`` NAN 代表安静 NaN 的 float 类型常量表达式。 ````

`M_E_F e 的值`

`M_LOG2E_F ^ log 2 e^ 的值^`

`M_LOG10E_F log 10 e 的值`

`M_LN2_F loge 2 的值`

``M_LN10_F loge 10 的值````

`M_PI_F ^ π^ 的值^`

`M_PI_2_F π / 2 的值`

`M_PI_4_F π / 4 的值`

`M_1_PI_F 值 1 / π`

`M_2_PI_F ^2 /^ π^ 的值 ^`

``M_2_SQRTPI_F````

` 2 / √π 的值`

`M_SQRT2_F ^ √^2 的值^`

`M_SQRT1_2_F ^1 /^ √^2 的值^`

``2023 - 06 - 02 |版权所有 © 2023 苹果公司 |版权所有。 ````

表 6. 6 列出了具有 half 类型值的可用符号常量，这些常量在半精度浮点数的精度范围内是准确的。

## 表 6.6。半精度浮点数学函数的常量

`常量名称`

` 描述`

```MAXHALF 最大非无限半精度浮点数的值。 ````

``` HUGE_VALH 正半常量表达式。 HUGE_VALH 的计算结果为+无穷大。 ````

`M_E_H e 的值`

`M_LOG2E_H log 2 e 的值`

`M_LOG10E_H log 10 e 的值`

`M_LN2_H loge 2 的值`

``M_LN10_H loge 10 的值````

`M_PI_H ^ π^ 的值^`

`M_PI_2_H π / 2 的值`

`M_PI_4_H ^ π^ /^4 的值^`

`M_1_PI_H 值 1 / π`

`M_2_PI_H 值 2 / π`

`M_2_SQRTPI_H 值 2 / √π`

``M_SQRT2_H √ 2 的值````

`M_SQRT1_2_H 值 1 / √ 2`

表 6. 7 列出了可用的符号常量，其值类型为 bfloat，在大脑浮点数的精度范围内是准确的。

``2023 - 06 - 02 |版权所有 © 2023 苹果公司 |版权所有。 ````

## 表 6.7。大脑浮点数学函数的常数

`常量名称说明`

``` MAXBFLOAT 最大非无限 bfloat 浮点数的值。 ````

``` HUGE_VALBF 正半常量表达式。 HUGE_VALBF 的计算结果为+无穷大。 ````

`M_E_BF e 的值`

`M_LOG2E_BF log 2 e 的值`

`M_LOG10E_BF log 10 e 的值`

`M_LN2_BF loge 2 的值`

`M_LN10_BF ^ loge^10 的值^`

`M_PI_BF π 值`

`M_PI_2_BF π / 2 的值`

`M_PI_4_BF π / 4 的值`

`M_1_PI_BF 值为 1 / π`

`M_2_PI_BF 值 2 / π`

M_2_SQRTPI_BF (^) 值 2 / √π M_SQRT2_BF 值 √ 2 M_SQRT1_2_BF 值 1 / √ 2
