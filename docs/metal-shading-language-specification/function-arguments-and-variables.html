<!doctype html>
<html lang="zh-hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-metal-shading-language-specification/function-arguments-and-variables/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">函数参数和变量 | Swift 悍刀行</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables"><meta data-rh="true" name="docusaurus_locale" content="zh-hans"><meta data-rh="true" name="docsearch:language" content="zh-hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="函数参数和变量 | Swift 悍刀行"><meta data-rh="true" name="description" content="图形（顶点或片段）和内核函数的大多数输入和输出都作为参数传递。（常量地址空间中的初始化变量和程序范围中声明的采样器是输入和输出，不必作为参数传递。）从 Metal 3.1 开始，内核、网格和对象着色器的内置输入变量现在可以在程序范围内声明，避免将它们作为参数传递。如果它们未在动态库或单独编译的二进制函数中使用，则这适用。"><meta data-rh="true" property="og:description" content="图形（顶点或片段）和内核函数的大多数输入和输出都作为参数传递。（常量地址空间中的初始化变量和程序范围中声明的采样器是输入和输出，不必作为参数传递。）从 Metal 3.1 开始，内核、网格和对象着色器的内置输入变量现在可以在程序范围内声明，避免将它们作为参数传递。如果它们未在动态库或单独编译的二进制函数中使用，则这适用。"><link data-rh="true" rel="icon" href="/swift-tutorials-cn/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables"><link data-rh="true" rel="alternate" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables" hreflang="zh-hans"><link data-rh="true" rel="alternate" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/swift-tutorials-cn/blog/rss.xml" title="Swift 悍刀行 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/swift-tutorials-cn/blog/atom.xml" title="Swift 悍刀行 Atom Feed"><link rel="stylesheet" href="/swift-tutorials-cn/assets/css/styles.2fe221d4.css">
<link rel="preload" href="/swift-tutorials-cn/assets/js/runtime~main.b26d0e19.js" as="script">
<link rel="preload" href="/swift-tutorials-cn/assets/js/main.03dc0736.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/swift-tutorials-cn/"><div class="navbar__logo"><img src="/swift-tutorials-cn/img/logo.svg" alt="Swift 悍刀行" class="themedImage_ToTc themedImage--light_HNdA"><img src="/swift-tutorials-cn/img/logo.svg" alt="Swift 悍刀行" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Swift 悍刀行</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swift/welcome/about">Swift</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swiftui/essentials/about">SwiftUI</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swift-data/essentials/about">SwiftData</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Media</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/audio-toolbox/esseentials/about">Audio Toolbox</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/avf-audio/esseentials/about">AVFAudio</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/av-foundation/esseentials/about">AVFoundation</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Frameworks</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/core-graphics/overview">Core Graphics</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/charts/essentials/about">Charts</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metal/overview">Metal</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metalkit/overview">MetalKit</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Books</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metal-programming-guide/introdution">Metal Programming Guide</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">Metal Shading Language Specification 3.1</a></li></ul></div><a href="https://github.com/zhuanghongji/swift-tutorials-cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Metal Shading Language 规范</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">前言</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">前言</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/purpose-of-this-document">介绍</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/purpose-of-this-document">本文档的目的</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/organization-of-this-specification">本规范的组织</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/references">参考文献</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/metal-and-cpp14">Metal 和 C++14</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/compiler-and-preprocessor">编译器和预处理器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/metal-coordinate-systems">Metal 坐标系</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-data-types">数据类型</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-data-types">标量数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/vector-data-types">向量数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/matrix-data-types">矩阵数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/simd-group-matrix-data-types">SIMD 组矩阵数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/alignment-of-data-types">数据类型的对齐</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/atomic-data-types">原子数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/pixel-data-types">像素数据类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/buffers">缓冲区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/textures">纹理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/samplers">采样器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/imageblocks">图像块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/aggregate-types">聚合类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/argument-buffers">参数缓冲区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/uniform-type">统一类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/visible-function-table">可见函数表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/function-group-attribute">功能组属性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/ray-tracing-types">光线追踪类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/interpolant-type">插值类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/mesh-shader-types">网格着色器类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/type-conversions-and-re-interpreting-data">类型转换和重新解释数据</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/implicit-type-conversions">隐式类型转换</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-and-vector-operators">运算符</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/scalar-and-vector-operators">标量和向量运算符</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/matrix-operators">矩阵运算符</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/device-address-space">地址空间</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/device-address-space">设备地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/constant-address-space">常量地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/thread-address-space">线程地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/threadgroup-address-space">线程组地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/threadgroup-imageblock-address-space">threadgroup_imageblock 地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/ray-data-address-space">ray_data 地址空间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/object-data-address-space">object_data 地址空间</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/functions">函数与变量声明</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/functions">函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables">函数参数和变量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/storage-class-specifiers">存储类说明符</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/sampling-and-interpolation-attributes">采样和插值属性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/per-fragment-function-versus-per-sample-function">每片段函数与每样本函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/imageblock-attributes">图像块属性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/graphics-function-signature-matching">图形功能 - 签名匹配</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/program-scope-function-constants">程序作用域函数常量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/program-scope-global-built-ins">程序范围全局内置函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/per-primitive-viewport-and-scissor-rectangle-index-selection">每个图元视口和剪刀矩形索引选择</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/additional-restrictions">附加限制</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/namespace-and-header-files">Metal 标准库</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/namespace-and-header-files">命名空间和头文件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/common-functions">常用函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/integer-functions">整数函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/relational-functions">关系函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/math-functions">数学函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/matrix-functions">矩阵函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/simd-group-matrix-functions">SIMD-group 矩阵函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/geometric-functions">几何函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions">同步和 SIMD-group 功能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/graphics-functions">图形函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/pull-model-interpolation">拉模型插值</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/texture-functions">纹理函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/imageblock-functions">图像块函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/pack-and-unpack-functions">打包和解包函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/atomic-functions">原子函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/encoding-commands-for-indirect-command-buffers">间接命令缓冲区的编码命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/variable-rasterization-rate">可变光栅化率</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/ray-tracing-functions">光线追踪函数</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/inf-nan-and-denormalized-numbers">数值符合性</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/inf-nan-and-denormalized-numbers">INF、NaN 和非规范化数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/rounding-mode">舍入模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/floating-point-exceptions">浮点异常</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/relative-error-as-ulps">作为 ULP 的相对误差</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/edge-case-behavior-in-flush-to-zero-mode">清零模式下的边缘情况行为</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/conversion-rules-for-floating-point-and-integer-types">浮点型和整数型的转换规则</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-shading-language-specification/texture-addressing-and-conversion-rules">纹理寻址和转换规则</a></li></ul></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/swift-tutorials-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Metal Shading Language 规范</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">函数与变量声明</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">函数参数和变量</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>函数参数和变量</h1><div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_S0QG"><p>该文档目前仅完成 Google 翻译，需进一步校对和润色。</p></div></div></div><div style="padding-left:1rem;padding-right:1rem;padding-top:1.5rem;padding-bottom:0.5rem;border-radius:0.5rem;background-color:#333333"><p>原文：<a href="https://developer.apple.com/metal/Metal-Shading-Language-Specification.pdf">Metal Shading Language Specification - Version 3.1</a></p><blockquote>5.2 Function Arguments and Variables</blockquote></div><br><p>图形（顶点或片段）和内核函数的大多数输入和输出都作为参数传递。（常量地址空间中的初始化变量和程序范围中声明的采样器是输入和输出，不必作为参数传递。）从 Metal 3.1 开始，内核、网格和对象着色器的内置输入变量现在可以在程序范围内声明，避免将它们作为参数传递。如果它们未在动态库或单独编译的二进制函数中使用，则这适用。</p><p>图形和内核函数的参数可以是以下任何一个：</p><ul><li>设备缓冲区 —— 指向 <code>device</code> 地址空间中任何数据类型的指针或引用（参见第 2.8 节）。</li><li>常量缓冲区 —— 指向 <code>constant</code> 地址空间中任何数据类型的指针或引用（参见第 2.8 节）。</li><li><code>texture</code> 对象（参见第 2.9 节）或纹理数组。</li><li><code>texture_buffer</code> 对象（参见第 2.9.1 节）或纹理缓冲区数组。</li><li><code>sampler</code> 对象（参见第 2.10 节）或采样器数组。</li><li>线程组中的线程之间共享的缓冲区—— 指向 <code>threadgroup</code> 地址空间中的类型的指针，只能用作内核函数的参数。</li><li>图像块（参见第 2.11 节）。</li><li>参数缓冲区（参见第 2.13 节）。</li><li>内核函数的可见函数表（参见第 2.15 节）。从 Metal 2.4 开始，可见函数表也可以用于图形函数。</li><li>核函数的交集函数表（参见第 2.17.3 节）。</li><li>用于交集函数的加速结构（参见第 6.18.1 节）。</li><li>包含缓冲区、纹理或纹理缓冲区元素的结构。</li></ul><p>指定为图形或内核函数的参数值的缓冲区（设备）不能使用别名；也就是说，作为参数值传递的缓冲区不能与传递给同一图形或内核函数的单独参数的另一个缓冲区重叠。</p><p>你不能将图形和内核函数的参数声明为 <code>size_t</code>、<code>ptrdiff_t</code> 类型，或者包含声明为这些内置标量类型之一的成员的结构和/或联合。</p><p>这些函数的参数通常用属性来指定，以提供对其使用的进一步指导。属性用于指定：</p><ul><li>参数的资源位置（参见第 5.2.1 节）。</li><li>支持固定功能和可编程流水线级之间数据通信的内置变量（参见第 5.2.3 节）。</li><li>哪些数据沿着管道从顶点函数发送到片段函数（参见第 5.2.4 节）。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="定位缓冲区纹理和采样器参数">定位缓冲区、纹理和采样器参数<a href="#定位缓冲区纹理和采样器参数" class="hash-link" aria-label="定位缓冲区、纹理和采样器参数的直接链接" title="定位缓冲区、纹理和采样器参数的直接链接">​</a></h2><p>对于每个参数，可以选择指定一个属性来标识用于该参数类型的缓冲区、纹理或采样器的位置。Metal 框架 API 使用此属性来标识这些参数类型的位置。</p><ul><li>设备和常量缓冲区：<code>[[buffer(index)]]</code></li><li>纹理（包括纹理缓冲区）：<code>[[texture(index)]]</code></li><li>采样器：<code>[[sampler(index)]]</code></li><li>线程组缓冲区：<code>[[threadgroup(index) )]]</code></li></ul><p>索引值是一个无符号整数，用于标识分配的缓冲区、纹理或采样器参数的位置。（纹理缓冲区是一种特定类型的纹理。）正确的语法是属性遵循参数或变量名称。</p><p>下面的示例是一个简单的内核函数 add_vectors，它将设备地址空间中的两个缓冲区 inA 和 inB 的数组相加，并将结果返回到缓冲区 out 中。属性 (<code>buffer(index)</code>) 指定函数参数的缓冲区位置。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">kernel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">add_vectors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> device float4 </span><span class="token operator">*</span><span class="token plain">inA </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> device float4 </span><span class="token operator">*</span><span class="token plain">inB </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            device float4 </span><span class="token operator">*</span><span class="token plain">out </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            uint id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">thread_position_in_grid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> inA</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> inB</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面的示例显示了用于几种不同类型的函数参数（缓冲区、纹理和采样器）的属性：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">kernel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">my_kernel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">device float4 </span><span class="token operator">*</span><span class="token plain">p </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          texture2d</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token operator">&gt;</span><span class="token plain"> img </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">texture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          sampler sam </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">sampler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果未指定位置索引，Metal 编译器将使用第一个可用的位置索引来分配它们。在以下示例中，为 <code>src</code> 分配纹理索引 0、<code>dst</code> 纹理索引 1、<code>s</code> 采样器索引 0 和 u 缓冲区索引 0：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kernel </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">my_kernel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">texture2d</span><span class="token operator">&lt;</span><span class="token plain">half</span><span class="token operator">&gt;</span><span class="token plain"> src</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      texture2d</span><span class="token operator">&lt;</span><span class="token plain">half</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> access</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">write</span><span class="token operator">&gt;</span><span class="token plain"> dst</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      sampler s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      device myUserInfo </span><span class="token operator">*</span><span class="token plain">u</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在下面的示例中，一些内核参数已显式分配位置索引，而另一些则没有。<code>src</code> 显式分配纹理索引 0，<code>f</code> 显式分配缓冲区索引 10。如果使用函数常量分配位置索引（第 5.8 节），则编译器在分配索引时不会考虑这些条目。其它参数分配第一个可用位置索引：<code>dst</code> 纹理索引 1、<code>s</code> 采样器索引 0 和 <code>u</code> 缓冲区索引 0。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kernel </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">my_kernel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">texture2d</span><span class="token operator">&lt;</span><span class="token plain">half</span><span class="token operator">&gt;</span><span class="token plain"> src </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">texture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      texture2d</span><span class="token operator">&lt;</span><span class="token plain">half</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> access</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">write</span><span class="token operator">&gt;</span><span class="token plain"> dst</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      sampler s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      device myUserInfo </span><span class="token operator">*</span><span class="token plain">u</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      device </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain">f </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>每个属性（<code>buffer</code>、<code>threadgroup</code>、<code>texture</code> 和 <code>sampler</code>）代表一组资源。参数上指定的索引值在每个资源组中应是唯一的。具有相同 <code>index</code> 的多个缓冲区、纹理或采样器参数会生成编译错误，除非使用函数常量属性声明它们（请参阅第 5.8.1 节）。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="具有资源和输出到设备内存的顶点函数示例">具有资源和输出到设备内存的顶点函数示例<a href="#具有资源和输出到设备内存的顶点函数示例" class="hash-link" aria-label="具有资源和输出到设备内存的顶点函数示例的直接链接" title="具有资源和输出到设备内存的顶点函数示例的直接链接">​</a></h3><p>以下示例是一个顶点函数 <code>render_vertex</code>，它输出到数组 <code>xform_output</code> 中的设备内存，该数组是使用 <code>device</code> 属性指定的函数参数 (在 4.1 节中介绍)。所有的 <code>render_vertex</code> 函数参数都是用 <code>buffer(0)</code>，<code>buffer(1)</code>，<code>buffer(2)</code> 和 <code>buffer(3)</code> 属性指定的 (在 5.2.1 节中介绍)。有关本例中显示的 <code>position</code> 属性的更多信息，请参见 5.2.3.3 节。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 texcoord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexInput</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 normal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 texcoord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> constant uint MAX_LIGHTS </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">LightDesc</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    uint  num_lights</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_attenuation_factors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vertex </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">render_vertex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> device VertexInput</span><span class="token operator">*</span><span class="token plain"> v_in </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          constant float4x4</span><span class="token operator">&amp;</span><span class="token plain"> mvp_matrix </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          constant LightDesc</span><span class="token operator">&amp;</span><span class="token plain"> light_desc </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          device VertexOutput</span><span class="token operator">*</span><span class="token plain"> xform_output </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          uint v_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">vertex_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    VertexOutput v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">position </span><span class="token operator">=</span><span class="token plain"> v_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">v_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">position </span><span class="token operator">*</span><span class="token plain"> mvp_matrix</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">do_lighting</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">v_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">v_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> light_desc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">texcoord </span><span class="token operator">=</span><span class="token plain"> v_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">v_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">texcoord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Output the position to a buffer. xform_output[v_id] = v_out;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="光栅顺序组">光栅顺序组<a href="#光栅顺序组" class="hash-link" aria-label="光栅顺序组的直接链接" title="光栅顺序组的直接链接">​</a></h3><p>所有操作系统：自 Metal 2 起支持光栅顺序组属性。</p><p>片段函数中的缓冲区（在 <code>device</code> 内存中）和纹理的加载和存储是无序的。用于缓冲区或纹理的 <code>[[raster_order_group(index)]]</code> 属性，如果每个样本着色处于活动状态，则保证映射到相同 <code>(x, y)</code> 像素坐标和样本的不同基元的任何重叠片段的访问顺序。</p><p><code>[[raster_order_group(index)]]</code> 属性可以在纹理（始终位于 <code>device</code> 内存中）或在 <code>device</code> 内存中声明的缓冲区上指定，但不能在 <code>threadgroup</code> 或 <code>constant</code> 地址空间中指定。<code>[[raster_order_group(index)]]</code> 属性不能与结构或类一起使用。</p><p>使用 <code>[[raster_order_group(index)]]</code> 属性标记对缓冲区或纹理的重叠访问的片段函数调用的执行顺序与提交几何图形的顺序相同。对于重叠片段函数调用，片段函数调用对标有 <code>[[raster_order_group(index)]]</code> 属性的缓冲区或纹理执行的写入需要可供后续调用读取，并且不得影响先前调用的读取。同样，片段函数调用执行的读取必须反映先前调用的写入，并且不得反映后续调用的写入。</p><p><code>[[raster_order_group(index)]]</code> 中的 <code>index</code> 是一个整数值，它指定光栅器顺序 ID，它提供对加载和存储顺序的更细粒度的控制。例如，如果两个缓冲区 A 和 B 被标记有不同的光栅器顺序 ID 值，则可以独立地同步对缓冲区 A 和 B 的重叠片段的加载和存储。</p><p>例子：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fragment </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">my_fragment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">texture2d</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> access</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">read_write</span><span class="token operator">&gt;</span><span class="token plain"> texA </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">raster_order_group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">texture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ushort2 coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 clr </span><span class="token operator">=</span><span class="token plain"> texA</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">read</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// do operations on clr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    clr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    texA</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">write</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">clr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于参数缓冲区，你可以在结构中的缓冲区或纹理成员上使用 <code>[[raster_order_group(index)]]</code> 属性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="定位每个顶点输入的属性">定位每个顶点输入的属性<a href="#定位每个顶点输入的属性" class="hash-link" aria-label="定位每个顶点输入的属性的直接链接" title="定位每个顶点输入的属性的直接链接">​</a></h2><p>顶点函数可以通过使用顶点和实例 ID 作为参数传递给顶点函数的缓冲区进行索引来读取每个顶点的输入。此外，你还可以使用 <code>[[stage_in]]</code> 属性声明每个顶点输入，并将该输入作为参数传递。对于作为使用 <code>[[stage_in]]</code> 属性声明的参数传递的每顶点输入，每顶点输入的每个元素必须将顶点属性位置指定为 <code>[[attribute(index)]]</code>。有关 <code>[[stage_in]]</code> 属性的更多信息，请参阅第 5.2.4 节。</p><p><code>index</code> 是一个无符号整数，用于标识分配的顶点输入位置。正确的语法是属性遵循参数或变量名称。Metal API 使用该属性用于标识顶点缓冲区的位置并描述顶点数据，例如从中获取每个顶点数据的缓冲区、其数据格式及其步幅。</p><p>以下示例演示如何将顶点属性分配给使用 <code>stage_in</code> 属性传递给顶点函数的顶点输入结构的元素：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexInput</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 normal   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    half4 color     </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    half2 texcoord  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> constant uint MAX_LIGHTS </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">LightDesc</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    uint  num_lights</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_attenuation_factors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> sampler s </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sampler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">coord</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">normalized</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              address</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">clamp_to_zero</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              filter</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">linear</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vertex VertexOutput</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">render_vertex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">VertexInput v_in </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">stage_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    constant float4x4</span><span class="token operator">&amp;</span><span class="token plain"> mvp_matrix </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    constant LightDesc</span><span class="token operator">&amp;</span><span class="token plain"> lights </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    uint v_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">vertex_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    VertexOutput v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面的示例显示了如何使用缓冲区和 <code>stage_in</code> 属性来获取顶点函数中的每个顶点输入。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexInput</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 normal   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexInput2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">half4 color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">half2 texcoord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> constant uint MAX_LIGHTS </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">LightDesc</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    uint  num_lights</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_attenuation_factors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> sampler s </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sampler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">coord</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">normalized</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              address</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">clamp_to_zero</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              filter</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">linear</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vertex VertexOutput</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">render_vertex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">VertexInput v_in </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">stage_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              VertexInput2 v_in2 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              constant float4x4</span><span class="token operator">&amp;</span><span class="token plain"> mvp_matrix </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              constant LightDesc</span><span class="token operator">&amp;</span><span class="token plain"> lights </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              uint v_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">vertex_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    VertexOutput vOut</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> vOut</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>曲面细分后顶点函数可以读取每个面片和面片控制点数据。曲面细分后顶点函数将面片控制点数据指定为以下模板化类型：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">patch_control_point</span><span class="token operator">&lt;</span><span class="token plain">T</span><span class="token operator">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 <code>T</code> 是用户定义的结构。<code>T</code> 的每个元素必须使用 <code>[[attribute(index)]]</code> 指定属性位置。</p><p>所有操作系统：自 Metal 1.2 起支持补丁控制点模板类型。</p><p><code>patch_control_point</code> 类型支持以下成员函数：</p><ul><li><code>constexpr size_t size() const; </code></li></ul><p>它返回补丁中控制点的数量。</p><ul><li><code>constexpr const_reference operator[] (size_t pos) const;</code></li></ul><p>它返回 pos 标识的特定斑块控制点的数据。</p><p>例子：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">ControlPoint</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    int3 patchParam  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 P         </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 P1        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 P2        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 vSegments </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">PerPatchData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 patchConstant          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 someOtherPatchConstant </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">PatchData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    patch_control_point</span><span class="token operator">&lt;</span><span class="token plain">ControlPoint</span><span class="token operator">&gt;</span><span class="token plain"> cp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Control-point data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    PerPatchData patchData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">               </span><span class="token comment" style="color:rgb(98, 114, 164)">// Per-patch data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">patch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">quad</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> vertex VertexOutput </span><span class="token function" style="color:rgb(80, 250, 123)">post_tess_vertex_func</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">PatchData input </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">stage_in </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内置变量的属性">内置变量的属性<a href="#内置变量的属性" class="hash-link" aria-label="内置变量的属性的直接链接" title="内置变量的属性的直接链接">​</a></h2><p>一些图形操作发生在固定功能流水线阶段，需要向图形函数提供值或从图形函数接收值。内置输入和输出变量用于在图形（顶点和片段）函数和固定功能图形管道阶段之间传递值。属性与图形函数的参数和返回类型一起使用来标识这些内置变量。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="顶点函数输入属性">顶点函数输入属性<a href="#顶点函数输入属性" class="hash-link" aria-label="顶点函数输入属性的直接链接" title="顶点函数输入属性的直接链接">​</a></h3><p>表 5.2 列出了可以为顶点函数的参数指定的内置属性以及可以使用它们的相应数据类型。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.2 - Attributes for vertex function input arguments</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">amplification_count 
macOS: Since Metal 2.3. iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The number of output vertices produced for each vertex instance.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">amplification_id 
macOS: Since Metal 2.3. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The array index offset mappings for viewport and render target array indices, which enables routing an amplified vertex to a different viewport and render target.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">base_instance</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The base instance value added to each instance identifier before reading per-instance data.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">base_vertex</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The base vertex value added to each vertex identifier before reading per-vertex data.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">instance_id</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The per-instance identifier, which includes the base instance value if one is specified.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">vertex_id</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The per-vertex identifier, which includes the base vertex value if one is specified.</td></tr></tbody></table></center><br></div><p><code>[[amplification_count]]</code> 的默认值为 1，表示禁用顶点放大。</p><p><code>[[amplification_id]]</code> 的值应在 <code>[0, amplification_count]</code> 范围内。</p><p>顶点函数输入属性类型注意事项：</p><ul><li>如果声明 <code>[[vertex_id]]</code> 的类型为 <code>uint</code>，则声明 <code>[[base_vertex]]</code> 的类型需要为 <code>uint</code> 或 <code>ushort</code>。</li><li>如果声明 <code>[[vertex_id]]</code> 的类型为 <code>ushort</code>，则声明 <code>[[base_vertex]]</code> 的类型也需要为 <code>ushort</code>。</li><li>如果声明 <code>[[instance_id]]</code> 的类型为 <code>uint</code>，则声明 <code>[[base_instance]]</code> 的类型需要为 <code>uint</code> 或 <code>ushort</code>。</li><li>如果声明 <code>[[instance_id]]</code> 的类型为 <code>ushort</code>，则声明 <code>[[base_instance]]</code> 的类型也需要为 <code>ushort</code>。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="曲面细分后顶点函数输入属性">曲面细分后顶点函数输入属性<a href="#曲面细分后顶点函数输入属性" class="hash-link" aria-label="曲面细分后顶点函数输入属性的直接链接" title="曲面细分后顶点函数输入属性的直接链接">​</a></h3><p>表 5.3 列出了可以为曲面细分后顶点函数的参数指定的内置属性以及可以使用它们的相应数据类型。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.3 - Attributes for post-tessellation vertex function input arguments</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">base_instance</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The base instance value added to each instance identifier before reading per-instance data.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">instance_id</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The per-instance identifier, which includes the base instance value if one is specified.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">patch_id</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The patch identifier.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">position_in_patch</td><td style="white-space:pre-line;min-width:10rem;color:white">float2 or float3</td><td style="white-space:pre-line;min-width:10rem;color:white">Defines the location on the patch being evaluated. For quad patches, must be float2. For triangle patches, must be float3.</td></tr></tbody></table></center><br></div><p>所有操作系统：自 Metal 1.2 起支持表 5.3 中的所有属性。</p><p>顶点函数输入属性注意事项：</p><ul><li>如果声明 <code>[[instance_id]]</code> 的类型为 <code>uint</code>，则声明 <code>[[base_instance]]</code> 的类型需要为 <code>uint</code> 或 <code>ushort</code>。</li><li>如果声明 <code>[[instance_id]]</code> 的类型为 <code>ushort</code>，则声明 <code>[[base_instance]]</code> 的类型也需要为 <code>ushort</code>。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="顶点函数输出属性">顶点函数输出属性<a href="#顶点函数输出属性" class="hash-link" aria-label="顶点函数输出属性的直接链接" title="顶点函数输出属性的直接链接">​</a></h3><p>表 5.4 列出了可以为顶点函数的返回类型或顶点函数返回的结构体的成员指定的内置属性（及其相应的数据类型）。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.4 - Attributes for vertex function return type</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">Attribute</td><td style="white-space:pre-line;min-width:10rem;color:white">Corresponding Data Types</td><td style="white-space:pre-line;min-width:10rem;color:white">Description</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">clip_distance</td><td style="white-space:pre-line;min-width:10rem;color:white">float or float[n] 
n needs to be known at compile time</td><td style="white-space:pre-line;min-width:10rem;color:white">Distance from vertex to clipping plane</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">invariant 
All OS: Since Metal 2.1</td><td style="white-space:pre-line;min-width:10rem;color:white">Not applicable; needs to be used with [[position]]</td><td style="white-space:pre-line;min-width:10rem;color:white">Marks the output position such that if the sequence of operations used to compute the output position in multiple vertex shaders is identical, there is a high likelihood that the resulting output position computed by these vertex shaders are the same value. Requires users to pass -fpreserve-invariance. Please see description below for more information.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">point_size</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">Size of a point primitive</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">position</td><td style="white-space:pre-line;min-width:10rem;color:white">float4</td><td style="white-space:pre-line;min-width:10rem;color:white">The transformed vertex position</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">render_target_array_ind ex 
macOS: Since Metal 1.1. 
iOS: Since Metal 2.1.</td><td style="white-space:pre-line;min-width:10rem;color:white">uchar, ushort, or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The array index that refers to one of: 
1) an array slice of a texture array, 
2) data at a specified depth of a 3D texture, 
3) the face of a cubemap, or 
4) a specified face of a specified array slice of a cubemap array.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">shared 
macOS: Since Metal 2.3. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">Not applicable</td><td style="white-space:pre-line;min-width:10rem;color:white">If present, then for every amplification_id, the output shall have the same value.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">viewport_array_index 
macOS: Since Metal 2. 
iOS: Since Metal 2.1.</td><td style="white-space:pre-line;min-width:10rem;color:white">uchar, ushort, or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The viewport (and scissor rectangle) index value of the primitive.</td></tr></tbody></table></center><br></div><p>所有操作系统：自 Metal 1 起支持表 5. 4 中的属性，除非另有说明。</p><p>立方体贴图表示为具有六层的渲染目标数组，每个面一层，<code>[[render_target_array_index]]</code> 是面索引，其值为 0 到 5 之间的值。对于立方体贴图数组，<code>[[render_target_array_index]]</code> 为计算为：<code>array_slice_index * 6 + face_index</code>。</p><p>你必须为基元中的每个顶点返回相同的 <code>[[render_target_array_index]]</code> 值。如果值不同，则传递给片段函数的行为和值未定义。相同的行为适用于由曲面细分生成的图元。如果 <code>[[render_target_array_index]]</code> 越界（即大于或等于 <code>renderTargetArrayLength</code>），则硬件会将此值解释为 0。有关 <code>[[render_target_array_index]]</code> 作为片段函数输入的更多信息，请参阅第 5.2.3.4 节。</p><p><code>[[viewport_array_index]]</code> 允许从多个活动视口和剪刀矩形指定一个视口和剪刀矩形。如果顶点函数没有指定 <code>[[viewport_array_index]]</code>，则输出视口数组索引值为 0。有关 <code>[[viewport_array_index]]</code> 的更多信息，请参见第 5.10 节。</p><p><code>[[invariant]]</code> 表示多个函数传递中使用的浮点数学必须生成与每个传递完全匹配的顶点位置。<code>[[invariant]]</code> 只能用于顶点函数中的位置（具有 <code>[[position]]</code> 属性的字段），以指示输出的计算结果是不变的。在 iOS 14.0 和 macOS 11.0 之前的编译器中，计算可能（尽管不能保证）是不变的。现在，当传递 <code>-fpreserve-invariance</code> 选项或从 Metal API 的 <code>MTLCompilerOptions</code> 设置 <code>preserveInvariance</code> 进行运行时编译时，此计算保证不变。请注意，如果未传递选项，则 <code>[[invariant]]</code> 将被忽略。这种位置不变性对于阴影体积或 z-prepass 等技术至关重要。</p><p>如果顶点函数的返回类型不是 <code>void</code>，则它必须包含顶点位置。如果顶点返回类型是 <code>float4</code>，那么它总是引用顶点位置，并且不能指定 <code>[[position]]</code> 属性。如果顶点返回类型是结构体，则它必须包含使用 <code>[[position]]</code> 属性声明的元素。</p><p>以下示例描述了一个名为 <code>process_vertex</code> 的顶点函数。该函数返回一个名为 <code>VertexOutput</code> 的用户定义结构，其中包含一个表示顶点位置的内置变量，因此需要 <code>[[position]]</code> 属性。</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 texcoord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vertex VertexOutput </span><span class="token function" style="color:rgb(80, 250, 123)">process_vertex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    VertexOutput v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// compute per-vertex output ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>曲面细分后顶点函数输出与常规顶点函数相同。</p><p>如果启用顶点放大，并且顶点输出变量的每个 <code>[[amplification_id]]</code> 属性具有相同的值，则顶点输出被视为 <em>共享</em>。共享的顶点输出可以使用单个变化的输出槽，这是有限的资源。未共享的顶点输出消耗多个不同的输出槽。（Metal 框架调用 <code>[MTLRenderPipelineDescriptor maxVertexAmplificationCount]</code> 返回可用于将放大的数据传递到片段函数调用的变化槽的数量，这会影响可用变化槽的总数。）</p><p>默认情况下，所有内置顶点输出都是共享的，除了具有 <code>[[position]]</code> 属性的顶点输出。默认情况下，不共享所有其它顶点输出。要显式指定输出是共享的，请将 <code>[[shared]]</code> 属性与顶点输出变量一起使用。</p><p>如果着色器编译器可以推断出顶点输出变量对于每个 <code>amplification_id</code> 具有相同的值，则编译器可以将该顶点输出标记为共享。在以下任何情况下，编译器可能不会将顶点输出标记为共享：</p><ul><li>输出值取决于 <code>[[amplification_id]]</code>。</li><li>原子 read-modify-write 操作返回输出值。</li><li>着色器从易失性存储器加载输出值。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="片段函数输入属性">片段函数输入属性<a href="#片段函数输入属性" class="hash-link" aria-label="片段函数输入属性的直接链接" title="片段函数输入属性的直接链接">​</a></h3><p>表 5.5 列出了可以为片段函数的参数指定的内置属性（及其相应的数据类型）。</p><p>如果顶点函数的返回类型不是 <code>void</code>，则它必须包含顶点位置。如果顶点返回类型是 <code>float4</code>，则它始终指的是顶点位置（并且不需要指定 <code>[[position]]</code> 属性）。如果顶点返回类型是结构体，则它必须包含使用 <code>[[position]]</code> 属性声明的元素。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.5 - Attributes for fragment function input arguments</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">amplification_count 
macOS: Since Metal 2.3. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The number of output vertices produced for each vertex instance.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">amplification_id 
macOS: Since Metal 2.3. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The array index offset mappings for viewport and render target array indices, which enables routing an amplified vertex to a different viewport and render target.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">barycentric_coord 
macOS: Since Metal 2.2. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">float, float2, or float3</td><td style="white-space:pre-line;min-width:10rem;color:white">The barycentric coordinates.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">color(m) 
macOS: Since Metal 2.3. 
iOS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">floatn, halfn, intn, uintn, shortn, or ushortn 
m needs to be known at compile time</td><td style="white-space:pre-line;min-width:10rem;color:white">The input value read from a color attachment. The index m indicates which color attachment to read from.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">front_facing</td><td style="white-space:pre-line;min-width:10rem;color:white">bool</td><td style="white-space:pre-line;min-width:10rem;color:white">This value is true if the fragment belongs to a front-facing primitive.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">point_coord</td><td style="white-space:pre-line;min-width:10rem;color:white">float2</td><td style="white-space:pre-line;min-width:10rem;color:white">Two-dimensional coordinates, which range from 0.0 to 1.0 across a point primitive, specifying the location of the current fragment within the point primitive.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">position</td><td style="white-space:pre-line;min-width:10rem;color:white">float4</td><td style="white-space:pre-line;min-width:10rem;color:white">Describes the window-relative coordinate (x, y, z, 1/w) values for the fragment.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">primitive_id 
macOS: Since Metal 2.2. 
iOS: Since Metal 2.3.</td><td style="white-space:pre-line;min-width:10rem;color:white">uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The per-primitive identifier used with barycentric coordinates.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">render_target_array_index 
macOS: Since Metal 1.1. 
iOS: Since Metal 2.1.</td><td style="white-space:pre-line;min-width:10rem;color:white">uchar, ushort, or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The render target array index, which refers to the face of a cubemap, data at a specified depth of a 3D texture, an array slice of a texture array, an array slice, or face of a cubemap array. For a cubemap, the render target array index is the face index, which is a value from 0 to 5. For a cubemap array the render target array index is computed as: array slice index * 6 + face index.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">sample_id</td><td style="white-space:pre-line;min-width:10rem;color:white">uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The sample number of the sample currently being processed.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">sample_mask</td><td style="white-space:pre-line;min-width:10rem;color:white">uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The set of samples covered by the primitive generating the fragment during multisample rasterization.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">sample_mask, post_depth_coverage 
iOS: Since Metal 2. 
macOS: Since Metal 2.3</td><td style="white-space:pre-line;min-width:10rem;color:white">uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The set of samples covered by the primitive generating the fragment after application of the early depth and stencil tests during multisample rasterization. The early_fragment_tests attribute needs to be used on the fragment function; otherwise the compilation fails.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_quadgroup 
All OS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_simdgro up 
All OS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_simdgroup 
All OS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">viewport_array_index 
macOS: Since Metal 2. 
iOS: Since Metal 2.1.</td><td style="white-space:pre-line;min-width:10rem;color:white">uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The viewport (and scissor rectangle) index value of the primitive.</td></tr></tbody></table></center><br></div><p>使用 <code>[[position]]</code> 属性声明为片段函数输入的变量只能使用 <code>center_no_perspective</code> 采样和插值属性声明。（参见第 5.4 节。）</p><p>对于 <code>[[color(m)]]</code>，<code>m</code> 用于在片段函数中访问（读取或写入）多个颜色附件时指定颜色附件索引。</p><p>对于片段函数输入，<code>[[sample_mask]]</code> 属性只能声明一次。</p><p>片段函数中 <code>[[render_target_array_index]]</code> 的值与从顶点函数写入的值相同，即使指定的值超出范围。</p><p>有关 <code>[[viewport_array_index]]</code> 的更多信息，请参阅第 5.10 节。</p><p><code>[[amplification_count]]</code> 的默认值为 1，表示禁用顶点放大。</p><p><code>[[amplification_id]]</code> 的值应在 <code>[0, amplification_count)</code> 范围内。</p><p>对于指定的 <code>[[amplification_id]]</code> 属性值，<code>[[viewport_array_index]]</code> 和 <code>[[render_target_array_index]]</code> 内置片段输入值将添加到相应 <code>MTLVertexAmplificationViewMapping</code> 结构提供的值（偏移）。</p><p>以下示例描述了结构体 <code>MyVertexOut</code>，它既是顶点函数返回类型又是片段函数输入类型。<code>MyVertexOut</code> 使用输入参数 <code>amp_id</code> 的 <code>[[amplification_id]]</code> 属性来放大位置和 <code>ampData</code> 成员。使用 <code>[[shared]]</code> 属性显式确保 <code>texcoord</code> 成员在顶点放大下对于所有变量具有相同的值，如第 5.2.3.3 节所述。</p><p>在顶点函数 <code>myVertex</code> 中，<code>[[amplification_id]]</code> 和 <code>[[amplification_count]]</code> 属性指定用于顶点放大的顶点函数输入变量，详见 5.2.3.1 节。着色器编译器推断出每个 <code>[[amplification_id]]</code> 的普通成员具有相同的值，因此编译器在顶点输出中将其标记为共享。</p><p>在片段函数 <code>myFragment</code> 中，相同的 <code>[[amplification_id]]</code> 和 <code>[[amplification_count]]</code> 属性指定片段函数输入变量。如果启用顶点放大，则 <code>amp_id</code> 确定从中选择视口数组索引（<code>viewportArrayIndexOffset</code> 成员）的映射（<code>MTLVertexAmplificationViewMapping</code> 结构）。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">MyVertexIn</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 normal   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 tangent  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 texcoord </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">MyVertexOut</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 normal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 tangent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 bitangent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 texcoord </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">shared</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// explicitly shared.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token plain">  ampData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ushort viewport </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">viewport_array_index</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// implicitly shared</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> ushort MAX_AMP </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vertex MyVertexOut </span><span class="token function" style="color:rgb(80, 250, 123)">myVertex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">MyVertexIn in </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">stage_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            constant float4x4 view_proj</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_AMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            constant </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_AMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            ushort amp_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">amplification_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            ushort amp_count </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">amplification_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    MyVertexOut vert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">position  </span><span class="token operator">=</span><span class="token plain"> view_proj</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">amp_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// deduced amplified     vert.normal    = in.normal; // deduced shared</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">tangent   </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bitangent </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">texcoord  </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ampData   </span><span class="token operator">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">amp_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// not shared</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">viewport  </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> vert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fragment float4 </span><span class="token function" style="color:rgb(80, 250, 123)">myFragment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">MyVertexOut in </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> stage_in </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                           ushort amp_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">amplification_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                           ushort amp_count </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">amplification_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                           </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// For MTLVertexAmplificationViewMapping = {{1,3},{2,4}}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">//   when amp_id == 0, in.viewport == 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">//   when amp_id == 1, in.viewport == 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ushort viewport </span><span class="token operator">=</span><span class="token plain"> in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">viewport</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 <code>[[barycentric_coord]]</code> 属性声明的片段函数输入只能使用 <code>center_perspective</code>（默认）或 <code>center_no_perspective</code> 采样和插值属性进行声明。重心坐标和每像素基元 ID 可以作为片段函数输入传递到按以下示例所示组织的结构中：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">FragmentInput0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    uint primitive_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">primitive_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// [[center_perspective]] is the default, so it can be omitted.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 barycentric_coord </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">barycentric_coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> center_perspective</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">FragmentInput1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    uint primitive_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">primitive_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 linear_barycentric_coord </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">barycentric_coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      center_no_perspective</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过存储重心坐标和每像素图元 ID，着色器可以在片段阶段内手动读取和插入绘制图元的顶点，或将此插值推迟到单独的通道。在延迟插值场景下，可以使用 thin buffer</p><p>在几何通道期间存储最小的表面数据集，包括预裁剪的重心坐标。在稍后阶段，你必须有足够的数据来根据图元 ID 数据重建原始顶点索引，并将重心坐标与这些顶点索引相关联。</p><p>当将 <code>barycentric_coord</code> 属性应用于具有 <em>more</em> 组件的输入参数（或参数的字段）时，其余元素将使用 <code>0.0f</code> 进行初始化。例如，对于</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fragment float4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">frag</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">float3 coord </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">barycentric_coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>绘制点时，<code>coord.yz</code> 为 <code>float2(0.0f)</code>。</li><li>画线时，<code>coord.z</code> 为 <code>0.0f</code>。</li></ul><p>当将 <code>barycentric_coord</code> 属性应用于具有 <em>fewer</em> 分量的输入参数（或参数的字段）时，其余元素将被忽略。</p><p>表 5.6 列出了可以为片段函数输入的图块参数指定的属性。声明 <code>[[pixel_position_in_tile]]</code> 和 <code>[[pixels_per_tile]]</code> 的数据类型必须匹配。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.6 - Attributes for fragment function tile input arguments</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">pixel_position_in_tile</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort2 or uint2</td><td style="white-space:pre-line;min-width:10rem;color:white">(x, y) position of the fragment in the tile.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">pixels_per_tile</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort2 or uint2</td><td style="white-space:pre-line;min-width:10rem;color:white">(width, height) of the tile in pixels.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">tile_index</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">1D tile index.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">render_target_array_index</td><td style="white-space:pre-line;min-width:10rem;color:white">uchar, ushort, or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The render target array index, which refers to the face of a cubemap, data at a specified depth of a 3D texture, an array slice of a texture array, an array slice, or face of a cubemap array. For a cubemap, the render target array index is the face index, which is a value from 0 to 5. For a cubemap array the render target array index is computed as: array slice index * 6 + face index.</td></tr></tbody></table></center><br></div><p>macOS：自 Metal 2.3 起支持表 5.6 中的属性。</p><p>iOS：自 Metal 2 起支持表 5.6 中的属性。</p><p><code>[[tile_index]]</code> 是 <code>[0, n)</code> 中的值，其中 <code>n</code> 是渲染目标中的图块数量。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="片段函数输出属性">片段函数输出属性<a href="#片段函数输出属性" class="hash-link" aria-label="片段函数输出属性的直接链接" title="片段函数输出属性的直接链接">​</a></h3><p>片段函数的返回类型描述了每个片段的输出。你必须使用表 5.7 中列出的属性来指定片段函数可以输出一个或多个渲染目标颜色值、深度值、采样覆盖遮罩或模板参考值。如果片段函数没有输出深度值，则将光栅化器生成的深度值输出到深度附件。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.7 - Attributes for fragment function return types</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">color(m) 
All OS: Since Metal 1. 

color(m), index(i) 
All OS: Since Metal 1.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">floatn, halfn, intn, uintn, shortn, or ushortn</td><td style="white-space:pre-line;min-width:10rem;color:white">Color value output for a color attachment. 
m is the color attachment index and needs to be known at compile time. The index i can be used to specify one or more colors output by a fragment function for a given color attachment and is an input to the blend equation.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">depth(depth_argument) 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">Depth value output using the function specified by depth_argument.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">sample_mask 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">uint</td><td style="white-space:pre-line;min-width:10rem;color:white">Coverage mask.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">stencil 
All OS: Since Metal 2.1.</td><td style="white-space:pre-line;min-width:10rem;color:white">uint</td><td style="white-space:pre-line;min-width:10rem;color:white">Stencil reference value to be used in a stencil test.</td></tr></tbody></table></center><br></div><p>片段输出的颜色附件索引 <code>m</code> 的指定方式与片段输入的 <code>[[color(m)]]</code> 的指定方式相同（参见表 5.5 的讨论）。片段函数返回类型中使用相同颜色附件索引进行混合的多个元素需要使用相同的数据类型进行声明。</p><p>如果片段函数中只有单色附件，则 <code>[[color(m)]]</code> 是可选的。如果不指定 <code>[[color(m)]]</code>，则附件索引为 0。如果指定多个颜色附件，则需要为所有颜色值指定 <code>[[color(m)]]</code>。请参阅第 5.5 节和第 5.8.1.5 节中指定颜色附件的示例。</p><p>如果属性中未指定 <code>index(i)</code>，则默认索引为 <code>0</code>。如果指定了 <code>index(i)</code>，则需要在编译时知道 <code>i</code> 的值。</p><p>如果片段函数写入深度值，则需要使用以下值之一指定 <code>depth_argument</code>：</p><ul><li><code>any</code></li><li><code>greater</code></li><li><code>less</code></li></ul><p>你不能在基于片段的图块着色函数中使用 <code>[[stencil]]</code> 属性。<code>[[stencil]]</code> 属性与 <code>[[early_fragment_tests]]</code> 函数属性不兼容。</p><p>如果片段函数没有输出模板值，<code>MTLRenderCommandEncoder</code> 的 <code>setStencilReferenceValue:</code> 或 <code>setStencilFrontReferenceValue:backReferenceValue:</code> 方法可以设置模板参考值。</p><p>以下示例显示了如何指定颜色附件索引。<code>clr_f</code> 中写入的颜色值写入颜色附件索引 0，<code>clr_i</code> 写入颜色附件索引 1，<code>clr_ui</code> 写入颜色附件索引 2。</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">MyFragmentOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// color attachment 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 clr_f </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// color attachment 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    int4 clr_i </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// color attachment 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    uint4 clr_ui </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fragment MyFragmentOutput </span><span class="token function" style="color:rgb(80, 250, 123)">my_fragment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    MyFragmentOutput f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">clr_f </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果颜色附件索引既用作片段函数的输入又用作片段函数的输出，则与使用此颜色附件索引声明的输入参数和输出关联的数据类型必须匹配。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="内核函数输入属性">内核函数输入属性<a href="#内核函数输入属性" class="hash-link" aria-label="内核函数输入属性的直接链接" title="内核函数输入属性的直接链接">​</a></h3><p>当内核函数被提交执行时，它会在 N 维线程网格上执行，其中 N 为一、二或三。线程是内核函数的一个实例对该网格中的每个点执行，并且 <code>thread_position_in_grid</code> 标识其在网格中的位置。</p><p>在计算单元内，线程组被划分为多个较小的组来执行。计算单元的执行宽度（称为 <code>threads_per_simdgroup</code>）决定了该较小组的建议大小。为了获得最佳性能，请将线程组中的线程总数设置为 <code>threads_per_simdgroup</code> 的倍数。</p><p>线程组在网格内被分配一个唯一的位置（称为 <code>threadgroup_position_in_grid</code>）。线程在线程组内被分配一个唯一的位置（称为 <code>thread_position_in_threadgroup</code>）。线程组内线程的唯一标量索引由 <code>thread_index_in_threadgroup</code> 给出。</p><p>每个线程在网格中的位置和在线程组中的位置都是 N 维元组。使用与线程类似的方法为线程组分配位置。线程被分配到一个线程组，并在线程组中指定一个位置，其组件的范围从零到该维度中线程组大小的大小减一。</p><p>当内核函数提交执行时，指定线程组的数量和线程组大小，或者指定网格中的线程数和线程组大小。例如，考虑提交执行的内核函数，该函数使用 2D 网格，其中指定的线程组数量为 (<code>Wx</code>, <code>Wy</code>)，线程组大小为 (<code>Sx</code>, <code>Sy</code>)。令 <code>(wx, wy)</code> 为每个线程组在网格中的位置 (<code>threadgroup_position_in_grid</code>)，<code>(lx, ly)</code> 为每个线程在线程组中的位置 (<code>thread_position_in_threadgroup</code>)。</p><p>网格中的线程位置（<code>thread_position_in_grid</code>）为：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(gx, gy) = (wx * Sx + lx, wy * Sy + ly)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>网格大小（<code>threads_per_grid</code>）为：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">(Gx, Gy) = (Wx * Sx, Wy * Sy)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在除图块函数之外的情况下，线程组中的线程索引 (thread_index_in_threadgroup) 由以下公式确定：<code>ly * Sx + lx</code></p><p>对于图块函数，线程索引不是 lx 和 ly 值的线性映射。瓦片函数中的每个线程都保证获得 <code>[0, Sx \* Sy)</code> 范围内的唯一索引。</p><p>在线程组内，线程以实现定义的方式分为 SIMD-group。SIMD-group 中的任何给定线程都可以查询其 SIMD 通道 ID 以及它属于哪个 SIMD-group。</p><p>表 5.8 列出了可以为内核函数的参数指定的内置属性以及可以使用它们的相应数据类型。从 Metal 3.1 开始，可以在要在内核上下文中使用的全局（程序范围）变量上指定内置属性。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.8 - Attributes for kernel function input arguments</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">dispatch_quadgroups_per_th readgroup 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The quad-group execution width of a threadgroup specified at dispatch.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">dispatch_simdgroups_per_threadgroup 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The SIMD-group execution width of a threadgroup specified at dispatch.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">dispatch_threads_per_threadgroup 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a threadgroup for threads specified at dispatch.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">grid_origin 
All OS: Since Metal 1.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The origin (offset) of the grid over which compute threads that read per-thread stage-in data are launched.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">grid_size 
All OS: Since Metal 1.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The maximum size of the grid over which compute threads that read per-thread stage-in data are launched.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">quadgroup_index_in_threadgroup 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a quad-group within a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">quadgroups_per_threadgroup 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The quad-group execution width of a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">simdgroup_index_in_threadgroup 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a SIMD-group within a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">simdgroups_per_threadgroup 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The SIMD-group execution width of a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_execution_width 
All OS: Since Metal 1. 
[[ Deprecated as of Metal 3 - use threads_per_simdgroup ]]</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a SIMD-group (compute unit).</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_quadgroup 
macOS: Since Metal 2.1. 
iOS: Since Metal 2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_simdgroup 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_threadgrou p 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_position_in_grid 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread’s position in an N-dimensional grid of threads.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_position_in_threadg roup 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread’s unique position within a threadgroup</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threadgroup_position_in_grid 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The threadgroup’s unique position within a grid.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threadgroups_per_grid 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The number of threadgroups in a grid.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_grid 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The grid size.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_simdgroup 
macOS: Since Metal 2. 
iOS: Since Metal 2.2.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a SIMD-group (compute unit).</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_threadgroup 
All OS: Since Metal 1.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a threadgroup.</td></tr></tbody></table></center><br></div><p>所有操作系统：自 Metal 1.2 起，支持 <code>grid_origin</code> 和 <code>grid_size</code>。</p><p>macOS：从 Metal 2 开始，支持 SIMD-group 属性。从 Metal 2.1 开始，支持 quad-group 属性。自 Metal 1 以来支持的其它属性。</p><p>iOS：从 Metal 2 开始，支持 quad-group 属性。从 Metal 2 开始，支持 SIMD-group 属性。</p><p>自 Metal 1 以来支持的其它属性。</p><p>所有操作系统：从 Metal 3.1 开始，全局（程序范围）变量现在可以指定这些属性，除非它们在动态库或单独编译的二进制函数中使用。</p><p>对于标准 Metal 计算函数（平铺函数除外）， SIMD-group 是线性的和一维的。（线程组可以是多维的。）线程组中的 SIMD-group 数量（<code>[[simdgroups_per_threadgroup]]</code>）是线程组中的线程总数（<code>[[threads_per_threadgroup]]</code>）除以 SIMD-group 大小（<code>[[threads_per_simdgroup]]</code>）：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">simdgroups_per_threadgroup </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">threads_per_threadgroup </span><span class="token operator">/</span><span class="token plain"> threads_per_simdgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同样，线程组中的四元组数量（<code>quadgroups_per_threadgroup</code>）是线程组中的线程总数除以 4，即四元组的线程执行宽度：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">quadgroups_per_threadgroup </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">threads_per_threadgroup </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于平铺函数，线程排列为 2 x 2 四边形。对于指定线程组数量为 <code>(Wx, Wy)</code> 的 2 D 网格，<code>simdgroups_per_threadgroup</code> 计算如下：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">simdgroups_per_threadgroup </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Wx </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Wy </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> threads_per_simdgroup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">simdgroups_per_threadgroup </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Wx </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Wy </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> threads_per_simdgroup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于图块函数，<code>quadgroups_per_threadgroup</code> 的计算方式如下：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">quadgroups_per_threadgroup </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Wx </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Wy </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">quadgroups_per_threadgroup </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Wx </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ceil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Wy </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于调度时指定的线程，<code>[[dispatch_simdgroups_per_threadgroup]]</code> 和 <code>[[dispatch_quadgroups_per_threadgroup]]</code> 的计算方式类似。</p><p>SIMD-group 在给定线程组内并发执行，并在没有线程组屏障操作的情况下相互独立地前进。SIMD-group 中的线程索引（由 <code>[[thread_index_in_simdgroup]]</code> 给出）是介于 0 和 SIMD-group 大小 - 1 之间的值（包含 0 和 1）。类似地，四元组中的线程索引（由 <code>[[thread_index_in_quadgroup]]</code> 给出）是 0 到 3 之间的值（包含 0 和 3）。</p><p>在 Metal 2 中，网格中的线程数量不必是线程组中线程数量的倍数。因此，特定线程组的实际线程组大小可能小于调度中指定的线程组大小。<code>[[threads_per_threadgroup]]</code> 属性指定执行内核的给定线程组的实际线程组大小。<code>[[dispatch_threads_per_threadgroup]]</code> 属性是调度时指定的线程组大小。</p><p>核函数属性注意事项：</p><ul><li>声明 <code>[[thread_position_in_grid]]</code>、<code>[[threads_per_grid]]</code>、<code>[[thread_position_in_threadgroup]]</code>、<code>[[threads_per_threadgroup]]</code>、<code>[[threadgroup_position_in_grid]]</code>、<code>[[dispatch_threads_per_threadgroup]]</code> 和 <code>[[threadgroups_per_grid]]</code> 的类型必须是标量类型或向量类型。如果它是向量类型，则用于声明这些参数的向量类型的组件数量需要匹配。</li><li>声明 <code>[[thread_position_in_grid]]</code> 和 <code>[[threads_per_grid]]</code> 的数据类型需要匹配。</li><li>声明 <code>[[thread_position_in_threadgroup]]</code>、<code>[[threads_per_threadgroup]]</code> 和 <code>[[dispatch_threads_per_threadgroup]]</code> 的数据类型需要匹配。</li><li>如果 <code>[[thread_position_in_threadgroup]]</code> 为 <code>uint</code>、<code>uint2</code> 或 <code>uint3</code> 类型，则 <code>[[thread_index_in_threadgroup]]</code> 需要为 <code>uint</code> 类型。</li><li>用于声明 <code>[[thread_index_in_simdgroup]]</code>、<code>[[threads_per_simdgroup]]</code>、<code>[[simdgroup_index_in_threadgroup]]</code>、<code>[[simdgroups_per_threadgroup]]</code>、<code>[[dispatch_simdgroups_per_threadgroup]]</code>、<code>[[quadgroup_index_in_threadgroup]]</code>、<code>[[quadgroups_per_threadgroup]]</code> 和 <code>[[dispatch_quadgroups_per_threadgroup]]</code> 的类型需要为 <code>ushort</code> 或 <code>uint</code>。声明这些内置变量的类型需要匹配。</li><li><code>[[threads_per_simdgroup]]</code> 和 <code>[[thread_execution_width]]</code> 是引用相同概念的彼此的别名。</li></ul><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.9 - Attributes for kernel function tile input arguments</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">render_target_array_index</td><td style="white-space:pre-line;min-width:10rem;color:white">uchar, ushort, or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The render target array index, which refers to the face of a cubemap, data at a specified depth of a 3D texture, an array slice of a texture array, an array slice, or face of a cubemap array. For a cubemap, the render target array index is the face index, which is a value from 0 to 5. For a cubemap array the render target array index is computed as: array slice index * 6 + face index. </td></tr></tbody></table></center><br></div><p>macOS：自 Metal 2.3 起支持表 5.9 中的属性。</p><p>iOS：从 Metal 2 开始支持表 5.9 中的属性。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="交集函数输入属性">交集函数输入属性<a href="#交集函数输入属性" class="hash-link" aria-label="交集函数输入属性的直接链接" title="交集函数输入属性的直接链接">​</a></h3><p>表 5.10 列出了可以为自定义交集函数的参数指定的内置属性（请参阅第 5.1.6 节）。当在交集函数上指定 <code>primitive_type</code> 和 <code>intersection_tags</code> 的特定值时，可以使用一些内置属性。</p><p>例如，如果 <code>intersection_tags</code> 包含 <code>instancing</code>，则 <code>instance_id</code> 可用。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">intersection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">triangle</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> triangle_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> instancing</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> world_space_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">triangleIntersectionFunction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> uint id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">instance_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>任何该类限制都列在属性的描述中。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.10 - Attributes for intersection function input arguments</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">origin</td><td style="white-space:pre-line;min-width:10rem;color:white">float3</td><td style="white-space:pre-line;min-width:10rem;color:white">Ray origin in object space.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">direction</td><td style="white-space:pre-line;min-width:10rem;color:white">float3</td><td style="white-space:pre-line;min-width:10rem;color:white">Ray direction in object space.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">min_distance</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">Ray min distance.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">max_distance</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">Passed by reference. Returns the current closest intersection max distance. The intersector initializes the initial value with the ray’s maximum distance and the value decreases as the intersector finds intersections.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">payload</td><td style="white-space:pre-line;min-width:10rem;color:white">User type. 
Passed by reference.</td><td style="white-space:pre-line;min-width:10rem;color:white">User defined payload passed by the calling thread. Needs to be specified to allow matching payload table by intersect()(section 6.18.2).</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">geometry_id</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The per-geometry id.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">primitive_id</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The per-primitive identifier. For curves, this is a curve segment index.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">instance_id</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, uint or array_ref&lt;uint&gt;</td><td style="white-space:pre-line;min-width:10rem;color:white">The per-instance identifier. Available if intersection_tags include instancing. Since Metal 3.1, if intersection_tags include max_levels&lt;Count&gt;, the type must be array_ref&lt;uint&gt;. Otherwise, it is ushort or uint.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">world_space_origin</td><td style="white-space:pre-line;min-width:10rem;color:white">float3</td><td style="white-space:pre-line;min-width:10rem;color:white">Origin in world space. Available if intersection_tags include world_space_data.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">world_space_direction</td><td style="white-space:pre-line;min-width:10rem;color:white">float3</td><td style="white-space:pre-line;min-width:10rem;color:white">Direction in world space. Available if intersection_tags include world_space_data.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">barycentric_coord</td><td style="white-space:pre-line;min-width:10rem;color:white">float2</td><td style="white-space:pre-line;min-width:10rem;color:white">The barycentric coordinates. Available if the primitive_type is triangle and intersection tag include triangle_data.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">front_facing</td><td style="white-space:pre-line;min-width:10rem;color:white">bool</td><td style="white-space:pre-line;min-width:10rem;color:white">This value is true if the triangle front face is visible from the ray origin. Available if intersection_tags include triangle_data.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">distance</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">Distance along the ray at the triangle intersection. Available if the primitive_type is triangle.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">opaque</td><td style="white-space:pre-line;min-width:10rem;color:white">bool</td><td style="white-space:pre-line;min-width:10rem;color:white">If this primitive should be considered opaque or not. Available if the primitive_type is a bounding_box.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">instance_intersection_ function_table_offset</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">Offset into the intersection function table used to select the intersection instance.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">geometry_intersection_function_table_offset</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">Offset into the geometry object used to select to select the intersection instance.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">time 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">Ray intersection time. Available if intersection_tags include primitive_motion.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">motion_start_time 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">Motion start time for this geometry. Available if intersection_tags include primitive_motion.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">motion_end_time 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">Motion end time for this geometry. Available if intersection_tags include primitive_motion.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">key_frame_count 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">Number of key frames. Available if intersection_tags include primitive_motion.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">object_to_world_transform 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">float4x3</td><td style="white-space:pre-line;min-width:10rem;color:white">Object space to world space transformation matrix. Available if intersection_tags include instancing and world_space_data. If intersection_tags include instance_motion, the matrix is interpolated based on the time.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">world_to_object_transform 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">float4x3</td><td style="white-space:pre-line;min-width:10rem;color:white">World space to object space transformation matrix. Available if intersection_tags include instancing and world_space_data. If intersection_tags include instance_motion, the matrix is interpolated based on the time.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">user_instance_id 
All OS: Since Metal 2.4.</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, uint or array_ref&lt;uint&gt;</td><td style="white-space:pre-line;min-width:10rem;color:white">User defined instance id. Available if intersection_tags include instancing. Since Metal 3.1, if intersection_tags include max_levels&lt;Count&gt;, the type must be array_ref&lt;uint&gt;. Otherwise, it is ushort or uint.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">primitive_data 
Since Metal 3.</td><td style="white-space:pre-line;min-width:10rem;color:white">const device T* or const device T&amp;</td><td style="white-space:pre-line;min-width:10rem;color:white">Per-primitive data. The data is read-only and passed in the device address space.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">curve_parameter 
Since Metal 3.1</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">The value which would need to be passed to the curve basis functions to reconstruct the position corresponding to the intersection along the curve segment. This will be exactly 0.0F or 1.0F if, and only if, the ray intersects a curve end cap or elbow. Available if intersection_tags include curve_data. See section 6.18.6 for a set of curve utility functions.</td></tr></tbody></table></center><br></div><p>对于顶点属性 <code>v0</code>、<code>v1</code> 和 <code>v2</code>，指定重心点处的属性值为：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">v1 </span><span class="token operator">*</span><span class="token plain"> barycentric_coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">x </span><span class="token operator">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">v2 </span><span class="token operator">*</span><span class="token plain"> barycentric_coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">y </span><span class="token operator">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">v0 </span><span class="token operator">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1.0f</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">barycentric_coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">x </span><span class="token operator">+</span><span class="token plain"> barycentric_coord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>具有 <code>[[payload]]</code> 属性的参数的类型采用 <code>ray_data T &amp;</code> 形式。它通过引用传递给交集函数，并分配在 <code>ray_data</code> 地址空间中。有效负载的类型 <code>T</code> 可以是或包含以下类型：</p><ul><li><code>device</code> 或 <code>constant</code> 指针或引用</li><li>整数类型</li><li>枚举类型</li><li>浮点类型</li><li>向量类型</li><li>该类类型的数组</li><li>结构体和联合体（<code>atomic&lt;T&#x27;&gt;</code> 和 <code>imageblock&lt;T&#x27;&gt;</code> 除外）。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="交集函数输出属性">交集函数输出属性<a href="#交集函数输出属性" class="hash-link" aria-label="交集函数输出属性的直接链接" title="交集函数输出属性的直接链接">​</a></h3><p>表 5.11 列出了可以为 <code>[[intersection(primitive_type, intersection_tags...)]]</code> 函数的返回类型指定的内置属性（及其相应的数据类型）。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.11 - Attributes for intersection return types</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">accept_intersection</td><td style="white-space:pre-line;min-width:10rem;color:white">bool</td><td style="white-space:pre-line;min-width:10rem;color:white">If true, this primitive becomes the next committed hit: if it is the nearest, it will be returned from intersect().</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">continue_search</td><td style="white-space:pre-line;min-width:10rem;color:white">bool</td><td style="white-space:pre-line;min-width:10rem;color:white">If the hit is accepted ([[accept_intersection]] == true), continue_search indicates if the search should continue. If continue_search is true, intersect() will continue to search for a closer hit. If false, no further searching is done. The current nearest hit is returned from intersect(). Defaults to true. Even if true is returned, a committed hit will immediately halt searching if accept_any_intersection() is true.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">distance</td><td style="white-space:pre-line;min-width:10rem;color:white">float</td><td style="white-space:pre-line;min-width:10rem;color:white">This returns the distance along the ray of a hit found within the bounding box. If the hit is rejected ([[accept_intersection]] == false), this return value is ignored. Available if the primitive_type is a bounding_box.</td></tr></tbody></table></center><br></div><p>对于三角形交集函数，<code>[[accept_intersection]]</code> 是唯一需要的返回值。如果函数返回一个不带属性的 <code>bool</code>，则假定为 <code>[[accept_intersection]]</code>。</p><p><code>[[distance]]</code> 的值需要大于或等于 <code>[[min_distance]]</code> 的值，并且需要小于或等于 <code>[[max_distance]]</code> 的值，并且在自定义图元的边界框内（包括在内），或者结果未定义。如果 <code>[[distance]]</code> 的值与 <code>[[max_distance]]</code> 的值相同，则接受此命中优先于相同距离的前一个命中。</p><p>无论交集函数如何返回，对光线有效负载所做的任何更改都会生效：被拒绝的基元可能会对内存产生副作用，这些副作用可以由未来的交集着色器线程观察到。</p><p>即使对于被拒绝的原语，也会写入设备内存。这些写入通过通常的内存一致性和一致性规则对其它线程可见（目前，只有原子是一致的，并且仅支持宽松的一致性）。即使光线不与图元的边界框相交，也可以调用相交函数。例如，实现可以将多个基元分组到一个加速结构叶节点中。</p><p>下面是边界框的交集函数的示例。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">IntersectionResult</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> continueSearch </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">continue_search</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> accept </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">accept_intersection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token plain"> distance </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">distance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">intersection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bounding_box</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> IntersectionResult </span><span class="token function" style="color:rgb(80, 250, 123)">sphereIntersectionFunction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        float3 origin </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">origin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        float3 direction </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">direction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        uint primitiveIndex </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">primitive_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ray_data float2</span><span class="token operator">&amp;</span><span class="token plain"> resources </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token plain"> min_distance </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">min_distance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token plain"> max_distance </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">max_distance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="对象函数输入属性">对象函数输入属性<a href="#对象函数输入属性" class="hash-link" aria-label="对象函数输入属性的直接链接" title="对象函数输入属性的直接链接">​</a></h3><p>所有操作系统：自 Metal 3 起</p><p>所有操作系统：从 Metal 3.1 开始，全局变量现在可以指定这些属性，除非在动态库或单独编译的二进制函数中使用。</p><p>对象函数使用与内核函数相同的执行模型（参见第 5.2.3.6 节），它在 N 维线程网格上执行。对象函数参数可以是 <code>samplers</code>、<code>textures</code>、<code>mesh_grid_properties</code> 类型的参数以及 <code>device</code>、<code>constant</code> 和 <code>threadgroup</code> 地址空间中的缓冲区。</p><p>对象函数支持内核函数的内置属性的子集以及 <code>[[amplification_count]]</code> 和 <code>[[payload]]</code>。<code>[[amplification_count]]</code> 的语义与第 5.2.3.1 节顶点函数输入属性中的相同。表 5. 12 列出了可以为对象函数的参数指定的内置属性以及可以使用它们的相应数据类型。从 Metal 3.1 开始，表 5. 12 中的内置属性可以在程序范围变量上指定，但 <code>amplification_count</code> 和 <code>payload</code> 除外。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.12 - Attributes for Object Function</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">amplification_count</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The number of output vertices produced for each vertex instance.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">dispatch_quadgroups_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The quad-group execution width of a threadgroup specified at dispatch.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">dispatch_simdgroups_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The SIMD-group execution width of a threadgroup specified at dispatch.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">dispatch_threads_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a threadgroup for threads specified at dispatch.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">payload</td><td style="white-space:pre-line;min-width:10rem;color:white">Pointer or l-value reference to User Defined T in object_data address space</td><td style="white-space:pre-line;min-width:10rem;color:white">The payload is data passed to the mesh shader from the object shader. The payload pointer or reference is the same for all threads in the threadgroup. The payload memory is assumed uninitialized at the entry of the object function.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">quadgroup_index_in_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a quad-group within a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">quadgroups_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The quad-group execution width of a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">simdgroup_index_in_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a SIMD-group within a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">simdgroups_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The SIMD-group execution width of a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_quadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_simdgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_position_in_grid</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread’s position in an N-dimensional grid of threads.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_position_in_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread’s unique position within a threadgroup</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threadgroup_position_in_grid</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The threadgroup’s unique position within a grid.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threadgroups_per_grid</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The number of threadgroups in a grid.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_grid</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The grid size.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_simdgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a threadgroup.</td></tr></tbody></table></center><br></div><p>对象函数属性与内核函数属性具有相同的限制：</p><ul><li>声明 <code>[[thread_position_in_grid]]</code>、<code>[[threads_per_grid]]</code>、<code>[[thread_position_in_threadgroup]]</code>、<code>[[threads_per_threadgroup]]</code>、<code>[[threadgroup_position_in_grid]]</code>、<code>[[dispatch_threads_per_threadgroup]]</code> 和 <code>[[threadgroups_per_grid]]</code> 的类型必须是标量类型或向量类型。如果它是向量类型，则用于声明这些参数的向量类型的组件数量需要匹配。</li><li>声明 <code>[[thread_position_in_grid]]</code> 和 <code>[[threads_per_grid]]</code> 的数据类型需要匹配。</li><li>声明 <code>[[thread_position_in_threadgroup]]</code>、<code>[[threads_per_threadgroup]]</code> 和 <code>[[dispatch_threads_per_threadgroup]]</code> 的数据类型需要匹配。</li><li>如果 <code>[[thread_position_in_threadgroup]]</code> 为 <code>uint</code>、<code>uint2</code> 或 <code>uint3</code> 类型，则 <code>[[thread_index_in_threadgroup]]</code> 需要为 <code>uint</code> 类型。</li><li>用于声明 <code>[[thread_index_in_simdgroup]]</code>、<code>[[threads_per_simdgroup]]</code>、<code>[[simdgroup_index_in_threadgroup]]</code>、<code>[[simdgroups_per_threadgroup]]</code>、<code>[[dispatch_simdgroups_per_threadgroup]]</code>、<code>[[quadgroup_index_in_threadgroup]]</code>、<code>[[quadgroups_per_threadgroup]]</code> 和 <code>[[的类型dispatch_quadgroups_per_threadgroup]]</code> 需要为 <code>ushort</code> 或 <code>uint</code>。声明这些内置变量的类型需要匹配。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="网格函数输入属性">网格函数输入属性<a href="#网格函数输入属性" class="hash-link" aria-label="网格函数输入属性的直接链接" title="网格函数输入属性的直接链接">​</a></h3><p>所有操作系统：自 Metal 3 起</p><p>所有操作系统：从 Metal 3.1 开始，全局变量现在可以指定这些属性，除非它们在动态库或单独编译的二进制函数中使用。</p><p>网格函数使用与内核函数相同的执行模型（请参阅第 5.2.3.6 节），它在 N 维线程网格上执行。网格函数参数可以来自 <code>samplers</code>、<code>textures</code>、<code>mesh&lt;V, P, NV, NP, t&gt;</code> 类型的参数以及 <code>device</code> 和 <code>constant</code> 的缓冲区。如果网格函数具有 <code>mesh&lt;V, P, NV, NP,t&gt;</code> 参数，则它指向表示要导出的网格的内存的不透明句柄。由 <code>mesh&lt;V, P, NV, NP,t&gt;</code> 参数引用的底层内存在给定线程组的线程之间共享。</p><p>网格函数支持内核函数内置属性的子集以及 <code>[[amplification_count]]</code>、<code>[[amplification_id]]</code> 和 <code>[[payload]]</code> 属性。<code>[[amplification_count]]</code> 和 <code>[[amplification_id]]</code> 的语义与第 5.2.3.1 节顶点函数输入属性中的相同。表 5.13 列出了可以为网格函数的参数指定的内置属性以及可以使用它们的相应数据类型。</p><p>从 Metal 3.1 开始，表 5.13 中的内置属性可以在程序范围变量上指定，但 <code>amplification_count</code>、<code>amplification_id</code> 和 <code>payload</code> 除外。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div><strong>Table 5.13 - Attributes for Mesh Function</strong></div><br><center style="max-width:90%"><table><thead><th>Attribute</th><th>Corresponding Data Types</th><th>Description</th></thead><tbody><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">amplification_count</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The number of output vertices produced for each primitive instance.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">amplification_id</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The array index offset mappings for viewport and render target array indices, which enables routing an amplified vertex to a different viewport and render target.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">dispatch_quadgroups_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The quad-group execution width of a threadgroup specified at dispatch.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">dispatch_simdgroups_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The SIMD-group execution width of a threadgroup specified at dispatch.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">dispatch_threads_per_threa dgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a threadgroup for threads specified at dispatch.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">payload</td><td style="white-space:pre-line;min-width:10rem;color:white">Pointer or l-value reference to User Defined T in object_data address space. Needs to be const qualified.</td><td style="white-space:pre-line;min-width:10rem;color:white">The payload is data passed to the mesh shader from the object shader. The payload pointer or reference is the same for all threads in the mesh grid,. The payload memory is read-only in the mesh function.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">quadgroup_index_in_threadg roup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a quad-group within a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">quadgroups_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The quad-group execution width of a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">simdgroup_index_in_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a SIMD-group within a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">simdgroups_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The SIMD-group execution width of a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_quadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a quad-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_simdgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_index_in_threadgrou p</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The scalar index of a thread within a threadgroup.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_position_in_grid</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread’s position in an N-dimensional grid of threads.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">thread_position_in_threadg roup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread’s unique position within a threadgroup</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threadgroup_position_in_grid</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The threadgroup’s unique position within a grid.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threadgroups_per_grid</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The number of threadgroups in a grid.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_grid</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The grid size.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_simdgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort or uint</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a SIMD-group.</td></tr><tr><td style="white-space:pre-line;min-width:10rem;color:#BDBDBD">threads_per_threadgroup</td><td style="white-space:pre-line;min-width:10rem;color:white">ushort, ushort2, ushort3, uint, uint2, or uint3</td><td style="white-space:pre-line;min-width:10rem;color:white">The thread execution width of a threadgroup.</td></tr></tbody></table></center><br></div><p>网格函数属性与核函数属性具有相同的限制：</p><ul><li>声明 <code>[[thread_position_in_grid]]</code>、<code>[[threads_per_grid]]</code>、<code>[[thread_position_in_threadgroup]]</code>、<code>[[threads_per_threadgroup]]</code>、<code>[[threadgroup_position_in_grid]]</code>、<code>[[dispatch_threads_per_threadgroup]]</code> 和 <code>[[threadgroups_per_grid]]</code> 的类型必须是标量类型或向量类型。如果它是向量类型，则用于声明这些参数的向量类型的组件数量需要匹配。</li><li>声明 <code>[[thread_position_in_grid]]</code> 和 <code>[[threads_per_grid]]</code> 的数据类型需要匹配。</li><li>声明 <code>[[thread_position_in_threadgroup]]</code>、<code>[[threads_per_threadgroup]]</code> 和 <code>[[dispatch_threads_per_threadgroup]]</code> 的数据类型需要匹配。</li><li>如果 <code>[[thread_position_in_threadgroup]]</code> 为 <code>uint</code>、<code>uint2</code> 或 <code>uint3</code> 类型，则 <code>[[thread_index_in_threadgroup]]</code> 需要为 <code>uint</code> 类型。</li><li>用于声明 <code>[[thread_index_in_simdgroup]]</code>、<code>[[threads_per_simdgroup]]</code>、<code>[[simdgroup_index_in_threadgroup]]</code>、<code>[[simdgroups_per_threadgroup]]</code>、<code>[[dispatch_simdgroups_per_threadgroup]]</code>、<code>[[quadgroup_index_in_threadgroup]]</code>、<code>[[quadgroups_per_threadgroup]]</code> 和 <code>[[的类型dispatch_quadgroups_per_threadgroup]]</code> 需要为 <code>ushort</code> 或 <code>uint</code>。声明这些内置变量的类型需要匹配。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="输入组件属性">输入组件属性<a href="#输入组件属性" class="hash-link" aria-label="输入组件属性的直接链接" title="输入组件属性的直接链接">​</a></h2><p>顶点函数输出和光栅化器生成的片段成为片段函数的每个片段输入。<code>[[stage_in]]</code> 属性可以组合每个片段的输入。</p><p>顶点函数可以通过使用顶点和实例 ID 作为参数传递给顶点函数的缓冲区进行索引来读取每个顶点的输入。要组装每个顶点的输入并将它们作为参数传递给顶点函数，请使用 <code>[[stage_in]]</code> 属性声明输入。</p><p>内核函数通过使用网格中的线程位置或线程组 ID 中的线程位置作为参数传递给内核函数的缓冲区或纹理进行索引来读取每个线程的输入。此外，要将每个线程输入作为参数传递给内核函数，请使用 <code>[[stage_in]]</code> 属性声明输入。</p><p>你只能使用 <code>[[stage_in]]</code> 属性声明顶点、片段或核函数的一个参数。对于使用 <code>[[stage_in]]</code> 属性声明的用户定义结构，该结构的成员可以是：</p><ul><li>标量整数或浮点值。</li><li>整数或浮点值向量。</li><li>片段函数输入的 <code>interpolant&lt;T,P&gt;</code> 值。</li></ul><p>不能使用 <code>stage_in</code> 属性来声明压缩向量、矩阵、结构、位域、类型引用或指针、标量、向量或矩阵数组的结构成员。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="顶点函数输出示例">顶点函数输出示例<a href="#顶点函数输出示例" class="hash-link" aria-label="顶点函数输出示例的直接链接" title="顶点函数输出示例的直接链接">​</a></h3><p>以下示例显示如何使用 <code>stage_in</code> 属性传递每个顶点的输入：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 texcoord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexInput</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 normal   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    half4 color     </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    half2 texcoord  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> constant uint MAX_LIGHTS </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">LightDesc</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    uint   num_lights</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 light_attenuation_factors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">MAX_LIGHTS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">constexpr</span><span class="token plain"> sampler s </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sampler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">coord</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">normalized</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              address</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">clamp_to_zero</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              filter</span><span class="token double-colon punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token plain">linear</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vertex VertexOutput </span><span class="token function" style="color:rgb(80, 250, 123)">render_vertex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">VertexInput v_in </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">stage_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  constant float4x4</span><span class="token operator">&amp;</span><span class="token plain"> mvp_matrix </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  constant LightDesc</span><span class="token operator">&amp;</span><span class="token plain"> lights </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">buffer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  uint v_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">vertex_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    VertexOutput v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">position </span><span class="token operator">=</span><span class="token plain"> v_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">position </span><span class="token operator">*</span><span class="token plain"> mvp_matrix</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">color </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">do_lighting</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> v_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> lights</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> v_out</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="片段函数输入示例">片段函数输入示例<a href="#片段函数输入示例" class="hash-link" aria-label="片段函数输入示例的直接链接" title="片段函数输入示例的直接链接">​</a></h3><p>5.2.3.3 节中的示例之前介绍了 <code>process_vertex</code> 顶点函数，该函数为每个顶点返回一个 <code>VertexOutput</code> 结构。在以下示例中，<code>process_vertex</code> 的输出经过管道化，成为名为 <code>render_pixel</code> 的片段函数的输入，因此片段函数的第一个参数使用 <code>[[stage_in]]</code> 属性并使用传入的 <code>VertexOutput</code> 类型。（在 <code>render_pixel</code> 中，<code>imgA</code> 和 <code>imgB</code> 2D 纹理调用内置函数 <code>sample</code>，该函数在 6.12.3 节中介绍）。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexOutput2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 color</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 texcoord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">VertexInputData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 position</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 normal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float2 texcoord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="内核函数每线程输入示例">内核函数每线程输入示例<a href="#内核函数每线程输入示例" class="hash-link" aria-label="内核函数每线程输入示例的直接链接" title="内核函数每线程输入示例的直接链接">​</a></h3><p>以下示例演示如何使用 <code>stage_in</code> 属性传递每线程输入。内核函数中的 <code>stage_in</code> 属性允许你将用于声明函数中每线程输入的数据类型与用于存储每线程输入的实际数据类型解耦。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name">PerThreadInput</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float4 a </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    float3 b </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    half4 c  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    half2 d  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token function" style="color:rgb(80, 250, 123)">attribute</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kernel </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">my_kernel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">PerThreadInput thread_input </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">stage_in</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                      uint t_id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">thread_position_in_grid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zhuanghongji/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables/index.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2023-10-22T04:45:09.000Z">2023年10月22日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/swift-tutorials-cn/docs/metal-shading-language-specification/functions"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">函数</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/swift-tutorials-cn/docs/metal-shading-language-specification/storage-class-specifiers"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">存储类说明符</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#定位缓冲区纹理和采样器参数" class="table-of-contents__link toc-highlight">定位缓冲区、纹理和采样器参数</a><ul><li><a href="#具有资源和输出到设备内存的顶点函数示例" class="table-of-contents__link toc-highlight">具有资源和输出到设备内存的顶点函数示例</a></li><li><a href="#光栅顺序组" class="table-of-contents__link toc-highlight">光栅顺序组</a></li></ul></li><li><a href="#定位每个顶点输入的属性" class="table-of-contents__link toc-highlight">定位每个顶点输入的属性</a></li><li><a href="#内置变量的属性" class="table-of-contents__link toc-highlight">内置变量的属性</a><ul><li><a href="#顶点函数输入属性" class="table-of-contents__link toc-highlight">顶点函数输入属性</a></li><li><a href="#曲面细分后顶点函数输入属性" class="table-of-contents__link toc-highlight">曲面细分后顶点函数输入属性</a></li><li><a href="#顶点函数输出属性" class="table-of-contents__link toc-highlight">顶点函数输出属性</a></li><li><a href="#片段函数输入属性" class="table-of-contents__link toc-highlight">片段函数输入属性</a></li><li><a href="#片段函数输出属性" class="table-of-contents__link toc-highlight">片段函数输出属性</a></li><li><a href="#内核函数输入属性" class="table-of-contents__link toc-highlight">内核函数输入属性</a></li><li><a href="#交集函数输入属性" class="table-of-contents__link toc-highlight">交集函数输入属性</a></li><li><a href="#交集函数输出属性" class="table-of-contents__link toc-highlight">交集函数输出属性</a></li><li><a href="#对象函数输入属性" class="table-of-contents__link toc-highlight">对象函数输入属性</a></li><li><a href="#网格函数输入属性" class="table-of-contents__link toc-highlight">网格函数输入属性</a></li></ul></li><li><a href="#输入组件属性" class="table-of-contents__link toc-highlight">输入组件属性</a><ul><li><a href="#顶点函数输出示例" class="table-of-contents__link toc-highlight">顶点函数输出示例</a></li><li><a href="#片段函数输入示例" class="table-of-contents__link toc-highlight">片段函数输入示例</a></li><li><a href="#内核函数每线程输入示例" class="table-of-contents__link toc-highlight">内核函数每线程输入示例</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://developer.apple.com/xcode/swiftui/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI Overview</a></li><li class="footer__item"><a href="https://developer.apple.com/documentation/swiftui/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI Documentation</a></li><li class="footer__item"><a href="https://developer.apple.com/videos/swiftui-ui-frameworks" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI &amp; UI Frameworks Videos</a></li><li class="footer__item"><a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/" target="_blank" rel="noopener noreferrer" class="footer__link-item">The Swift Programming Language</a></li></ul></div><div class="col footer__col"><div class="footer__title">参考</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.fatbobman.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Fatbob Man</a></li><li class="footer__item"><a href="https://designcode.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Design Code</a></li><li class="footer__item"><a href="https://www.swiftanytime.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Swift Anytime</a></li><li class="footer__item"><a href="https://www.hackingwithswift.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Hacking With Swift</a></li></ul></div><div class="col footer__col"><div class="footer__title">探索</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/@Kavsoft" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kavsoft</a></li><li class="footer__item"><a href="https://www.youtube.com/@ChaoCode" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chao Code</a></li><li class="footer__item"><a href="https://www.youtube.com/@iOSAcademy" target="_blank" rel="noopener noreferrer" class="footer__link-item">iOS Academy</a></li><li class="footer__item"><a href="https://www.youtube.com/@XCA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Xcoding with Alfian</a></li></ul></div><div class="col footer__col"><div class="footer__title">发现</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/swift-tutorials-cn/sponsor-me">Sponsor Me</a></li><li class="footer__item"><a class="footer__link-item" href="/swift-tutorials-cn/sponsor-list">Sponsor List</a></li><li class="footer__item"><a href="https://twitter.com/ajizhhans" target="_blank" rel="noopener noreferrer" class="footer__link-item">Follow Twitter</a></li><li class="footer__item"><a href="https://github.com/zhuanghongji" target="_blank" rel="noopener noreferrer" class="footer__link-item">Follow GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ZHUANGHONGJI<br><a style="font-size: 12px;color: white;" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0) License</a></div></div></div></footer></div>
<script src="/swift-tutorials-cn/assets/js/runtime~main.b26d0e19.js"></script>
<script src="/swift-tutorials-cn/assets/js/main.03dc0736.js"></script>
</body>
</html>