# 作为 ULP 的相对误差

<OrigninalPDF title="7.4 Relative Error as ULPs" />

表 7. 1 描述了以 ULP 值给出的单精度浮点基本算术运算和数学函数的最低精度。用于计算算术运算的 ULP 值的参考值是无限精确的结果。

`表 7. 1. 单精度浮点运算和函数的精度`

`数学函数最小精度（ULP 值）`

`x + y 正确舍入`

`x - y 正确舍入`

`x * y 正确舍入`

`1.0 / x 正确舍入`

`x / y 正确舍入`

**数学函数最低精度（ULP 值）**

```
acos <= 4 ulp

acosh <= 4 ulp

asin <= 4 ulp

asinh <= 4 ulp

阿坦 <= 5 ulp

atan2 <= 6 ulp

atanh <= 5 ulp

ceil 正确舍入

复制签名 0 ulp

cos <= 4 ulp

科什 <= 4 ulp

cospi <= 4 ulp

exp <= 4 ulp

exp2 <= 4 ulp

exp10 <= 4 ulp

晶圆厂 0 ulp

fdim 正确舍入

地板正确倒圆

fma 正确舍入

最大频率 0 超低功率

fmin 0 ulp

fmod 0 超低功耗

fract 正确舍入

frexp 0 ulp

ilogb 0 ulp

ldexp 正确舍入

日志 <= 4 ulp

log2 <= 4 ulp

`数学函数最小精度（ULP 值）`

`log10 <= 4 ulp`

`modf 0 ulp`

`nextafter 0 ulp`

`pow <= 16 ulp`

`功率 <= 16 ulp`

` rint 正确舍入`

`round 正确的圆角`

`rsqrt 正确舍入`

`sin <= 4 ulp`

`sincos <= 4 ulp`

`sinh <= 4 ulp`

`sinpi <= 4 ulp`

`sqrt 正确舍入`

`tan <= 6 ulp`

`tanpi <= 6 ulp`

`tanh <= 5 ulp`

` trunc 正确舍入`

```

表 7. 2 描述了单精度浮点算术运算的最低精度，以启用快速数学的 ULP 值给出（这是默认值，除非你指定

- fno-fast-math 作为编译器选项）。

## 表 7.2。启用快速数学的单精度运算和函数的准确性

`数学函数最小精度（ULP 值）`

`x + y 正确舍入`

`x - y 正确舍入`

`x * y 正确舍入`

`对于 2 -^126 到 2126 域中的 x，1.0 / x <= 1 ulp`

**数学函数最低精度（ULP 值）**

```
对于 2 -^126 到 2126 域中的 y，x / y <= 2.5 ulp

对于域 [-1, 1] 中的 x，acos(x) <= 5 ulp

acosh(x) 实现为 log(x + sqrt(x \* x - 1.0))

对于域 [-1, 1] 和 |x| 中的 x，asin(x) <= 5 ulp >= 2 -^125

asinh(x) 实现为 log(x + sqrt(x \* x + 1.0))

atan(x) <= 5 ulp

atanh(x) 实现为 0.5 \* (log( (1.0 + x) / (1.0 - x) )

atan2(y, x) 实现为 x > 0 ，atan(y / x)，如果 x < 0 且 y > 0 ，atan(y / x) + M_PI_F 如果 x < 0 且 y < 0 ，atan(y / x) - M_PI_F 并且如果 x = 0 且 y = 0 ，则未定义。

cos(x) 对于域 [-pi, pi] 中的 x，最大绝对误差 <= 2 -^13，否则更大。

cosh(x) 实现为 0.5 \* (exp(x) + exp(-x))

cospi(x) 对于域 [-1, 1] 中的 x，最大绝对误差 <= 2 -^13，否则更大。

exp(x) <= 3 + 楼层(fabs(2 \* x)) ulp

exp2(x) <= 3 + 楼层(fabs(2 \* x)) ulp

exp10(x) 实现为 exp2(x \* log2(10))
```

晶圆厂 0 ulp

fdim 正确舍入

地板正确倒圆

fma 正确舍入

最大频率 0 超低功率

fmin 0 ulp

fmod 未定义

fract 正确舍入

frexp 0 ulp

ilogb 0 ulp

`数学函数最小精度（ULP 值）`

`ldexp 正确舍入`

` log(x) 对于域 [0.5, 2] 中的 x，最大绝对误差为 <= 2 -^21 ；否则，如果 x > 0，则最大误差 <= 3 ulp；否则结果是不确定的。`

` log2(x) 对于域 [0.5, 2] 中的 x，最大绝对误差为 <= 2 -^22 ；否则，如果 x > 0，则最大误差 <= 2 ulp；否则结果是不确定的。`

`log10(x) 实现为 log2(x) * log10(2)`

`modf 0 ulp`

` pow(x, y) 实现为 exp2(y * log2(x))。x = 0 和 y = 0 时未定义。`

` powr(x, y) 实现为 exp2(y * log2(x))。x = 0 和 y = 0 时未定义。`

` rint 正确舍入`

`round(x) 正确舍入`

`rsqrt <= 2 ulp`

` sin(x) 对于域 [-pi, pi] 中的 x，最大绝对误差 <= 2 -^13，否则更大。`

`sinh(x) 实现为 0.5 * (exp(x) - exp(-x))`

`sincos(x) ULP 值定义为 sin(x) 和 cos(x)`

` sinpi(x) 对于域 [-1, 1] 中的 x，最大绝对误差 <= 2 -^13，否则更大。`

``` sqrt(x) 实现为 x \* rsqrt(x)，并正确处理特殊情况。````

`tan(x) 实现为 sin(x) * (1.0 / cos(x))`

tanh(x) (^) 实现为 (t - 1.0)/(t + 1.0)，其中 t = exp(2.0 _ x) tanpi(x) 实现为 tan(x _ pi) trunc 正确舍入 表 7. 3 描述以 ULP 值给出的半精度浮点基本算术运算和数学函数的最低精度。表 7. 3 适用于 iOS 和 macOS，从 MTLGPUFamilyApple4 硬件开始。

## 表 7.3。半精度浮点运算和函数的精度

`数学函数最小精度（ULP 值）`

`x + y 正确舍入`

`x - y 正确舍入`

`x * y 正确舍入`

`1.0 / x 正确舍入`

`x / y 正确舍入`

`acos(x) <= 1 ulp`

`acosh(x) <= 1 ulp`

`asin(x) <= 1 ulp`

`asinh(x) <= 1 ulp`

`atan(x) <= 1 ulp`

`atanh(x) <= 1 ulp`

`atan2(y, x) <= 1 ulp`

`cos(x) <= 1 ulp`

`cosh(x) <= 1 ulp`

`cospi(x) <= 1 ulp`

`exp(x) <= 1 ulp`

`exp2(x) <= 1 ulp`

`exp10(x) <= 1 ulp`

`晶圆厂 0 ulp`

`fdim 正确舍入`

`地板正确倒圆`

`fma 正确舍入`

`fmax 0 ulp`

`fmin 0 ulp`

`fmod 0 ulp`

` fract 正确舍入`

`数学函数最小精度（ULP 值）`

`frexp 0 ulp`

`ilogb 0 ulp`

`ldexp 正确舍入`

`log(x) <= 1 ulp`

`log2(x) <= 1 ulp`

`log10(x) <= 1 ulp`

`modf 0 ulp`

`nextafter 0 ulp`

` rint 正确舍入`

`round(x) 正确舍入`

`rsqrt 正确舍入`

`sin(x) <= 1 ulp`

`sinh(x) <= 1 ulp`

`sincos(x) ULP 值定义为 sin(x) 和 cos(x)`

`sinpi(x) <= 1 ulp`

`sqrt(x) 正确舍入`

`tan(x) <= 1 ulp`

`tanh(x) <= 1 ulp`

`tanpi(x) <= 1 ulp`

` trunc 正确舍入`

表 7. 4 描述了以 ULP 值给出的大脑浮点基本算术运算和数学函数的最低精度。表 7. 4 适用于所有操作系统，从 MTLGPUFamilyApple 6 或 MTLGPUFamilyMac2 硬件开始。

## 表 7.4。大脑浮点运算和函数的准确性

`数学函数最小精度（ULP 值）`

`x + y 正确舍入`

`x - y 正确舍入`

`数学函数最小精度（ULP 值）`

`x * y 正确舍入`

`1.0 / x 正确舍入`

`x / y 正确舍入`

## 表 7.5。启用快速数学的大脑浮点运算和函数的准确性

`数学函数最小精度（ULP 值）`

`x + y 正确舍入`

`x - y 正确舍入`

`x * y 正确舍入`

`1.0 / x <= 0. 6 ulp，对于 2 -^126 到 2126 域中的 x`

`x / y <= 0. 6 ulp 对于 2 -^126 到 2126 域中的 y`

尽管表 7. 1 、表 7. 2 、表 7. 3 、表 7. 4 和表 7. 5 中指定了各个数学运算和函数的精度，但 Metal 编译器在快速数学模式下（请参阅 1.5.5)，可以进行各种优化，例如重新关联浮点运算，这可能会显着改变浮点结果。重新关联可能会更改或忽略零的符号，允许优化假设参数和结果不是 NaN 或 +/-INF，抑制或创建下溢或溢出，因此不能出现在依赖于舍入行为（例如 (x + 252) 的代码中） ) - 252 ，或有序浮点比较。

ULP 定义如下：

如果 x 是位于两个连续浮点数 a 和 b 之间的实数，且不等于其中之一，则 ulp(x) = |b − a|，否则 ulp(x) 是两者之间的距离最接近 x 的两个不相等的 !nite 浮点数。此外，ulp(NaN) 是 NaN。
