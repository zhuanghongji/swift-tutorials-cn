# 介绍

<Screenshot src={require("../figures/000.jpg")} size={480} />

# 前言

2014 年，苹果宣布了一项改变游戏规则的创新，动摇了 30 年来的既定范式，并引起了计算领域的普遍兴奋。然后，10 分钟后，它介绍了 Swift。

如果你问大多数 Cocoa 开发者 2014 年最令人兴奋的开发是什么，他们绝大多数都会提到 Swift。但 Swift 并不是苹果当年宣布的唯一创新——它宣布的游戏规则改变者是 Metal，一种新的 GPU 编程框架。几十年来，iOS 上默认的低级图形框架是 OpenGL ES。多年来，OpenGL 已经变得非常有限且粗糙。它没有充分利用 GPU。它不允许像较新的 API 和框架那样进行通用 GPU 编程。苹果没有采用这些框架，而是选择像往常一样推出自己的实现。

多年来，我看到很多人尝试学习 Metal 但都失败了。他们选择 Metal 有不同的原因。许多人想证明他们可以学习一些困难的东西。有些人对低级图形的工作原理感兴趣。有些人想做科学计算。图形编程是一个极其庞大且多样化的主题，很容易被大量的学习信息淹没。这本书是我多年来尝试学习图形编程并了解人们容易迷失和放弃的地方的产物。

## 谁应该读这本书

本书主要针对对图形编程感兴趣但不知道从哪里开始的 iOS 程序员。这本书的格式是我多年来尝试学习 OpenGL 过程中遭遇的挫折而诞生的。有大量书籍详细介绍了该框架，但从未明确说明人们可以使用该框架做什么。他们假设了解纹理和投影矩阵等术语，这会给刚入门的人带来很多困惑。

本书假定读者具备 Swift 基础知识。如果你的目的只是为了理解这些概念，那么你即使不是 Swift 专家也能过得去。然而，如果你是 iOS 新手，并且指望这本书来解释 Swift 和 Xcode，那么这本书并不是最好的起点。有许多很棒的资源可用于学习 Swift 和 iOS 概念。

本书不针对那些正在突破 Metal 功能界限的人。 Metal 是一个非常广泛的主题，本书重点概述该主题，为新手提供足够的入门信息。它没有深入探讨构建 Unity 级游戏引擎或高度复杂的循环神经网络的细微差别。如果你有这样的目标，这本书是一个很好的第一步，应该为你提供坚实的基础来构建你的知识。

## 本书的结构

在本书中，我们讨论 Metal 编程框架。该框架有两个组成部分：图形和计算。本书对创建有用的东西所需的概念以及 Metal 中的特定代码实现进行了概念性概述。

本书的开头是基础章节，解释了你需要理解的概念，以便学习后面的章节。直接跳到神经网络的最后几章可能很诱人，但这些章节假设你已经阅读了之前的大部分内容，如果你没有粗略地了解前面介绍的概念，那么这些章节就没有意义。

第一部分“ Metal 基础知识”涵盖介绍性 Metal 和图形概念。第 1、2 和 3 章与网站或会议上的 Metal 介绍性教程中的大部分内容相关。

在第二部分“渲染和图形”中，你将进入更多特定于图形的库和概念。第 4 章到第 14 章涵盖了特定的 Metal 类、数学以及 Metal 着色语言的介绍。其中一些章节适用于图形和数据处理，这将在第三部分“数据并行编程”中讨论。

第三部分向你介绍 Metal 计算管道。第 15 章到第 20 章详细介绍了 Metal 计算管道，并概述了 GPGPU 编程的实际应用。

以下是各章的简要说明。第一部分重点介绍 Metal 图形编程的历史和基础：

- 第 1 章“什么是 Metal？”概述了 Metal 编程和图形编程的历史。它还解释了本书的范围。 - 第 2 章“渲染和光栅图形概述”详细介绍了 Metal 渲染管道的工作原理。本章让你了解所有部分如何连接在一起。 - 第 3 章，“你的第一个 Metal 应用程序（你好，Triangle！）”提供了一个基本项目，向你介绍启动和运行最基本的 Metal 项目所需的所有 Metal 对象。

第二部分介绍了 Metal 渲染管道以及在 iPhone 上实现 3D 图形所需的概念。

- 第 4 章，“图形基础数学”，回顾了着色器编程中使用的数学概念。本章旨在为至少 10 年没有使用过 TI-83 的读者提供温和的复习，但它应该对任何人都有用。 - 第 5 章“着色器简介”将引导你实现稍微复杂的着色器。本章帮助你学习如何使其他语言的算法和着色器适应你的应用程序。 - 第 6 章“Metal 资源和内存管理”介绍了 MTLResource 对象以及它们如何在内存管理中发挥作用。 - 第 7 章“库、函数和管道状态”解释了 CPU 如何编译和访问 Metal 着色器。 - 第 8 章“2D 绘图”比第 3 章更进一步，对创建 2D 应用程序所需的对象进行了更深入的解释。

- 第 9 章“3D 绘图简介”概述了 3D 图形编程概念。 - 第 10 章“高级 3D 绘图”解释了如何将这些 3D 图形概念应用到你的 Metal 应用程序中。 - 第 11 章“与模型 I/O 接口”探讨了 Apple 从 Blender 和 Maya 等程序导入 3D 模型和资产的框架。 - 第 12 章“纹理和采样”解释了如何导入纹理并将其应用到模型对象。 - 第 13 章“多通道渲染技术”详细介绍了如何在不破坏性能的情况下实现计算成本更高的渲染技术。 - 第 14 章“几何释放： Metal 中的曲面细分”讨论了如何利用曲面细分来利用不太详细的网格。

第三部分介绍如何使用 GPU 进行通用计算，特别是图像处理和神经网络。

- 第 15 章“Metal 计算管道”详细介绍了计算编码器与渲染编码器的区别以及如何设置数据并行 Metal 应用程序。 - 第 16 章“ Metal 中的图像处理”介绍了一些基本的图像处理概念。 - 第 17 章“机器视觉”基于上一章介绍的创建计算机视觉应用程序的基本概念。 - 第 18 章“Metal Performance Shaders 框架”详细介绍了 Metal Performance Shaders 框架中存在哪些对象来实现图像处理和线性代数。 - 第 19 章“神经网络概念”解释了什么是神经网络，并概述了构建神经网络所需的组件。 - 第 20 章“卷积神经网络”教你如何利用 Metal Performance Shaders 构建卷积神经网络图。

## 示例代码

本书中提供了许多代码示例来测试每一章的内容。建议你在阅读本书时下载示例代码。它可以为你提供良好的实践经验，并为你提供理解每一章内容的宝贵见解。

示例代码是用 Swift 4 和 Xcode 9 编写的。作者的目的是为未来版本的 Swift 和 Xcode 维护代码。示例代码旨在补充本书中的材料，并让每个项目都建立在以前的项目的基础上。

本书的源代码可以在 GitHub 上找到：https://github.com/RedQueenCoder/Metal-Programming-Guide。

## 本书中使用的约定

本书使用以下印刷约定：

- *斜体*表示新术语和菜单选项。 - 恒定宽度用于程序列表，以及在文本中引用程序元素，例如变量或函数名称、数据库、数据类型、环境变量、语句和关键字。

在 informit.com 上注册你的*Metal 编程指南* 副本，以便在可用时方便地进行下载、更新和/或更正。要开始注册过程，请访问 informit.com/register 并登录或创建帐户。输入产品 ISBN (9780134668949)，然后单击“提交”。该过程完成后，你将在“注册产品”下找到任何可用的奖励内容。
