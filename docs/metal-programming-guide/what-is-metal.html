<!doctype html>
<html lang="zh-hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-metal-programming-guide/what-is-metal/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">什么是 Metal | Swift 悍刀行</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-programming-guide/what-is-metal"><meta data-rh="true" name="docusaurus_locale" content="zh-hans"><meta data-rh="true" name="docsearch:language" content="zh-hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="什么是 Metal | Swift 悍刀行"><meta data-rh="true" name="description" content="&lt;Wisdom"><meta data-rh="true" property="og:description" content="&lt;Wisdom"><link data-rh="true" rel="icon" href="/swift-tutorials-cn/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-programming-guide/what-is-metal"><link data-rh="true" rel="alternate" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-programming-guide/what-is-metal" hreflang="zh-hans"><link data-rh="true" rel="alternate" href="https://zhuanghongji.github.io/swift-tutorials-cn/docs/metal-programming-guide/what-is-metal" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/swift-tutorials-cn/blog/rss.xml" title="Swift 悍刀行 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/swift-tutorials-cn/blog/atom.xml" title="Swift 悍刀行 Atom Feed"><link rel="stylesheet" href="/swift-tutorials-cn/assets/css/styles.a7cf13f8.css">
<link rel="preload" href="/swift-tutorials-cn/assets/js/runtime~main.b4417766.js" as="script">
<link rel="preload" href="/swift-tutorials-cn/assets/js/main.0cbf57d5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/swift-tutorials-cn/"><div class="navbar__logo"><img src="/swift-tutorials-cn/img/logo.svg" alt="Swift 悍刀行" class="themedImage_ToTc themedImage--light_HNdA"><img src="/swift-tutorials-cn/img/logo.svg" alt="Swift 悍刀行" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Swift 悍刀行</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swift/welcome/about">Swift</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swiftui/essentials/about">SwiftUI</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swiftcharts/essentials/about">SwiftCharts</a><a class="navbar__item navbar__link" href="/swift-tutorials-cn/docs/swiftdata/essentials/about">SwiftData</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Frameworks</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/core-graphics/overview">Core Graphics</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metal/overview">Metal</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metalkit/overview">MetalKit</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Books</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/swift-tutorials-cn/docs/metal-programming-guide/introdution">Metal Programming Guide</a></li><li><a class="dropdown__link" href="/swift-tutorials-cn/docs/metal-shading-language-specification/preface">Metal Shading Language Specification 3.1</a></li></ul></div><a href="https://github.com/zhuanghongji/swift-tutorials-cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Metal 编程指南</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/introdution">引言</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/introdution">介绍</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/what-is-metal">Metal 基础</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/what-is-metal">什么是 Metal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/overview-of-rendering-and-raster-graphics">渲染和光栅图形概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/your-first-metal-application">你的第一个 Metal 应用</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/essential-mathematics-for-graphics">渲染与图形</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/essential-mathematics-for-graphics">图形基础数学</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/introduction-to-shaders">着色器简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/metal-resources-and-memory-management">Metal 资源和内存管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/libraries-functions-and-pipeline-states">库、函数和管道状态</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/2d-drawing">2D 绘图</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/introduction-to-3d-drawing">3D 绘图简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/advanced-3d-drawing">高级 3D 绘图</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/interfacing-with-model-io">与模型 I/O 接口</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/texturing-and-sampling">纹理和采样</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/multipass-rendering-techniques">多通道渲染技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/geometry-unleashed-tessellation-in-metal">释放几何： Metal 中的镶嵌</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/the-metal-compute-pipeline">数据并行编程</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/the-metal-compute-pipeline">Metal 计算管道</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/image-processing-in-metal">Metal 中的图像处理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/machine-vision">机器视觉</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/metal-performance-shaders-framework">Metal 性能着色器框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/neural-network-concepts">神经网络概念</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/swift-tutorials-cn/docs/metal-programming-guide/convolutional-neural-networks">卷积神经网络</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/swift-tutorials-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Metal 编程指南</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Metal 基础</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">什么是 Metal</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>什么是 Metal</h1><div style="padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;border-radius:0.5rem;background-color:#333333"><p>在这一点上，我们必须抛弃旧模型，并采用新的现实规则。</p>— 弗诺·文奇</div><br><p>2014 年，Apple 为 iOS 引入了新的低级 GPU 编程框架：Metal。一年后，Metal 登陆 macOS，随后是 watchOS 和 tvOS。苹果设备有两个可以编程来创建应用程序的“大脑”：中央处理单元（CPU）和图形处理单元（GPU）GPU 是一种专用处理器，可以非常快速高效地并行执行浮点数学运算。这些任务在 CPU 上的成本很高，因为它们无法并行完成，因此创建了各种框架和 API，将这些昂贵的任务卸载到最适合执行这些任务的处理器。</p><p>浮点数学是图形编程不可或缺的一部分，但这并不是它的唯一应用。非图形 GPU 编程称为通用 GPU (GPGPU) 编程。较旧的图形范例（例如 OpenGL）是在 GPGPU 编程可行之前开发的 OpenGL 对于 iPhone 的前 5 年来说已经足够了，但随着它变得更加强大并且可以完成更多任务，它也在不断发展。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="图形-api-的历史">图形 API 的历史<a href="#图形-api-的历史" class="hash-link" aria-label="图形 API 的历史的直接链接" title="图形 API 的历史的直接链接">​</a></h2><p>三维计算机图形可以追溯到 20 世纪 60 年代和 1970 年代 James Blinn 和 Edwin Catmull 等先驱者的工作为当今的许多创新铺平了道路。但直到 20 世纪 80 年代和 90 年代的家用计算机革命之后，计算机图形才变得无处不在。</p><p>在 20 世纪 80 年代，编写跨平台软件非常困难，尤其是游戏。每台计算机和视频游戏系统都有自己专有的硬件和软件驱动程序。每次你想要在新设备上发布软件时，你都必须编写特定于设备的驱动程序、软件和用户界面。这项工作是重复性的，而且感觉基本上没有必要。</p><p>1981 年，Silicon Graphics (SGI) 公司成立。它制造高性能 3D 工作站。与所有其他 3D 工作站制造商一样，它拥有自己的专有 3D 图形 API，称为 IRIS GL。它在 20 世纪 80 年代的大部分时间里占据着市场主导地位，但到了 90 年代初，其市场份额已经被侵蚀 1992 年，为了防止市场份额进一步受到侵蚀，它开放了 IRIS GL API 并将其更名为 OpenGL。</p><p>直到 1997 年，OpenGL 才成为事实上的 3D 图形 API。视频游戏公司 idSoftware 在首席程序员 John Carmack 的领导下，开发了其最畅销视频游戏 <em>Doom</em> 的后续版本。它被称为 <em>Quake</em> 。每个游戏平台都渴望将《雷神之锤》移植到自己的平台上。卡马克不想为市场上的每种硬件和操作系统编写独特的驱动程序，因此他选择 OpenGL 作为标准。他告诉制造商，如果他们不支持 OpenGL，他们就无法将 <em>Quake</em> 移植到他们的平台上。制造商编译并编写了驱动程序来支持 OpenGL。由于每个制造商都已完成支持 OpenGL 的工作，因此许多游戏开发人员开始专门支持 OpenGL，因为他们知道它可以在每个平台上运行。瞧！一个行业标准诞生了。</p><p>2004 年，OpenGL 2.0 发布。这是 OpenGL 的重大进步，因为它引入了 OpenGL 着色语言。这种类似 C 的语言允许程序员为 GPU 编写程序并修改可编程管道的转换和片段着色阶段（见图 1.1）。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div style="width:720px;padding:1rem;background-color:black"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAGAAoDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAUI/8QAHxAAAgICAQUAAAAAAAAAAAAAAQIDBAARBRMhIkGh/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQP/xAAXEQEBAQEAAAAAAAAAAAAAAAABAgAx/9oADAMBAAIRAxEAPwDP8qUJLHF0IKxEYhE7SufORmXeifQGj2GSpOYLOzCpVAJJA6KHXzGMGTXu05v/2Q==&quot;);width:100%"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1467" height="892"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/swift-tutorials-cn/assets/ideal-img/1_1.dd6b06f.1467.jpg" srcset="/swift-tutorials-cn/assets/ideal-img/1_1.dd6b06f.1467.jpg 1467w" width="1467" height="892"></noscript></div></div><p style="margin-top:0.5rem;font-size:1.0rem"><em>图 1.1 应用分子。左边是具有固定功能管道的应用程序。右边是使用着色器增强的版本。</em></p></div><p>当着色器被添加到 OpenGL 时，API 开始变得相当粗糙 OpenGL 最初发布时，GPU 的功能并不是特别强大。他们无法处理太多工作。最初的 OpenGL API 旨在将尽可能多的工作推送给 CPU，因为 GPU 是一个瓶颈。当着色器发布时，这种限制已经发生了巨大的变化 GPU 的功能越来越强大，许多原来执行任务的方式效率低得令人难以置信。随着时间的推移，新的方法被引入以适应这种新的现实，但旧的方法从未从 API 中删除。执行相同任务有多种方法，其中一些方法比其他方法更有效。</p><p>2003 年，OpenGL 的精简版本发布：OpenGL ESOpenGL ES 是 OpenGL 的子集。它删除了所有旧的、粗糙的实现，这些实现不再是向 GPU 分配工作的最佳方式。它是为嵌入式设备（例如视频游戏控制台和智能手机）开发的，但任何用 OpenGL ES 编写的程序都可以在使用 OpenGL 的程序上运行，只需对着色器进行一些小的修改 2007 年，OpenGL ES 2.0 发布。该版本包含着色器和可编程管道。</p><p>也是在 2007 年，第一代 iPhone 发布。第一个 iOS SDK 中可用的图形框架和 API 极其有限，但 iPhone 确实支持 OpenGL ES。大多数想要在游戏和应用程序中采用复杂图形的开发人员必须在 OpenGL ES 中对所有内容进行编程。许多拥有多年使用 OpenGL 经验的程序员能够在 SDK 出现时为 iPhone 创建复杂的图形。</p><p>正处于起步阶段 2010 年，Apple 开始在 iPhone 上支持 OpenGL ES 2.0 以及可编程着色器。</p><p>多年来，Apple 为 iPhone 上的图形开发了更高级别的抽象：Sprite Kit、Scene Kit 等。但如果你想直接对 GPU 进行编程，则必须使用 OpenGL ES。你还必须对 GPU 进行图形编程。你无法利用 GPU 进行通用编程，也无法利用 Apple 与其其他框架的紧密硬件/软件集成。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metal在-apple-平台上制作图形的新方法">Metal：在 Apple 平台上制作图形的新方法<a href="#metal在-apple-平台上制作图形的新方法" class="hash-link" aria-label="Metal：在 Apple 平台上制作图形的新方法的直接链接" title="Metal：在 Apple 平台上制作图形的新方法的直接链接">​</a></h2><p>今天，我们的口袋里装着超级计算机 iPhone 的计算能力正在接近我们许多笔记本电脑的计算能力。即使拥有所有这些额外的功能，我们仍然受到 OpenGL API 的速率限制。由于 OpenGL 必须适应 GPU 和 CPU 的所有组合和变化，因此它永远无法充分利用 Apple 为其所有产品提供的深度集成 Apple 确切地知道将使用哪个芯片进行 GPU 编程，并且可以优化框架以专门、直接地适应该芯片的特性。</p><p>除了现在可以通过控制整个制造链实现深度集成之外，OpenGL 还存在一些结构性问题，导致其无法发挥应有的效率。有许多昂贵的操作被安排在每个不必要的绘制调用上发生。通过更改操作顺序并将昂贵的工作移至绘制调用之外，Metal 释放了更多处理器带宽。通过让程序员完全控制他们想要如何安排 GPU 的工作，可以进一步释放带宽。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="平衡-cpu-和-gpu-之间的工作">平衡 CPU 和 GPU 之间的工作<a href="#平衡-cpu-和-gpu-之间的工作" class="hash-link" aria-label="平衡 CPU 和 GPU 之间的工作的直接链接" title="平衡 CPU 和 GPU 之间的工作的直接链接">​</a></h3><p>CPU 和 GPU 是偏置工作的 CPU 为 GPU 准备命令，然后将它们发送给 GPU。当 GPU 处理收到的命令时，CPU 正在准备下一批命令。在图形编程中，你有责任平衡 CPU 和 GPU 之间的工作负载。将工作从 CPU 批处理并发送到 GPU 的时间成本很高。发送给 GPU 的工作越多，花费的时间就越多。在传统的 OpenGL 应用程序中，很多时候这种偏移并不是完美平衡的。通常，CPU 无法向 GPU 发送足够的工作以使其在整个帧中保持忙碌，因此 GPU 处于空闲状态，如图 1.2 所示 Metal 提高了这种偏移的效率，以便 GPU 可以充分利用。效率提高的部分原因是无需在 CPU 和 GPU 之间复制内存。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div style="width:720px;padding:1rem;background-color:white"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAEAAoDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAYH/8QAHxAAAQMDBQAAAAAAAAAAAAAAAQACAwQRIQUSFCJB/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAZEQACAwEAAAAAAAAAAAAAAAABAgAREiH/2gAMAwEAAhEDEQA/ANv1wRUkLpo4nF5mYDeolt2Ocb7Ku5Lx41ETkAclu7OBo3P/2Q==&quot;);width:100%"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="713" height="302"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/swift-tutorials-cn/assets/ideal-img/1_2.8a253d9.713.jpg" srcset="/swift-tutorials-cn/assets/ideal-img/1_2.8a253d9.713.jpg 713w" width="713" height="302"></noscript></div></div><p style="margin-top:0.5rem;font-size:1.0rem"><em>图 1.2 在较旧的图形 API 中，CPU 无法批处理足够的工作以保持 GPU 得到充分利用。</em></p></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="复制内存">复制内存<a href="#复制内存" class="hash-link" aria-label="复制内存的直接链接" title="复制内存的直接链接">​</a></h3><p>OpenGL 之所以如此设置，是因为直到最近，CPU 和 GPU 始终位于单独的芯片上。它要求将数据从一个芯片复制到另一芯片，这需要昂贵的线程锁来确保不会发生竞争条件并覆盖数据。</p><p>在 iPhone 的每一次迭代中，CPU 和 GPU 都占用相同的芯片。这样就不需要来回复制数据，从而消除了先前计算机体系结构中遗留下来的昂贵操作（见图 1.3）CPU 只是授予 GPU 访问权限以直接修改数据。从 A7 芯片开始，苹果通过支持 Metal 充分利用了这种设计。</p><div style="display:flex;flex-direction:column;width:100%;justify-content:center;align-items:center"><div style="width:720px;padding:1rem;background-color:white"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAFAAoDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAYH/8QAHxAAAgICAQUAAAAAAAAAAAAAAQIABAMSESExMmFx/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAL/xAAZEQACAwEAAAAAAAAAAAAAAAABAgAREjH/2gAMAwEAAhEDEQA/AN/sUK+Sy7M94M+zHW9mUDr2ADcAepUJ4L8iIyByW7s1Bjc//9k=&quot;);width:100%"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="586" height="312"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/swift-tutorials-cn/assets/ideal-img/1_3.e37bf45.586.jpg" srcset="/swift-tutorials-cn/assets/ideal-img/1_3.e37bf45.586.jpg 586w" width="586" height="312"></noscript></div></div><p style="margin-top:0.5rem;font-size:1.0rem"><em>图 1.3 通过消除复制内存的需要，可以消除昂贵的批量复制命令。</em></p></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="直接控制命令缓冲区">直接控制命令缓冲区<a href="#直接控制命令缓冲区" class="hash-link" aria-label="直接控制命令缓冲区的直接链接" title="直接控制命令缓冲区的直接链接">​</a></h3><p>命令缓冲区是 Metal 应用程序的中央控制对象 Metal 与 OpenGL 不同，因为它让程序员可以访问此控件，而不是以简化的名义将其抽象出来。将命令缓冲区暴露给程序员可以在何时以及如何执行渲染缓冲区方面提供更大的灵活性。在 OpenGL 中，由 OpenGL 驱动程序（而不是开发人员）决定工作顺序。通过向开发人员公开缓冲区的复杂性并允许他们按照自己喜欢的顺序对工作进行排队，Metal 提供了对应用程序性能的更多控制。可以创建多个线程，并且可以延迟缓冲区执行。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="预编译着色器">预编译着色器<a href="#预编译着色器" class="hash-link" aria-label="预编译着色器的直接链接" title="预编译着色器的直接链接">​</a></h3><p>在 OpenGL 中，着色器是在运行时编译的。编译着色器的成本很高。在 Metal 出现之前，这项工作必须在每次绘制调用时完成。在加载时编译这些着色器没有多大意义。这项工作可以从加载时间移至应用程序构建时间。预编译的着色器可以存储在库中，以便在运行时引用它们，从而将耗时且昂贵的工作转移到不影响用户体验的地方。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="预验证状态">预验证状态<a href="#预验证状态" class="hash-link" aria-label="预验证状态的直接链接" title="预验证状态的直接链接">​</a></h3><p>在其他图形 API 中，在每次绘制调用时，应用程序都必须检查以确保 API 上的状态有效，以避免向 GPU 发送错误命令。应用程序中的状态会发生变化，但不会在每次绘制调用时发生变化。作为开发人员，你可以在命令编码器中对这些状态更改进行编码。命令编码器被提交到命令缓冲区，并且仅当状态实际改变时才会发生昂贵的状态验证。</p><p>Apple 工程师使 Metal API 尽可能精简。精简设计意味着在批处理工作并将工作从 CPU 发送到 GPU 时需要运行的工作更少。它消除了由 GPU 默默完成的不必要的工作，因为 GPU 的工作被从程序员手中抽象出来，使他们的工作变得更容易。使这项工作的发送成本更低意味着程序员不再受 CPU 的速率限制。他们可以充分利用 GPU 的潜力。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metal-背景-metal-如何补充和支持其他-metal">Metal 背景： Metal 如何补充和支持其他 Metal<a href="#metal-背景-metal-如何补充和支持其他-metal" class="hash-link" aria-label="Metal 背景： Metal 如何补充和支持其他 Metal的直接链接" title="Metal 背景： Metal 如何补充和支持其他 Metal的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="平台框架">平台框架<a href="#平台框架" class="hash-link" aria-label="平台框架的直接链接" title="平台框架的直接链接">​</a></h3><p>Metal 框架是一项非凡的成就，但它并不独立存在。它是庞大的 Cocoa 框架生态系统的一部分。它扮演着重要角色，但不是独唱演员。它集成到许多其他框架中，并且依赖于其他框架。</p><p>多个框架已更新以利用 Metal，包括 SceneKit 和 SpriteKit。如果你想做一些不高度专业化的事情，你可以通过使用这些框架之一来利用 Metal。它们还可以轻松地与 Metal 集成。如果你想为 SceneKit 项目编写自定义着色器，可以轻松地使用 Metal 来获取所需的部分，同时仍然利用 SceneKit 提供的更高级别的抽象。</p><p>Metal 遵循数据守恒定律。它不会创建或销毁数据；它只是修改它。因此，Metal 需要一个数据源 Cocoa 中专门设置为充当数据源的一个框架是模型 I/O 框架。模型 I/O 提供了一种从 3D 建模程序引入顶点数据的简单方法。它被设计为与 Metal 紧密集成。</p><p>你可以让 Model I/O 完成解析数据文件和加载顶点缓冲区的所有繁重工作，以便你可以专注于要对数据执行的操作，而不是如何将其放入应用程序中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概括">概括<a href="#概括" class="hash-link" aria-label="概括的直接链接" title="概括的直接链接">​</a></h2><p>Apple 革命性的全新 GPU 编程框架解决了传统图形编程 API 的许多长期存在的问题。通过利用硬件和软件的紧密集成，Apple 充分利用了 GPU 的所有功能。通过将昂贵的任务移出绘制调用之外，Apple 可以降低向 GPU 发送命令的成本，从而释放更多的 CPU 时间来改进应用程序的其他方面 Metal 还被设计为与其他 Apple 框架完美集成，让你比以往更轻松地利用这些框架来完成常见任务，而无需转向 Metal。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zhuanghongji/swift-tutorials-cn/docs/metal-programming-guide/what-is-metal/index.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2023-08-29T05:01:04.000Z">2023年8月29日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/swift-tutorials-cn/docs/metal-programming-guide/introdution"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">介绍</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/swift-tutorials-cn/docs/metal-programming-guide/overview-of-rendering-and-raster-graphics"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">渲染和光栅图形概述</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#图形-api-的历史" class="table-of-contents__link toc-highlight">图形 API 的历史</a></li><li><a href="#metal在-apple-平台上制作图形的新方法" class="table-of-contents__link toc-highlight">Metal：在 Apple 平台上制作图形的新方法</a><ul><li><a href="#平衡-cpu-和-gpu-之间的工作" class="table-of-contents__link toc-highlight">平衡 CPU 和 GPU 之间的工作</a></li><li><a href="#复制内存" class="table-of-contents__link toc-highlight">复制内存</a></li><li><a href="#直接控制命令缓冲区" class="table-of-contents__link toc-highlight">直接控制命令缓冲区</a></li><li><a href="#预编译着色器" class="table-of-contents__link toc-highlight">预编译着色器</a></li><li><a href="#预验证状态" class="table-of-contents__link toc-highlight">预验证状态</a></li></ul></li><li><a href="#metal-背景-metal-如何补充和支持其他-metal" class="table-of-contents__link toc-highlight">Metal 背景： Metal 如何补充和支持其他 Metal</a><ul><li><a href="#平台框架" class="table-of-contents__link toc-highlight">平台框架</a></li></ul></li><li><a href="#概括" class="table-of-contents__link toc-highlight">概括</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://developer.apple.com/xcode/swiftui/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI Overview</a></li><li class="footer__item"><a href="https://developer.apple.com/documentation/swiftui/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI Documentation</a></li><li class="footer__item"><a href="https://developer.apple.com/videos/swiftui-ui-frameworks" target="_blank" rel="noopener noreferrer" class="footer__link-item">SwiftUI &amp; UI Frameworks Videos</a></li><li class="footer__item"><a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/" target="_blank" rel="noopener noreferrer" class="footer__link-item">The Swift Programming Language</a></li></ul></div><div class="col footer__col"><div class="footer__title">参考</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.fatbobman.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Fatbob Man</a></li><li class="footer__item"><a href="https://designcode.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Design Code</a></li><li class="footer__item"><a href="https://www.swiftanytime.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Swift Anytime</a></li><li class="footer__item"><a href="https://www.hackingwithswift.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Hacking With Swift</a></li></ul></div><div class="col footer__col"><div class="footer__title">探索</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/@Kavsoft" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kavsoft</a></li><li class="footer__item"><a href="https://www.youtube.com/@ChaoCode" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chao Code</a></li><li class="footer__item"><a href="https://www.youtube.com/@iOSAcademy" target="_blank" rel="noopener noreferrer" class="footer__link-item">iOS Academy</a></li><li class="footer__item"><a href="https://www.youtube.com/@XCA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Xcoding with Alfian</a></li></ul></div><div class="col footer__col"><div class="footer__title">发现</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/swift-tutorials-cn/sponsor-me">Sponsor Me</a></li><li class="footer__item"><a class="footer__link-item" href="/swift-tutorials-cn/sponsor-list">Sponsor List</a></li><li class="footer__item"><a href="https://twitter.com/ajizhhans" target="_blank" rel="noopener noreferrer" class="footer__link-item">Follow Twitter</a></li><li class="footer__item"><a href="https://github.com/zhuanghongji" target="_blank" rel="noopener noreferrer" class="footer__link-item">Follow GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ZHUANGHONGJI<br><a style="font-size: 12px;color: white;" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0) License</a></div></div></div></footer></div>
<script src="/swift-tutorials-cn/assets/js/runtime~main.b4417766.js"></script>
<script src="/swift-tutorials-cn/assets/js/main.0cbf57d5.js"></script>
</body>
</html>