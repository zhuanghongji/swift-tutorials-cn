(self.webpackChunkswift_tutorials_cn=self.webpackChunkswift_tutorials_cn||[]).push([[9687],{76962:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image_1.9c8f708.596.png 596w",images:[{path:n.p+"assets/ideal-img/image_1.9c8f708.596.png",width:596,height:538}],src:n.p+"assets/ideal-img/image_1.9c8f708.596.png",toString:function(){return n.p+"assets/ideal-img/image_1.9c8f708.596.png"},placeholder:void 0,width:596,height:538},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAIAAACExCpEAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeUlEQVQYlW2N2w6DMAxD+/+/icQDQqqKKDRXT1lHNTb8ksRHjhO+tK61FALg/nFSH/1eljNnfsAARERVmNnMhjnSTkTuUDWi+H/DzKyq/3tgs1vi+hT9gX/6AOhbgYuU+ZyhYGG5xGbHNHmtaW/71jZX74mhI2dp7QU7IAnX4zBN8QAAAABJRU5ErkJggg=="}},40840:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image_2.27e19fd.1206.png 1206w",images:[{path:n.p+"assets/ideal-img/image_2.27e19fd.1206.png",width:1206,height:100}],src:n.p+"assets/ideal-img/image_2.27e19fd.1206.png",toString:function(){return n.p+"assets/ideal-img/image_2.27e19fd.1206.png"},placeholder:void 0,width:1206,height:100},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAIAAABol6gpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAKklEQVQImQEfAOD/APv39tjs9qTT7dfs+MHh8rHa8Nzu+KzW7Mbk9fHw8JqGGnG9c6jzAAAAAElFTkSuQmCC"}},78345:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image_3.b16a1e1.845.png 845w",images:[{path:n.p+"assets/ideal-img/image_3.b16a1e1.845.png",width:845,height:672}],src:n.p+"assets/ideal-img/image_3.b16a1e1.845.png",toString:function(){return n.p+"assets/ideal-img/image_3.b16a1e1.845.png"},placeholder:void 0,width:845,height:672},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAb0lEQVQYlVWPCwpAIQgEvf99o3/7GGGjJ4g6rmYhSecc9d7VWtMY4+e11uzFWisBBXDOKRjRHEshxd47I9vZTI4jphc0mHbESilXAEuhC8zP+264l6SQaU5AhMN8u3v5NIWnX5E/Rx4vMHSEM8SvP73oOvJ92KtDAAAAAElFTkSuQmCC"}},63346:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image_4.8d44608.1259.png 1259w",images:[{path:n.p+"assets/ideal-img/image_4.8d44608.1259.png",width:1259,height:631}],src:n.p+"assets/ideal-img/image_4.8d44608.1259.png",toString:function(){return n.p+"assets/ideal-img/image_4.8d44608.1259.png"},placeholder:void 0,width:1259,height:631},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaUlEQVQImVWMAQoDMQgE8//PJhWMxqhblDtoBVlchxlmBiLCWgubGbo3IhPMjDkniD4g3hjujt/JTETEX1f3KGPB55xOVe2NcLy/ygatH9G2ex3uF2q3AXR3MUQEKoLKslaZEbAHLGOBX30YxFqzcgqWAAAAAElFTkSuQmCC"}},14580:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image_5.a9afc09.778.png 778w",images:[{path:n.p+"assets/ideal-img/image_5.a9afc09.778.png",width:778,height:838}],src:n.p+"assets/ideal-img/image_5.a9afc09.778.png",toString:function(){return n.p+"assets/ideal-img/image_5.a9afc09.778.png"},placeholder:void 0,width:778,height:838},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAIAAADJDItPAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVQYlU2OUYtGQBiF/f9/o8iYZnBBKcmNsJJSkhtyw8y878zOLr7afe5Op6dzHEQEAERUSukHeCI8OAAghFBKAcC+7/M8a62llEIIKaXzegBgjJmmqaoqa616uG2llBACAM7zTNM0iqJ1XbXW13X92Yg4zzMhJAiCuq6llB8bAKSUiJhlGSEkSRJK6bZtr3bXxphhGDjnhBDGGKW0LMt3/mMXRcEfkiThnMdxfBzHXVtrh2FwXZcx5vt+GIaEEM/z8jw3xjha62VZmqbp+77ruq+Htm3HcRRC3M8BwFr7/Q9rrTHm9/kPFR8p9PnjmrIAAAAASUVORK5CYII="}},45672:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image_6.d3b9c3c.622.png 622w",images:[{path:n.p+"assets/ideal-img/image_6.d3b9c3c.622.png",width:622,height:508}],src:n.p+"assets/ideal-img/image_6.d3b9c3c.622.png",toString:function(){return n.p+"assets/ideal-img/image_6.d3b9c3c.622.png"},placeholder:void 0,width:622,height:508},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAIAAABPmPnhAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAf0lEQVQImU2MSwqEMBAFc/9D6kpQXEjsdDL90p8BHSapZRVUioHtOx9HjbC/SlMOZmHGbEbuEyOrqnyEG198RYS7A3D3XzYzVSWmk87KlYgEUNUxd/d3WB6MWVp7B8nDC4qp+YMAedvovjtzuKfc8kqrVOnaAYhIV20ALUvL+Qs1U+qNordboQAAAABJRU5ErkJggg=="}},52611:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/screenshot_1.cacbf4f.1179.png 1179w",images:[{path:n.p+"assets/ideal-img/screenshot_1.cacbf4f.1179.png",width:1179,height:2556}],src:n.p+"assets/ideal-img/screenshot_1.cacbf4f.1179.png",toString:function(){return n.p+"assets/ideal-img/screenshot_1.cacbf4f.1179.png"},placeholder:void 0,width:1179,height:2556},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAWCAYAAAD5Jg1dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqklEQVQokZVSPUsDQRDdYJJrlLPQzo+cREFrq2glookGbAUR/4AgWGqREDAi2EkaC8FCyE+IdnZGT03A6iDFtSlDIJLczpPZu70EjYID73bn7ds3u7cjiOiYiHoA0Gq1Hl3X3cvn8zeNRuOeOSJiXAsi+uSEo9PpfLTb7ctKpfLQbDZfAyEHhE4ASO2gg/qJZMcwJyLJx5BSejwfcCR2VEK94TcI3uV5Hrrd7lD0ej1fOHimv0Lwp1wuI5fL4fy8iLMzH8ViEYVCAaVSCVJKX5hKpSCEGArTNFV5Jcxms4o0DIF4PAnDWEYs5guTyWRfmE6nQ4cx6xALExeIBHkikegLM1sZRUbMcUwfHOFg8QQzkRnFzSWsQeGWf55TC+u3q7jaWcHV5KLvaFnwwtIbm4oc3TUwn4libSmKfTOOuBCYmp3tC7ez20oYEzEIMeJjJPrzMo7j4Kn6BPvdhv32grfXF7zbNp6rVdTr9f+/DPGf9zyP+M2/g9d0U+g2G2btL3Cb6RbTBDsELmGjMs2O3W/dzGPornl2PA3m0nVdqtVq6qaO46gCgfjuCxKjvBvAzn4BAAAAAElFTkSuQmCC"}},24882:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/screenshot_2.c60ba15.1179.png 1179w",images:[{path:n.p+"assets/ideal-img/screenshot_2.c60ba15.1179.png",width:1179,height:2556}],src:n.p+"assets/ideal-img/screenshot_2.c60ba15.1179.png",toString:function(){return n.p+"assets/ideal-img/screenshot_2.c60ba15.1179.png"},placeholder:void 0,width:1179,height:2556},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAWCAYAAAD5Jg1dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQokZVSsU4CQRAdDpCSD7AAIonf4H2AgPAHfoGtJjYWEJI7GlsaTew0fALaWZiAhAiJ1SUU1xIrQoKB23lm9m7hRDRxkneZefv27c7tEDOfM/MKAGaz2bPv+6eNRuNuMpk8CsfMghti5k8pJBaLxft8Pr/udrtP0+l0GAklQKYAoIyDCd4UShzXNTMruYZSKpA85sjiqIVmw28g2RUEAZbL5U6sVqtQGL/TX0Hy6XQ6qNfrcFstuI6DluPAdV00m020220opUKhbdsgop3IZrP6eC2s1WrhQiaDw1QKR6kUaG9Pc8VicSMsl8uh0LJwS4QXyRMJzeXz+Y3wJBLuWxY+iAAi2JHwIC6sViqafEgmtUgwtCzNFQoFBEZ4XCpp8iyRwCURLiJk5JRcbiOsVavhHaUBaUSQTv9sxvM89Hs9vA0GGMXw2u9jPB7//2VY/nwQBCxvvg1ZM0NhLHdZa06PmRkxQ4hD5LIeVKHFcbk1zd+cDS+OV1GufN/n0WikO/U8Tx8Qie+/AN+gu/ioTC7nAAAAAElFTkSuQmCC"}},78559:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/xcode_1.0bf3875.1680.png 1680w",images:[{path:n.p+"assets/ideal-img/xcode_1.0bf3875.1680.png",width:1680,height:574}],src:n.p+"assets/ideal-img/xcode_1.0bf3875.1680.png",toString:function(){return n.p+"assets/ideal-img/xcode_1.0bf3875.1680.png"},placeholder:void 0,width:1680,height:574},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAIAAAA4WjmaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdElEQVQImQXBSw4CIQwAUG7hZigUWsoAxQ8zJrpAY2KiR/D+F/E90/REFD0iEalq7eesI4mEEB14cxl7KeuaRVvt2hJzJA7oHFgH1mQRHwj1Ob8/2d4HvufrJ48XHR/QpgGwiwWf2n6bpW9LKJgacvVcgcofpX8TX7z7gQ0AAAAASUVORK5CYII="}},3905:(e,t,n)=>{"use strict";n.d(t,{Zo:()=>d,kt:()=>u});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=i.createContext({}),s=function(e){var t=i.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=s(e.components);return i.createElement(o.Provider,{value:t},e.children)},c="mdxType",A={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),c=s(n),m=r,u=c["".concat(o,".").concat(m)]||c[m]||A[m]||a;return n?i.createElement(u,l(l({ref:t},d),{},{components:n})):i.createElement(u,l({ref:t},d))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=m;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p[c]="string"==typeof e?e:r,l[1]=p;for(var s=2;s<a;s++)l[s]=n[s];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1652:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>k,frontMatter:()=>a,metadata:()=>p,toc:()=>s});var i=n(87462),r=(n(67294),n(3905));const a={},l="\u4f7f\u7528\u6e32\u67d3\u7ba1\u9053\u6e32\u67d3\u57fa\u5143",p={unversionedId:"metal/samples/using-a-render-pipeline-to-render-primitives/index",id:"metal/samples/using-a-render-pipeline-to-render-primitives/index",title:"\u4f7f\u7528\u6e32\u67d3\u7ba1\u9053\u6e32\u67d3\u57fa\u5143",description:"<OriginalSource",source:"@site/docs/metal/samples/using-a-render-pipeline-to-render-primitives/index.mdx",sourceDirName:"metal/samples/using-a-render-pipeline-to-render-primitives",slug:"/metal/samples/using-a-render-pipeline-to-render-primitives/",permalink:"/swift-tutorials-cn/docs/metal/samples/using-a-render-pipeline-to-render-primitives/",draft:!1,editUrl:"https://github.com/zhuanghongji/swift-tutorials-cn/docs/metal/samples/using-a-render-pipeline-to-render-primitives/index.mdx",tags:[],version:"current",lastUpdatedAt:1697949909,formattedLastUpdatedAt:"2023\u5e7410\u670822\u65e5",frontMatter:{},sidebar:"metalSidebar",previous:{title:"\u4f7f\u7528 Metal \u7ed8\u5236\u89c6\u56fe\u7684\u5185\u5bb9",permalink:"/swift-tutorials-cn/docs/metal/samples/using-metal-to-draw-a-view-s-contents/"},next:{title:"\u7ed8\u5236\u4e00\u4e2a\u4e09\u89d2\u5f62",permalink:"/swift-tutorials-cn/docs/metal/samples/draw-an-triangle/"}},o={},s=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u4e86\u89e3 Metal \u6e32\u67d3\u7ba1\u9053",id:"\u4e86\u89e3-metal-\u6e32\u67d3\u7ba1\u9053",level:2},{value:"\u81ea\u5b9a\u4e49\u6e32\u67d3\u7ba1\u9053\u51b3\u5b9a\u5982\u4f55\u5904\u7406\u6570\u636e",id:"\u81ea\u5b9a\u4e49\u6e32\u67d3\u7ba1\u9053\u51b3\u5b9a\u5982\u4f55\u5904\u7406\u6570\u636e",level:2},{value:"\u58f0\u660e\u9876\u70b9\u51fd\u6570",id:"\u58f0\u660e\u9876\u70b9\u51fd\u6570",level:2},{value:"\u7f16\u5199\u9876\u70b9\u51fd\u6570",id:"\u7f16\u5199\u9876\u70b9\u51fd\u6570",level:2},{value:"\u7f16\u5199\u4e00\u4e2a\u7247\u6bb5\u51fd\u6570",id:"\u7f16\u5199\u4e00\u4e2a\u7247\u6bb5\u51fd\u6570",level:2},{value:"\u521b\u5efa\u6e32\u67d3\u7ba1\u9053\u72b6\u6001\u5bf9\u8c61",id:"\u521b\u5efa\u6e32\u67d3\u7ba1\u9053\u72b6\u6001\u5bf9\u8c61",level:2},{value:"\u8bbe\u7f6e\u89c6\u53e3",id:"\u8bbe\u7f6e\u89c6\u53e3",level:2},{value:"\u8bbe\u7f6e\u6e32\u67d3\u7ba1\u9053\u72b6\u6001",id:"\u8bbe\u7f6e\u6e32\u67d3\u7ba1\u9053\u72b6\u6001",level:2},{value:"\u5c06\u53c2\u6570\u6570\u636e\u53d1\u9001\u5230\u9876\u70b9\u51fd\u6570",id:"\u5c06\u53c2\u6570\u6570\u636e\u53d1\u9001\u5230\u9876\u70b9\u51fd\u6570",level:2},{value:"\u5bf9\u7ed8\u5236\u547d\u4ee4\u8fdb\u884c\u7f16\u7801",id:"\u5bf9\u7ed8\u5236\u547d\u4ee4\u8fdb\u884c\u7f16\u7801",level:2},{value:"\u5c1d\u8bd5\u989c\u8272\u63d2\u503c",id:"\u5c1d\u8bd5\u989c\u8272\u63d2\u503c",level:2},{value:"\u5b8c\u6574\u793a\u4f8b",id:"\u5b8c\u6574\u793a\u4f8b",level:2},{value:"AAPLShaderTypes.h",id:"aaplshadertypesh",level:3},{value:"AAPL-Bridging-Header.h",id:"aapl-bridging-headerh",level:3},{value:"AAPLShaders.metal",id:"aaplshadersmetal",level:3},{value:"AAPLView.swift",id:"aaplviewswift",level:3},{value:"ContentView.swift",id:"contentviewswift",level:3}],d=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},c=d("OriginalSource"),A=d("Figure"),m=d("Screenshot"),u=d("ScreenshotBlock"),g={toc:s},f="wrapper";function k(e){let{components:t,...a}=e;return(0,r.kt)(f,(0,i.Z)({},g,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u4f7f\u7528\u6e32\u67d3\u7ba1\u9053\u6e32\u67d3\u57fa\u5143"},"\u4f7f\u7528\u6e32\u67d3\u7ba1\u9053\u6e32\u67d3\u57fa\u5143"),(0,r.kt)(c,{title:"Using a Render Pipeline to Render Primitives",url:"https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives",summary:"\u6e32\u67d3\u4e00\u4e2a\u7b80\u5355\u7684 2D \u4e09\u89d2\u5f62",mdxType:"OriginalSource"}),(0,r.kt)("h2",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,r.kt)("p",null,"\u8be5\u793a\u4f8b\u5411\u4f60\u5c55\u793a\u5982\u4f55\u914d\u7f6e\u6e32\u67d3\u7ba1\u9053\u5e76\u5c06\u5176\u7528\u4f5c\u6e32\u67d3\u901a\u9053\u7684\u4e00\u90e8\u5206\uff0c\u4ee5\u5c06\u7b80\u5355\u7684 2D \u5f69\u8272\u4e09\u89d2\u5f62\u7ed8\u5236\u5230\u89c6\u56fe\u4e2d\u3002\u8be5\u793a\u4f8b\u4e3a\u6bcf\u4e2a\u9876\u70b9\u63d0\u4f9b\u4f4d\u7f6e\u548c\u989c\u8272\uff0c\u6e32\u67d3\u7ba1\u9053\u4f7f\u7528\u8be5\u6570\u636e\u6765\u6e32\u67d3\u4e09\u89d2\u5f62\uff0c\u5728\u4e3a\u4e09\u89d2\u5f62\u9876\u70b9\u6307\u5b9a\u7684\u989c\u8272\u4e4b\u95f4\u63d2\u5165\u989c\u8272\u503c\u3002"),(0,r.kt)(A,{src:n(76962),size:320,mdxType:"Figure"}),(0,r.kt)("p",null,"Xcode \u9879\u76ee\u5305\u542b\u5728 macOS\u3001iOS \u548c tvOS \u4e0a\u8fd0\u884c\u793a\u4f8b\u7684\u65b9\u6848\u3002"),(0,r.kt)("h2",{id:"\u4e86\u89e3-metal-\u6e32\u67d3\u7ba1\u9053"},"\u4e86\u89e3 Metal \u6e32\u67d3\u7ba1\u9053"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6e32\u67d3\u7ba1\u9053")," \u5904\u7406\u7ed8\u5236\u547d\u4ee4\u5e76\u5c06\u6570\u636e\u5199\u5165\u6e32\u67d3\u901a\u9053\u7684\u76ee\u6807\u3002\u6e32\u67d3\u7ba1\u9053\u6709\u8bb8\u591a\u9636\u6bb5\uff0c\u4e00\u4e9b\u9636\u6bb5\u4f7f\u7528\u7740\u8272\u5668\u8fdb\u884c\u7f16\u7a0b\uff0c\u53e6\u4e00\u4e9b\u9636\u6bb5\u5219\u5177\u6709\u56fa\u5b9a\u6216\u53ef\u914d\u7f6e\u7684\u884c\u4e3a\u3002\u8be5\u793a\u4f8b\u91cd\u70b9\u5173\u6ce8\u7ba1\u9053\u7684\u4e09\u4e2a\u4e3b\u8981\u9636\u6bb5\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u9876\u70b9\u9636\u6bb5\uff08the vertex stage\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u5149\u6805\u5316\u9636\u6bb5\uff08the rasterization stage\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u7247\u6bb5\u9636\u6bb5\uff08the fragment stage\uff09")),(0,r.kt)("p",null,"\u9876\u70b9\u9636\u6bb5\u548c\u7247\u6bb5\u9636\u6bb5\u662f\u53ef\u7f16\u7a0b\u7684\uff0c\u56e0\u6b64\u4f60\u53ef\u4ee5\u4f7f\u7528 Metal \u7740\u8272\u8bed\u8a00\uff08MSL\uff09\u4e3a\u5b83\u4eec\u7f16\u5199\u51fd\u6570\u3002\u5149\u6805\u5316\u9636\u6bb5\u5177\u6709\u56fa\u5b9a\u7684\u884c\u4e3a\u3002"),(0,r.kt)(A,{src:n(40840),size:720,edge:"white",mdxType:"Figure"}),(0,r.kt)("p",null,"\u6e32\u67d3\u4ece\u7ed8\u5236\u547d\u4ee4\u5f00\u59cb\uff0c\u5176\u4e2d\u5305\u62ec\u9876\u70b9\u6570\u548c\u8981\u6e32\u67d3\u7684\u56fe\u5143\u7c7b\u578b\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u8be5\u793a\u4f8b\u4e2d\u7684\u7ed8\u5236\u547d\u4ee4\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},"// Draw the triangle\nrenderEncoder.drawPrimitives(type: .triangle, vertexStart: 0, vertexCount: 3)\n")),(0,r.kt)("p",null,"\u9876\u70b9\u9636\u6bb5\u4e3a\u6bcf\u4e2a\u9876\u70b9\u63d0\u4f9b\u6570\u636e\u3002\u5f53\u8db3\u591f\u591a\u7684\u9876\u70b9\u5f97\u5230\u5904\u7406\u540e\uff0c\u6e32\u67d3\u7ba1\u9053\u4f1a\u5bf9\u56fe\u5143\u8fdb\u884c\u5149\u6805\u5316\uff0c\u786e\u5b9a\u6e32\u67d3\u76ee\u6807\u4e2d\u7684\u54ea\u4e9b\u50cf\u7d20\u4f4d\u4e8e\u56fe\u5143\u7684\u8fb9\u754c\u5185\u3002\u7247\u6bb5\u9636\u6bb5\u786e\u5b9a\u8981\u5199\u5165\u8fd9\u4e9b\u50cf\u7d20\u7684\u6e32\u67d3\u76ee\u6807\u7684\u503c\u3002"),(0,r.kt)("p",null,"\u5728\u8be5\u793a\u4f8b\u7684\u5176\u4f59\u90e8\u5206\u4e2d\uff0c\u4f60\u5c06\u4e86\u89e3\u5982\u4f55\u7f16\u5199\u9876\u70b9\u548c\u7247\u6bb5\u51fd\u6570\uff0c\u5982\u4f55\u521b\u5efa\u6e32\u67d3\u7ba1\u9053\u72b6\u6001\u5bf9\u8c61\uff0c\u4ee5\u53ca\u6700\u540e\u5982\u4f55\u5bf9\u4f7f\u7528\u6b64\u7ba1\u9053\u7684\u7ed8\u5236\u547d\u4ee4\u8fdb\u884c\u7f16\u7801\u3002"),(0,r.kt)("h2",{id:"\u81ea\u5b9a\u4e49\u6e32\u67d3\u7ba1\u9053\u51b3\u5b9a\u5982\u4f55\u5904\u7406\u6570\u636e"},"\u81ea\u5b9a\u4e49\u6e32\u67d3\u7ba1\u9053\u51b3\u5b9a\u5982\u4f55\u5904\u7406\u6570\u636e"),(0,r.kt)("p",null,"\u9876\u70b9\u51fd\u6570\u4e3a\u5355\u4e2a\u9876\u70b9\u751f\u6210\u6570\u636e\uff0c\u7247\u6bb5\u51fd\u6570\u4e3a\u5355\u4e2a\u7247\u6bb5\u751f\u6210\u6570\u636e\uff0c\u4f46\u4f60\u51b3\u5b9a\u5b83\u4eec\u5982\u4f55\u5de5\u4f5c\u3002\u4f60\u53ef\u4ee5\u6839\u636e\u76ee\u6807\u914d\u7f6e\u7ba1\u9053\u7684\u5404\u4e2a\u9636\u6bb5\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u77e5\u9053\u4f60\u5e0c\u671b\u7ba1\u9053\u751f\u6210\u4ec0\u4e48\u4ee5\u53ca\u5b83\u5982\u4f55\u751f\u6210\u8fd9\u4e9b\u7ed3\u679c\u3002"),(0,r.kt)("p",null,"\u51b3\u5b9a\u5c06\u54ea\u4e9b\u6570\u636e\u4f20\u9012\u5230\u6e32\u67d3\u7ba1\u9053\uff0c\u4ee5\u53ca\u5c06\u54ea\u4e9b\u6570\u636e\u4f20\u9012\u5230\u7ba1\u9053\u7684\u540e\u7eed\u9636\u6bb5\u3002\u901a\u5e38\u53ef\u4ee5\u5728\u4e09\u4e2a\u5730\u65b9\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7ba1\u9053\u7684\u8f93\u5165\uff1a\u7531\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u5e76\u4f20\u9012\u5230\u9876\u70b9\u9636\u6bb5\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u9876\u70b9\u9636\u6bb5\u7684\u8f93\u51fa\uff1a\u4f20\u9012\u5230\u5149\u6805\u5316\u9636\u6bb5\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7247\u6bb5\u9636\u6bb5\u7684\u8f93\u5165\uff1a\u7531\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u6216\u7531\u5149\u6805\u5316\u9636\u6bb5\u751f\u6210\u3002")),(0,r.kt)("p",null,"\u5728\u8be5\u793a\u4f8b\u4e2d\uff0c\u7ba1\u9053\u7684\u8f93\u5165\u6570\u636e\u662f\u9876\u70b9\u7684\u4f4d\u7f6e\u53ca\u5176\u989c\u8272\u3002\u4e3a\u4e86\u6f14\u793a\u901a\u5e38\u5728\u9876\u70b9\u51fd\u6570\u4e2d\u6267\u884c\u7684\u53d8\u6362\u7c7b\u578b\uff0c\u8f93\u5165\u5750\u6807\u5728\u81ea\u5b9a\u4e49\u5750\u6807\u7a7a\u95f4\u4e2d\u5b9a\u4e49\uff0c\u4ee5\u8ddd\u89c6\u56fe\u4e2d\u5fc3\u7684\u50cf\u7d20\u4e3a\u5355\u4f4d\u8fdb\u884c\u6d4b\u91cf\u3002\u8fd9\u4e9b\u5750\u6807\u9700\u8981\u8f6c\u6362\u4e3a Metal \u7684\u5750\u6807\u7cfb\u3002"),(0,r.kt)("p",null,"\u58f0\u660e\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"AAPLVertex")," \u7ed3\u6784\uff0c\u4f7f\u7528 SIMD \u5411\u91cf\u7c7b\u578b\u6765\u4fdd\u5b58\u4f4d\u7f6e\u548c\u989c\u8272\u6570\u636e\u3002\u8981\u5171\u4eab\u7ed3\u6784\u5728\u5185\u5b58\u4e2d\u7684\u5e03\u5c40\u65b9\u5f0f\u7684\u5355\u4e2a\u5b9a\u4e49\uff0c\u8bf7\u5728\u516c\u5171\u5934\u6587\u4ef6\u4e2d\u58f0\u660e\u8be5\u7ed3\u6784\u5e76\u5c06\u5176\u5bfc\u5165 Metal \u7740\u8272\u5668\u548c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"typedef struct\n{\n    vector_float2 position;\n    vector_float4 color;\n} AAPLVertex;\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"AAPL \u662f Apple \u516c\u53f8\u7684\u80a1\u7968\u4ee3\u7801\u3002")),(0,r.kt)("p",null,"SIMD \u7c7b\u578b\u5728 Metal Shading Language \u4e2d\u5f88\u5e38\u89c1\uff0c\u4f60\u8fd8\u5e94\u8be5\u4f7f\u7528 simd \u5e93\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002SIMD \u7c7b\u578b\u5305\u542b\u7279\u5b9a\u6570\u636e\u7c7b\u578b\u7684\u591a\u4e2a\u901a\u9053\uff0c\u56e0\u6b64\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"position")," \u58f0\u660e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"vector_float2")," \u7c7b\u578b\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u5305\u542b\u4e24\u4e2a 32 \u4f4d\u6d6e\u70b9\u503c\uff08\u5176\u5c06\u6301\u6709 ",(0,r.kt)("inlineCode",{parentName:"p"},"x")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"y")," \u5750\u6807\uff09\u3002\u989c\u8272\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"vector_float4"),"\u7c7b\u578b\uff0c\u56e0\u6b64\u5b83\u4eec\u6709\u56db\u4e2a\u901a\u9053 - \u7ea2\u8272\u3001\u7eff\u8272\u3001\u84dd\u8272\u548c\u900f\u660e\u5ea6\uff08alpha\uff09\u3002"),(0,r.kt)("p",null,"\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u8f93\u5165\u6570\u636e\u4f7f\u7528\u5e38\u91cf\u6570\u7ec4\u6307\u5b9a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},"private let triangleVertices: [AAPLVertex] = [\n        AAPLVertex(position: vector_float2(250, -250),\n                   color: vector_float4(1, 0, 0, 1)),\n        AAPLVertex(position: vector_float2(-250, -250),\n                   color: vector_float4(0, 1, 0, 1)),\n        AAPLVertex(position: vector_float2(0, 250),\n                   color: vector_float4(0, 0, 1, 1)),\n]\n")),(0,r.kt)("p",null,"\u9876\u70b9\u9636\u6bb5\u751f\u6210\u9876\u70b9\u6570\u636e\uff0c\u56e0\u6b64\u9700\u8981\u63d0\u4f9b\u989c\u8272\u548c\u53d8\u6362\u540e\u7684\u4f4d\u7f6e\u3002\u518d\u6b21\u4f7f\u7528 SIMD \u7c7b\u578b\u58f0\u660e\u4e00\u4e2a\u5305\u542b\u4f4d\u7f6e\u548c\u989c\u8272\u503c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"RasterizerData")," \u7ed3\u6784\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"struct RasterizerData\n{\n    // \u6b64\u6210\u5458\u7684 [[position]] \u5c5e\u6027\u8868\u660e\uff0c\u5f53\u6b64\u7ed3\u6784\u4ece\u9876\u70b9\u51fd\u6570\u8fd4\u56de\u65f6\n    // \u6b64\u503c\u662f\u9876\u70b9\u7684\u88c1\u526a\u7a7a\u95f4\u4f4d\u7f6e\u300c\u526a\u88c1\u7a7a\u95f4\u4f4d\u7f6e\uff08clip space position\uff09\u300d\n    float4 position [[position]];\n\n    // \u7531\u4e8e\u8be5\u6210\u5458\u6ca1\u6709\u7279\u6b8a\u5c5e\u6027\uff0c\u300c\u5149\u6805\u5316\u5668\uff08rasterizer\uff09\u300d\u4f1a\u7528\u5176\u5b83\u4e09\u89d2\u5f62\u9876\u70b9\u7684\u503c\u6765\u63d2\u503c\u5176\u503c\n    // \u7136\u540e\u5c06\u63d2\u503c\u540e\u7684\u503c\u4f20\u9012\u7ed9\u4e09\u89d2\u5f62\u4e2d\u6bcf\u4e2a\u7247\u6bb5\u7684\u300c\u7247\u65ad\u7740\u8272\u5668\u300d\u3002\n    float4 color;\n};\n")),(0,r.kt)("p",null,"\u8f93\u51fa ",(0,r.kt)("inlineCode",{parentName:"p"},"position"),"\uff08\u4e0b\u9762\u8be6\u7ec6\u63cf\u8ff0\uff09\u5fc5\u987b\u5b9a\u4e49\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"vector_float4"),"\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"color")," \u7684\u58f0\u660e\u65b9\u5f0f\u4e0e\u8f93\u5165\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u989c\u8272\u76f8\u540c\u3002"),(0,r.kt)("p",null,"\u4f60\u9700\u8981\u544a\u8bc9 Metal \u5149\u6805\u5316\u6570\u636e\u4e2d\u7684\u54ea\u4e2a\u5b57\u6bb5\u63d0\u4f9b\u4f4d\u7f6e\u6570\u636e\uff0c\u56e0\u4e3a Metal \u4e0d\u4f1a\u5bf9\u7ed3\u6784\u4e2d\u7684\u5b57\u6bb5\u5f3a\u5236\u6267\u884c\u4efb\u4f55\u7279\u5b9a\u7684\u547d\u540d\u7ea6\u5b9a\u3002\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"[[position]]")," \u5c5e\u6027\u9650\u5b9a\u7b26\u6ce8\u91ca\uff08annotate\uff09",(0,r.kt)("inlineCode",{parentName:"p"},"position")," \u5b57\u6bb5\uff0c\u4ee5\u58f0\u660e\u8be5\u5b57\u6bb5\u4fdd\u5b58\u8f93\u51fa\u4f4d\u7f6e\u3002"),(0,r.kt)("p",null,"\u7247\u6bb5\u51fd\u6570\u53ea\u662f\u5c06\u5149\u6805\u5316\u9636\u6bb5\u7684\u6570\u636e\u4f20\u9012\u5230\u540e\u9762\u7684\u9636\u6bb5\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u4efb\u4f55\u989d\u5916\u7684\u53c2\u6570\u3002"),(0,r.kt)("h2",{id:"\u58f0\u660e\u9876\u70b9\u51fd\u6570"},"\u58f0\u660e\u9876\u70b9\u51fd\u6570"),(0,r.kt)("p",null,"\u58f0\u660e\u9876\u70b9\u51fd\u6570\uff0c\u5305\u62ec\u5176\u8f93\u5165\u53c2\u6570\u548c\u8f93\u51fa\u6570\u636e\u3002\u4e0e\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"kernel")," \u5173\u952e\u5b57\u58f0\u660e\u8ba1\u7b97\u51fd\u6570\u975e\u5e38\u76f8\u4f3c\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"vertex")," \u5173\u952e\u5b57\u58f0\u660e\u9876\u70b9\u51fd\u6570\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"vertex RasterizerData\nvertexShader(uint vertexID [[vertex_id]],\n             constant AAPLVertex *vertices [[buffer(AAPLVertexInputIndexVertices)]],\n             constant vector_uint2 *viewportSizePointer [[buffer(AAPLVertexInputIndexViewportSize)]])\n")),(0,r.kt)("p",null,"\u7b2c\u4e00\u4e2a\u53c2\u6570 ",(0,r.kt)("inlineCode",{parentName:"p"},"vertexID")," \u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"[[vertex_id]]")," \u5c5e\u6027\u9650\u5b9a\u7b26\uff0c\u8fd9\u662f\u53e6\u4e00\u4e2a Metal \u5173\u952e\u5b57\u3002\u5f53\u4f60\u6267\u884c\u6e32\u67d3\u547d\u4ee4\u65f6\uff0cGPU \u4f1a\u591a\u6b21\u8c03\u7528\u9876\u70b9\u51fd\u6570\uff0c\u4e3a\u6bcf\u4e2a\u9876\u70b9\u751f\u6210\u552f\u4e00\u7684\u503c\u3002"),(0,r.kt)("p",null,"\u7b2c\u4e8c\u4e2a\u53c2\u6570 ",(0,r.kt)("inlineCode",{parentName:"p"},"vertices")," \u662f\u4e00\u4e2a\u5305\u542b\u9876\u70b9\u6570\u636e\u7684\u6570\u7ec4\uff0c\u4f7f\u7528\u5148\u524d\u5b9a\u4e49\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"AAPLVertex")," \u7ed3\u6784\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u5c06\u4f4d\u7f6e\u8f6c\u6362\u4e3a Metal \u7684\u5750\u6807\uff0c\u8be5\u51fd\u6570\u9700\u8981\u4e09\u89d2\u5f62\u88ab\u7ed8\u5236\u5230\u7684\u89c6\u53e3\u7684\u5927\u5c0f\uff08\u4ee5\u50cf\u7d20\u4e3a\u5355\u4f4d\uff09\uff0c\u56e0\u6b64\u5b83\u5b58\u50a8\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"viewportSizePointer")," \u53c2\u6570\u4e2d\u3002"),(0,r.kt)("p",null,"\u7b2c\u4e8c\u4e2a\u548c\u7b2c\u4e09\u4e2a\u53c2\u6570\u5177\u6709 ",(0,r.kt)("inlineCode",{parentName:"p"},"[[buffer(n)]]")," \u5c5e\u6027\u9650\u5b9a\u7b26\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cMetal \u4f1a\u81ea\u52a8\u5728\u53c2\u6570\u8868\u4e2d\u4e3a\u6bcf\u4e2a\u53c2\u6570\u5206\u914d\u69fd\u4f4d\u3002\u5f53\u4f60\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"[[buffer(n)]]")," \u9650\u5b9a\u7b26\u6dfb\u52a0\u5230\u7f13\u51b2\u533a\u53c2\u6570\u65f6\uff0c\u4f60\u660e\u786e\u544a\u8bc9 Metal \u8981\u4f7f\u7528\u54ea\u4e2a\u69fd\u3002\u663e\u5f0f\u58f0\u660e\u63d2\u69fd\u53ef\u4ee5\u66f4\u8f7b\u677e\u5730\u4fee\u6539\u7740\u8272\u5668\uff0c\u800c\u65e0\u9700\u66f4\u6539\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u3002\u5728\u5171\u4eab\u5934\u6587\u4ef6\u4e2d\u58f0\u660e\u4e24\u4e2a\u7d22\u5f15\u7684\u5e38\u91cf\u3002"),(0,r.kt)("p",null,"\u8be5\u51fd\u6570\u7684\u8f93\u51fa\u662f\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"RasterizerData")," \u7ed3\u6784\u3002"),(0,r.kt)("h2",{id:"\u7f16\u5199\u9876\u70b9\u51fd\u6570"},"\u7f16\u5199\u9876\u70b9\u51fd\u6570"),(0,r.kt)("p",null,"\u4f60\u7684\u9876\u70b9\u51fd\u6570\u5fc5\u987b\u751f\u6210\u8f93\u51fa\u7ed3\u6784\u7684\u4e24\u4e2a\u5b57\u6bb5\u3002\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"vertexID")," \u53c2\u6570\u5bf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"vertices")," \u6570\u7ec4\u8fdb\u884c\u7d22\u5f15\u5e76\u8bfb\u53d6\u9876\u70b9\u7684\u8f93\u5165\u6570\u636e\u3002\u53e6\u5916\uff0c\u68c0\u7d22\u89c6\u53e3\u5c3a\u5bf8\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"float2 pixelSpacePosition = vertices[vertexID].position.xy;\n\n// \u83b7\u53d6\u89c6\u53e3\u5927\u5c0f\u5e76\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\nvector_float2 viewportSize = vector_float2(*viewportSizePointer);\n")),(0,r.kt)("p",null,"\u9876\u70b9\u51fd\u6570\u5fc5\u987b\u63d0\u4f9b clip-space \u5750\u6807\u4e2d\u7684\u4f4d\u7f6e\u6570\u636e\uff0c\u8fd9\u4e9b\u5750\u6807\u662f\u4f7f\u7528\u56db\u7ef4\u9f50\u6b21\u5411\u91cf ",(0,r.kt)("inlineCode",{parentName:"p"},"(x, y, z, w)")," \u6307\u5b9a\u7684 3D \u70b9\u3002\u5149\u6805\u5316\u9636\u6bb5\u83b7\u53d6\u8f93\u51fa\u4f4d\u7f6e\u5e76\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"x"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"y")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"z")," \u5750\u6807\u534f\u540c ",(0,r.kt)("inlineCode",{parentName:"p"},"w")," \u4ee5\u751f\u6210 3D \u70b9\u7684 ",(0,r.kt)("strong",{parentName:"p"},"\u6807\u51c6\u5316\u8bbe\u5907\u5750\u6807\uff08normalized device coordinates\uff09"),"\u3002\u6807\u51c6\u5316\u8bbe\u5907\u5750\u6807\u4e0e\u89c6\u53e3\u5927\u5c0f\u65e0\u5173\u3002"),(0,r.kt)(A,{src:n(78345),size:320,edge:"white",mdxType:"Figure"}),(0,r.kt)("p",null,"\u6807\u51c6\u5316\u8bbe\u5907\u5750\u6807\u4f7f\u7528\u5de6\u624b\u5750\u6807\u7cfb\u5e76\u6620\u5c04\u5230\u89c6\u53e3\u4e2d\u7684\u4f4d\u7f6e\u3002\u57fa\u5143\u88ab\u526a\u88c1\u5230\u8be5\u5750\u6807\u7cfb\u4e2d\u7684\u4e00\u4e2a\u6846\u5185\uff0c\u7136\u540e\u8fdb\u884c\u5149\u6805\u5316\u3002\u526a\u5207\u6846\u7684\u5de6\u4e0b\u89d2\u4f4d\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"(-1.0 , -1.0)")," \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"(x ,y)")," \u5750\u6807\u5904\uff0c\u53f3\u4e0a\u89d2\u4f4d\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"(1.0 , 1.0)")," \u5904\u3002\u6b63 ",(0,r.kt)("inlineCode",{parentName:"p"},"z")," \u503c\u6307\u5411\u8fdc\u79bb\u76f8\u673a\u7684\u65b9\u5411\uff08\u8fdb\u5165\u5c4f\u5e55\uff09\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"z")," \u5750\u6807\u7684\u53ef\u89c1\u90e8\u5206\u4f4d\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"0.0")," \uff08\u8fd1\u526a\u88c1\u5e73\u9762\uff09\u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"1.0")," \uff08\u8fdc\u526a\u88c1\u5e73\u9762\uff09\u3002"),(0,r.kt)("p",null,"\u5c06\u8f93\u5165\u5750\u6807\u7cfb\u8f6c\u6362\u4e3a\u6807\u51c6\u5316\u8bbe\u5907\u5750\u6807\u7cfb\u3002"),(0,r.kt)(A,{src:n(63346),size:620,edge:"white",mdxType:"Figure"}),(0,r.kt)("p",null,"\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a 2D \u5e94\u7528\u7a0b\u5e8f\uff0c\u4e0d\u9700\u8981\u9f50\u6b21\u5750\u6807\uff08homogenous coordinates\uff09\uff0c\u6240\u4ee5\u9996\u5148\u5c06\u9ed8\u8ba4\u503c\u5199\u5165\u8f93\u51fa\u5750\u6807\uff0c\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"w")," \u503c\u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"1.0")," \uff0c\u5c06\u5176\u5b83\u5750\u6807\u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"0.0"),"\u3002\u8fd9\u610f\u5473\u7740\u5750\u6807\u5df2\u7ecf\u4f4d\u4e8e\u6807\u51c6\u5316\u8bbe\u5907\u5750\u6807\u7a7a\u95f4\u4e2d\uff0c\u5e76\u4e14\u9876\u70b9\u51fd\u6570\u5e94\u5728\u8be5\u5750\u6807\u7a7a\u95f4\u4e2d\u751f\u6210 ",(0,r.kt)("inlineCode",{parentName:"p"},"(x, y)")," \u5750\u6807\u3002\u5c06\u8f93\u5165\u4f4d\u7f6e\u9664\u4ee5\u89c6\u53e3\u5927\u5c0f\u7684\u4e00\u534a\u4ee5\u751f\u6210\u6807\u51c6\u5316\u7684\u8bbe\u5907\u5750\u6807\u3002\u7531\u4e8e\u8be5\u8ba1\u7b97\u662f\u4f7f\u7528 SIMD \u7c7b\u578b\u6267\u884c\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u4e00\u884c\u4ee3\u7801\u540c\u65f6\u5212\u5206\u4e24\u4e2a\u901a\u9053\u3002\u6267\u884c\u9664\u6cd5\u5e76\u5c06\u7ed3\u679c\u653e\u5165\u8f93\u51fa\u4f4d\u7f6e\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"x")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"y")," \u901a\u9053\u4e2d\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"out.position = vector_float4(0.0, 0.0, 0.0, 1.0);\nout.position.xy = pixelSpacePosition / (viewportSize / 2.0);\n")),(0,r.kt)("p",null,"\u6700\u540e\uff0c\u5c06\u989c\u8272\u503c\u590d\u5236\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"out.color")," \u8fd4\u56de\u503c\u4e2d\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"out.color = vertices[vertexID].color;\n")),(0,r.kt)("h2",{id:"\u7f16\u5199\u4e00\u4e2a\u7247\u6bb5\u51fd\u6570"},"\u7f16\u5199\u4e00\u4e2a\u7247\u6bb5\u51fd\u6570"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u7247\u6bb5")," \u662f\u5bf9\u6e32\u67d3\u76ee\u6807\u7684\u53ef\u80fd\u66f4\u6539\u3002\u5149\u6805\u5316\u5668\u786e\u5b9a\u6e32\u67d3\u76ee\u6807\u7684\u54ea\u4e9b\u50cf\u7d20\u88ab\u56fe\u5143\u8986\u76d6\u3002\u4ec5\u6e32\u67d3\u50cf\u7d20\u4e2d\u5fc3\u4f4d\u4e8e\u4e09\u89d2\u5f62\u5185\u90e8\u7684\u7247\u6bb5\u3002"),(0,r.kt)(A,{src:n(14580),size:420,mdxType:"Figure"}),(0,r.kt)("p",null,"\u7247\u6bb5\u51fd\u6570\u5904\u7406\u6765\u81ea\u5149\u6805\u5668\u7684\u5355\u4e2a\u4f4d\u7f6e\u7684\u4f20\u5165\u4fe1\u606f\uff0c\u5e76\u8ba1\u7b97\u6bcf\u4e2a\u6e32\u67d3\u76ee\u6807\u7684\u8f93\u51fa\u503c\u3002\u8fd9\u4e9b\u7247\u6bb5\u503c\u7531\u7ba1\u9053\u4e2d\u7684\u540e\u7eed\u9636\u6bb5\u5904\u7406\uff0c\u6700\u7ec8\u88ab\u5199\u5165\u6e32\u67d3\u76ee\u6807\u3002"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},'\u7247\u6bb5\u88ab\u79f0\u4e3a "\u53ef\u80fd\u7684\u66f4\u6539" \u7684\u539f\u56e0\uff1a\u7247\u6bb5\u9636\u6bb5\u4e4b\u540e\u7684\u7ba1\u9053\u9636\u6bb5\u53ef\u4ee5\u914d\u7f6e\u4e3a\u62d2\u7edd\u67d0\u4e9b\u7247\u6bb5\uff0c\u6216\u66f4\u6539\u5199\u5165\u6e32\u67d3\u76ee\u6807\u7684\u5185\u5bb9\u3002\u5728\u8be5\u793a\u4f8b\u4e2d\uff0c\u7247\u6bb5\u9636\u6bb5\u8ba1\u7b97\u7684\u6240\u6709\u503c\u5747\u6309\u539f\u6837\u5199\u5165\u6e32\u67d3\u76ee\u6807\u3002')),(0,r.kt)("p",null,'\u5728\u8be5\u793a\u4f8b\u4e2d\uff0c"\u7247\u6bb5\u7740\u8272\u5668\u63a5\u6536\u7684\u53c2\u6570" \u4e0e "\u9876\u70b9\u7740\u8272\u5668\u8f93\u51fa\u4e2d\u58f0\u660e\u7684\u53c2\u6570" \u76f8\u540c\u3002\u4f7f\u7528 ',(0,r.kt)("inlineCode",{parentName:"p"},"fragment")," \u5173\u952e\u5b57\u58f0\u660e\u7247\u6bb5\u51fd\u6570\u3002\u5b83\u9700\u8981\u4e00\u4e2a\u53c2\u6570\uff0c\u4e0e\u9876\u70b9\u9636\u6bb5\u63d0\u4f9b\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"RasterizerData")," \u7ed3\u6784\u76f8\u540c\u3002\u6dfb\u52a0 ",(0,r.kt)("inlineCode",{parentName:"p"},"[[stage_in]]")," \u5c5e\u6027\u9650\u5b9a\u7b26\u4ee5\u6307\u793a\u8be5\u53c2\u6570\u7531\u5149\u6805\u5316\u5668\u751f\u6210\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"fragment float4 fragmentShader(RasterizerData in [[stage_in]])\n")),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u7684\u7247\u6bb5\u51fd\u6570\u5199\u5165\u591a\u4e2a\u6e32\u67d3\u76ee\u6807\uff0c\u5219\u5b83\u5fc5\u987b\u58f0\u660e\u4e00\u4e2a\u5305\u542b\u6bcf\u4e2a\u6e32\u67d3\u76ee\u6807\u5b57\u6bb5\u7684\u7ed3\u6784\u3002\u7531\u4e8e\u8be5\u793a\u4f8b\u53ea\u6709\u4e00\u4e2a\u6e32\u67d3\u76ee\u6807\uff0c\u56e0\u6b64\u4f60\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a\u6d6e\u70b9\u5411\u91cf\u4f5c\u4e3a\u51fd\u6570\u7684\u8f93\u51fa\u3002\u6b64\u8f93\u51fa\u662f\u8981\u5199\u5165\u6e32\u67d3\u76ee\u6807\u7684\u989c\u8272\u3002"),(0,r.kt)("p",null,"\u5149\u6805\u5316\u9636\u6bb5\u8ba1\u7b97\u6bcf\u4e2a\u7247\u6bb5\u53c2\u6570\u7684\u503c\u5e76\u7528\u5b83\u4eec\u8c03\u7528\u7247\u6bb5\u51fd\u6570\u3002\u5149\u6805\u5316\u9636\u6bb5\u5c06\u5176\u989c\u8272\u53c2\u6570\u8ba1\u7b97\u4e3a\u4e09\u89d2\u5f62\u9876\u70b9\u989c\u8272\u7684\u6df7\u5408\uff08blend\uff09\u3002\u7247\u6bb5\u8ddd\u79bb\u9876\u70b9\u8d8a\u8fd1\uff0c\u8be5\u9876\u70b9\u5bf9\u6700\u7ec8\u989c\u8272\u7684\u8d21\u732e\u5c31\u8d8a\u5927\u3002"),(0,r.kt)(A,{src:n(45672),size:420,edge:"white",mdxType:"Figure"}),(0,r.kt)("p",null,"\u8fd4\u56de\u63d2\u503c\u989c\u8272\u4f5c\u4e3a\u51fd\u6570\u7684\u8f93\u51fa\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"return in.color;\n")),(0,r.kt)("h2",{id:"\u521b\u5efa\u6e32\u67d3\u7ba1\u9053\u72b6\u6001\u5bf9\u8c61"},"\u521b\u5efa\u6e32\u67d3\u7ba1\u9053\u72b6\u6001\u5bf9\u8c61"),(0,r.kt)("p",null,"\u73b0\u5728\u51fd\u6570\u90e8\u5206\u5df2\u5b8c\u6210\uff0c\u4f60\u53ef\u4ee5\u521b\u5efa\u4f7f\u7528\u5b83\u4eec\u7684\u6e32\u67d3\u7ba1\u9053\u3002\u9996\u5148\uff0c\u83b7\u53d6\u9ed8\u8ba4\u5e93\u5e76\u4e3a\u6bcf\u4e2a\u51fd\u6570\u83b7\u53d6\u4e00\u4e2a ",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/metal/mtlfunction"},"MTLFunction")," \u5bf9\u8c61\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},'let defaultLibrary = device.makeDefaultLibrary()\n\nlet vertexFunction = defaultLibrary.makeFunction(name: "vertexShader")\nlet fragmentFunction = defaultLibrary.makeFunction(name: "fragmentShader")\n')),(0,r.kt)("p",null,"\u63a5\u4e0b\u6765\uff0c\u521b\u5efa\u4e00\u4e2a ",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/metal/mtlrenderpipelinestate"},"MTLRenderPipelineState")," \u5bf9\u8c61\u3002\u6e32\u67d3\u7ba1\u9053\u6709\u66f4\u591a\u9636\u6bb5\u9700\u8981\u914d\u7f6e\uff0c\u56e0\u6b64\u4f60\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/metal/mtlrenderpipelinedescriptor"},"MTLRenderPipelineDescriptor")," \u6765\u914d\u7f6e\u7ba1\u9053\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},'let pipelineDescriptor = MTLRenderPipelineDescriptor()\npipelineDescriptor.label = "Simple Pipeline"\npipelineDescriptor.vertexFunction = vertexFunction\npipelineDescriptor.fragmentFunction = fragmentFunction\npipelineDescriptor.colorAttachments[0].pixelFormat = format\n\npipelineState = try device.makeRenderPipelineState(descriptor: pipelineDescriptor)\n')),(0,r.kt)("p",null,"\u9664\u4e86\u6307\u5b9a\u9876\u70b9\u548c\u7247\u6bb5\u51fd\u6570\u4e4b\u5916\uff0c\u4f60\u8fd8\u53ef\u4ee5\u58f0\u660e\u7ba1\u9053\u5c06\u7ed8\u5236\u5230\u7684\u6240\u6709\u6e32\u67d3\u76ee\u6807\u7684 ",(0,r.kt)("strong",{parentName:"p"},"\u50cf\u7d20\u683c\u5f0f"),"\u3002\u50cf\u7d20\u683c\u5f0f\uff08",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/metal/mtlpixelformat"},"MTLPixelFormat"),"\uff09\u5b9a\u4e49\u50cf\u7d20\u6570\u636e\u7684\u5185\u5b58\u5e03\u5c40\uff08memory layout\uff09\u3002\u5bf9\u4e8e\u7b80\u5355\u683c\u5f0f\uff0c\u6b64\u5b9a\u4e49\u5305\u62ec\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a\u50cf\u7d20\u7684\u5b57\u8282\u6570"),(0,r.kt)("li",{parentName:"ul"},"\u50cf\u7d20\u4e2d\u5b58\u50a8\u7684\u6570\u636e\u901a\u9053\u6570"),(0,r.kt)("li",{parentName:"ul"},"\u8fd9\u4e9b\u901a\u9053\u7684\u4f4d\u5e03\u5c40\uff08bit layout\uff09")),(0,r.kt)("p",null,"\u7531\u4e8e\u8be5\u793a\u4f8b\u53ea\u6709\u4e00\u4e2a\u6e32\u67d3\u76ee\u6807\u5e76\u4e14\u662f\u7531\u89c6\u56fe\u63d0\u4f9b\uff0c\u56e0\u6b64\u53ea\u9700\u5c06\u89c6\u56fe\u7684\u50cf\u7d20\u683c\u5f0f\u590d\u5236\u5230\u6e32\u67d3\u7ba1\u9053\u63cf\u8ff0\u5668\u4e2d\u3002\u4f60\u7684\u6e32\u67d3\u7ba1\u9053\u72b6\u6001\u5fc5\u987b\u4f7f\u7528\u4e0e\u6e32\u67d3\u901a\u9053\u6307\u5b9a\u7684\u50cf\u7d20\u683c\u5f0f\u517c\u5bb9\u7684\u50cf\u7d20\u683c\u5f0f\u3002\u5728\u8be5\u793a\u4f8b\u4e2d\uff0c\u6e32\u67d3\u901a\u9053\u548c\u7ba1\u9053\u72b6\u6001\u5bf9\u8c61\u90fd\u4f7f\u7528\u89c6\u56fe\u7684\u50cf\u7d20\u683c\u5f0f\uff0c\u56e0\u6b64\u5b83\u4eec\u59cb\u7ec8\u76f8\u540c\u3002"),(0,r.kt)("p",null,"\u5f53 Metal \u521b\u5efa\u6e32\u67d3\u7ba1\u9053\u72b6\u6001\u5bf9\u8c61\u65f6\uff0c\u7ba1\u9053\u88ab\u914d\u7f6e\u4e3a\u5c06\u7247\u6bb5\u51fd\u6570\u7684\u8f93\u51fa\u8f6c\u6362\u4e3a\u6e32\u67d3\u76ee\u6807\u7684\u50cf\u7d20\u683c\u5f0f\u3002\u5982\u679c\u8981\u9488\u5bf9\u4e0d\u540c\u7684\u50cf\u7d20\u683c\u5f0f\uff0c\u5219\u9700\u8981\u521b\u5efa\u4e0d\u540c\u7684\u7ba1\u9053\u72b6\u6001\u5bf9\u8c61\u3002\u4f60\u53ef\u4ee5\u5728\u9488\u5bf9\u4e0d\u540c\u50cf\u7d20\u683c\u5f0f\u7684\u591a\u4e2a\u7ba1\u9053\u4e2d\u91cd\u590d\u4f7f\u7528\u76f8\u540c\u7684\u7740\u8272\u5668\u3002"),(0,r.kt)("h2",{id:"\u8bbe\u7f6e\u89c6\u53e3"},"\u8bbe\u7f6e\u89c6\u53e3"),(0,r.kt)("p",null,"\u73b0\u5728\u4f60\u5df2\u7ecf\u6709\u4e86\u7ba1\u9053\u7684\u6e32\u67d3\u7ba1\u9053\u72b6\u6001\u5bf9\u8c61\uff0c\u4f60\u5c06\u6e32\u67d3\u4e09\u89d2\u5f62\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u6e32\u67d3\u547d\u4ee4\u7f16\u7801\u5668\u6765\u6267\u884c\u6b64\u64cd\u4f5c\u3002\u9996\u5148\uff0c\u8bbe\u7f6e\u89c6\u53e3\uff0c\u4ee5\u4fbf Metal \u77e5\u9053\u8981\u7ed8\u5236\u5230\u6e32\u67d3\u76ee\u6807\u7684\u54ea\u4e00\u90e8\u5206\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},"// \u8bbe\u7f6e\u8981\u7ed8\u5236\u5230\u7684 drawable \u533a\u57df\nrenderEncoder.setViewport(MTLViewport(originX: 0.0,\n                                        originY: 0.0,\n                                        width: Double(viewportSize.x),\n                                        height: Double(viewportSize.y),\n                                        znear: 0.0,\n                                        zfar: 1.0))\n")),(0,r.kt)("h2",{id:"\u8bbe\u7f6e\u6e32\u67d3\u7ba1\u9053\u72b6\u6001"},"\u8bbe\u7f6e\u6e32\u67d3\u7ba1\u9053\u72b6\u6001"),(0,r.kt)("p",null,"\u8bbe\u7f6e\u8981\u4f7f\u7528\u7684\u7ba1\u9053\u7684\u6e32\u67d3\u7ba1\u9053\u72b6\u6001\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},"renderEncoder.setRenderPipelineState(pipelineState)\n")),(0,r.kt)("h2",{id:"\u5c06\u53c2\u6570\u6570\u636e\u53d1\u9001\u5230\u9876\u70b9\u51fd\u6570"},"\u5c06\u53c2\u6570\u6570\u636e\u53d1\u9001\u5230\u9876\u70b9\u51fd\u6570"),(0,r.kt)("p",null,"\u901a\u5e38\uff0c\u4f60\u4f7f\u7528\u7f13\u51b2\u533a\uff08",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/metal/mtlbuffer"},"MTLBuffer"),"\uff09\u5c06\u6570\u636e\u4f20\u9012\u7ed9\u7740\u8272\u5668\u3002\u4f46\u662f\uff0c\u5f53\u4f60\u53ea\u9700\u8981\u5411\u9876\u70b9\u51fd\u6570\u4f20\u9012\u5c11\u91cf\u6570\u636e\u65f6\uff08\u5c31\u50cf\u6b64\u5904\u7684\u60c5\u51b5\u4e00\u6837\uff09\uff0c\u53ef\u5c06\u6570\u636e\u76f4\u63a5\u590d\u5236\u5230\u547d\u4ee4\u7f13\u51b2\u533a\u4e2d\u3002"),(0,r.kt)("p",null,"\u8be5\u793a\u4f8b\u5c06\u4e24\u4e2a\u53c2\u6570\u7684\u6570\u636e\u590d\u5236\u5230\u547d\u4ee4\u7f13\u51b2\u533a\u4e2d\u3002\u9876\u70b9\u6570\u636e\u662f\u4ece\u793a\u4f8b\u4e2d\u5b9a\u4e49\u7684\u6570\u7ec4\u590d\u5236\u7684\u3002\u89c6\u53e3\u6570\u636e\u662f\u4ece\u7528\u4e8e\u8bbe\u7f6e\u89c6\u53e3\u7684\u540c\u4e00\u53d8\u91cf\u590d\u5236\u7684\u3002"),(0,r.kt)("p",null,"\u5728\u8be5\u793a\u4f8b\u4e2d\uff0c\u7247\u6bb5\u51fd\u6570\u4ec5\u4f7f\u7528\u4ece\u5149\u6805\u5316\u5668\u63a5\u6536\u7684\u6570\u636e\uff0c\u56e0\u6b64\u65e0\u9700\u8bbe\u7f6e\u53c2\u6570\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},"renderEncoder.setVertexBytes(triangleVertices,\n                             length: triangleVertices.count * MemoryLayout<AAPLVertex>.stride,\n                             index: Int(AAPLVertexInputIndexVertices.rawValue))\nrenderEncoder.setVertexBytes(&viewportSize,\n                             length: triangleVertices.count * MemoryLayout<AAPLVertex>.stride,\n                             index: Int(AAPLVertexInputIndexViewportSize.rawValue))\n")),(0,r.kt)("h2",{id:"\u5bf9\u7ed8\u5236\u547d\u4ee4\u8fdb\u884c\u7f16\u7801"},"\u5bf9\u7ed8\u5236\u547d\u4ee4\u8fdb\u884c\u7f16\u7801"),(0,r.kt)("p",null,"\u6307\u5b9a\u56fe\u5143\uff08primitive\uff09\u7684\u7c7b\u578b\u3001\u5f00\u59cb\u7684\u7d22\u5f15\u548c\u9876\u70b9\u6570\u3002\u6e32\u67d3\u4e09\u89d2\u5f62\u65f6\uff0c\u5c06\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"0"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"1")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"2")," \u4f5c\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"vertexID")," \u53c2\u6570\u7684\u503c\u6765\u8c03\u7528\u9876\u70b9\u51fd\u6570\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},"// Draw the triangle.\nrenderEncoder.drawPrimitives(type: .triangle, vertexStart: 0, vertexCount: 3)\n")),(0,r.kt)("p",null,"\u4e0e\u4f7f\u7528 Metal \u7ed8\u5236\u5230\u5c4f\u5e55\u4e00\u6837\uff0c\u4f60\u7ed3\u675f\u7f16\u7801\u8fc7\u7a0b\u5e76\u63d0\u4ea4\u547d\u4ee4\u7f13\u51b2\u533a\u3002\u4f46\u662f\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u7ec4\u6b65\u9aa4\u5bf9\u66f4\u591a\u6e32\u67d3\u547d\u4ee4\u8fdb\u884c\u7f16\u7801\u3002\u6700\u7ec8\u56fe\u50cf\u7684\u6e32\u67d3\u5c31\u50cf\u547d\u4ee4\u662f\u6309\u7167\u6307\u5b9a\u7684\u987a\u5e8f\u5904\u7406\u7684\u4e00\u6837\u3002 \uff08\u4e3a\u4e86\u6027\u80fd\uff0cGPU \u53ef\u4ee5\u5e76\u884c\u5904\u7406\u547d\u4ee4\u751a\u81f3\u90e8\u5206\u547d\u4ee4\uff0c\u53ea\u8981\u6700\u7ec8\u7ed3\u679c\u770b\u8d77\u6765\u662f\u6309\u987a\u5e8f\u6e32\u67d3\u7684\u3002\uff09"),(0,r.kt)("h2",{id:"\u5c1d\u8bd5\u989c\u8272\u63d2\u503c"},"\u5c1d\u8bd5\u989c\u8272\u63d2\u503c"),(0,r.kt)("p",null,"\u5728\u8be5\u793a\u4f8b\u4e2d\uff0c\u989c\u8272\u503c\u5728\u4e09\u89d2\u5f62\u4e0a\u8fdb\u884c\u63d2\u503c\u3002\u8fd9\u901a\u5e38\u662f\u4f60\u60f3\u8981\u7684\uff0c\u4f46\u6709\u65f6\u4f60\u5e0c\u671b\u7531\u4e00\u4e2a\u9876\u70b9\u751f\u6210\u4e00\u4e2a\u503c\uff0c\u5e76\u5728\u6574\u4e2a\u56fe\u5143\u4e2d\u4fdd\u6301\u4e0d\u53d8\u3002\u4e3a\u6b64\uff0c\u8bf7\u5728\u9876\u70b9\u51fd\u6570\u7684\u8f93\u51fa\u4e0a\u6307\u5b9a flat \u5c5e\u6027\u9650\u5b9a\u7b26\u3002\u73b0\u5728\u5c31\u8bd5\u8bd5\u8fd9\u4e2a\u3002\u5728\u793a\u4f8b\u9879\u76ee\u4e2d\u627e\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"RasterizerData")," \u7684\u5b9a\u4e49\uff0c\u5e76\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"[[flat]]")," \u9650\u5b9a\u7b26\u6dfb\u52a0\u5230\u5176 ",(0,r.kt)("inlineCode",{parentName:"p"},"color")," \u5b57\u6bb5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"float4 color [[flat]];\n")),(0,r.kt)("p",null,"\u518d\u6b21\u8fd0\u884c\u793a\u4f8b\u3002\u6e32\u67d3\u7ba1\u9053\u5728\u6574\u4e2a\u4e09\u89d2\u5f62\u4e0a\u5747\u5300\u5730\u4f7f\u7528\u6765\u81ea\u7b2c\u4e00\u4e2a\u9876\u70b9\uff08\u79f0\u4e3a\u6fc0\u53d1\u9876\u70b9\uff09\u7684\u989c\u8272\u503c\uff0c\u5e76\u5ffd\u7565\u6765\u81ea\u5176\u5b83\u4e24\u4e2a\u9876\u70b9\u7684\u989c\u8272\u3002\u4f60\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528\u5e73\u9762\u9634\u5f71\u548c\u63d2\u503c\uff0c\u53ea\u9700\u5728\u9876\u70b9\u51fd\u6570\u7684\u8f93\u51fa\u4e0a\u6dfb\u52a0\u6216\u7701\u7565 ",(0,r.kt)("inlineCode",{parentName:"p"},"flat")," \u9650\u5b9a\u7b26\u5373\u53ef\u3002",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/metal/Metal-Shading-Language-Specification.pdf"},"Metal \u7740\u8272\u8bed\u8a00\u89c4\u8303")," \u5b9a\u4e49\u4e86\u5176\u5b83\u5c5e\u6027\u9650\u5b9a\u7b26\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u6765\u4fee\u6539\u5149\u6805\u5316\u884c\u4e3a\u3002"),(0,r.kt)("p",null,"\u6548\u679c\u5982\u4e0b\uff1a"),(0,r.kt)(m,{src:n(24882),size:120,mdxType:"Screenshot"}),(0,r.kt)("h2",{id:"\u5b8c\u6574\u793a\u4f8b"},"\u5b8c\u6574\u793a\u4f8b"),(0,r.kt)("h3",{id:"aaplshadertypesh"},"AAPLShaderTypes.h"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'#ifndef AAPLShaderTypes_h\n#define AAPLShaderTypes_h\n\n#include <simd/simd.h>\n\n// \u7f13\u51b2\u533a\u7d22\u5f15\n// - \u5728\u7740\u8272\u5668\uff08shader\uff09\u548c Swift \u4ee3\u7801\u4e4b\u95f4\u5171\u4eab\n//   \u4ee5\u786e\u4fdd "Metal API \u7f13\u51b2\u533a\u96c6\u8c03\u7528" \u80fd\u591f\u4e0e "Metal \u7740\u8272\u5668\u7f13\u51b2\u533a\u8f93\u5165" \u76f8\u5339\u914d\ntypedef enum AAPLVertexInputIndex\n{\n    AAPLVertexInputIndexVertices     = 0,\n    AAPLVertexInputIndexViewportSize = 1,\n} AAPLVertexInputIndex;\n\n// \u53d1\u9001\u5230 "\u9876\u70b9\u7740\u8272\u5668" \u7684\u9876\u70b9\u7684\u5e03\u5c40\uff08layout\uff09\u7684\u7ed3\u6784\n// - \u4e5f\u5728\u7740\u8272\u5668\uff08shader\uff09\u548c Swift \u4ee3\u7801\u4e4b\u95f4\u5171\u4eab\uff0c\n//   \u4ee5\u786e\u4fdd "Swift \u4ee3\u7801\u4e2d\u7684\u9876\u70b9\u6570\u7ec4\u7684\u5e03\u5c40" \u4e0e "Metal \u9876\u70b9\u7740\u8272\u5668\u9884\u671f\u7684" \u76f8\u5339\u914d\ntypedef struct {\n    // \u4e8c\u7ef4\u4f4d\u7f6e\n    vector_float2 position;\n    // RGBA \u989c\u8272\n    vector_float4 color;\n} AAPLVertex;\n\n#endif /* AAPLShaderTypes_h */\n')),(0,r.kt)("h3",{id:"aapl-bridging-headerh"},"AAPL-Bridging-Header.h"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'#ifndef AAPL_Bridging_Header_h\n#define AAPL_Bridging_Header_h\n\n#import "AAPLShaderTypes.h"\n\n#endif /* AAPL_Bridging_Header_h */\n')),(0,r.kt)("p",null,'\u4e3a\u80fd\u591f\u5728 Swift \u4e2d\u4f7f\u7528\u5934\u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u7ed3\u6784\uff0c\u4f60\u9700\u8981\u5728\u5efa\u7acb "-Bridging-Header.h" \u6765\u6865\u63a5\u5934\u6587\u4ef6\uff0c\u5e76\u5728 Xcode \u4e2d\u8fdb\u884c\u76f8\u5173\u914d\u7f6e\uff1a'),(0,r.kt)(A,{src:n(78559),size:720,mdxType:"Figure"}),(0,r.kt)("p",null,"\u8be6\u89c1 ",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/swift/importing-objective-c-into-swift"},"Importing Objective-C into Swift")," \u3002"),(0,r.kt)("h3",{id:"aaplshadersmetal"},"AAPLShaders.metal"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'#include <metal_stdlib>\nusing namespace metal;\n\n\n// \u5305\u542b\u8be5\u8bf7\u6c42\u5934\u4ee5\u5b9e\u73b0\u5728 "Metal \u7740\u8272\u5668\u4ee3\u7801" \u548c "\u6267\u884c Metal API \u547d\u4ee4\u7684 Swift \u4ee3\u7801" \u8fdb\u884c\u5171\u4eab\n#include "AAPLShaderTypes.h"\n\n// "\u9876\u70b9\u7740\u8272\u5668\u8f93\u51fa" \u548c "\u7247\u6bb5\u7740\u8272\u5668\u8f93\u5165" \u7684\u7ed3\u6784\nstruct RasterizerData\n{\n    // \u6b64\u6210\u5458\u7684 [[position]] \u5c5e\u6027\u8868\u660e\uff0c\u5f53\u6b64\u7ed3\u6784\u4ece\u9876\u70b9\u51fd\u6570\u8fd4\u56de\u65f6\n    // \u6b64\u503c\u662f\u9876\u70b9\u7684\u88c1\u526a\u7a7a\u95f4\u4f4d\u7f6e\u300c\u526a\u88c1\u7a7a\u95f4\u4f4d\u7f6e\uff08clip space position\uff09\u300d\n    float4 position [[position]];\n\n    // \u7531\u4e8e\u8be5\u6210\u5458\u6ca1\u6709\u7279\u6b8a\u5c5e\u6027\uff0c\u300c\u5149\u6805\u5316\u5668\uff08rasterizer\uff09\u300d\u4f1a\u7528\u5176\u5b83\u4e09\u89d2\u5f62\u9876\u70b9\u7684\u503c\u6765\u63d2\u503c\u5176\u503c\n    // \u7136\u540e\u5c06\u63d2\u503c\u540e\u7684\u503c\u4f20\u9012\u7ed9\u4e09\u89d2\u5f62\u4e2d\u6bcf\u4e2a\u7247\u6bb5\u7684\u300c\u7247\u65ad\u7740\u8272\u5668\u300d\u3002\n    float4 color;\n};\n\nvertex RasterizerData\nvertexShader(uint vertexID [[vertex_id]],\n             constant AAPLVertex *vertices [[buffer(AAPLVertexInputIndexVertices)]],\n             constant vector_uint2 *viewportSizePointer [[buffer(AAPLVertexInputIndexViewportSize)]])\n{\n    RasterizerData out;\n\n    // \u5728\u4f4d\u7f6e\u6570\u7ec4\u4e2d\u7d22\u5f15\u4ee5\u83b7\u53d6\u5f53\u524d\u9876\u70b9\n    // \u4f4d\u7f6e\u4ee5\u50cf\u7d20\u7ef4\u5ea6\u6307\u5b9a\uff08\u6bd4\u5982\uff0c\u503c 100 \u8868\u793a\u8ddd\u79bb\u539f\u70b9 100 \u50cf\u7d20\uff09\n    float2 pixelSpacePosition = vertices[vertexID].position.xy;\n\n    // \u83b7\u53d6\u89c6\u53e3\u5927\u5c0f\u5e76\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\n    vector_float2 viewportSize = vector_float2(*viewportSizePointer);\n\n    // \u8981\u5c06\u300c\u50cf\u7d20\u7a7a\u95f4\u300d\u4e2d\u7684\u4f4d\u7f6e\u8f6c\u6362\u4e3a\u300c\u88c1\u526a\u7a7a\u95f4\u300d\u4e2d\u7684\u4f4d\u7f6e\n    // \u8bf7\u5c06\u50cf\u7d20\u5750\u6807\u9664\u4ee5\u89c6\u53e3\u5927\u5c0f\u7684\u4e00\u534a\n    out.position = vector_float4(0.0, 0.0, 0.0, 1.0);\n    out.position.xy = pixelSpacePosition / (viewportSize / 2.0);\n\n    // \u5c06\u8f93\u5165\u989c\u8272\u76f4\u63a5\u4f20\u7ed9\u300c\u5149\u6805\u5316\u5668\u300d\n    out.color = vertices[vertexID].color;\n\n    return out;\n}\n\nfragment float4 fragmentShader(RasterizerData in [[stage_in]]) {\n    // \u8fd4\u56de\u63d2\u503c\u989c\u8272\n    return in.color;\n}\n')),(0,r.kt)("h3",{id:"aaplviewswift"},"AAPLView.swift"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},'import MetalKit\nimport SwiftUI\n\n// \u5305\u88c5 MTKView \u4ee5\u4fbf\u5728 SwiftUI \u4e2d\u4f7f\u7528\nstruct AAPLView: UIViewRepresentable {\n    typealias UIViewType = MTKView\n\n    func makeUIView(context: Context) -> MTKView {\n        let uiView = MTKView()\n        uiView.device = MTLCreateSystemDefaultDevice()\n        uiView.delegate = context.coordinator\n        return uiView\n    }\n\n    func updateUIView(_ uiView: MTKView, context: Context) {\n        // none\n    }\n}\n\nextension AAPLView {\n    // \u6267\u884c\u7ed8\u5236\u7684\u534f\u8c03\u5668\n    class Coordinator: NSObject, MTKViewDelegate {\n\n        // \u4ece .metal \u7740\u8272\u5668\u6587\u4ef6\u4e2d\u7684\u9876\u70b9\u548c\u7247\u6bb5\u7740\u8272\u5668\u751f\u6210\u7684\u6e32\u67d3\u7ba1\u7ebf\n        private var pipelineState: MTLRenderPipelineState?\n\n        // \u7528\u4e8e\u4f20\u9012\u547d\u4ee4\u7ed9\u8bbe\u5907\u7684\u547d\u4ee4\u961f\u5217\n        private var commandQueue: MTLCommandQueue?\n\n        // \u5f53\u524d\u89c6\u56fe\u5927\u5c0f\uff0c\u7528\u4f5c\u9876\u70b9\u7740\u8272\u5668\u7684\u8f93\u5165\n        private var viewportSize = vector_uint2(x: 0, y: 0)\n\n        // \u9876\u70b9\u6570\u636e\uff0c\u989c\u8272\u6570\u636e\n        private let triangleVertices: [AAPLVertex] = [\n            AAPLVertex(position: vector_float2(250, -250),\n                       color: vector_float4(1, 0, 0, 1)),\n            AAPLVertex(position: vector_float2(-250, -250),\n                       color: vector_float4(0, 1, 0, 1)),\n            AAPLVertex(position: vector_float2(0, 250),\n                       color: vector_float4(0, 0, 1, 1)),\n        ]\n\n        private func makePipelineState(device: MTLDevice?, format: MTLPixelFormat) {\n            guard pipelineState == nil else {\n                // pipelineState is already maked\n                return\n            }\n            guard let device else {\n                print("Device is not set to MTKView.")\n                return\n            }\n            // \u5728\u9879\u76ee\u4e2d\u52a0\u8f7d\u6240\u6709\u5177\u6709 .metal \u6587\u4ef6\u6269\u5c55\u540d\u7684\u7740\u8272\u5668\u6587\u4ef6\n            guard let defaultLibrary = device.makeDefaultLibrary() else {\n                print("Failed to make default library.")\n                return\n            }\n            guard let vertexFunction = defaultLibrary.makeFunction(name: "vertexShader") else {\n                print("Failed to make vertex function.")\n                return\n            }\n            guard let fragmentFunction = defaultLibrary.makeFunction(name: "fragmentShader") else {\n                print("Failed to make fragment function.")\n                return\n            }\n\n            // \u914d\u7f6e\u7528\u4e8e\u521b\u5efa\u7ba1\u9053\u72b6\u6001\u7684\u7ba1\u9053\u63cf\u8ff0\u5668\n            let pipelineDescriptor = MTLRenderPipelineDescriptor()\n            pipelineDescriptor.label = "Simple Pipeline"\n            pipelineDescriptor.vertexFunction = vertexFunction\n            pipelineDescriptor.fragmentFunction = fragmentFunction\n            pipelineDescriptor.colorAttachments[0].pixelFormat = format\n            do {\n                // \u5982\u679c\u7ba1\u9053\u63cf\u8ff0\u5668\u8bbe\u7f6e\u4e0d\u6b63\u786e\uff0c\u5219\u7ba1\u9053\u72b6\u6001\u521b\u5efa\u53ef\u80fd\u5931\u8d25\n                // \u5982\u679c\u542f\u7528\u4e86 Metal API \u9a8c\u8bc1\uff0c\u5219\u53ef\u4ee5\u67e5\u627e\u6709\u5173\u51fa\u9519\u539f\u56e0\u7684\u8be6\u7ec6\u4fe1\u606f\n                // \uff08\u5728 Xcode \u8fd0\u884c\u8c03\u8bd5\u7f16\u8bd1\u65f6\uff0c\u9ed8\u8ba4\u542f\u7528 Metal API \u9a8c\u8bc1\uff09\n                pipelineState = try device.makeRenderPipelineState(descriptor: pipelineDescriptor)\n            } catch {\n                print("Failed to make pipelineState.")\n            }\n        }\n\n        private func makeCommandQueue(device: MTLDevice?) {\n            guard commandQueue == nil else {\n                return\n            }\n            // \u521b\u5efa\u547d\u4ee4\u961f\u5217\n            commandQueue = device?.makeCommandQueue()\n        }\n\n        /// Called whenever the drawableSize of the view will change\n        func mtkView(_ view: MTKView, drawableSizeWillChange size: CGSize) {\n            print("mtkView", size.width, size.height)\n            viewportSize.x = uint(size.width)\n            viewportSize.y = uint(size.height)\n        }\n\n        /// Called on the delegate when it is asked to render into the view\n        func draw(in view: MTKView) {\n            // \u53ef\u901a\u8fc7\u4e0b\u9762\u7684\u4ee3\u7801\u8bbe\u7f6e\u89c6\u56fe\u80cc\u666f\u8272\n            // view.clearColor = MTLClearColor(red: 0, green: 1.0, blue: 0, alpha: 1.0)\n\n            // \u786e\u4fdd\u7ba1\u9053\u72b6\u6001\u548c\u547d\u4ee4\u961f\u5217\u5df2\u521b\u5efa\n            makePipelineState(device: view.device, format: view.colorPixelFormat)\n            makeCommandQueue(device: view.device)\n            guard let pipelineState, let commandQueue else {\n                return\n            }\n\n            // \u4e3a\u5f53\u524d drawable \u7684\u6bcf\u4e2a\u6e32\u67d3\u8fc7\u7a0b\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u547d\u4ee4\u7f13\u51b2\u533a\n            guard let commandBuffer = commandQueue.makeCommandBuffer() else {\n                return\n            }\n            commandBuffer.label = "MyCommandBuffer"\n\n            // \u83b7\u53d6\u4ece\u89c6\u56fe\u7684 drawable \u7eb9\u7406\u751f\u6210\u7684 renderPassDescriptor\n            // \u4ee5\u901a\u8fc7\u8be5 descriptor \u521b\u5efa\u6e32\u67d3\u547d\u4ee4\u7f16\u7801\u5668\n            guard let renderPassDescriptor = view.currentRenderPassDescriptor else {\n                return\n            }\n            guard let renderEncoder = commandBuffer.makeRenderCommandEncoder(descriptor: renderPassDescriptor) else {\n                return\n            }\n            renderEncoder.label = "MyRenderEncoder"\n\n            // \u8bbe\u7f6e\u8981\u7ed8\u5236\u7684 drawable \u533a\u57df\n            renderEncoder.setViewport(MTLViewport(originX: 0.0,\n                                                  originY: 0.0,\n                                                  width: Double(viewportSize.x),\n                                                  height: Double(viewportSize.y),\n                                                  znear: 0.0,\n                                                  zfar: 1.0))\n\n            renderEncoder.setRenderPipelineState(pipelineState)\n\n            // \u4f20\u9012\u53c2\u6570\u6570\u636e\n            renderEncoder.setVertexBytes(triangleVertices,\n                                         length: triangleVertices.count * MemoryLayout<AAPLVertex>.stride,\n                                         index: Int(AAPLVertexInputIndexVertices.rawValue))\n            renderEncoder.setVertexBytes(&viewportSize,\n                                         length: triangleVertices.count * MemoryLayout<AAPLVertex>.stride,\n                                         index: Int(AAPLVertexInputIndexViewportSize.rawValue))\n\n            // \u7ed8\u5236\u4e09\u89d2\u5f62\n            renderEncoder.drawPrimitives(type: .triangle, vertexStart: 0, vertexCount: 3)\n\n            renderEncoder.endEncoding()\n\n            // \u5728\u5e27\u7f13\u51b2\u533a\uff08framebuffer\uff09\u5b8c\u6210\u65f6\uff0c\u4f7f\u7528\u5f53\u524d drawable \u8fdb\u884c\u4e00\u6b21\u5448\u73b0\uff08present\uff09\n            commandBuffer.present(view.currentDrawable!)\n            // \u5728\u6b64\u5904\u5b8c\u6210\u6e32\u67d3\u5e76\u5c06\u547d\u4ee4\u7f13\u51b2\u533a\u63a8\u9001\u5230 GPU\n            commandBuffer.commit()\n        }\n    }\n\n    func makeCoordinator() -> Coordinator {\n        Coordinator()\n    }\n}\n')),(0,r.kt)("h3",{id:"contentviewswift"},"ContentView.swift"),(0,r.kt)(u,{src:n(52611),mdxType:"ScreenshotBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-swift"},"import SwiftUI\n\nstruct ContentView: View {\n    var body: some View {\n        // highlight-start\n        AAPLView()\n            .frame(width: 300, height: 300)\n        // highlight-end\n    }\n}\n\n#Preview {\n    ContentView()\n}\n"))))}k.isMDXComponent=!0}}]);