"use strict";(self.webpackChunkswift_tutorials_cn=self.webpackChunkswift_tutorials_cn||[]).push([[8898],{48920:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var i=r(85893),t=r(11151);const a={},s="\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u64ad\u653e\u8fdb\u5ea6",o={id:"av-foundation/esseentials/monitoring-playback-progress-in-your-app/index",title:"\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u64ad\u653e\u8fdb\u5ea6",description:"<OriginalSource",source:"@site/docs/av-foundation/esseentials/monitoring-playback-progress-in-your-app/index.mdx",sourceDirName:"av-foundation/esseentials/monitoring-playback-progress-in-your-app",slug:"/av-foundation/esseentials/monitoring-playback-progress-in-your-app/",permalink:"/swift-tutorials-cn/docs/av-foundation/esseentials/monitoring-playback-progress-in-your-app/",draft:!1,unlisted:!1,editUrl:"https://github.com/zhuanghongji/swift-tutorials-cn/docs/av-foundation/esseentials/monitoring-playback-progress-in-your-app/index.mdx",tags:[],version:"current",lastUpdatedAt:1698830538,formattedLastUpdatedAt:"2023\u5e7411\u67081\u65e5",frontMatter:{},sidebar:"avfoundationSidebar",previous:{title:"\u652f\u6301\u534f\u8c03\u5a92\u4f53\u64ad\u653e",permalink:"/swift-tutorials-cn/docs/av-foundation/esseentials/supporting-coordinated-media-playback/"},next:{title:"\u5c06 HEVC \u89c6\u9891\u4e0e Alpha \u7ed3\u5408\u4f7f\u7528",permalink:"/swift-tutorials-cn/docs/av-foundation/esseentials/using-hevc-video-with-alpha/"}},l={},d=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u5b9a\u671f\u89c2\u5bdf\u5f53\u524d\u64ad\u653e\u65f6\u95f4",id:"\u5b9a\u671f\u89c2\u5bdf\u5f53\u524d\u64ad\u653e\u65f6\u95f4",level:2},{value:"\u89c2\u5bdf\u5a92\u4f53\u6f14\u793a\u4e2d\u7279\u5b9a\u65f6\u95f4\u7684\u64ad\u653e",id:"\u89c2\u5bdf\u5a92\u4f53\u6f14\u793a\u4e2d\u7279\u5b9a\u65f6\u95f4\u7684\u64ad\u653e",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,t.a)(),...e.components},{OriginalSource:r,ToBePolishedAfterTranslation:a}=n;return r||p("OriginalSource",!0),a||p("ToBePolishedAfterTranslation",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u64ad\u653e\u8fdb\u5ea6",children:"\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u64ad\u653e\u8fdb\u5ea6"}),"\n",(0,i.jsx)(a,{}),"\n",(0,i.jsx)(r,{title:"Monitoring playback progress in your app",url:"https://developer.apple.com/documentation/avfoundation/media_playback/monitoring_playback_progress_in_your_app",summary:"\u89c2\u5bdf\u5a92\u4f53\u8d44\u4ea7\u7684\u64ad\u653e\u4ee5\u66f4\u65b0\u5e94\u7528\u7a0b\u5e8f\u7684\u7528\u6237\u754c\u9762\u72b6\u6001"}),"\n",(0,i.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,i.jsx)(n.p,{children:"\u5a92\u4f53\u64ad\u653e\u5e94\u7528\u7a0b\u5e8f\u901a\u5e38\u9700\u8981\u76d1\u89c6\u64ad\u653e\u8fdb\u5ea6\u4ee5\u9a71\u52a8\u64ad\u653e\u5668 UI \u7684\u72b6\u6001\u6216\u6267\u884c\u5176\u5b83\u64cd\u4f5c\u3002\u76d1\u89c6\u6b64\u72b6\u6001\u9700\u8981\u6bd4\u952e\u503c\u89c2\u5bdf\u6240\u80fd\u63d0\u4f9b\u7684\u66f4\u9ad8\u7ea7\u522b\u7684\u65f6\u95f4\u7cbe\u5ea6\uff0c\u56e0\u6b64 AVPlayer \u63d0\u4f9b\u4e86\u7279\u5b9a\u7684 API \u6765\u89c2\u5bdf\u64ad\u653e\u65f6\u95f4\u3002\u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u5b9a\u671f\u89c2\u5bdf\u6b64\u72b6\u6001\u6216\u5728\u64ad\u653e\u8de8\u8d8a\u7279\u5b9a\u65f6\u95f4\u8fb9\u754c\u65f6\u89c2\u5bdf\u6b64\u72b6\u6001\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5b9a\u671f\u89c2\u5bdf\u5f53\u524d\u64ad\u653e\u65f6\u95f4",children:"\u5b9a\u671f\u89c2\u5bdf\u5f53\u524d\u64ad\u653e\u65f6\u95f4"}),"\n",(0,i.jsx)(n.p,{children:"\u89c2\u5bdf\u73a9\u5bb6\u5f53\u524d\u65f6\u95f4\u7684\u6700\u5e38\u89c1\u65b9\u6cd5\u662f\u5b9a\u671f\u89c2\u5bdf\u3002\u5f53\u9a71\u52a8\u73a9\u5bb6\u7528\u6237\u754c\u9762\u4e2d\u7684\u65f6\u95f4\u663e\u793a\u72b6\u6001\u65f6\uff0c\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u89c2\u5bdf\u5b83\u975e\u5e38\u6709\u7528\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8981\u5b9a\u671f\u89c2\u5bdf\u73a9\u5bb6\u7684\u5f53\u524d\u65f6\u95f4\uff0c\u8bf7\u8c03\u7528\u5176 addPeriodicTimeObserver(forInterval:queue:using:) \u65b9\u6cd5\u3002\u8be5\u65b9\u6cd5\u91c7\u7528\u4e00\u4e2a CMTime \u503c\uff08\u8868\u793a\u89c2\u5bdf\u65f6\u95f4\u7684\u95f4\u9694\uff09\u3001\u4e32\u884c\u8c03\u5ea6\u961f\u5217\u4ee5\u53ca\u73a9\u5bb6\u5728\u6307\u5b9a\u65f6\u95f4\u95f4\u9694\u8c03\u7528\u7684\u56de\u8c03\u3002\u4ee5\u4e0b\u793a\u4f8b\u6dfb\u52a0\u4e86\u4e00\u4e2a\u89c2\u5bdf\u8005\uff0c\u64ad\u653e\u5668\u5728\u6b63\u5e38\u64ad\u653e\u671f\u95f4\u6bcf\u534a\u79d2\u8c03\u7528\u4e00\u6b21\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"@Published private(set) var duration: TimeInterval = 0.0\n@Published private(set) var currentTime: TimeInterval = 0.0\n\nprivate let player = AVPlayer()\nprivate var timeObserver: Any?\n\n/// Adds an observer of the player timing.\nprivate func addPeriodicTimeObserver() {\n    // Create a 0.5 second interval time.\n    let interval = CMTime(value: 1, timescale: 2)\n    timeObserver = player.addPeriodicTimeObserver(forInterval: interval,\n                                                  queue: .main) { [weak self] time in\n        guard let self else { return }\n        // Update the published currentTime and duration values.\n        currentTime = time.seconds\n        duration = player.currentItem?.duration.seconds ?? 0.0\n    }\n}\n\n/// Removes the time observer from the player.\nprivate func removePeriodicTimeObserver() {\n    guard let timeObserver else { return }\n    player.removeTimeObserver(timeObserver)\n    self.timeObserver = nil\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u4f60\u5b8c\u6210\u72b6\u6001\u76d1\u63a7\u65f6\uff0c\u59cb\u7ec8\u5c06\u5bf9\u64ad\u653e\u5668\u7684 addPeriodicTimeObserver(forInterval:queue:using:) \u65b9\u6cd5\u7684\u8c03\u7528\u4e0e\u5bf9 removeTimeObserver(_:) \u7684\u8c03\u7528\u914d\u5bf9\u3002\u4e0d\u9075\u5b88\u6b64\u89c4\u5219\u4f1a\u5bfc\u81f4\u672a\u5b9a\u4e49\u7684\u884c\u4e3a\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u89c2\u5bdf\u5a92\u4f53\u6f14\u793a\u4e2d\u7279\u5b9a\u65f6\u95f4\u7684\u64ad\u653e",children:"\u89c2\u5bdf\u5a92\u4f53\u6f14\u793a\u4e2d\u7279\u5b9a\u65f6\u95f4\u7684\u64ad\u653e"}),"\n",(0,i.jsx)(n.p,{children:"\u89c2\u5bdf\u64ad\u653e\u5668\u7684\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u64ad\u653e\u5668\u5728\u64ad\u653e\u8fc7\u7a0b\u4e2d\u4f55\u65f6\u8de8\u8d8a\u7279\u5b9a\u65f6\u95f4\u8fb9\u754c\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u66f4\u65b0\u64ad\u653e\u5668 UI \u6216\u6267\u884c\u5176\u5b83\u64cd\u4f5c\u6765\u5e94\u5bf9\u8fd9\u4e9b\u65f6\u95f4\u7684\u6d41\u901d\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8981\u8ba9\u64ad\u653e\u5668\u5728\u7a7f\u8fc7\u5a92\u4f53\u65f6\u95f4\u8f74\u4e2d\u7684\u7279\u5b9a\u70b9\u65f6\u901a\u77e5\u4f60\u7684\u5e94\u7528\uff0c\u8bf7\u8c03\u7528\u64ad\u653e\u5668\u7684 addBoundaryTimeObserver(forTimes:queue:using:) \u65b9\u6cd5\u3002\u8be5\u65b9\u6cd5\u91c7\u7528\u4e00\u4e2a NSValue \u5bf9\u8c61\u6570\u7ec4\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u5305\u88c5\u4e86\u5b9a\u4e49\u8fb9\u754c\u65f6\u95f4\u7684 CMTime \u503c\u3001\u4e32\u884c\u8c03\u5ea6\u961f\u5217\u548c\u56de\u8c03\u95ed\u5305\u3002\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\u5982\u4f55\u5b9a\u4e49\u6bcf\u4e2a\u5b63\u5ea6\u64ad\u653e\u7684\u8fb9\u754c\u65f6\u95f4\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-swift",children:"/// Adds an observer of the player traversing specific times during standard playback.\nprivate func addBoundaryTimeObserver() async throws {\n\n    // Asynchronously load the duration of the asset.\n    let duration = try await asset.load(.duration)\n\n    // Divide the asset's duration into quarters.\n    let quarterDuration = CMTimeMultiplyByRatio(duration,\n                                                multiplier: 1,\n                                                divisor: 4)\n\n    var currentTime = CMTime.zero\n    var times = [NSValue]()\n\n    // Calculate boundary times.\n    while currentTime < duration {\n        currentTime = currentTime + quarterDuration\n        times.append(NSValue(time:currentTime))\n    }\n\n    timeObserver = player.addBoundaryTimeObserver(forTimes: times,\n                                                  queue: .main) { [weak self] in\n        // Update the percentage complete in the user interface.\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u6dfb\u52a0\u5468\u671f\u6216\u8fb9\u754c\u65f6\u95f4\u89c2\u5bdf\u5668\uff0c\u5219\u9700\u8981\u5728\u5b8c\u6210\u65f6\u901a\u8fc7\u8c03\u7528 removeTimeObserver(_:) \u6765\u5220\u9664\u89c2\u5bdf\u3002"})]})}function c(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}function p(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},11151:(e,n,r)=>{r.d(n,{Z:()=>o,a:()=>s});var i=r(67294);const t={},a=i.createContext(t);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);