"use strict";(self.webpackChunkswift_tutorials_cn=self.webpackChunkswift_tutorials_cn||[]).push([[4386],{30415:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>c});var r=i(85893),t=i(11151);const d={},o="\u51fd\u6570\u53c2\u6570\u548c\u53d8\u91cf",s={id:"metal-shading-language-specification/function-arguments-and-variables/index",title:"\u51fd\u6570\u53c2\u6570\u548c\u53d8\u91cf",description:"\u56fe\u5f62\uff08\u9876\u70b9\u6216\u7247\u6bb5\uff09\u548c\u5185\u6838\u51fd\u6570\u7684\u5927\u591a\u6570\u8f93\u5165\u548c\u8f93\u51fa\u90fd\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\uff08\u5e38\u91cf\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u521d\u59cb\u5316\u53d8\u91cf\u548c\u7a0b\u5e8f\u8303\u56f4\u4e2d\u58f0\u660e\u7684\u91c7\u6837\u5668\u662f\u8f93\u5165\u548c\u8f93\u51fa\uff0c\u4e0d\u5fc5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\uff09\u4ece Metal 3.1 \u5f00\u59cb\uff0c\u5185\u6838\u3001\u7f51\u683c\u548c\u5bf9\u8c61\u7740\u8272\u5668\u7684\u5185\u7f6e\u8f93\u5165\u53d8\u91cf\u73b0\u5728\u53ef\u4ee5\u5728\u7a0b\u5e8f\u8303\u56f4\u5185\u58f0\u660e\uff0c\u907f\u514d\u5c06\u5b83\u4eec\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\u5982\u679c\u5b83\u4eec\u672a\u5728\u52a8\u6001\u5e93\u6216\u5355\u72ec\u7f16\u8bd1\u7684\u4e8c\u8fdb\u5236\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u5219\u8fd9\u9002\u7528\u3002",source:"@site/docs/metal-shading-language-specification/function-arguments-and-variables/index.mdx",sourceDirName:"metal-shading-language-specification/function-arguments-and-variables",slug:"/metal-shading-language-specification/function-arguments-and-variables/",permalink:"/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables/",draft:!1,unlisted:!1,editUrl:"https://github.com/zhuanghongji/swift-tutorials-cn/docs/metal-shading-language-specification/function-arguments-and-variables/index.mdx",tags:[],version:"current",lastUpdatedAt:1698830538,formattedLastUpdatedAt:"2023\u5e7411\u67081\u65e5",frontMatter:{},sidebar:"metalshadinglanguagespecificationSidebar",previous:{title:"\u51fd\u6570",permalink:"/swift-tutorials-cn/docs/metal-shading-language-specification/functions/"},next:{title:"\u5b58\u50a8\u7c7b\u8bf4\u660e\u7b26",permalink:"/swift-tutorials-cn/docs/metal-shading-language-specification/storage-class-specifiers/"}},a={},c=[{value:"\u5b9a\u4f4d\u7f13\u51b2\u533a\u3001\u7eb9\u7406\u548c\u91c7\u6837\u5668\u53c2\u6570",id:"\u5b9a\u4f4d\u7f13\u51b2\u533a\u7eb9\u7406\u548c\u91c7\u6837\u5668\u53c2\u6570",level:2},{value:"\u5177\u6709\u8d44\u6e90\u548c\u8f93\u51fa\u5230\u8bbe\u5907\u5185\u5b58\u7684\u9876\u70b9\u51fd\u6570\u793a\u4f8b",id:"\u5177\u6709\u8d44\u6e90\u548c\u8f93\u51fa\u5230\u8bbe\u5907\u5185\u5b58\u7684\u9876\u70b9\u51fd\u6570\u793a\u4f8b",level:3},{value:"\u5149\u6805\u987a\u5e8f\u7ec4",id:"\u5149\u6805\u987a\u5e8f\u7ec4",level:3},{value:"\u5b9a\u4f4d\u6bcf\u4e2a\u9876\u70b9\u8f93\u5165\u7684\u5c5e\u6027",id:"\u5b9a\u4f4d\u6bcf\u4e2a\u9876\u70b9\u8f93\u5165\u7684\u5c5e\u6027",level:2},{value:"\u5185\u7f6e\u53d8\u91cf\u7684\u5c5e\u6027",id:"\u5185\u7f6e\u53d8\u91cf\u7684\u5c5e\u6027",level:2},{value:"\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027",id:"\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027",level:3},{value:"\u66f2\u9762\u7ec6\u5206\u540e\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027",id:"\u66f2\u9762\u7ec6\u5206\u540e\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027",level:3},{value:"\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u5c5e\u6027",id:"\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u5c5e\u6027",level:3},{value:"\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u5c5e\u6027",id:"\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u5c5e\u6027",level:3},{value:"\u7247\u6bb5\u51fd\u6570\u8f93\u51fa\u5c5e\u6027",id:"\u7247\u6bb5\u51fd\u6570\u8f93\u51fa\u5c5e\u6027",level:3},{value:"\u5185\u6838\u51fd\u6570\u8f93\u5165\u5c5e\u6027",id:"\u5185\u6838\u51fd\u6570\u8f93\u5165\u5c5e\u6027",level:3},{value:"\u4ea4\u96c6\u51fd\u6570\u8f93\u5165\u5c5e\u6027",id:"\u4ea4\u96c6\u51fd\u6570\u8f93\u5165\u5c5e\u6027",level:3},{value:"\u4ea4\u96c6\u51fd\u6570\u8f93\u51fa\u5c5e\u6027",id:"\u4ea4\u96c6\u51fd\u6570\u8f93\u51fa\u5c5e\u6027",level:3},{value:"\u5bf9\u8c61\u51fd\u6570\u8f93\u5165\u5c5e\u6027",id:"\u5bf9\u8c61\u51fd\u6570\u8f93\u5165\u5c5e\u6027",level:3},{value:"\u7f51\u683c\u51fd\u6570\u8f93\u5165\u5c5e\u6027",id:"\u7f51\u683c\u51fd\u6570\u8f93\u5165\u5c5e\u6027",level:3},{value:"\u8f93\u5165\u7ec4\u4ef6\u5c5e\u6027",id:"\u8f93\u5165\u7ec4\u4ef6\u5c5e\u6027",level:2},{value:"\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u793a\u4f8b",id:"\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u793a\u4f8b",level:3},{value:"\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u793a\u4f8b",id:"\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u793a\u4f8b",level:3},{value:"\u5185\u6838\u51fd\u6570\u6bcf\u7ebf\u7a0b\u8f93\u5165\u793a\u4f8b",id:"\u5185\u6838\u51fd\u6570\u6bcf\u7ebf\u7a0b\u8f93\u5165\u793a\u4f8b",level:3}];function l(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components},{OriginalPDF:i,TableView:d,ToBePolishedAfterTranslation:o}=n;return i||u("OriginalPDF",!0),d||u("TableView",!0),o||u("ToBePolishedAfterTranslation",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"\u51fd\u6570\u53c2\u6570\u548c\u53d8\u91cf",children:"\u51fd\u6570\u53c2\u6570\u548c\u53d8\u91cf"}),"\n",(0,r.jsx)(o,{}),"\n",(0,r.jsx)(i,{title:"5.2 Function Arguments and Variables"}),"\n",(0,r.jsx)(n.p,{children:"\u56fe\u5f62\uff08\u9876\u70b9\u6216\u7247\u6bb5\uff09\u548c\u5185\u6838\u51fd\u6570\u7684\u5927\u591a\u6570\u8f93\u5165\u548c\u8f93\u51fa\u90fd\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\uff08\u5e38\u91cf\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u521d\u59cb\u5316\u53d8\u91cf\u548c\u7a0b\u5e8f\u8303\u56f4\u4e2d\u58f0\u660e\u7684\u91c7\u6837\u5668\u662f\u8f93\u5165\u548c\u8f93\u51fa\uff0c\u4e0d\u5fc5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\uff09\u4ece Metal 3.1 \u5f00\u59cb\uff0c\u5185\u6838\u3001\u7f51\u683c\u548c\u5bf9\u8c61\u7740\u8272\u5668\u7684\u5185\u7f6e\u8f93\u5165\u53d8\u91cf\u73b0\u5728\u53ef\u4ee5\u5728\u7a0b\u5e8f\u8303\u56f4\u5185\u58f0\u660e\uff0c\u907f\u514d\u5c06\u5b83\u4eec\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\u5982\u679c\u5b83\u4eec\u672a\u5728\u52a8\u6001\u5e93\u6216\u5355\u72ec\u7f16\u8bd1\u7684\u4e8c\u8fdb\u5236\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u5219\u8fd9\u9002\u7528\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u56fe\u5f62\u548c\u5185\u6838\u51fd\u6570\u7684\u53c2\u6570\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4efb\u4f55\u4e00\u4e2a\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u8bbe\u5907\u7f13\u51b2\u533a \u2014\u2014 \u6307\u5411 ",(0,r.jsx)(n.code,{children:"device"})," \u5730\u5740\u7a7a\u95f4\u4e2d\u4efb\u4f55\u6570\u636e\u7c7b\u578b\u7684\u6307\u9488\u6216\u5f15\u7528\uff08\u53c2\u89c1\u7b2c 2.8 \u8282\uff09\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5e38\u91cf\u7f13\u51b2\u533a \u2014\u2014 \u6307\u5411 ",(0,r.jsx)(n.code,{children:"constant"})," \u5730\u5740\u7a7a\u95f4\u4e2d\u4efb\u4f55\u6570\u636e\u7c7b\u578b\u7684\u6307\u9488\u6216\u5f15\u7528\uff08\u53c2\u89c1\u7b2c 2.8 \u8282\uff09\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"texture"})," \u5bf9\u8c61\uff08\u53c2\u89c1\u7b2c 2.9 \u8282\uff09\u6216\u7eb9\u7406\u6570\u7ec4\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"texture_buffer"})," \u5bf9\u8c61\uff08\u53c2\u89c1\u7b2c 2.9.1 \u8282\uff09\u6216\u7eb9\u7406\u7f13\u51b2\u533a\u6570\u7ec4\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sampler"})," \u5bf9\u8c61\uff08\u53c2\u89c1\u7b2c 2.10 \u8282\uff09\u6216\u91c7\u6837\u5668\u6570\u7ec4\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u7ebf\u7a0b\u7ec4\u4e2d\u7684\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u7684\u7f13\u51b2\u533a\u2014\u2014 \u6307\u5411 ",(0,r.jsx)(n.code,{children:"threadgroup"})," \u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u7c7b\u578b\u7684\u6307\u9488\uff0c\u53ea\u80fd\u7528\u4f5c\u5185\u6838\u51fd\u6570\u7684\u53c2\u6570\u3002"]}),"\n",(0,r.jsx)(n.li,{children:"\u56fe\u50cf\u5757\uff08\u53c2\u89c1\u7b2c 2.11 \u8282\uff09\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u53c2\u6570\u7f13\u51b2\u533a\uff08\u53c2\u89c1\u7b2c 2.13 \u8282\uff09\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u5185\u6838\u51fd\u6570\u7684\u53ef\u89c1\u51fd\u6570\u8868\uff08\u53c2\u89c1\u7b2c 2.15 \u8282\uff09\u3002\u4ece Metal 2.4 \u5f00\u59cb\uff0c\u53ef\u89c1\u51fd\u6570\u8868\u4e5f\u53ef\u4ee5\u7528\u4e8e\u56fe\u5f62\u51fd\u6570\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u6838\u51fd\u6570\u7684\u4ea4\u96c6\u51fd\u6570\u8868\uff08\u53c2\u89c1\u7b2c 2.17.3 \u8282\uff09\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u7528\u4e8e\u4ea4\u96c6\u51fd\u6570\u7684\u52a0\u901f\u7ed3\u6784\uff08\u53c2\u89c1\u7b2c 6.18.1 \u8282\uff09\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u5305\u542b\u7f13\u51b2\u533a\u3001\u7eb9\u7406\u6216\u7eb9\u7406\u7f13\u51b2\u533a\u5143\u7d20\u7684\u7ed3\u6784\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6307\u5b9a\u4e3a\u56fe\u5f62\u6216\u5185\u6838\u51fd\u6570\u7684\u53c2\u6570\u503c\u7684\u7f13\u51b2\u533a\uff08\u8bbe\u5907\uff09\u4e0d\u80fd\u4f7f\u7528\u522b\u540d\uff1b\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f5c\u4e3a\u53c2\u6570\u503c\u4f20\u9012\u7684\u7f13\u51b2\u533a\u4e0d\u80fd\u4e0e\u4f20\u9012\u7ed9\u540c\u4e00\u56fe\u5f62\u6216\u5185\u6838\u51fd\u6570\u7684\u5355\u72ec\u53c2\u6570\u7684\u53e6\u4e00\u4e2a\u7f13\u51b2\u533a\u91cd\u53e0\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u4e0d\u80fd\u5c06\u56fe\u5f62\u548c\u5185\u6838\u51fd\u6570\u7684\u53c2\u6570\u58f0\u660e\u4e3a ",(0,r.jsx)(n.code,{children:"size_t"}),"\u3001",(0,r.jsx)(n.code,{children:"ptrdiff_t"})," \u7c7b\u578b\uff0c\u6216\u8005\u5305\u542b\u58f0\u660e\u4e3a\u8fd9\u4e9b\u5185\u7f6e\u6807\u91cf\u7c7b\u578b\u4e4b\u4e00\u7684\u6210\u5458\u7684\u7ed3\u6784\u548c/\u6216\u8054\u5408\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u4e9b\u51fd\u6570\u7684\u53c2\u6570\u901a\u5e38\u7528\u5c5e\u6027\u6765\u6307\u5b9a\uff0c\u4ee5\u63d0\u4f9b\u5bf9\u5176\u4f7f\u7528\u7684\u8fdb\u4e00\u6b65\u6307\u5bfc\u3002\u5c5e\u6027\u7528\u4e8e\u6307\u5b9a\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u53c2\u6570\u7684\u8d44\u6e90\u4f4d\u7f6e\uff08\u53c2\u89c1\u7b2c 5.2.1 \u8282\uff09\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301\u56fa\u5b9a\u529f\u80fd\u548c\u53ef\u7f16\u7a0b\u6d41\u6c34\u7ebf\u7ea7\u4e4b\u95f4\u6570\u636e\u901a\u4fe1\u7684\u5185\u7f6e\u53d8\u91cf\uff08\u53c2\u89c1\u7b2c 5.2.3 \u8282\uff09\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u54ea\u4e9b\u6570\u636e\u6cbf\u7740\u7ba1\u9053\u4ece\u9876\u70b9\u51fd\u6570\u53d1\u9001\u5230\u7247\u6bb5\u51fd\u6570\uff08\u53c2\u89c1\u7b2c 5.2.4 \u8282\uff09\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5b9a\u4f4d\u7f13\u51b2\u533a\u7eb9\u7406\u548c\u91c7\u6837\u5668\u53c2\u6570",children:"\u5b9a\u4f4d\u7f13\u51b2\u533a\u3001\u7eb9\u7406\u548c\u91c7\u6837\u5668\u53c2\u6570"}),"\n",(0,r.jsx)(n.p,{children:"\u5bf9\u4e8e\u6bcf\u4e2a\u53c2\u6570\uff0c\u53ef\u4ee5\u9009\u62e9\u6307\u5b9a\u4e00\u4e2a\u5c5e\u6027\u6765\u6807\u8bc6\u7528\u4e8e\u8be5\u53c2\u6570\u7c7b\u578b\u7684\u7f13\u51b2\u533a\u3001\u7eb9\u7406\u6216\u91c7\u6837\u5668\u7684\u4f4d\u7f6e\u3002Metal \u6846\u67b6 API \u4f7f\u7528\u6b64\u5c5e\u6027\u6765\u6807\u8bc6\u8fd9\u4e9b\u53c2\u6570\u7c7b\u578b\u7684\u4f4d\u7f6e\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u8bbe\u5907\u548c\u5e38\u91cf\u7f13\u51b2\u533a\uff1a",(0,r.jsx)(n.code,{children:"[[buffer(index)]]"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u7eb9\u7406\uff08\u5305\u62ec\u7eb9\u7406\u7f13\u51b2\u533a\uff09\uff1a",(0,r.jsx)(n.code,{children:"[[texture(index)]]"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u91c7\u6837\u5668\uff1a",(0,r.jsx)(n.code,{children:"[[sampler(index)]]"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u7ebf\u7a0b\u7ec4\u7f13\u51b2\u533a\uff1a",(0,r.jsx)(n.code,{children:"[[threadgroup(index) )]]"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7d22\u5f15\u503c\u662f\u4e00\u4e2a\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u7528\u4e8e\u6807\u8bc6\u5206\u914d\u7684\u7f13\u51b2\u533a\u3001\u7eb9\u7406\u6216\u91c7\u6837\u5668\u53c2\u6570\u7684\u4f4d\u7f6e\u3002\uff08\u7eb9\u7406\u7f13\u51b2\u533a\u662f\u4e00\u79cd\u7279\u5b9a\u7c7b\u578b\u7684\u7eb9\u7406\u3002\uff09\u6b63\u786e\u7684\u8bed\u6cd5\u662f\u5c5e\u6027\u9075\u5faa\u53c2\u6570\u6216\u53d8\u91cf\u540d\u79f0\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0b\u9762\u7684\u793a\u4f8b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u5185\u6838\u51fd\u6570 add_vectors\uff0c\u5b83\u5c06\u8bbe\u5907\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u4e24\u4e2a\u7f13\u51b2\u533a inA \u548c inB \u7684\u6570\u7ec4\u76f8\u52a0\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u5230\u7f13\u51b2\u533a out \u4e2d\u3002\u5c5e\u6027 (",(0,r.jsx)(n.code,{children:"buffer(index)"}),") \u6307\u5b9a\u51fd\u6570\u53c2\u6570\u7684\u7f13\u51b2\u533a\u4f4d\u7f6e\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"[[kernel]] void add_vectors(const device float4 *inA [[buffer(0)]],\n                            const device float4 *inB [[buffer(1)]],\n                            device float4 *out [[buffer(2)]],\n                            uint id [[thread_position_in_grid]]\n) {\n    out[id] = inA[id] + inB[id];\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u9762\u7684\u793a\u4f8b\u663e\u793a\u4e86\u7528\u4e8e\u51e0\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u51fd\u6570\u53c2\u6570\uff08\u7f13\u51b2\u533a\u3001\u7eb9\u7406\u548c\u91c7\u6837\u5668\uff09\u7684\u5c5e\u6027\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"[[kernel]] void my_kernel(device float4 *p [[buffer(0)]],\n                          texture2d<float> img [[texture(0)]],\n                          sampler sam [[sampler(1)]]\n) {\n    // ...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u672a\u6307\u5b9a\u4f4d\u7f6e\u7d22\u5f15\uff0cMetal \u7f16\u8bd1\u5668\u5c06\u4f7f\u7528\u7b2c\u4e00\u4e2a\u53ef\u7528\u7684\u4f4d\u7f6e\u7d22\u5f15\u6765\u5206\u914d\u5b83\u4eec\u3002\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c\u4e3a ",(0,r.jsx)(n.code,{children:"src"})," \u5206\u914d\u7eb9\u7406\u7d22\u5f15 0\u3001",(0,r.jsx)(n.code,{children:"dst"})," \u7eb9\u7406\u7d22\u5f15 1\u3001",(0,r.jsx)(n.code,{children:"s"})," \u91c7\u6837\u5668\u7d22\u5f15 0 \u548c u \u7f13\u51b2\u533a\u7d22\u5f15 0\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"kernel void my_kernel(texture2d<half> src,\n                      texture2d<half, access::write> dst,\n                      sampler s,\n                      device myUserInfo *u\n) {\n    // ...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u4e00\u4e9b\u5185\u6838\u53c2\u6570\u5df2\u663e\u5f0f\u5206\u914d\u4f4d\u7f6e\u7d22\u5f15\uff0c\u800c\u53e6\u4e00\u4e9b\u5219\u6ca1\u6709\u3002",(0,r.jsx)(n.code,{children:"src"})," \u663e\u5f0f\u5206\u914d\u7eb9\u7406\u7d22\u5f15 0\uff0c",(0,r.jsx)(n.code,{children:"f"})," \u663e\u5f0f\u5206\u914d\u7f13\u51b2\u533a\u7d22\u5f15 10\u3002\u5982\u679c\u4f7f\u7528\u51fd\u6570\u5e38\u91cf\u5206\u914d\u4f4d\u7f6e\u7d22\u5f15\uff08\u7b2c 5.8 \u8282\uff09\uff0c\u5219\u7f16\u8bd1\u5668\u5728\u5206\u914d\u7d22\u5f15\u65f6\u4e0d\u4f1a\u8003\u8651\u8fd9\u4e9b\u6761\u76ee\u3002\u5176\u5b83\u53c2\u6570\u5206\u914d\u7b2c\u4e00\u4e2a\u53ef\u7528\u4f4d\u7f6e\u7d22\u5f15\uff1a",(0,r.jsx)(n.code,{children:"dst"})," \u7eb9\u7406\u7d22\u5f15 1\u3001",(0,r.jsx)(n.code,{children:"s"})," \u91c7\u6837\u5668\u7d22\u5f15 0 \u548c ",(0,r.jsx)(n.code,{children:"u"})," \u7f13\u51b2\u533a\u7d22\u5f15 0\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"kernel void my_kernel(texture2d<half> src [[texture(0)]],\n                      texture2d<half, access::write> dst,\n                      sampler s,\n                      device myUserInfo *u,\n                      device float *f [[buffer(10)]]\n) {\n    // ...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6bcf\u4e2a\u5c5e\u6027\uff08",(0,r.jsx)(n.code,{children:"buffer"}),"\u3001",(0,r.jsx)(n.code,{children:"threadgroup"}),"\u3001",(0,r.jsx)(n.code,{children:"texture"})," \u548c ",(0,r.jsx)(n.code,{children:"sampler"}),"\uff09\u4ee3\u8868\u4e00\u7ec4\u8d44\u6e90\u3002\u53c2\u6570\u4e0a\u6307\u5b9a\u7684\u7d22\u5f15\u503c\u5728\u6bcf\u4e2a\u8d44\u6e90\u7ec4\u4e2d\u5e94\u662f\u552f\u4e00\u7684\u3002\u5177\u6709\u76f8\u540c ",(0,r.jsx)(n.code,{children:"index"})," \u7684\u591a\u4e2a\u7f13\u51b2\u533a\u3001\u7eb9\u7406\u6216\u91c7\u6837\u5668\u53c2\u6570\u4f1a\u751f\u6210\u7f16\u8bd1\u9519\u8bef\uff0c\u9664\u975e\u4f7f\u7528\u51fd\u6570\u5e38\u91cf\u5c5e\u6027\u58f0\u660e\u5b83\u4eec\uff08\u8bf7\u53c2\u9605\u7b2c 5.8.1 \u8282\uff09\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u5177\u6709\u8d44\u6e90\u548c\u8f93\u51fa\u5230\u8bbe\u5907\u5185\u5b58\u7684\u9876\u70b9\u51fd\u6570\u793a\u4f8b",children:"\u5177\u6709\u8d44\u6e90\u548c\u8f93\u51fa\u5230\u8bbe\u5907\u5185\u5b58\u7684\u9876\u70b9\u51fd\u6570\u793a\u4f8b"}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u662f\u4e00\u4e2a\u9876\u70b9\u51fd\u6570 ",(0,r.jsx)(n.code,{children:"render_vertex"}),"\uff0c\u5b83\u8f93\u51fa\u5230\u6570\u7ec4 ",(0,r.jsx)(n.code,{children:"xform_output"})," \u4e2d\u7684\u8bbe\u5907\u5185\u5b58\uff0c\u8be5\u6570\u7ec4\u662f\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"device"})," \u5c5e\u6027\u6307\u5b9a\u7684\u51fd\u6570\u53c2\u6570 (\u5728 4.1 \u8282\u4e2d\u4ecb\u7ecd)\u3002\u6240\u6709\u7684 ",(0,r.jsx)(n.code,{children:"render_vertex"})," \u51fd\u6570\u53c2\u6570\u90fd\u662f\u7528 ",(0,r.jsx)(n.code,{children:"buffer(0)"}),"\uff0c",(0,r.jsx)(n.code,{children:"buffer(1)"}),"\uff0c",(0,r.jsx)(n.code,{children:"buffer(2)"})," \u548c ",(0,r.jsx)(n.code,{children:"buffer(3)"})," \u5c5e\u6027\u6307\u5b9a\u7684 (\u5728 5.2.1 \u8282\u4e2d\u4ecb\u7ecd)\u3002\u6709\u5173\u672c\u4f8b\u4e2d\u663e\u793a\u7684 ",(0,r.jsx)(n.code,{children:"position"})," \u5c5e\u6027\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 5.2.3.3 \u8282\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct VertexOutput {\n    float4 position [[position]];\n    float4 color;\n    float2 texcoord;\n};\n\nstruct VertexInput {\n    float4 position;\n    float3 normal;\n    float2 texcoord;\n};\n\nconstexpr constant uint MAX_LIGHTS = 4;\n\nstruct LightDesc {\n    uint  num_lights;\n    float4 light_position[MAX_LIGHTS];\n    float4 light_color[MAX_LIGHTS];\n    float4 light_attenuation_factors[MAX_LIGHTS];\n};\n\nvertex void render_vertex(const device VertexInput* v_in [[buffer(0)]],\n                          constant float4x4& mvp_matrix [[buffer(1)]],\n                          constant LightDesc& light_desc [[buffer(2)]],\n                          device VertexOutput* xform_output [[buffer(3)]],\n                          uint v_id [[vertex_id]]\n) {\n    VertexOutput v_out;\n    v_out.position = v_in[v_id].position * mvp_matrix; v_out.color = do_lighting(v_in[v_id].position,\n    v_in[v_id].normal, light_desc);\n\n    v_out.texcoord = v_in[v_id].texcoord;\n    // Output the position to a buffer. xform_output[v_id] = v_out;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5149\u6805\u987a\u5e8f\u7ec4",children:"\u5149\u6805\u987a\u5e8f\u7ec4"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 2 \u8d77\u652f\u6301\u5149\u6805\u987a\u5e8f\u7ec4\u5c5e\u6027\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u7247\u6bb5\u51fd\u6570\u4e2d\u7684\u7f13\u51b2\u533a\uff08\u5728 ",(0,r.jsx)(n.code,{children:"device"})," \u5185\u5b58\u4e2d\uff09\u548c\u7eb9\u7406\u7684\u52a0\u8f7d\u548c\u5b58\u50a8\u662f\u65e0\u5e8f\u7684\u3002\u7528\u4e8e\u7f13\u51b2\u533a\u6216\u7eb9\u7406\u7684 ",(0,r.jsx)(n.code,{children:"[[raster_order_group(index)]]"})," \u5c5e\u6027\uff0c\u5982\u679c\u6bcf\u4e2a\u6837\u672c\u7740\u8272\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\uff0c\u5219\u4fdd\u8bc1\u6620\u5c04\u5230\u76f8\u540c ",(0,r.jsx)(n.code,{children:"(x, y)"})," \u50cf\u7d20\u5750\u6807\u548c\u6837\u672c\u7684\u4e0d\u540c\u57fa\u5143\u7684\u4efb\u4f55\u91cd\u53e0\u7247\u6bb5\u7684\u8bbf\u95ee\u987a\u5e8f\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[raster_order_group(index)]]"})," \u5c5e\u6027\u53ef\u4ee5\u5728\u7eb9\u7406\uff08\u59cb\u7ec8\u4f4d\u4e8e ",(0,r.jsx)(n.code,{children:"device"})," \u5185\u5b58\u4e2d\uff09\u6216\u5728 ",(0,r.jsx)(n.code,{children:"device"})," \u5185\u5b58\u4e2d\u58f0\u660e\u7684\u7f13\u51b2\u533a\u4e0a\u6307\u5b9a\uff0c\u4f46\u4e0d\u80fd\u5728 ",(0,r.jsx)(n.code,{children:"threadgroup"})," \u6216 ",(0,r.jsx)(n.code,{children:"constant"})," \u5730\u5740\u7a7a\u95f4\u4e2d\u6307\u5b9a\u3002",(0,r.jsx)(n.code,{children:"[[raster_order_group(index)]]"})," \u5c5e\u6027\u4e0d\u80fd\u4e0e\u7ed3\u6784\u6216\u7c7b\u4e00\u8d77\u4f7f\u7528\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[raster_order_group(index)]]"})," \u5c5e\u6027\u6807\u8bb0\u5bf9\u7f13\u51b2\u533a\u6216\u7eb9\u7406\u7684\u91cd\u53e0\u8bbf\u95ee\u7684\u7247\u6bb5\u51fd\u6570\u8c03\u7528\u7684\u6267\u884c\u987a\u5e8f\u4e0e\u63d0\u4ea4\u51e0\u4f55\u56fe\u5f62\u7684\u987a\u5e8f\u76f8\u540c\u3002\u5bf9\u4e8e\u91cd\u53e0\u7247\u6bb5\u51fd\u6570\u8c03\u7528\uff0c\u7247\u6bb5\u51fd\u6570\u8c03\u7528\u5bf9\u6807\u6709 ",(0,r.jsx)(n.code,{children:"[[raster_order_group(index)]]"})," \u5c5e\u6027\u7684\u7f13\u51b2\u533a\u6216\u7eb9\u7406\u6267\u884c\u7684\u5199\u5165\u9700\u8981\u53ef\u4f9b\u540e\u7eed\u8c03\u7528\u8bfb\u53d6\uff0c\u5e76\u4e14\u4e0d\u5f97\u5f71\u54cd\u5148\u524d\u8c03\u7528\u7684\u8bfb\u53d6\u3002\u540c\u6837\uff0c\u7247\u6bb5\u51fd\u6570\u8c03\u7528\u6267\u884c\u7684\u8bfb\u53d6\u5fc5\u987b\u53cd\u6620\u5148\u524d\u8c03\u7528\u7684\u5199\u5165\uff0c\u5e76\u4e14\u4e0d\u5f97\u53cd\u6620\u540e\u7eed\u8c03\u7528\u7684\u5199\u5165\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[raster_order_group(index)]]"})," \u4e2d\u7684 ",(0,r.jsx)(n.code,{children:"index"})," \u662f\u4e00\u4e2a\u6574\u6570\u503c\uff0c\u5b83\u6307\u5b9a\u5149\u6805\u5668\u987a\u5e8f ID\uff0c\u5b83\u63d0\u4f9b\u5bf9\u52a0\u8f7d\u548c\u5b58\u50a8\u987a\u5e8f\u7684\u66f4\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e24\u4e2a\u7f13\u51b2\u533a A \u548c B \u88ab\u6807\u8bb0\u6709\u4e0d\u540c\u7684\u5149\u6805\u5668\u987a\u5e8f ID \u503c\uff0c\u5219\u53ef\u4ee5\u72ec\u7acb\u5730\u540c\u6b65\u5bf9\u7f13\u51b2\u533a A \u548c B \u7684\u91cd\u53e0\u7247\u6bb5\u7684\u52a0\u8f7d\u548c\u5b58\u50a8\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u4f8b\u5b50\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"fragment void\nmy_fragment(texture2d<float, access::read_write> texA [[raster_order_group(0),\n            texture(0)]],\n            ...\n) {\n    ushort2 coord;\n    float4 clr = texA.read(coord);\n    // do operations on clr\n    clr = ...;\n    texA.write(clr, coord);\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u53c2\u6570\u7f13\u51b2\u533a\uff0c\u4f60\u53ef\u4ee5\u5728\u7ed3\u6784\u4e2d\u7684\u7f13\u51b2\u533a\u6216\u7eb9\u7406\u6210\u5458\u4e0a\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[raster_order_group(index)]]"})," \u5c5e\u6027\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5b9a\u4f4d\u6bcf\u4e2a\u9876\u70b9\u8f93\u5165\u7684\u5c5e\u6027",children:"\u5b9a\u4f4d\u6bcf\u4e2a\u9876\u70b9\u8f93\u5165\u7684\u5c5e\u6027"}),"\n",(0,r.jsxs)(n.p,{children:["\u9876\u70b9\u51fd\u6570\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u9876\u70b9\u548c\u5b9e\u4f8b ID \u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u9876\u70b9\u51fd\u6570\u7684\u7f13\u51b2\u533a\u8fdb\u884c\u7d22\u5f15\u6765\u8bfb\u53d6\u6bcf\u4e2a\u9876\u70b9\u7684\u8f93\u5165\u3002\u6b64\u5916\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[stage_in]]"})," \u5c5e\u6027\u58f0\u660e\u6bcf\u4e2a\u9876\u70b9\u8f93\u5165\uff0c\u5e76\u5c06\u8be5\u8f93\u5165\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\u5bf9\u4e8e\u4f5c\u4e3a\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[stage_in]]"})," \u5c5e\u6027\u58f0\u660e\u7684\u53c2\u6570\u4f20\u9012\u7684\u6bcf\u9876\u70b9\u8f93\u5165\uff0c\u6bcf\u9876\u70b9\u8f93\u5165\u7684\u6bcf\u4e2a\u5143\u7d20\u5fc5\u987b\u5c06\u9876\u70b9\u5c5e\u6027\u4f4d\u7f6e\u6307\u5b9a\u4e3a ",(0,r.jsx)(n.code,{children:"[[attribute(index)]]"}),"\u3002\u6709\u5173 ",(0,r.jsx)(n.code,{children:"[[stage_in]]"})," \u5c5e\u6027\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u7b2c 5.2.4 \u8282\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"index"})," \u662f\u4e00\u4e2a\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u7528\u4e8e\u6807\u8bc6\u5206\u914d\u7684\u9876\u70b9\u8f93\u5165\u4f4d\u7f6e\u3002\u6b63\u786e\u7684\u8bed\u6cd5\u662f\u5c5e\u6027\u9075\u5faa\u53c2\u6570\u6216\u53d8\u91cf\u540d\u79f0\u3002Metal API \u4f7f\u7528\u8be5\u5c5e\u6027\u7528\u4e8e\u6807\u8bc6\u9876\u70b9\u7f13\u51b2\u533a\u7684\u4f4d\u7f6e\u5e76\u63cf\u8ff0\u9876\u70b9\u6570\u636e\uff0c\u4f8b\u5982\u4ece\u4e2d\u83b7\u53d6\u6bcf\u4e2a\u9876\u70b9\u6570\u636e\u7684\u7f13\u51b2\u533a\u3001\u5176\u6570\u636e\u683c\u5f0f\u53ca\u5176\u6b65\u5e45\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u5c06\u9876\u70b9\u5c5e\u6027\u5206\u914d\u7ed9\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"stage_in"})," \u5c5e\u6027\u4f20\u9012\u7ed9\u9876\u70b9\u51fd\u6570\u7684\u9876\u70b9\u8f93\u5165\u7ed3\u6784\u7684\u5143\u7d20\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct VertexInput {\n    float4 position [[attribute(0)]];\n    float3 normal   [[attribute(1)]];\n    half4 color     [[attribute(2)]];\n    half2 texcoord  [[attribute(3)]];\n};\n\nconstexpr constant uint MAX_LIGHTS = 4;\n\nstruct LightDesc {\n    uint  num_lights;\n    float4 light_position[MAX_LIGHTS];\n    float4 light_color[MAX_LIGHTS];\n    float4 light_attenuation_factors[MAX_LIGHTS];\n};\n\nconstexpr sampler s = sampler(coord::normalized,\n                              address::clamp_to_zero,\n                              filter::linear);\n\nvertex VertexOutput\nrender_vertex(VertexInput v_in [[stage_in]],\n    constant float4x4& mvp_matrix [[buffer(1)]],\n    constant LightDesc& lights [[buffer(2)]],\n    uint v_id [[vertex_id]]\n) {\n    VertexOutput v_out;\n    ...\n    return v_out;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0b\u9762\u7684\u793a\u4f8b\u663e\u793a\u4e86\u5982\u4f55\u4f7f\u7528\u7f13\u51b2\u533a\u548c ",(0,r.jsx)(n.code,{children:"stage_in"})," \u5c5e\u6027\u6765\u83b7\u53d6\u9876\u70b9\u51fd\u6570\u4e2d\u7684\u6bcf\u4e2a\u9876\u70b9\u8f93\u5165\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct VertexInput {\n    float4 position [[attribute(0)]];\n    float3 normal   [[attribute(1)]];\n};\n\nstruct VertexInput2 {\nhalf4 color;\nhalf2 texcoord[4];\n};\n\nconstexpr constant uint MAX_LIGHTS = 4;\n\nstruct LightDesc {\n    uint  num_lights;\n    float4 light_position[MAX_LIGHTS];\n    float4 light_color[MAX_LIGHTS];\n    float4 light_attenuation_factors[MAX_LIGHTS];\n};\n\nconstexpr sampler s = sampler(coord::normalized,\n                              address::clamp_to_zero,\n                              filter::linear);\n\nvertex VertexOutput\nrender_vertex(VertexInput v_in [[stage_in]],\n              VertexInput2 v_in2 [[buffer(0)]],\n              constant float4x4& mvp_matrix [[buffer(1)]],\n              constant LightDesc& lights [[buffer(2)]],\n              uint v_id [[vertex_id]]\n) {\n    VertexOutput vOut;\n    ...\n    return vOut;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u66f2\u9762\u7ec6\u5206\u540e\u9876\u70b9\u51fd\u6570\u53ef\u4ee5\u8bfb\u53d6\u6bcf\u4e2a\u9762\u7247\u548c\u9762\u7247\u63a7\u5236\u70b9\u6570\u636e\u3002\u66f2\u9762\u7ec6\u5206\u540e\u9876\u70b9\u51fd\u6570\u5c06\u9762\u7247\u63a7\u5236\u70b9\u6570\u636e\u6307\u5b9a\u4e3a\u4ee5\u4e0b\u6a21\u677f\u5316\u7c7b\u578b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"patch_control_point<T>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5176\u4e2d ",(0,r.jsx)(n.code,{children:"T"})," \u662f\u7528\u6237\u5b9a\u4e49\u7684\u7ed3\u6784\u3002",(0,r.jsx)(n.code,{children:"T"})," \u7684\u6bcf\u4e2a\u5143\u7d20\u5fc5\u987b\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[attribute(index)]]"})," \u6307\u5b9a\u5c5e\u6027\u4f4d\u7f6e\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 1.2 \u8d77\u652f\u6301\u8865\u4e01\u63a7\u5236\u70b9\u6a21\u677f\u7c7b\u578b\u3002"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"patch_control_point"})," \u7c7b\u578b\u652f\u6301\u4ee5\u4e0b\u6210\u5458\u51fd\u6570\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"constexpr size_t size() const; "})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5b83\u8fd4\u56de\u8865\u4e01\u4e2d\u63a7\u5236\u70b9\u7684\u6570\u91cf\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"constexpr const_reference operator[] (size_t pos) const;"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5b83\u8fd4\u56de pos \u6807\u8bc6\u7684\u7279\u5b9a\u6591\u5757\u63a7\u5236\u70b9\u7684\u6570\u636e\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u4f8b\u5b50\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct ControlPoint {\n    int3 patchParam  [[attribute(0)]];\n    float3 P         [[attribute(1)]];\n    float3 P1        [[attribute(2)]];\n    float3 P2        [[attribute(3)]];\n    float2 vSegments [[attribute(4)]];\n};\n\nstruct PerPatchData {\n    float4 patchConstant          [[attribute(5)]];\n    float4 someOtherPatchConstant [[attribute(6)]];\n};\n\nstruct PatchData {\n    patch_control_point<ControlPoint> cp; // Control-point data\n    PerPatchData patchData;               // Per-patch data\n};\n\n[[patch(quad)]] vertex VertexOutput post_tess_vertex_func(PatchData input [[stage_in ]], ...) {\n    // ...\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5185\u7f6e\u53d8\u91cf\u7684\u5c5e\u6027",children:"\u5185\u7f6e\u53d8\u91cf\u7684\u5c5e\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u4e00\u4e9b\u56fe\u5f62\u64cd\u4f5c\u53d1\u751f\u5728\u56fa\u5b9a\u529f\u80fd\u6d41\u6c34\u7ebf\u9636\u6bb5\uff0c\u9700\u8981\u5411\u56fe\u5f62\u51fd\u6570\u63d0\u4f9b\u503c\u6216\u4ece\u56fe\u5f62\u51fd\u6570\u63a5\u6536\u503c\u3002\u5185\u7f6e\u8f93\u5165\u548c\u8f93\u51fa\u53d8\u91cf\u7528\u4e8e\u5728\u56fe\u5f62\uff08\u9876\u70b9\u548c\u7247\u6bb5\uff09\u51fd\u6570\u548c\u56fa\u5b9a\u529f\u80fd\u56fe\u5f62\u7ba1\u9053\u9636\u6bb5\u4e4b\u95f4\u4f20\u9012\u503c\u3002\u5c5e\u6027\u4e0e\u56fe\u5f62\u51fd\u6570\u7684\u53c2\u6570\u548c\u8fd4\u56de\u7c7b\u578b\u4e00\u8d77\u4f7f\u7528\u6765\u6807\u8bc6\u8fd9\u4e9b\u5185\u7f6e\u53d8\u91cf\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027",children:"\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u8868 5.2 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a\u9876\u70b9\u51fd\u6570\u7684\u53c2\u6570\u6307\u5b9a\u7684\u5185\u7f6e\u5c5e\u6027\u4ee5\u53ca\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u7684\u76f8\u5e94\u6570\u636e\u7c7b\u578b\u3002"}),"\n",(0,r.jsx)(d,{num:"5.2",title:"Attributes for vertex function input arguments",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["amplification_count \nmacOS: Since Metal 2.3. iOS: Since Metal 2.2.","ushort or uint","The number of output vertices produced for each vertex instance."],["amplification_id \nmacOS: Since Metal 2.3. \niOS: Since Metal 2.2.","ushort or uint","The array index offset mappings for viewport and render target array indices, which enables routing an amplified vertex to a different viewport and render target."],["base_instance","ushort or uint","The base instance value added to each instance identifier before reading per-instance data."],["base_vertex","ushort or uint","The base vertex value added to each vertex identifier before reading per-vertex data."],["instance_id","ushort or uint","The per-instance identifier, which includes the base instance value if one is specified."],["vertex_id","ushort or uint","The per-vertex identifier, which includes the base vertex value if one is specified."]]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[amplification_count]]"})," \u7684\u9ed8\u8ba4\u503c\u4e3a 1\uff0c\u8868\u793a\u7981\u7528\u9876\u70b9\u653e\u5927\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u7684\u503c\u5e94\u5728 ",(0,r.jsx)(n.code,{children:"[0, amplification_count]"})," \u8303\u56f4\u5185\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027\u7c7b\u578b\u6ce8\u610f\u4e8b\u9879\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[vertex_id]]"})," \u7684\u7c7b\u578b\u4e3a ",(0,r.jsx)(n.code,{children:"uint"}),"\uff0c\u5219\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[base_vertex]]"})," \u7684\u7c7b\u578b\u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"uint"})," \u6216 ",(0,r.jsx)(n.code,{children:"ushort"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[vertex_id]]"})," \u7684\u7c7b\u578b\u4e3a ",(0,r.jsx)(n.code,{children:"ushort"}),"\uff0c\u5219\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[base_vertex]]"})," \u7684\u7c7b\u578b\u4e5f\u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"ushort"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[instance_id]]"})," \u7684\u7c7b\u578b\u4e3a ",(0,r.jsx)(n.code,{children:"uint"}),"\uff0c\u5219\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[base_instance]]"})," \u7684\u7c7b\u578b\u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"uint"})," \u6216 ",(0,r.jsx)(n.code,{children:"ushort"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[instance_id]]"})," \u7684\u7c7b\u578b\u4e3a ",(0,r.jsx)(n.code,{children:"ushort"}),"\uff0c\u5219\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[base_instance]]"})," \u7684\u7c7b\u578b\u4e5f\u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"ushort"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u66f2\u9762\u7ec6\u5206\u540e\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027",children:"\u66f2\u9762\u7ec6\u5206\u540e\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u8868 5.3 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a\u66f2\u9762\u7ec6\u5206\u540e\u9876\u70b9\u51fd\u6570\u7684\u53c2\u6570\u6307\u5b9a\u7684\u5185\u7f6e\u5c5e\u6027\u4ee5\u53ca\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u7684\u76f8\u5e94\u6570\u636e\u7c7b\u578b\u3002"}),"\n",(0,r.jsx)(d,{num:"5.3",title:"Attributes for post-tessellation vertex function input arguments",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["base_instance","ushort or uint","The base instance value added to each instance identifier before reading per-instance data."],["instance_id","ushort or uint","The per-instance identifier, which includes the base instance value if one is specified."],["patch_id","ushort or uint","The patch identifier."],["position_in_patch","float2 or float3","Defines the location on the patch being evaluated. For quad patches, must be float2. For triangle patches, must be float3."]]}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 1.2 \u8d77\u652f\u6301\u8868 5.3 \u4e2d\u7684\u6240\u6709\u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027\u6ce8\u610f\u4e8b\u9879\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[instance_id]]"})," \u7684\u7c7b\u578b\u4e3a ",(0,r.jsx)(n.code,{children:"uint"}),"\uff0c\u5219\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[base_instance]]"})," \u7684\u7c7b\u578b\u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"uint"})," \u6216 ",(0,r.jsx)(n.code,{children:"ushort"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[instance_id]]"})," \u7684\u7c7b\u578b\u4e3a ",(0,r.jsx)(n.code,{children:"ushort"}),"\uff0c\u5219\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[base_instance]]"})," \u7684\u7c7b\u578b\u4e5f\u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"ushort"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u5c5e\u6027",children:"\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u5c5e\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u8868 5.4 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a\u9876\u70b9\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u6216\u9876\u70b9\u51fd\u6570\u8fd4\u56de\u7684\u7ed3\u6784\u4f53\u7684\u6210\u5458\u6307\u5b9a\u7684\u5185\u7f6e\u5c5e\u6027\uff08\u53ca\u5176\u76f8\u5e94\u7684\u6570\u636e\u7c7b\u578b\uff09\u3002"}),"\n",(0,r.jsx)(d,{num:"5.4",title:"Attributes for vertex function return type",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["Attribute","Corresponding Data Types","Description"],["clip_distance","float or float[n] \nn needs to be known at compile time","Distance from vertex to clipping plane"],["invariant \nAll OS: Since Metal 2.1","Not applicable; needs to be used with [[position]]","Marks the output position such that if the sequence of operations used to compute the output position in multiple vertex shaders is identical, there is a high likelihood that the resulting output position computed by these vertex shaders are the same value. Requires users to pass -fpreserve-invariance. Please see description below for more information."],["point_size","float","Size of a point primitive"],["position","float4","The transformed vertex position"],["render_target_array_ind ex \nmacOS: Since Metal 1.1. \niOS: Since Metal 2.1.","uchar, ushort, or uint","The array index that refers to one of: \n1) an array slice of a texture array, \n2) data at a specified depth of a 3D texture, \n3) the face of a cubemap, or \n4) a specified face of a specified array slice of a cubemap array."],["shared \nmacOS: Since Metal 2.3. \niOS: Since Metal 2.2.","Not applicable","If present, then for every amplification_id, the output shall have the same value."],["viewport_array_index \nmacOS: Since Metal 2. \niOS: Since Metal 2.1.","uchar, ushort, or uint","The viewport (and scissor rectangle) index value of the primitive."]]}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 1 \u8d77\u652f\u6301\u8868 5. 4 \u4e2d\u7684\u5c5e\u6027\uff0c\u9664\u975e\u53e6\u6709\u8bf4\u660e\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u7acb\u65b9\u4f53\u8d34\u56fe\u8868\u793a\u4e3a\u5177\u6709\u516d\u5c42\u7684\u6e32\u67d3\u76ee\u6807\u6570\u7ec4\uff0c\u6bcf\u4e2a\u9762\u4e00\u5c42\uff0c",(0,r.jsx)(n.code,{children:"[[render_target_array_index]]"})," \u662f\u9762\u7d22\u5f15\uff0c\u5176\u503c\u4e3a 0 \u5230 5 \u4e4b\u95f4\u7684\u503c\u3002\u5bf9\u4e8e\u7acb\u65b9\u4f53\u8d34\u56fe\u6570\u7ec4\uff0c",(0,r.jsx)(n.code,{children:"[[render_target_array_index]]"})," \u4e3a\u8ba1\u7b97\u4e3a\uff1a",(0,r.jsx)(n.code,{children:"array_slice_index * 6 + face_index"}),"\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u5fc5\u987b\u4e3a\u57fa\u5143\u4e2d\u7684\u6bcf\u4e2a\u9876\u70b9\u8fd4\u56de\u76f8\u540c\u7684 ",(0,r.jsx)(n.code,{children:"[[render_target_array_index]]"})," \u503c\u3002\u5982\u679c\u503c\u4e0d\u540c\uff0c\u5219\u4f20\u9012\u7ed9\u7247\u6bb5\u51fd\u6570\u7684\u884c\u4e3a\u548c\u503c\u672a\u5b9a\u4e49\u3002\u76f8\u540c\u7684\u884c\u4e3a\u9002\u7528\u4e8e\u7531\u66f2\u9762\u7ec6\u5206\u751f\u6210\u7684\u56fe\u5143\u3002\u5982\u679c ",(0,r.jsx)(n.code,{children:"[[render_target_array_index]]"})," \u8d8a\u754c\uff08\u5373\u5927\u4e8e\u6216\u7b49\u4e8e ",(0,r.jsx)(n.code,{children:"renderTargetArrayLength"}),"\uff09\uff0c\u5219\u786c\u4ef6\u4f1a\u5c06\u6b64\u503c\u89e3\u91ca\u4e3a 0\u3002\u6709\u5173 ",(0,r.jsx)(n.code,{children:"[[render_target_array_index]]"})," \u4f5c\u4e3a\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u7b2c 5.2.3.4 \u8282\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[viewport_array_index]]"})," \u5141\u8bb8\u4ece\u591a\u4e2a\u6d3b\u52a8\u89c6\u53e3\u548c\u526a\u5200\u77e9\u5f62\u6307\u5b9a\u4e00\u4e2a\u89c6\u53e3\u548c\u526a\u5200\u77e9\u5f62\u3002\u5982\u679c\u9876\u70b9\u51fd\u6570\u6ca1\u6709\u6307\u5b9a ",(0,r.jsx)(n.code,{children:"[[viewport_array_index]]"}),"\uff0c\u5219\u8f93\u51fa\u89c6\u53e3\u6570\u7ec4\u7d22\u5f15\u503c\u4e3a 0\u3002\u6709\u5173 ",(0,r.jsx)(n.code,{children:"[[viewport_array_index]]"})," \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u7b2c 5.10 \u8282\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[invariant]]"})," \u8868\u793a\u591a\u4e2a\u51fd\u6570\u4f20\u9012\u4e2d\u4f7f\u7528\u7684\u6d6e\u70b9\u6570\u5b66\u5fc5\u987b\u751f\u6210\u4e0e\u6bcf\u4e2a\u4f20\u9012\u5b8c\u5168\u5339\u914d\u7684\u9876\u70b9\u4f4d\u7f6e\u3002",(0,r.jsx)(n.code,{children:"[[invariant]]"})," \u53ea\u80fd\u7528\u4e8e\u9876\u70b9\u51fd\u6570\u4e2d\u7684\u4f4d\u7f6e\uff08\u5177\u6709 ",(0,r.jsx)(n.code,{children:"[[position]]"})," \u5c5e\u6027\u7684\u5b57\u6bb5\uff09\uff0c\u4ee5\u6307\u793a\u8f93\u51fa\u7684\u8ba1\u7b97\u7ed3\u679c\u662f\u4e0d\u53d8\u7684\u3002\u5728 iOS 14.0 \u548c macOS 11.0 \u4e4b\u524d\u7684\u7f16\u8bd1\u5668\u4e2d\uff0c\u8ba1\u7b97\u53ef\u80fd\uff08\u5c3d\u7ba1\u4e0d\u80fd\u4fdd\u8bc1\uff09\u662f\u4e0d\u53d8\u7684\u3002\u73b0\u5728\uff0c\u5f53\u4f20\u9012 ",(0,r.jsx)(n.code,{children:"-fpreserve-invariance"})," \u9009\u9879\u6216\u4ece Metal API \u7684 ",(0,r.jsx)(n.code,{children:"MTLCompilerOptions"})," \u8bbe\u7f6e ",(0,r.jsx)(n.code,{children:"preserveInvariance"})," \u8fdb\u884c\u8fd0\u884c\u65f6\u7f16\u8bd1\u65f6\uff0c\u6b64\u8ba1\u7b97\u4fdd\u8bc1\u4e0d\u53d8\u3002\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u672a\u4f20\u9012\u9009\u9879\uff0c\u5219 ",(0,r.jsx)(n.code,{children:"[[invariant]]"})," \u5c06\u88ab\u5ffd\u7565\u3002\u8fd9\u79cd\u4f4d\u7f6e\u4e0d\u53d8\u6027\u5bf9\u4e8e\u9634\u5f71\u4f53\u79ef\u6216 z-prepass \u7b49\u6280\u672f\u81f3\u5173\u91cd\u8981\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u9876\u70b9\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u4e0d\u662f ",(0,r.jsx)(n.code,{children:"void"}),"\uff0c\u5219\u5b83\u5fc5\u987b\u5305\u542b\u9876\u70b9\u4f4d\u7f6e\u3002\u5982\u679c\u9876\u70b9\u8fd4\u56de\u7c7b\u578b\u662f ",(0,r.jsx)(n.code,{children:"float4"}),"\uff0c\u90a3\u4e48\u5b83\u603b\u662f\u5f15\u7528\u9876\u70b9\u4f4d\u7f6e\uff0c\u5e76\u4e14\u4e0d\u80fd\u6307\u5b9a ",(0,r.jsx)(n.code,{children:"[[position]]"})," \u5c5e\u6027\u3002\u5982\u679c\u9876\u70b9\u8fd4\u56de\u7c7b\u578b\u662f\u7ed3\u6784\u4f53\uff0c\u5219\u5b83\u5fc5\u987b\u5305\u542b\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[position]]"})," \u5c5e\u6027\u58f0\u660e\u7684\u5143\u7d20\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u63cf\u8ff0\u4e86\u4e00\u4e2a\u540d\u4e3a ",(0,r.jsx)(n.code,{children:"process_vertex"})," \u7684\u9876\u70b9\u51fd\u6570\u3002\u8be5\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u540d\u4e3a ",(0,r.jsx)(n.code,{children:"VertexOutput"})," \u7684\u7528\u6237\u5b9a\u4e49\u7ed3\u6784\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u8868\u793a\u9876\u70b9\u4f4d\u7f6e\u7684\u5185\u7f6e\u53d8\u91cf\uff0c\u56e0\u6b64\u9700\u8981 ",(0,r.jsx)(n.code,{children:"[[position]]"})," \u5c5e\u6027\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"struct VertexOutput {\n    float4 position [[position]];\n    float4 color;\n    float2 texcoord;\n}\n\nvertex VertexOutput process_vertex(...)\n{\n    VertexOutput v_out;\n    // compute per-vertex output ...\n    return v_out;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u66f2\u9762\u7ec6\u5206\u540e\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u4e0e\u5e38\u89c4\u9876\u70b9\u51fd\u6570\u76f8\u540c\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u542f\u7528\u9876\u70b9\u653e\u5927\uff0c\u5e76\u4e14\u9876\u70b9\u8f93\u51fa\u53d8\u91cf\u7684\u6bcf\u4e2a ",(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u5c5e\u6027\u5177\u6709\u76f8\u540c\u7684\u503c\uff0c\u5219\u9876\u70b9\u8f93\u51fa\u88ab\u89c6\u4e3a ",(0,r.jsx)(n.em,{children:"\u5171\u4eab"}),"\u3002\u5171\u4eab\u7684\u9876\u70b9\u8f93\u51fa\u53ef\u4ee5\u4f7f\u7528\u5355\u4e2a\u53d8\u5316\u7684\u8f93\u51fa\u69fd\uff0c\u8fd9\u662f\u6709\u9650\u7684\u8d44\u6e90\u3002\u672a\u5171\u4eab\u7684\u9876\u70b9\u8f93\u51fa\u6d88\u8017\u591a\u4e2a\u4e0d\u540c\u7684\u8f93\u51fa\u69fd\u3002\uff08Metal \u6846\u67b6\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"[MTLRenderPipelineDescriptor maxVertexAmplificationCount]"})," \u8fd4\u56de\u53ef\u7528\u4e8e\u5c06\u653e\u5927\u7684\u6570\u636e\u4f20\u9012\u5230\u7247\u6bb5\u51fd\u6570\u8c03\u7528\u7684\u53d8\u5316\u69fd\u7684\u6570\u91cf\uff0c\u8fd9\u4f1a\u5f71\u54cd\u53ef\u7528\u53d8\u5316\u69fd\u7684\u603b\u6570\u3002\uff09"]}),"\n",(0,r.jsxs)(n.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u5185\u7f6e\u9876\u70b9\u8f93\u51fa\u90fd\u662f\u5171\u4eab\u7684\uff0c\u9664\u4e86\u5177\u6709 ",(0,r.jsx)(n.code,{children:"[[position]]"})," \u5c5e\u6027\u7684\u9876\u70b9\u8f93\u51fa\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0d\u5171\u4eab\u6240\u6709\u5176\u5b83\u9876\u70b9\u8f93\u51fa\u3002\u8981\u663e\u5f0f\u6307\u5b9a\u8f93\u51fa\u662f\u5171\u4eab\u7684\uff0c\u8bf7\u5c06 ",(0,r.jsx)(n.code,{children:"[[shared]]"})," \u5c5e\u6027\u4e0e\u9876\u70b9\u8f93\u51fa\u53d8\u91cf\u4e00\u8d77\u4f7f\u7528\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u7740\u8272\u5668\u7f16\u8bd1\u5668\u53ef\u4ee5\u63a8\u65ad\u51fa\u9876\u70b9\u8f93\u51fa\u53d8\u91cf\u5bf9\u4e8e\u6bcf\u4e2a ",(0,r.jsx)(n.code,{children:"amplification_id"})," \u5177\u6709\u76f8\u540c\u7684\u503c\uff0c\u5219\u7f16\u8bd1\u5668\u53ef\u4ee5\u5c06\u8be5\u9876\u70b9\u8f93\u51fa\u6807\u8bb0\u4e3a\u5171\u4eab\u3002\u5728\u4ee5\u4e0b\u4efb\u4f55\u60c5\u51b5\u4e0b\uff0c\u7f16\u8bd1\u5668\u53ef\u80fd\u4e0d\u4f1a\u5c06\u9876\u70b9\u8f93\u51fa\u6807\u8bb0\u4e3a\u5171\u4eab\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u8f93\u51fa\u503c\u53d6\u51b3\u4e8e ",(0,r.jsx)(n.code,{children:"[[amplification_id]]"}),"\u3002"]}),"\n",(0,r.jsx)(n.li,{children:"\u539f\u5b50 read-modify-write \u64cd\u4f5c\u8fd4\u56de\u8f93\u51fa\u503c\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u7740\u8272\u5668\u4ece\u6613\u5931\u6027\u5b58\u50a8\u5668\u52a0\u8f7d\u8f93\u51fa\u503c\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u5c5e\u6027",children:"\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u5c5e\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u8868 5.5 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a\u7247\u6bb5\u51fd\u6570\u7684\u53c2\u6570\u6307\u5b9a\u7684\u5185\u7f6e\u5c5e\u6027\uff08\u53ca\u5176\u76f8\u5e94\u7684\u6570\u636e\u7c7b\u578b\uff09\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u9876\u70b9\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u4e0d\u662f ",(0,r.jsx)(n.code,{children:"void"}),"\uff0c\u5219\u5b83\u5fc5\u987b\u5305\u542b\u9876\u70b9\u4f4d\u7f6e\u3002\u5982\u679c\u9876\u70b9\u8fd4\u56de\u7c7b\u578b\u662f ",(0,r.jsx)(n.code,{children:"float4"}),"\uff0c\u5219\u5b83\u59cb\u7ec8\u6307\u7684\u662f\u9876\u70b9\u4f4d\u7f6e\uff08\u5e76\u4e14\u4e0d\u9700\u8981\u6307\u5b9a ",(0,r.jsx)(n.code,{children:"[[position]]"})," \u5c5e\u6027\uff09\u3002\u5982\u679c\u9876\u70b9\u8fd4\u56de\u7c7b\u578b\u662f\u7ed3\u6784\u4f53\uff0c\u5219\u5b83\u5fc5\u987b\u5305\u542b\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[position]]"})," \u5c5e\u6027\u58f0\u660e\u7684\u5143\u7d20\u3002"]}),"\n",(0,r.jsx)(d,{num:"5.5",title:"Attributes for fragment function input arguments",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["amplification_count \nmacOS: Since Metal 2.3. \niOS: Since Metal 2.2.","ushort or uint","The number of output vertices produced for each vertex instance."],["amplification_id \nmacOS: Since Metal 2.3. \niOS: Since Metal 2.2.","ushort or uint","The array index offset mappings for viewport and render target array indices, which enables routing an amplified vertex to a different viewport and render target."],["barycentric_coord \nmacOS: Since Metal 2.2. \niOS: Since Metal 2.3.","float, float2, or float3","The barycentric coordinates."],["color(m) \nmacOS: Since Metal 2.3. \niOS: Since Metal 1.","floatn, halfn, intn, uintn, shortn, or ushortn \nm needs to be known at compile time","The input value read from a color attachment. The index m indicates which color attachment to read from."],["front_facing","bool","This value is true if the fragment belongs to a front-facing primitive."],["point_coord","float2","Two-dimensional coordinates, which range from 0.0 to 1.0 across a point primitive, specifying the location of the current fragment within the point primitive."],["position","float4","Describes the window-relative coordinate (x, y, z, 1/w) values for the fragment."],["primitive_id \nmacOS: Since Metal 2.2. \niOS: Since Metal 2.3.","uint","The per-primitive identifier used with barycentric coordinates."],["render_target_array_index \nmacOS: Since Metal 1.1. \niOS: Since Metal 2.1.","uchar, ushort, or uint","The render target array index, which refers to the face of a cubemap, data at a specified depth of a 3D texture, an array slice of a texture array, an array slice, or face of a cubemap array. For a cubemap, the render target array index is the face index, which is a value from 0 to 5. For a cubemap array the render target array index is computed as: array slice index * 6 + face index."],["sample_id","uint","The sample number of the sample currently being processed."],["sample_mask","uint","The set of samples covered by the primitive generating the fragment during multisample rasterization."],["sample_mask, post_depth_coverage \niOS: Since Metal 2. \nmacOS: Since Metal 2.3","uint","The set of samples covered by the primitive generating the fragment after application of the early depth and stencil tests during multisample rasterization. The early_fragment_tests attribute needs to be used on the fragment function; otherwise the compilation fails."],["thread_index_in_quadgroup \nAll OS: Since Metal 2.2.","ushort or uint","The scalar index of a thread within a quad-group."],["thread_index_in_simdgro up \nAll OS: Since Metal 2.2.","ushort or uint","The scalar index of a thread within a SIMD-group."],["threads_per_simdgroup \nAll OS: Since Metal 2.2.","ushort or uint","The thread execution width of a SIMD-group."],["viewport_array_index \nmacOS: Since Metal 2. \niOS: Since Metal 2.1.","uint","The viewport (and scissor rectangle) index value of the primitive."]]}),"\n",(0,r.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[position]]"})," \u5c5e\u6027\u58f0\u660e\u4e3a\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u7684\u53d8\u91cf\u53ea\u80fd\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"center_no_perspective"})," \u91c7\u6837\u548c\u63d2\u503c\u5c5e\u6027\u58f0\u660e\u3002\uff08\u53c2\u89c1\u7b2c 5.4 \u8282\u3002\uff09"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e ",(0,r.jsx)(n.code,{children:"[[color(m)]]"}),"\uff0c",(0,r.jsx)(n.code,{children:"m"})," \u7528\u4e8e\u5728\u7247\u6bb5\u51fd\u6570\u4e2d\u8bbf\u95ee\uff08\u8bfb\u53d6\u6216\u5199\u5165\uff09\u591a\u4e2a\u989c\u8272\u9644\u4ef6\u65f6\u6307\u5b9a\u989c\u8272\u9644\u4ef6\u7d22\u5f15\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u7247\u6bb5\u51fd\u6570\u8f93\u5165\uff0c",(0,r.jsx)(n.code,{children:"[[sample_mask]]"})," \u5c5e\u6027\u53ea\u80fd\u58f0\u660e\u4e00\u6b21\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7247\u6bb5\u51fd\u6570\u4e2d ",(0,r.jsx)(n.code,{children:"[[render_target_array_index]]"})," \u7684\u503c\u4e0e\u4ece\u9876\u70b9\u51fd\u6570\u5199\u5165\u7684\u503c\u76f8\u540c\uff0c\u5373\u4f7f\u6307\u5b9a\u7684\u503c\u8d85\u51fa\u8303\u56f4\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u6709\u5173 ",(0,r.jsx)(n.code,{children:"[[viewport_array_index]]"})," \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u7b2c 5.10 \u8282\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[amplification_count]]"})," \u7684\u9ed8\u8ba4\u503c\u4e3a 1\uff0c\u8868\u793a\u7981\u7528\u9876\u70b9\u653e\u5927\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u7684\u503c\u5e94\u5728 ",(0,r.jsx)(n.code,{children:"[0, amplification_count)"})," \u8303\u56f4\u5185\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u6307\u5b9a\u7684 ",(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u5c5e\u6027\u503c\uff0c",(0,r.jsx)(n.code,{children:"[[viewport_array_index]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[render_target_array_index]]"})," \u5185\u7f6e\u7247\u6bb5\u8f93\u5165\u503c\u5c06\u6dfb\u52a0\u5230\u76f8\u5e94 ",(0,r.jsx)(n.code,{children:"MTLVertexAmplificationViewMapping"})," \u7ed3\u6784\u63d0\u4f9b\u7684\u503c\uff08\u504f\u79fb\uff09\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u63cf\u8ff0\u4e86\u7ed3\u6784\u4f53 ",(0,r.jsx)(n.code,{children:"MyVertexOut"}),"\uff0c\u5b83\u65e2\u662f\u9876\u70b9\u51fd\u6570\u8fd4\u56de\u7c7b\u578b\u53c8\u662f\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u7c7b\u578b\u3002",(0,r.jsx)(n.code,{children:"MyVertexOut"})," \u4f7f\u7528\u8f93\u5165\u53c2\u6570 ",(0,r.jsx)(n.code,{children:"amp_id"})," \u7684 ",(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u5c5e\u6027\u6765\u653e\u5927\u4f4d\u7f6e\u548c ",(0,r.jsx)(n.code,{children:"ampData"})," \u6210\u5458\u3002\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[shared]]"})," \u5c5e\u6027\u663e\u5f0f\u786e\u4fdd ",(0,r.jsx)(n.code,{children:"texcoord"})," \u6210\u5458\u5728\u9876\u70b9\u653e\u5927\u4e0b\u5bf9\u4e8e\u6240\u6709\u53d8\u91cf\u5177\u6709\u76f8\u540c\u7684\u503c\uff0c\u5982\u7b2c 5.2.3.3 \u8282\u6240\u8ff0\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u9876\u70b9\u51fd\u6570 ",(0,r.jsx)(n.code,{children:"myVertex"})," \u4e2d\uff0c",(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[amplification_count]]"})," \u5c5e\u6027\u6307\u5b9a\u7528\u4e8e\u9876\u70b9\u653e\u5927\u7684\u9876\u70b9\u51fd\u6570\u8f93\u5165\u53d8\u91cf\uff0c\u8be6\u89c1 5.2.3.1 \u8282\u3002\u7740\u8272\u5668\u7f16\u8bd1\u5668\u63a8\u65ad\u51fa\u6bcf\u4e2a ",(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u7684\u666e\u901a\u6210\u5458\u5177\u6709\u76f8\u540c\u7684\u503c\uff0c\u56e0\u6b64\u7f16\u8bd1\u5668\u5728\u9876\u70b9\u8f93\u51fa\u4e2d\u5c06\u5176\u6807\u8bb0\u4e3a\u5171\u4eab\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u7247\u6bb5\u51fd\u6570 ",(0,r.jsx)(n.code,{children:"myFragment"})," \u4e2d\uff0c\u76f8\u540c\u7684 ",(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[amplification_count]]"})," \u5c5e\u6027\u6307\u5b9a\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u53d8\u91cf\u3002\u5982\u679c\u542f\u7528\u9876\u70b9\u653e\u5927\uff0c\u5219 ",(0,r.jsx)(n.code,{children:"amp_id"})," \u786e\u5b9a\u4ece\u4e2d\u9009\u62e9\u89c6\u53e3\u6570\u7ec4\u7d22\u5f15\uff08",(0,r.jsx)(n.code,{children:"viewportArrayIndexOffset"})," \u6210\u5458\uff09\u7684\u6620\u5c04\uff08",(0,r.jsx)(n.code,{children:"MTLVertexAmplificationViewMapping"})," \u7ed3\u6784\uff09\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct MyVertexIn {\n    float4 position [[attribute(0)]];\n    float3 normal   [[attribute(1)]];\n    float3 tangent  [[attribute(2)]];\n    float2 texcoord [[attribute(3)]];\n};\n\nstruct MyVertexOut {\n    float4 position [[position]];\n    float3 normal;\n    float3 tangent;\n    float3 bitangent;\n    float2 texcoord [[shared]]; // explicitly shared.\n    float  ampData;\n    ushort viewport [[viewport_array_index]]; // implicitly shared\n};\n\nconstexpr ushort MAX_AMP = 2;\n\nvertex MyVertexOut myVertex(MyVertexIn in [[stage_in]],\n                            constant float4x4 view_proj[MAX_AMP],\n                            constant float data[MAX_AMP],\n                            ushort amp_id [[amplification_id]],\n                            ushort amp_count [[amplification_count]], ...) {\n    MyVertexOut vert;\n    vert.position  = view_proj[amp_id] * in.position; // deduced amplified     vert.normal    = in.normal; // deduced shared\n    vert.tangent   = ...;\n    vert.bitangent = ...;\n    vert.texcoord  = ...;\n    vert.ampData   = data[amp_id]; // not shared\n    vert.viewport  = 1;\n    return vert;\n}\n\nfragment float4 myFragment(MyVertexOut in [[ stage_in ]],\n                           ushort amp_id [[amplification_id]],\n                           ushort amp_count [[amplification_count]],\n                           ...) {\n    // For MTLVertexAmplificationViewMapping = {{1,3},{2,4}}\n    //   when amp_id == 0, in.viewport == 2\n    //   when amp_id == 1, in.viewport == 3\n    ushort viewport = in.viewport;\n    ...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[barycentric_coord]]"})," \u5c5e\u6027\u58f0\u660e\u7684\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u53ea\u80fd\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"center_perspective"}),"\uff08\u9ed8\u8ba4\uff09\u6216 ",(0,r.jsx)(n.code,{children:"center_no_perspective"})," \u91c7\u6837\u548c\u63d2\u503c\u5c5e\u6027\u8fdb\u884c\u58f0\u660e\u3002\u91cd\u5fc3\u5750\u6807\u548c\u6bcf\u50cf\u7d20\u57fa\u5143 ID \u53ef\u4ee5\u4f5c\u4e3a\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u4f20\u9012\u5230\u6309\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\u7ec4\u7ec7\u7684\u7ed3\u6784\u4e2d\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct FragmentInput0 {\n    uint primitive_id [[primitive_id]];\n    // [[center_perspective]] is the default, so it can be omitted.\n    float3 barycentric_coord [[barycentric_coord, center_perspective]];\n};\n\nstruct FragmentInput1 {\n    uint primitive_id [[primitive_id]];\n    float2 linear_barycentric_coord [[barycentric_coord,\n                                      center_no_perspective]];\n};\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7\u5b58\u50a8\u91cd\u5fc3\u5750\u6807\u548c\u6bcf\u50cf\u7d20\u56fe\u5143 ID\uff0c\u7740\u8272\u5668\u53ef\u4ee5\u5728\u7247\u6bb5\u9636\u6bb5\u5185\u624b\u52a8\u8bfb\u53d6\u548c\u63d2\u5165\u7ed8\u5236\u56fe\u5143\u7684\u9876\u70b9\uff0c\u6216\u5c06\u6b64\u63d2\u503c\u63a8\u8fdf\u5230\u5355\u72ec\u7684\u901a\u9053\u3002\u5728\u5ef6\u8fdf\u63d2\u503c\u573a\u666f\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528 thin buffer"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u51e0\u4f55\u901a\u9053\u671f\u95f4\u5b58\u50a8\u6700\u5c0f\u7684\u8868\u9762\u6570\u636e\u96c6\uff0c\u5305\u62ec\u9884\u88c1\u526a\u7684\u91cd\u5fc3\u5750\u6807\u3002\u5728\u7a0d\u540e\u9636\u6bb5\uff0c\u4f60\u5fc5\u987b\u6709\u8db3\u591f\u7684\u6570\u636e\u6765\u6839\u636e\u56fe\u5143 ID \u6570\u636e\u91cd\u5efa\u539f\u59cb\u9876\u70b9\u7d22\u5f15\uff0c\u5e76\u5c06\u91cd\u5fc3\u5750\u6807\u4e0e\u8fd9\u4e9b\u9876\u70b9\u7d22\u5f15\u76f8\u5173\u8054\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53\u5c06 ",(0,r.jsx)(n.code,{children:"barycentric_coord"})," \u5c5e\u6027\u5e94\u7528\u4e8e\u5177\u6709 ",(0,r.jsx)(n.em,{children:"more"})," \u7ec4\u4ef6\u7684\u8f93\u5165\u53c2\u6570\uff08\u6216\u53c2\u6570\u7684\u5b57\u6bb5\uff09\u65f6\uff0c\u5176\u4f59\u5143\u7d20\u5c06\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"0.0f"})," \u8fdb\u884c\u521d\u59cb\u5316\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"fragment float4\nfrag (float3 coord [[barycentric_coord]]) { ... }\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7ed8\u5236\u70b9\u65f6\uff0c",(0,r.jsx)(n.code,{children:"coord.yz"})," \u4e3a ",(0,r.jsx)(n.code,{children:"float2(0.0f)"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u753b\u7ebf\u65f6\uff0c",(0,r.jsx)(n.code,{children:"coord.z"})," \u4e3a ",(0,r.jsx)(n.code,{children:"0.0f"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53\u5c06 ",(0,r.jsx)(n.code,{children:"barycentric_coord"})," \u5c5e\u6027\u5e94\u7528\u4e8e\u5177\u6709 ",(0,r.jsx)(n.em,{children:"fewer"})," \u5206\u91cf\u7684\u8f93\u5165\u53c2\u6570\uff08\u6216\u53c2\u6570\u7684\u5b57\u6bb5\uff09\u65f6\uff0c\u5176\u4f59\u5143\u7d20\u5c06\u88ab\u5ffd\u7565\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u8868 5.6 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u7684\u56fe\u5757\u53c2\u6570\u6307\u5b9a\u7684\u5c5e\u6027\u3002\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[pixel_position_in_tile]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[pixels_per_tile]]"})," \u7684\u6570\u636e\u7c7b\u578b\u5fc5\u987b\u5339\u914d\u3002"]}),"\n",(0,r.jsx)(d,{num:"5.6",title:"Attributes for fragment function tile input arguments",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["pixel_position_in_tile","ushort2 or uint2","(x, y) position of the fragment in the tile."],["pixels_per_tile","ushort2 or uint2","(width, height) of the tile in pixels."],["tile_index","ushort or uint","1D tile index."],["render_target_array_index","uchar, ushort, or uint","The render target array index, which refers to the face of a cubemap, data at a specified depth of a 3D texture, an array slice of a texture array, an array slice, or face of a cubemap array. For a cubemap, the render target array index is the face index, which is a value from 0 to 5. For a cubemap array the render target array index is computed as: array slice index * 6 + face index."]]}),"\n",(0,r.jsx)(n.p,{children:"macOS\uff1a\u81ea Metal 2.3 \u8d77\u652f\u6301\u8868 5.6 \u4e2d\u7684\u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(n.p,{children:"iOS\uff1a\u81ea Metal 2 \u8d77\u652f\u6301\u8868 5.6 \u4e2d\u7684\u5c5e\u6027\u3002"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[tile_index]]"})," \u662f ",(0,r.jsx)(n.code,{children:"[0, n)"})," \u4e2d\u7684\u503c\uff0c\u5176\u4e2d ",(0,r.jsx)(n.code,{children:"n"})," \u662f\u6e32\u67d3\u76ee\u6807\u4e2d\u7684\u56fe\u5757\u6570\u91cf\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7247\u6bb5\u51fd\u6570\u8f93\u51fa\u5c5e\u6027",children:"\u7247\u6bb5\u51fd\u6570\u8f93\u51fa\u5c5e\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u7247\u6bb5\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u63cf\u8ff0\u4e86\u6bcf\u4e2a\u7247\u6bb5\u7684\u8f93\u51fa\u3002\u4f60\u5fc5\u987b\u4f7f\u7528\u8868 5.7 \u4e2d\u5217\u51fa\u7684\u5c5e\u6027\u6765\u6307\u5b9a\u7247\u6bb5\u51fd\u6570\u53ef\u4ee5\u8f93\u51fa\u4e00\u4e2a\u6216\u591a\u4e2a\u6e32\u67d3\u76ee\u6807\u989c\u8272\u503c\u3001\u6df1\u5ea6\u503c\u3001\u91c7\u6837\u8986\u76d6\u906e\u7f69\u6216\u6a21\u677f\u53c2\u8003\u503c\u3002\u5982\u679c\u7247\u6bb5\u51fd\u6570\u6ca1\u6709\u8f93\u51fa\u6df1\u5ea6\u503c\uff0c\u5219\u5c06\u5149\u6805\u5316\u5668\u751f\u6210\u7684\u6df1\u5ea6\u503c\u8f93\u51fa\u5230\u6df1\u5ea6\u9644\u4ef6\u3002"}),"\n",(0,r.jsx)(d,{num:"5.7",title:"Attributes for fragment function return types",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["color(m) \nAll OS: Since Metal 1. \n\ncolor(m), index(i) \nAll OS: Since Metal 1.2.","floatn, halfn, intn, uintn, shortn, or ushortn","Color value output for a color attachment. \nm is the color attachment index and needs to be known at compile time. The index i can be used to specify one or more colors output by a fragment function for a given color attachment and is an input to the blend equation."],["depth(depth_argument) \nAll OS: Since Metal 1.","float","Depth value output using the function specified by depth_argument."],["sample_mask \nAll OS: Since Metal 1.","uint","Coverage mask."],["stencil \nAll OS: Since Metal 2.1.","uint","Stencil reference value to be used in a stencil test."]]}),"\n",(0,r.jsxs)(n.p,{children:["\u7247\u6bb5\u8f93\u51fa\u7684\u989c\u8272\u9644\u4ef6\u7d22\u5f15 ",(0,r.jsx)(n.code,{children:"m"})," \u7684\u6307\u5b9a\u65b9\u5f0f\u4e0e\u7247\u6bb5\u8f93\u5165\u7684 ",(0,r.jsx)(n.code,{children:"[[color(m)]]"})," \u7684\u6307\u5b9a\u65b9\u5f0f\u76f8\u540c\uff08\u53c2\u89c1\u8868 5.5 \u7684\u8ba8\u8bba\uff09\u3002\u7247\u6bb5\u51fd\u6570\u8fd4\u56de\u7c7b\u578b\u4e2d\u4f7f\u7528\u76f8\u540c\u989c\u8272\u9644\u4ef6\u7d22\u5f15\u8fdb\u884c\u6df7\u5408\u7684\u591a\u4e2a\u5143\u7d20\u9700\u8981\u4f7f\u7528\u76f8\u540c\u7684\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u58f0\u660e\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u7247\u6bb5\u51fd\u6570\u4e2d\u53ea\u6709\u5355\u8272\u9644\u4ef6\uff0c\u5219 ",(0,r.jsx)(n.code,{children:"[[color(m)]]"})," \u662f\u53ef\u9009\u7684\u3002\u5982\u679c\u4e0d\u6307\u5b9a ",(0,r.jsx)(n.code,{children:"[[color(m)]]"}),"\uff0c\u5219\u9644\u4ef6\u7d22\u5f15\u4e3a 0\u3002\u5982\u679c\u6307\u5b9a\u591a\u4e2a\u989c\u8272\u9644\u4ef6\uff0c\u5219\u9700\u8981\u4e3a\u6240\u6709\u989c\u8272\u503c\u6307\u5b9a ",(0,r.jsx)(n.code,{children:"[[color(m)]]"}),"\u3002\u8bf7\u53c2\u9605\u7b2c 5.5 \u8282\u548c\u7b2c 5.8.1.5 \u8282\u4e2d\u6307\u5b9a\u989c\u8272\u9644\u4ef6\u7684\u793a\u4f8b\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u5c5e\u6027\u4e2d\u672a\u6307\u5b9a ",(0,r.jsx)(n.code,{children:"index(i)"}),"\uff0c\u5219\u9ed8\u8ba4\u7d22\u5f15\u4e3a ",(0,r.jsx)(n.code,{children:"0"}),"\u3002\u5982\u679c\u6307\u5b9a\u4e86 ",(0,r.jsx)(n.code,{children:"index(i)"}),"\uff0c\u5219\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u77e5\u9053 ",(0,r.jsx)(n.code,{children:"i"})," \u7684\u503c\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u7247\u6bb5\u51fd\u6570\u5199\u5165\u6df1\u5ea6\u503c\uff0c\u5219\u9700\u8981\u4f7f\u7528\u4ee5\u4e0b\u503c\u4e4b\u4e00\u6307\u5b9a ",(0,r.jsx)(n.code,{children:"depth_argument"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"any"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"greater"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"less"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u4e0d\u80fd\u5728\u57fa\u4e8e\u7247\u6bb5\u7684\u56fe\u5757\u7740\u8272\u51fd\u6570\u4e2d\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[stencil]]"})," \u5c5e\u6027\u3002",(0,r.jsx)(n.code,{children:"[[stencil]]"})," \u5c5e\u6027\u4e0e ",(0,r.jsx)(n.code,{children:"[[early_fragment_tests]]"})," \u51fd\u6570\u5c5e\u6027\u4e0d\u517c\u5bb9\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u7247\u6bb5\u51fd\u6570\u6ca1\u6709\u8f93\u51fa\u6a21\u677f\u503c\uff0c",(0,r.jsx)(n.code,{children:"MTLRenderCommandEncoder"})," \u7684 ",(0,r.jsx)(n.code,{children:"setStencilReferenceValue:"})," \u6216 ",(0,r.jsx)(n.code,{children:"setStencilFrontReferenceValue:backReferenceValue:"})," \u65b9\u6cd5\u53ef\u4ee5\u8bbe\u7f6e\u6a21\u677f\u53c2\u8003\u503c\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\u4e86\u5982\u4f55\u6307\u5b9a\u989c\u8272\u9644\u4ef6\u7d22\u5f15\u3002",(0,r.jsx)(n.code,{children:"clr_f"})," \u4e2d\u5199\u5165\u7684\u989c\u8272\u503c\u5199\u5165\u989c\u8272\u9644\u4ef6\u7d22\u5f15 0\uff0c",(0,r.jsx)(n.code,{children:"clr_i"})," \u5199\u5165\u989c\u8272\u9644\u4ef6\u7d22\u5f15 1\uff0c",(0,r.jsx)(n.code,{children:"clr_ui"})," \u5199\u5165\u989c\u8272\u9644\u4ef6\u7d22\u5f15 2\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"struct MyFragmentOutput {\n    // color attachment 0\n    float4 clr_f [[color(0)]];\n\n    // color attachment 1\n    int4 clr_i [[color(1)]];\n\n    // color attachment 2\n    uint4 clr_ui [[color(2)]];\n}\n\nfragment MyFragmentOutput my_fragment(...) {\n    MyFragmentOutput f;\n    ...\n    f.clr_f = ...;\n    ...\n    return f;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u989c\u8272\u9644\u4ef6\u7d22\u5f15\u65e2\u7528\u4f5c\u7247\u6bb5\u51fd\u6570\u7684\u8f93\u5165\u53c8\u7528\u4f5c\u7247\u6bb5\u51fd\u6570\u7684\u8f93\u51fa\uff0c\u5219\u4e0e\u4f7f\u7528\u6b64\u989c\u8272\u9644\u4ef6\u7d22\u5f15\u58f0\u660e\u7684\u8f93\u5165\u53c2\u6570\u548c\u8f93\u51fa\u5173\u8054\u7684\u6570\u636e\u7c7b\u578b\u5fc5\u987b\u5339\u914d\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u5185\u6838\u51fd\u6570\u8f93\u5165\u5c5e\u6027",children:"\u5185\u6838\u51fd\u6570\u8f93\u5165\u5c5e\u6027"}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53\u5185\u6838\u51fd\u6570\u88ab\u63d0\u4ea4\u6267\u884c\u65f6\uff0c\u5b83\u4f1a\u5728 N \u7ef4\u7ebf\u7a0b\u7f51\u683c\u4e0a\u6267\u884c\uff0c\u5176\u4e2d N \u4e3a\u4e00\u3001\u4e8c\u6216\u4e09\u3002\u7ebf\u7a0b\u662f\u5185\u6838\u51fd\u6570\u7684\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8be5\u7f51\u683c\u4e2d\u7684\u6bcf\u4e2a\u70b9\u6267\u884c\uff0c\u5e76\u4e14 ",(0,r.jsx)(n.code,{children:"thread_position_in_grid"})," \u6807\u8bc6\u5176\u5728\u7f51\u683c\u4e2d\u7684\u4f4d\u7f6e\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u8ba1\u7b97\u5355\u5143\u5185\uff0c\u7ebf\u7a0b\u7ec4\u88ab\u5212\u5206\u4e3a\u591a\u4e2a\u8f83\u5c0f\u7684\u7ec4\u6765\u6267\u884c\u3002\u8ba1\u7b97\u5355\u5143\u7684\u6267\u884c\u5bbd\u5ea6\uff08\u79f0\u4e3a ",(0,r.jsx)(n.code,{children:"threads_per_simdgroup"}),"\uff09\u51b3\u5b9a\u4e86\u8be5\u8f83\u5c0f\u7ec4\u7684\u5efa\u8bae\u5927\u5c0f\u3002\u4e3a\u4e86\u83b7\u5f97\u6700\u4f73\u6027\u80fd\uff0c\u8bf7\u5c06\u7ebf\u7a0b\u7ec4\u4e2d\u7684\u7ebf\u7a0b\u603b\u6570\u8bbe\u7f6e\u4e3a ",(0,r.jsx)(n.code,{children:"threads_per_simdgroup"})," \u7684\u500d\u6570\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7ebf\u7a0b\u7ec4\u5728\u7f51\u683c\u5185\u88ab\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684\u4f4d\u7f6e\uff08\u79f0\u4e3a ",(0,r.jsx)(n.code,{children:"threadgroup_position_in_grid"}),"\uff09\u3002\u7ebf\u7a0b\u5728\u7ebf\u7a0b\u7ec4\u5185\u88ab\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684\u4f4d\u7f6e\uff08\u79f0\u4e3a ",(0,r.jsx)(n.code,{children:"thread_position_in_threadgroup"}),"\uff09\u3002\u7ebf\u7a0b\u7ec4\u5185\u7ebf\u7a0b\u7684\u552f\u4e00\u6807\u91cf\u7d22\u5f15\u7531 ",(0,r.jsx)(n.code,{children:"thread_index_in_threadgroup"})," \u7ed9\u51fa\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u6bcf\u4e2a\u7ebf\u7a0b\u5728\u7f51\u683c\u4e2d\u7684\u4f4d\u7f6e\u548c\u5728\u7ebf\u7a0b\u7ec4\u4e2d\u7684\u4f4d\u7f6e\u90fd\u662f N \u7ef4\u5143\u7ec4\u3002\u4f7f\u7528\u4e0e\u7ebf\u7a0b\u7c7b\u4f3c\u7684\u65b9\u6cd5\u4e3a\u7ebf\u7a0b\u7ec4\u5206\u914d\u4f4d\u7f6e\u3002\u7ebf\u7a0b\u88ab\u5206\u914d\u5230\u4e00\u4e2a\u7ebf\u7a0b\u7ec4\uff0c\u5e76\u5728\u7ebf\u7a0b\u7ec4\u4e2d\u6307\u5b9a\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5176\u7ec4\u4ef6\u7684\u8303\u56f4\u4ece\u96f6\u5230\u8be5\u7ef4\u5ea6\u4e2d\u7ebf\u7a0b\u7ec4\u5927\u5c0f\u7684\u5927\u5c0f\u51cf\u4e00\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53\u5185\u6838\u51fd\u6570\u63d0\u4ea4\u6267\u884c\u65f6\uff0c\u6307\u5b9a\u7ebf\u7a0b\u7ec4\u7684\u6570\u91cf\u548c\u7ebf\u7a0b\u7ec4\u5927\u5c0f\uff0c\u6216\u8005\u6307\u5b9a\u7f51\u683c\u4e2d\u7684\u7ebf\u7a0b\u6570\u548c\u7ebf\u7a0b\u7ec4\u5927\u5c0f\u3002\u4f8b\u5982\uff0c\u8003\u8651\u63d0\u4ea4\u6267\u884c\u7684\u5185\u6838\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4f7f\u7528 2D \u7f51\u683c\uff0c\u5176\u4e2d\u6307\u5b9a\u7684\u7ebf\u7a0b\u7ec4\u6570\u91cf\u4e3a (",(0,r.jsx)(n.code,{children:"Wx"}),", ",(0,r.jsx)(n.code,{children:"Wy"}),")\uff0c\u7ebf\u7a0b\u7ec4\u5927\u5c0f\u4e3a (",(0,r.jsx)(n.code,{children:"Sx"}),", ",(0,r.jsx)(n.code,{children:"Sy"}),")\u3002\u4ee4 ",(0,r.jsx)(n.code,{children:"(wx, wy)"})," \u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u7ec4\u5728\u7f51\u683c\u4e2d\u7684\u4f4d\u7f6e (",(0,r.jsx)(n.code,{children:"threadgroup_position_in_grid"}),")\uff0c",(0,r.jsx)(n.code,{children:"(lx, ly)"})," \u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u5728\u7ebf\u7a0b\u7ec4\u4e2d\u7684\u4f4d\u7f6e (",(0,r.jsx)(n.code,{children:"thread_position_in_threadgroup"}),")\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7f51\u683c\u4e2d\u7684\u7ebf\u7a0b\u4f4d\u7f6e\uff08",(0,r.jsx)(n.code,{children:"thread_position_in_grid"}),"\uff09\u4e3a\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"(gx, gy) = (wx * Sx + lx, wy * Sy + ly)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7f51\u683c\u5927\u5c0f\uff08",(0,r.jsx)(n.code,{children:"threads_per_grid"}),"\uff09\u4e3a\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"(Gx, Gy) = (Wx * Sx, Wy * Sy)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u9664\u56fe\u5757\u51fd\u6570\u4e4b\u5916\u7684\u60c5\u51b5\u4e0b\uff0c\u7ebf\u7a0b\u7ec4\u4e2d\u7684\u7ebf\u7a0b\u7d22\u5f15 (thread_index_in_threadgroup) \u7531\u4ee5\u4e0b\u516c\u5f0f\u786e\u5b9a\uff1a",(0,r.jsx)(n.code,{children:"ly * Sx + lx"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u56fe\u5757\u51fd\u6570\uff0c\u7ebf\u7a0b\u7d22\u5f15\u4e0d\u662f lx \u548c ly \u503c\u7684\u7ebf\u6027\u6620\u5c04\u3002\u74e6\u7247\u51fd\u6570\u4e2d\u7684\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4fdd\u8bc1\u83b7\u5f97 ",(0,r.jsx)(n.code,{children:"[0, Sx \\* Sy)"})," \u8303\u56f4\u5185\u7684\u552f\u4e00\u7d22\u5f15\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u7ebf\u7a0b\u7ec4\u5185\uff0c\u7ebf\u7a0b\u4ee5\u5b9e\u73b0\u5b9a\u4e49\u7684\u65b9\u5f0f\u5206\u4e3a SIMD-group\u3002SIMD-group \u4e2d\u7684\u4efb\u4f55\u7ed9\u5b9a\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u67e5\u8be2\u5176 SIMD \u901a\u9053 ID \u4ee5\u53ca\u5b83\u5c5e\u4e8e\u54ea\u4e2a SIMD-group\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8868 5.8 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a\u5185\u6838\u51fd\u6570\u7684\u53c2\u6570\u6307\u5b9a\u7684\u5185\u7f6e\u5c5e\u6027\u4ee5\u53ca\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u7684\u76f8\u5e94\u6570\u636e\u7c7b\u578b\u3002\u4ece Metal 3.1 \u5f00\u59cb\uff0c\u53ef\u4ee5\u5728\u8981\u5728\u5185\u6838\u4e0a\u4e0b\u6587\u4e2d\u4f7f\u7528\u7684\u5168\u5c40\uff08\u7a0b\u5e8f\u8303\u56f4\uff09\u53d8\u91cf\u4e0a\u6307\u5b9a\u5185\u7f6e\u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(d,{num:"5.8",title:"Attributes for kernel function input arguments",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["dispatch_quadgroups_per_th readgroup \nmacOS: Since Metal 2.1. \niOS: Since Metal 2.","ushort or uint","The quad-group execution width of a threadgroup specified at dispatch."],["dispatch_simdgroups_per_threadgroup \nmacOS: Since Metal 2. \niOS: Since Metal 2.2.","ushort or uint","The SIMD-group execution width of a threadgroup specified at dispatch."],["dispatch_threads_per_threadgroup \nAll OS: Since Metal 1.","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread execution width of a threadgroup for threads specified at dispatch."],["grid_origin \nAll OS: Since Metal 1.2.","ushort, ushort2, ushort3, uint, uint2, or uint3","The origin (offset) of the grid over which compute threads that read per-thread stage-in data are launched."],["grid_size \nAll OS: Since Metal 1.2.","ushort, ushort2, ushort3, uint, uint2, or uint3","The maximum size of the grid over which compute threads that read per-thread stage-in data are launched."],["quadgroup_index_in_threadgroup \nmacOS: Since Metal 2.1. \niOS: Since Metal 2.","ushort or uint","The scalar index of a quad-group within a threadgroup."],["quadgroups_per_threadgroup \nmacOS: Since Metal 2.1. \niOS: Since Metal 2.","ushort or uint","The quad-group execution width of a threadgroup."],["simdgroup_index_in_threadgroup \nmacOS: Since Metal 2. \niOS: Since Metal 2.2.","ushort or uint","The scalar index of a SIMD-group within a threadgroup."],["simdgroups_per_threadgroup \nmacOS: Since Metal 2. \niOS: Since Metal 2.2.","ushort or uint","The SIMD-group execution width of a threadgroup."],["thread_execution_width \nAll OS: Since Metal 1. \n[[ Deprecated as of Metal 3 - use threads_per_simdgroup ]]","ushort or uint","The thread execution width of a SIMD-group (compute unit)."],["thread_index_in_quadgroup \nmacOS: Since Metal 2.1. \niOS: Since Metal 2.","ushort or uint","The scalar index of a thread within a quad-group."],["thread_index_in_simdgroup \nmacOS: Since Metal 2. \niOS: Since Metal 2.2.","ushort or uint","The scalar index of a thread within a SIMD-group."],["thread_index_in_threadgrou p \nAll OS: Since Metal 1.","ushort or uint","The scalar index of a thread within a threadgroup."],["thread_position_in_grid \nAll OS: Since Metal 1.","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread\u2019s position in an N-dimensional grid of threads."],["thread_position_in_threadg roup \nAll OS: Since Metal 1.","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread\u2019s unique position within a threadgroup"],["threadgroup_position_in_grid \nAll OS: Since Metal 1.","ushort, ushort2, ushort3, uint, uint2, or uint3","The threadgroup\u2019s unique position within a grid."],["threadgroups_per_grid \nAll OS: Since Metal 1.","ushort, ushort2, ushort3, uint, uint2, or uint3","The number of threadgroups in a grid."],["threads_per_grid \nAll OS: Since Metal 1.","ushort, ushort2, ushort3, uint, uint2, or uint3","The grid size."],["threads_per_simdgroup \nmacOS: Since Metal 2. \niOS: Since Metal 2.2.","ushort or uint","The thread execution width of a SIMD-group (compute unit)."],["threads_per_threadgroup \nAll OS: Since Metal 1.","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread execution width of a threadgroup."]]}),"\n",(0,r.jsxs)(n.p,{children:["\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 1.2 \u8d77\uff0c\u652f\u6301 ",(0,r.jsx)(n.code,{children:"grid_origin"})," \u548c ",(0,r.jsx)(n.code,{children:"grid_size"}),"\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"macOS\uff1a\u4ece Metal 2 \u5f00\u59cb\uff0c\u652f\u6301 SIMD-group \u5c5e\u6027\u3002\u4ece Metal 2.1 \u5f00\u59cb\uff0c\u652f\u6301 quad-group \u5c5e\u6027\u3002\u81ea Metal 1 \u4ee5\u6765\u652f\u6301\u7684\u5176\u5b83\u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(n.p,{children:"iOS\uff1a\u4ece Metal 2 \u5f00\u59cb\uff0c\u652f\u6301 quad-group \u5c5e\u6027\u3002\u4ece Metal 2 \u5f00\u59cb\uff0c\u652f\u6301 SIMD-group \u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u81ea Metal 1 \u4ee5\u6765\u652f\u6301\u7684\u5176\u5b83\u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u4ece Metal 3.1 \u5f00\u59cb\uff0c\u5168\u5c40\uff08\u7a0b\u5e8f\u8303\u56f4\uff09\u53d8\u91cf\u73b0\u5728\u53ef\u4ee5\u6307\u5b9a\u8fd9\u4e9b\u5c5e\u6027\uff0c\u9664\u975e\u5b83\u4eec\u5728\u52a8\u6001\u5e93\u6216\u5355\u72ec\u7f16\u8bd1\u7684\u4e8c\u8fdb\u5236\u51fd\u6570\u4e2d\u4f7f\u7528\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u6807\u51c6 Metal \u8ba1\u7b97\u51fd\u6570\uff08\u5e73\u94fa\u51fd\u6570\u9664\u5916\uff09\uff0c SIMD-group \u662f\u7ebf\u6027\u7684\u548c\u4e00\u7ef4\u7684\u3002\uff08\u7ebf\u7a0b\u7ec4\u53ef\u4ee5\u662f\u591a\u7ef4\u7684\u3002\uff09\u7ebf\u7a0b\u7ec4\u4e2d\u7684 SIMD-group \u6570\u91cf\uff08",(0,r.jsx)(n.code,{children:"[[simdgroups_per_threadgroup]]"}),"\uff09\u662f\u7ebf\u7a0b\u7ec4\u4e2d\u7684\u7ebf\u7a0b\u603b\u6570\uff08",(0,r.jsx)(n.code,{children:"[[threads_per_threadgroup]]"}),"\uff09\u9664\u4ee5 SIMD-group \u5927\u5c0f\uff08",(0,r.jsx)(n.code,{children:"[[threads_per_simdgroup]]"}),"\uff09\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"simdgroups_per_threadgroup = ceil(threads_per_threadgroup / threads_per_simdgroup)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u540c\u6837\uff0c\u7ebf\u7a0b\u7ec4\u4e2d\u7684\u56db\u5143\u7ec4\u6570\u91cf\uff08",(0,r.jsx)(n.code,{children:"quadgroups_per_threadgroup"}),"\uff09\u662f\u7ebf\u7a0b\u7ec4\u4e2d\u7684\u7ebf\u7a0b\u603b\u6570\u9664\u4ee5 4\uff0c\u5373\u56db\u5143\u7ec4\u7684\u7ebf\u7a0b\u6267\u884c\u5bbd\u5ea6\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"quadgroups_per_threadgroup = ceil(threads_per_threadgroup / 4)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u5e73\u94fa\u51fd\u6570\uff0c\u7ebf\u7a0b\u6392\u5217\u4e3a 2 x 2 \u56db\u8fb9\u5f62\u3002\u5bf9\u4e8e\u6307\u5b9a\u7ebf\u7a0b\u7ec4\u6570\u91cf\u4e3a ",(0,r.jsx)(n.code,{children:"(Wx, Wy)"})," \u7684 2 D \u7f51\u683c\uff0c",(0,r.jsx)(n.code,{children:"simdgroups_per_threadgroup"})," \u8ba1\u7b97\u5982\u4e0b\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"simdgroups_per_threadgroup = ceil(Wx / 2) * 2 * ceil(Wy / 2) * 2 / threads_per_simdgroup\nsimdgroups_per_threadgroup = ceil(Wx / 2) * ceil(Wy / 2) * 4 / threads_per_simdgroup\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u56fe\u5757\u51fd\u6570\uff0c",(0,r.jsx)(n.code,{children:"quadgroups_per_threadgroup"})," \u7684\u8ba1\u7b97\u65b9\u5f0f\u5982\u4e0b\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"quadgroups_per_threadgroup = ceil(Wx / 2) * 2 * ceil(Wy / 2) * 2 / 4\nquadgroups_per_threadgroup = ceil(Wx / 2) * ceil(Wy / 2)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u8c03\u5ea6\u65f6\u6307\u5b9a\u7684\u7ebf\u7a0b\uff0c",(0,r.jsx)(n.code,{children:"[[dispatch_simdgroups_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[dispatch_quadgroups_per_threadgroup]]"})," \u7684\u8ba1\u7b97\u65b9\u5f0f\u7c7b\u4f3c\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["SIMD-group \u5728\u7ed9\u5b9a\u7ebf\u7a0b\u7ec4\u5185\u5e76\u53d1\u6267\u884c\uff0c\u5e76\u5728\u6ca1\u6709\u7ebf\u7a0b\u7ec4\u5c4f\u969c\u64cd\u4f5c\u7684\u60c5\u51b5\u4e0b\u76f8\u4e92\u72ec\u7acb\u5730\u524d\u8fdb\u3002SIMD-group \u4e2d\u7684\u7ebf\u7a0b\u7d22\u5f15\uff08\u7531 ",(0,r.jsx)(n.code,{children:"[[thread_index_in_simdgroup]]"})," \u7ed9\u51fa\uff09\u662f\u4ecb\u4e8e 0 \u548c SIMD-group \u5927\u5c0f - 1 \u4e4b\u95f4\u7684\u503c\uff08\u5305\u542b 0 \u548c 1\uff09\u3002\u7c7b\u4f3c\u5730\uff0c\u56db\u5143\u7ec4\u4e2d\u7684\u7ebf\u7a0b\u7d22\u5f15\uff08\u7531 ",(0,r.jsx)(n.code,{children:"[[thread_index_in_quadgroup]]"})," \u7ed9\u51fa\uff09\u662f 0 \u5230 3 \u4e4b\u95f4\u7684\u503c\uff08\u5305\u542b 0 \u548c 3\uff09\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 Metal 2 \u4e2d\uff0c\u7f51\u683c\u4e2d\u7684\u7ebf\u7a0b\u6570\u91cf\u4e0d\u5fc5\u662f\u7ebf\u7a0b\u7ec4\u4e2d\u7ebf\u7a0b\u6570\u91cf\u7684\u500d\u6570\u3002\u56e0\u6b64\uff0c\u7279\u5b9a\u7ebf\u7a0b\u7ec4\u7684\u5b9e\u9645\u7ebf\u7a0b\u7ec4\u5927\u5c0f\u53ef\u80fd\u5c0f\u4e8e\u8c03\u5ea6\u4e2d\u6307\u5b9a\u7684\u7ebf\u7a0b\u7ec4\u5927\u5c0f\u3002",(0,r.jsx)(n.code,{children:"[[threads_per_threadgroup]]"})," \u5c5e\u6027\u6307\u5b9a\u6267\u884c\u5185\u6838\u7684\u7ed9\u5b9a\u7ebf\u7a0b\u7ec4\u7684\u5b9e\u9645\u7ebf\u7a0b\u7ec4\u5927\u5c0f\u3002",(0,r.jsx)(n.code,{children:"[[dispatch_threads_per_threadgroup]]"})," \u5c5e\u6027\u662f\u8c03\u5ea6\u65f6\u6307\u5b9a\u7684\u7ebf\u7a0b\u7ec4\u5927\u5c0f\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u6838\u51fd\u6570\u5c5e\u6027\u6ce8\u610f\u4e8b\u9879\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_position_in_grid]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_grid]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[thread_position_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threadgroup_position_in_grid]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[dispatch_threads_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[threadgroups_per_grid]]"})," \u7684\u7c7b\u578b\u5fc5\u987b\u662f\u6807\u91cf\u7c7b\u578b\u6216\u5411\u91cf\u7c7b\u578b\u3002\u5982\u679c\u5b83\u662f\u5411\u91cf\u7c7b\u578b\uff0c\u5219\u7528\u4e8e\u58f0\u660e\u8fd9\u4e9b\u53c2\u6570\u7684\u5411\u91cf\u7c7b\u578b\u7684\u7ec4\u4ef6\u6570\u91cf\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_position_in_grid]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[threads_per_grid]]"})," \u7684\u6570\u636e\u7c7b\u578b\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_position_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[dispatch_threads_per_threadgroup]]"})," \u7684\u6570\u636e\u7c7b\u578b\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c ",(0,r.jsx)(n.code,{children:"[[thread_position_in_threadgroup]]"})," \u4e3a ",(0,r.jsx)(n.code,{children:"uint"}),"\u3001",(0,r.jsx)(n.code,{children:"uint2"})," \u6216 ",(0,r.jsx)(n.code,{children:"uint3"})," \u7c7b\u578b\uff0c\u5219 ",(0,r.jsx)(n.code,{children:"[[thread_index_in_threadgroup]]"})," \u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"uint"})," \u7c7b\u578b\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u7528\u4e8e\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_index_in_simdgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_simdgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[simdgroup_index_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[simdgroups_per_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[dispatch_simdgroups_per_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[quadgroup_index_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[quadgroups_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[dispatch_quadgroups_per_threadgroup]]"})," \u7684\u7c7b\u578b\u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"ushort"})," \u6216 ",(0,r.jsx)(n.code,{children:"uint"}),"\u3002\u58f0\u660e\u8fd9\u4e9b\u5185\u7f6e\u53d8\u91cf\u7684\u7c7b\u578b\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"[[threads_per_simdgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[thread_execution_width]]"})," \u662f\u5f15\u7528\u76f8\u540c\u6982\u5ff5\u7684\u5f7c\u6b64\u7684\u522b\u540d\u3002"]}),"\n"]}),"\n",(0,r.jsx)(d,{num:"5.9",title:"Attributes for kernel function tile input arguments",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["render_target_array_index","uchar, ushort, or uint","The render target array index, which refers to the face of a cubemap, data at a specified depth of a 3D texture, an array slice of a texture array, an array slice, or face of a cubemap array. For a cubemap, the render target array index is the face index, which is a value from 0 to 5. For a cubemap array the render target array index is computed as: array slice index * 6 + face index. "]]}),"\n",(0,r.jsx)(n.p,{children:"macOS\uff1a\u81ea Metal 2.3 \u8d77\u652f\u6301\u8868 5.9 \u4e2d\u7684\u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(n.p,{children:"iOS\uff1a\u4ece Metal 2 \u5f00\u59cb\u652f\u6301\u8868 5.9 \u4e2d\u7684\u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u4ea4\u96c6\u51fd\u6570\u8f93\u5165\u5c5e\u6027",children:"\u4ea4\u96c6\u51fd\u6570\u8f93\u5165\u5c5e\u6027"}),"\n",(0,r.jsxs)(n.p,{children:["\u8868 5.10 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a\u81ea\u5b9a\u4e49\u4ea4\u96c6\u51fd\u6570\u7684\u53c2\u6570\u6307\u5b9a\u7684\u5185\u7f6e\u5c5e\u6027\uff08\u8bf7\u53c2\u9605\u7b2c 5.1.6 \u8282\uff09\u3002\u5f53\u5728\u4ea4\u96c6\u51fd\u6570\u4e0a\u6307\u5b9a ",(0,r.jsx)(n.code,{children:"primitive_type"})," \u548c ",(0,r.jsx)(n.code,{children:"intersection_tags"})," \u7684\u7279\u5b9a\u503c\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u5185\u7f6e\u5c5e\u6027\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4f8b\u5982\uff0c\u5982\u679c ",(0,r.jsx)(n.code,{children:"intersection_tags"})," \u5305\u542b ",(0,r.jsx)(n.code,{children:"instancing"}),"\uff0c\u5219 ",(0,r.jsx)(n.code,{children:"instance_id"})," \u53ef\u7528\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"[[intersection(triangle, triangle_data, instancing, world_space_data)]]\n          bool triangleIntersectionFunction(..., uint id [[instance_id]], ...\n) {\n      // ...\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4efb\u4f55\u8be5\u7c7b\u9650\u5236\u90fd\u5217\u5728\u5c5e\u6027\u7684\u63cf\u8ff0\u4e2d\u3002"}),"\n",(0,r.jsx)(d,{num:"5.10",title:"Attributes for intersection function input arguments",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["origin","float3","Ray origin in object space."],["direction","float3","Ray direction in object space."],["min_distance","float","Ray min distance."],["max_distance","float","Passed by reference. Returns the current closest intersection max distance. The intersector initializes the initial value with the ray\u2019s maximum distance and the value decreases as the intersector finds intersections."],["payload","User type. \nPassed by reference.","User defined payload passed by the calling thread. Needs to be specified to allow matching payload table by intersect()(section 6.18.2)."],["geometry_id","ushort or uint","The per-geometry id."],["primitive_id","ushort or uint","The per-primitive identifier. For curves, this is a curve segment index."],["instance_id","ushort, uint or array_ref<uint>","The per-instance identifier. Available if intersection_tags include instancing. Since Metal 3.1, if intersection_tags include max_levels<Count>, the type must be array_ref<uint>. Otherwise, it is ushort or uint."],["world_space_origin","float3","Origin in world space. Available if intersection_tags include world_space_data."],["world_space_direction","float3","Direction in world space. Available if intersection_tags include world_space_data."],["barycentric_coord","float2","The barycentric coordinates. Available if the primitive_type is triangle and intersection tag include triangle_data."],["front_facing","bool","This value is true if the triangle front face is visible from the ray origin. Available if intersection_tags include triangle_data."],["distance","float","Distance along the ray at the triangle intersection. Available if the primitive_type is triangle."],["opaque","bool","If this primitive should be considered opaque or not. Available if the primitive_type is a bounding_box."],["instance_intersection_ function_table_offset","ushort or uint","Offset into the intersection function table used to select the intersection instance."],["geometry_intersection_function_table_offset","ushort or uint","Offset into the geometry object used to select to select the intersection instance."],["time \nAll OS: Since Metal 2.4.","float","Ray intersection time. Available if intersection_tags include primitive_motion."],["motion_start_time \nAll OS: Since Metal 2.4.","float","Motion start time for this geometry. Available if intersection_tags include primitive_motion."],["motion_end_time \nAll OS: Since Metal 2.4.","float","Motion end time for this geometry. Available if intersection_tags include primitive_motion."],["key_frame_count \nAll OS: Since Metal 2.4.","ushort or uint","Number of key frames. Available if intersection_tags include primitive_motion."],["object_to_world_transform \nAll OS: Since Metal 2.4.","float4x3","Object space to world space transformation matrix. Available if intersection_tags include instancing and world_space_data. If intersection_tags include instance_motion, the matrix is interpolated based on the time."],["world_to_object_transform \nAll OS: Since Metal 2.4.","float4x3","World space to object space transformation matrix. Available if intersection_tags include instancing and world_space_data. If intersection_tags include instance_motion, the matrix is interpolated based on the time."],["user_instance_id \nAll OS: Since Metal 2.4.","ushort, uint or array_ref<uint>","User defined instance id. Available if intersection_tags include instancing. Since Metal 3.1, if intersection_tags include max_levels<Count>, the type must be array_ref<uint>. Otherwise, it is ushort or uint."],["primitive_data \nSince Metal 3.","const device T* or const device T&","Per-primitive data. The data is read-only and passed in the device address space."],["curve_parameter \nSince Metal 3.1","float","The value which would need to be passed to the curve basis functions to reconstruct the position corresponding to the intersection along the curve segment. This will be exactly 0.0F or 1.0F if, and only if, the ray intersects a curve end cap or elbow. Available if intersection_tags include curve_data. See section 6.18.6 for a set of curve utility functions."]]}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u9876\u70b9\u5c5e\u6027 ",(0,r.jsx)(n.code,{children:"v0"}),"\u3001",(0,r.jsx)(n.code,{children:"v1"})," \u548c ",(0,r.jsx)(n.code,{children:"v2"}),"\uff0c\u6307\u5b9a\u91cd\u5fc3\u70b9\u5904\u7684\u5c5e\u6027\u503c\u4e3a\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"v1 * barycentric_coord.x +\nv2 * barycentric_coord.y +\nv0 * (1.0f - (barycentric_coord.x + barycentric_coord.y))\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5177\u6709 ",(0,r.jsx)(n.code,{children:"[[payload]]"})," \u5c5e\u6027\u7684\u53c2\u6570\u7684\u7c7b\u578b\u91c7\u7528 ",(0,r.jsx)(n.code,{children:"ray_data T &"})," \u5f62\u5f0f\u3002\u5b83\u901a\u8fc7\u5f15\u7528\u4f20\u9012\u7ed9\u4ea4\u96c6\u51fd\u6570\uff0c\u5e76\u5206\u914d\u5728 ",(0,r.jsx)(n.code,{children:"ray_data"})," \u5730\u5740\u7a7a\u95f4\u4e2d\u3002\u6709\u6548\u8d1f\u8f7d\u7684\u7c7b\u578b ",(0,r.jsx)(n.code,{children:"T"})," \u53ef\u4ee5\u662f\u6216\u5305\u542b\u4ee5\u4e0b\u7c7b\u578b\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"device"})," \u6216 ",(0,r.jsx)(n.code,{children:"constant"})," \u6307\u9488\u6216\u5f15\u7528"]}),"\n",(0,r.jsx)(n.li,{children:"\u6574\u6570\u7c7b\u578b"}),"\n",(0,r.jsx)(n.li,{children:"\u679a\u4e3e\u7c7b\u578b"}),"\n",(0,r.jsx)(n.li,{children:"\u6d6e\u70b9\u7c7b\u578b"}),"\n",(0,r.jsx)(n.li,{children:"\u5411\u91cf\u7c7b\u578b"}),"\n",(0,r.jsx)(n.li,{children:"\u8be5\u7c7b\u7c7b\u578b\u7684\u6570\u7ec4"}),"\n",(0,r.jsxs)(n.li,{children:["\u7ed3\u6784\u4f53\u548c\u8054\u5408\u4f53\uff08",(0,r.jsx)(n.code,{children:"atomic<T'>"})," \u548c ",(0,r.jsx)(n.code,{children:"imageblock<T'>"})," \u9664\u5916\uff09\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u4ea4\u96c6\u51fd\u6570\u8f93\u51fa\u5c5e\u6027",children:"\u4ea4\u96c6\u51fd\u6570\u8f93\u51fa\u5c5e\u6027"}),"\n",(0,r.jsxs)(n.p,{children:["\u8868 5.11 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a ",(0,r.jsx)(n.code,{children:"[[intersection(primitive_type, intersection_tags...)]]"})," \u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u6307\u5b9a\u7684\u5185\u7f6e\u5c5e\u6027\uff08\u53ca\u5176\u76f8\u5e94\u7684\u6570\u636e\u7c7b\u578b\uff09\u3002"]}),"\n",(0,r.jsx)(d,{num:"5.11",title:"Attributes for intersection return types",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["accept_intersection","bool","If true, this primitive becomes the next committed hit: if it is the nearest, it will be returned from intersect()."],["continue_search","bool","If the hit is accepted ([[accept_intersection]] == true), continue_search indicates if the search should continue. If continue_search is true, intersect() will continue to search for a closer hit. If false, no further searching is done. The current nearest hit is returned from intersect(). Defaults to true. Even if true is returned, a committed hit will immediately halt searching if accept_any_intersection() is true."],["distance","float","This returns the distance along the ray of a hit found within the bounding box. If the hit is rejected ([[accept_intersection]] == false), this return value is ignored. Available if the primitive_type is a bounding_box."]]}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u4e09\u89d2\u5f62\u4ea4\u96c6\u51fd\u6570\uff0c",(0,r.jsx)(n.code,{children:"[[accept_intersection]]"})," \u662f\u552f\u4e00\u9700\u8981\u7684\u8fd4\u56de\u503c\u3002\u5982\u679c\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u4e0d\u5e26\u5c5e\u6027\u7684 ",(0,r.jsx)(n.code,{children:"bool"}),"\uff0c\u5219\u5047\u5b9a\u4e3a ",(0,r.jsx)(n.code,{children:"[[accept_intersection]]"}),"\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"[[distance]]"})," \u7684\u503c\u9700\u8981\u5927\u4e8e\u6216\u7b49\u4e8e ",(0,r.jsx)(n.code,{children:"[[min_distance]]"})," \u7684\u503c\uff0c\u5e76\u4e14\u9700\u8981\u5c0f\u4e8e\u6216\u7b49\u4e8e ",(0,r.jsx)(n.code,{children:"[[max_distance]]"})," \u7684\u503c\uff0c\u5e76\u4e14\u5728\u81ea\u5b9a\u4e49\u56fe\u5143\u7684\u8fb9\u754c\u6846\u5185\uff08\u5305\u62ec\u5728\u5185\uff09\uff0c\u6216\u8005\u7ed3\u679c\u672a\u5b9a\u4e49\u3002\u5982\u679c ",(0,r.jsx)(n.code,{children:"[[distance]]"})," \u7684\u503c\u4e0e ",(0,r.jsx)(n.code,{children:"[[max_distance]]"})," \u7684\u503c\u76f8\u540c\uff0c\u5219\u63a5\u53d7\u6b64\u547d\u4e2d\u4f18\u5148\u4e8e\u76f8\u540c\u8ddd\u79bb\u7684\u524d\u4e00\u4e2a\u547d\u4e2d\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u65e0\u8bba\u4ea4\u96c6\u51fd\u6570\u5982\u4f55\u8fd4\u56de\uff0c\u5bf9\u5149\u7ebf\u6709\u6548\u8d1f\u8f7d\u6240\u505a\u7684\u4efb\u4f55\u66f4\u6539\u90fd\u4f1a\u751f\u6548\uff1a\u88ab\u62d2\u7edd\u7684\u57fa\u5143\u53ef\u80fd\u4f1a\u5bf9\u5185\u5b58\u4ea7\u751f\u526f\u4f5c\u7528\uff0c\u8fd9\u4e9b\u526f\u4f5c\u7528\u53ef\u4ee5\u7531\u672a\u6765\u7684\u4ea4\u96c6\u7740\u8272\u5668\u7ebf\u7a0b\u89c2\u5bdf\u5230\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5373\u4f7f\u5bf9\u4e8e\u88ab\u62d2\u7edd\u7684\u539f\u8bed\uff0c\u4e5f\u4f1a\u5199\u5165\u8bbe\u5907\u5185\u5b58\u3002\u8fd9\u4e9b\u5199\u5165\u901a\u8fc7\u901a\u5e38\u7684\u5185\u5b58\u4e00\u81f4\u6027\u548c\u4e00\u81f4\u6027\u89c4\u5219\u5bf9\u5176\u5b83\u7ebf\u7a0b\u53ef\u89c1\uff08\u76ee\u524d\uff0c\u53ea\u6709\u539f\u5b50\u662f\u4e00\u81f4\u7684\uff0c\u5e76\u4e14\u4ec5\u652f\u6301\u5bbd\u677e\u7684\u4e00\u81f4\u6027\uff09\u3002\u5373\u4f7f\u5149\u7ebf\u4e0d\u4e0e\u56fe\u5143\u7684\u8fb9\u754c\u6846\u76f8\u4ea4\uff0c\u4e5f\u53ef\u4ee5\u8c03\u7528\u76f8\u4ea4\u51fd\u6570\u3002\u4f8b\u5982\uff0c\u5b9e\u73b0\u53ef\u4ee5\u5c06\u591a\u4e2a\u57fa\u5143\u5206\u7ec4\u5230\u4e00\u4e2a\u52a0\u901f\u7ed3\u6784\u53f6\u8282\u70b9\u4e2d\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u9762\u662f\u8fb9\u754c\u6846\u7684\u4ea4\u96c6\u51fd\u6570\u7684\u793a\u4f8b\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct IntersectionResult {\n    bool continueSearch [[continue_search]];\n    bool accept [[accept_intersection]];\n    float distance [[distance]];\n};\n\n[[intersection(bounding_box)]] IntersectionResult sphereIntersectionFunction(\n        float3 origin [[origin]],\n        float3 direction [[direction]],\n        uint primitiveIndex [[primitive_id]],\n        ray_data float2& resources [[payload]],\n        float min_distance [[min_distance]],\n        float max_distance [[max_distance]]\n) {\n    // ...\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5bf9\u8c61\u51fd\u6570\u8f93\u5165\u5c5e\u6027",children:"\u5bf9\u8c61\u51fd\u6570\u8f93\u5165\u5c5e\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 3 \u8d77"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u4ece Metal 3.1 \u5f00\u59cb\uff0c\u5168\u5c40\u53d8\u91cf\u73b0\u5728\u53ef\u4ee5\u6307\u5b9a\u8fd9\u4e9b\u5c5e\u6027\uff0c\u9664\u975e\u5728\u52a8\u6001\u5e93\u6216\u5355\u72ec\u7f16\u8bd1\u7684\u4e8c\u8fdb\u5236\u51fd\u6570\u4e2d\u4f7f\u7528\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u8c61\u51fd\u6570\u4f7f\u7528\u4e0e\u5185\u6838\u51fd\u6570\u76f8\u540c\u7684\u6267\u884c\u6a21\u578b\uff08\u53c2\u89c1\u7b2c 5.2.3.6 \u8282\uff09\uff0c\u5b83\u5728 N \u7ef4\u7ebf\u7a0b\u7f51\u683c\u4e0a\u6267\u884c\u3002\u5bf9\u8c61\u51fd\u6570\u53c2\u6570\u53ef\u4ee5\u662f ",(0,r.jsx)(n.code,{children:"samplers"}),"\u3001",(0,r.jsx)(n.code,{children:"textures"}),"\u3001",(0,r.jsx)(n.code,{children:"mesh_grid_properties"})," \u7c7b\u578b\u7684\u53c2\u6570\u4ee5\u53ca ",(0,r.jsx)(n.code,{children:"device"}),"\u3001",(0,r.jsx)(n.code,{children:"constant"})," \u548c ",(0,r.jsx)(n.code,{children:"threadgroup"})," \u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u7f13\u51b2\u533a\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u8c61\u51fd\u6570\u652f\u6301\u5185\u6838\u51fd\u6570\u7684\u5185\u7f6e\u5c5e\u6027\u7684\u5b50\u96c6\u4ee5\u53ca ",(0,r.jsx)(n.code,{children:"[[amplification_count]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[payload]]"}),"\u3002",(0,r.jsx)(n.code,{children:"[[amplification_count]]"})," \u7684\u8bed\u4e49\u4e0e\u7b2c 5.2.3.1 \u8282\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027\u4e2d\u7684\u76f8\u540c\u3002\u8868 5. 12 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a\u5bf9\u8c61\u51fd\u6570\u7684\u53c2\u6570\u6307\u5b9a\u7684\u5185\u7f6e\u5c5e\u6027\u4ee5\u53ca\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u7684\u76f8\u5e94\u6570\u636e\u7c7b\u578b\u3002\u4ece Metal 3.1 \u5f00\u59cb\uff0c\u8868 5. 12 \u4e2d\u7684\u5185\u7f6e\u5c5e\u6027\u53ef\u4ee5\u5728\u7a0b\u5e8f\u8303\u56f4\u53d8\u91cf\u4e0a\u6307\u5b9a\uff0c\u4f46 ",(0,r.jsx)(n.code,{children:"amplification_count"})," \u548c ",(0,r.jsx)(n.code,{children:"payload"})," \u9664\u5916\u3002"]}),"\n",(0,r.jsx)(d,{num:"5.12",title:"Attributes for Object Function",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["amplification_count","ushort or uint","The number of output vertices produced for each vertex instance."],["dispatch_quadgroups_per_threadgroup","ushort or uint","The quad-group execution width of a threadgroup specified at dispatch."],["dispatch_simdgroups_per_threadgroup","ushort or uint","The SIMD-group execution width of a threadgroup specified at dispatch."],["dispatch_threads_per_threadgroup","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread execution width of a threadgroup for threads specified at dispatch."],["payload","Pointer or l-value reference to User Defined T in object_data address space","The payload is data passed to the mesh shader from the object shader. The payload pointer or reference is the same for all threads in the threadgroup. The payload memory is assumed uninitialized at the entry of the object function."],["quadgroup_index_in_threadgroup","ushort or uint","The scalar index of a quad-group within a threadgroup."],["quadgroups_per_threadgroup","ushort or uint","The quad-group execution width of a threadgroup."],["simdgroup_index_in_threadgroup","ushort or uint","The scalar index of a SIMD-group within a threadgroup."],["simdgroups_per_threadgroup","ushort or uint","The SIMD-group execution width of a threadgroup."],["thread_index_in_quadgroup","ushort or uint","The scalar index of a thread within a quad-group."],["thread_index_in_simdgroup","ushort or uint","The scalar index of a thread within a SIMD-group."],["thread_index_in_threadgroup","ushort or uint","The scalar index of a thread within a threadgroup."],["thread_position_in_grid","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread\u2019s position in an N-dimensional grid of threads."],["thread_position_in_threadgroup","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread\u2019s unique position within a threadgroup"],["threadgroup_position_in_grid","ushort, ushort2, ushort3, uint, uint2, or uint3","The threadgroup\u2019s unique position within a grid."],["threadgroups_per_grid","ushort, ushort2, ushort3, uint, uint2, or uint3","The number of threadgroups in a grid."],["threads_per_grid","ushort, ushort2, ushort3, uint, uint2, or uint3","The grid size."],["threads_per_simdgroup","ushort or uint","The thread execution width of a SIMD-group."],["threads_per_threadgroup","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread execution width of a threadgroup."]]}),"\n",(0,r.jsx)(n.p,{children:"\u5bf9\u8c61\u51fd\u6570\u5c5e\u6027\u4e0e\u5185\u6838\u51fd\u6570\u5c5e\u6027\u5177\u6709\u76f8\u540c\u7684\u9650\u5236\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_position_in_grid]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_grid]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[thread_position_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threadgroup_position_in_grid]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[dispatch_threads_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[threadgroups_per_grid]]"})," \u7684\u7c7b\u578b\u5fc5\u987b\u662f\u6807\u91cf\u7c7b\u578b\u6216\u5411\u91cf\u7c7b\u578b\u3002\u5982\u679c\u5b83\u662f\u5411\u91cf\u7c7b\u578b\uff0c\u5219\u7528\u4e8e\u58f0\u660e\u8fd9\u4e9b\u53c2\u6570\u7684\u5411\u91cf\u7c7b\u578b\u7684\u7ec4\u4ef6\u6570\u91cf\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_position_in_grid]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[threads_per_grid]]"})," \u7684\u6570\u636e\u7c7b\u578b\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_position_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[dispatch_threads_per_threadgroup]]"})," \u7684\u6570\u636e\u7c7b\u578b\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c ",(0,r.jsx)(n.code,{children:"[[thread_position_in_threadgroup]]"})," \u4e3a ",(0,r.jsx)(n.code,{children:"uint"}),"\u3001",(0,r.jsx)(n.code,{children:"uint2"})," \u6216 ",(0,r.jsx)(n.code,{children:"uint3"})," \u7c7b\u578b\uff0c\u5219 ",(0,r.jsx)(n.code,{children:"[[thread_index_in_threadgroup]]"})," \u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"uint"})," \u7c7b\u578b\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u7528\u4e8e\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_index_in_simdgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_simdgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[simdgroup_index_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[simdgroups_per_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[dispatch_simdgroups_per_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[quadgroup_index_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[quadgroups_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[\u7684\u7c7b\u578bdispatch_quadgroups_per_threadgroup]]"})," \u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"ushort"})," \u6216 ",(0,r.jsx)(n.code,{children:"uint"}),"\u3002\u58f0\u660e\u8fd9\u4e9b\u5185\u7f6e\u53d8\u91cf\u7684\u7c7b\u578b\u9700\u8981\u5339\u914d\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7f51\u683c\u51fd\u6570\u8f93\u5165\u5c5e\u6027",children:"\u7f51\u683c\u51fd\u6570\u8f93\u5165\u5c5e\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 3 \u8d77"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u4ece Metal 3.1 \u5f00\u59cb\uff0c\u5168\u5c40\u53d8\u91cf\u73b0\u5728\u53ef\u4ee5\u6307\u5b9a\u8fd9\u4e9b\u5c5e\u6027\uff0c\u9664\u975e\u5b83\u4eec\u5728\u52a8\u6001\u5e93\u6216\u5355\u72ec\u7f16\u8bd1\u7684\u4e8c\u8fdb\u5236\u51fd\u6570\u4e2d\u4f7f\u7528\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u7f51\u683c\u51fd\u6570\u4f7f\u7528\u4e0e\u5185\u6838\u51fd\u6570\u76f8\u540c\u7684\u6267\u884c\u6a21\u578b\uff08\u8bf7\u53c2\u9605\u7b2c 5.2.3.6 \u8282\uff09\uff0c\u5b83\u5728 N \u7ef4\u7ebf\u7a0b\u7f51\u683c\u4e0a\u6267\u884c\u3002\u7f51\u683c\u51fd\u6570\u53c2\u6570\u53ef\u4ee5\u6765\u81ea ",(0,r.jsx)(n.code,{children:"samplers"}),"\u3001",(0,r.jsx)(n.code,{children:"textures"}),"\u3001",(0,r.jsx)(n.code,{children:"mesh<V, P, NV, NP, t>"})," \u7c7b\u578b\u7684\u53c2\u6570\u4ee5\u53ca ",(0,r.jsx)(n.code,{children:"device"})," \u548c ",(0,r.jsx)(n.code,{children:"constant"})," \u7684\u7f13\u51b2\u533a\u3002\u5982\u679c\u7f51\u683c\u51fd\u6570\u5177\u6709 ",(0,r.jsx)(n.code,{children:"mesh<V, P, NV, NP,t>"})," \u53c2\u6570\uff0c\u5219\u5b83\u6307\u5411\u8868\u793a\u8981\u5bfc\u51fa\u7684\u7f51\u683c\u7684\u5185\u5b58\u7684\u4e0d\u900f\u660e\u53e5\u67c4\u3002\u7531 ",(0,r.jsx)(n.code,{children:"mesh<V, P, NV, NP,t>"})," \u53c2\u6570\u5f15\u7528\u7684\u5e95\u5c42\u5185\u5b58\u5728\u7ed9\u5b9a\u7ebf\u7a0b\u7ec4\u7684\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7f51\u683c\u51fd\u6570\u652f\u6301\u5185\u6838\u51fd\u6570\u5185\u7f6e\u5c5e\u6027\u7684\u5b50\u96c6\u4ee5\u53ca ",(0,r.jsx)(n.code,{children:"[[amplification_count]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[payload]]"})," \u5c5e\u6027\u3002",(0,r.jsx)(n.code,{children:"[[amplification_count]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[amplification_id]]"})," \u7684\u8bed\u4e49\u4e0e\u7b2c 5.2.3.1 \u8282\u9876\u70b9\u51fd\u6570\u8f93\u5165\u5c5e\u6027\u4e2d\u7684\u76f8\u540c\u3002\u8868 5.13 \u5217\u51fa\u4e86\u53ef\u4ee5\u4e3a\u7f51\u683c\u51fd\u6570\u7684\u53c2\u6570\u6307\u5b9a\u7684\u5185\u7f6e\u5c5e\u6027\u4ee5\u53ca\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u7684\u76f8\u5e94\u6570\u636e\u7c7b\u578b\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4ece Metal 3.1 \u5f00\u59cb\uff0c\u8868 5.13 \u4e2d\u7684\u5185\u7f6e\u5c5e\u6027\u53ef\u4ee5\u5728\u7a0b\u5e8f\u8303\u56f4\u53d8\u91cf\u4e0a\u6307\u5b9a\uff0c\u4f46 ",(0,r.jsx)(n.code,{children:"amplification_count"}),"\u3001",(0,r.jsx)(n.code,{children:"amplification_id"})," \u548c ",(0,r.jsx)(n.code,{children:"payload"})," \u9664\u5916\u3002"]}),"\n",(0,r.jsx)(d,{num:"5.13",title:"Attributes for Mesh Function",headers:["Attribute","Corresponding Data Types","Description"],datasList:[["amplification_count","ushort or uint","The number of output vertices produced for each primitive instance."],["amplification_id","ushort or uint","The array index offset mappings for viewport and render target array indices, which enables routing an amplified vertex to a different viewport and render target."],["dispatch_quadgroups_per_threadgroup","ushort or uint","The quad-group execution width of a threadgroup specified at dispatch."],["dispatch_simdgroups_per_threadgroup","ushort or uint","The SIMD-group execution width of a threadgroup specified at dispatch."],["dispatch_threads_per_threa dgroup","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread execution width of a threadgroup for threads specified at dispatch."],["payload","Pointer or l-value reference to User Defined T in object_data address space. Needs to be const qualified.","The payload is data passed to the mesh shader from the object shader. The payload pointer or reference is the same for all threads in the mesh grid,. The payload memory is read-only in the mesh function."],["quadgroup_index_in_threadg roup","ushort or uint","The scalar index of a quad-group within a threadgroup."],["quadgroups_per_threadgroup","ushort or uint","The quad-group execution width of a threadgroup."],["simdgroup_index_in_threadgroup","ushort or uint","The scalar index of a SIMD-group within a threadgroup."],["simdgroups_per_threadgroup","ushort or uint","The SIMD-group execution width of a threadgroup."],["thread_index_in_quadgroup","ushort or uint","The scalar index of a thread within a quad-group."],["thread_index_in_simdgroup","ushort or uint","The scalar index of a thread within a SIMD-group."],["thread_index_in_threadgrou p","ushort or uint","The scalar index of a thread within a threadgroup."],["thread_position_in_grid","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread\u2019s position in an N-dimensional grid of threads."],["thread_position_in_threadg roup","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread\u2019s unique position within a threadgroup"],["threadgroup_position_in_grid","ushort, ushort2, ushort3, uint, uint2, or uint3","The threadgroup\u2019s unique position within a grid."],["threadgroups_per_grid","ushort, ushort2, ushort3, uint, uint2, or uint3","The number of threadgroups in a grid."],["threads_per_grid","ushort, ushort2, ushort3, uint, uint2, or uint3","The grid size."],["threads_per_simdgroup","ushort or uint","The thread execution width of a SIMD-group."],["threads_per_threadgroup","ushort, ushort2, ushort3, uint, uint2, or uint3","The thread execution width of a threadgroup."]]}),"\n",(0,r.jsx)(n.p,{children:"\u7f51\u683c\u51fd\u6570\u5c5e\u6027\u4e0e\u6838\u51fd\u6570\u5c5e\u6027\u5177\u6709\u76f8\u540c\u7684\u9650\u5236\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_position_in_grid]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_grid]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[thread_position_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threadgroup_position_in_grid]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[dispatch_threads_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[threadgroups_per_grid]]"})," \u7684\u7c7b\u578b\u5fc5\u987b\u662f\u6807\u91cf\u7c7b\u578b\u6216\u5411\u91cf\u7c7b\u578b\u3002\u5982\u679c\u5b83\u662f\u5411\u91cf\u7c7b\u578b\uff0c\u5219\u7528\u4e8e\u58f0\u660e\u8fd9\u4e9b\u53c2\u6570\u7684\u5411\u91cf\u7c7b\u578b\u7684\u7ec4\u4ef6\u6570\u91cf\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_position_in_grid]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[threads_per_grid]]"})," \u7684\u6570\u636e\u7c7b\u578b\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_position_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[dispatch_threads_per_threadgroup]]"})," \u7684\u6570\u636e\u7c7b\u578b\u9700\u8981\u5339\u914d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c ",(0,r.jsx)(n.code,{children:"[[thread_position_in_threadgroup]]"})," \u4e3a ",(0,r.jsx)(n.code,{children:"uint"}),"\u3001",(0,r.jsx)(n.code,{children:"uint2"})," \u6216 ",(0,r.jsx)(n.code,{children:"uint3"})," \u7c7b\u578b\uff0c\u5219 ",(0,r.jsx)(n.code,{children:"[[thread_index_in_threadgroup]]"})," \u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"uint"})," \u7c7b\u578b\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u7528\u4e8e\u58f0\u660e ",(0,r.jsx)(n.code,{children:"[[thread_index_in_simdgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[threads_per_simdgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[simdgroup_index_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[simdgroups_per_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[dispatch_simdgroups_per_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[quadgroup_index_in_threadgroup]]"}),"\u3001",(0,r.jsx)(n.code,{children:"[[quadgroups_per_threadgroup]]"})," \u548c ",(0,r.jsx)(n.code,{children:"[[\u7684\u7c7b\u578bdispatch_quadgroups_per_threadgroup]]"})," \u9700\u8981\u4e3a ",(0,r.jsx)(n.code,{children:"ushort"})," \u6216 ",(0,r.jsx)(n.code,{children:"uint"}),"\u3002\u58f0\u660e\u8fd9\u4e9b\u5185\u7f6e\u53d8\u91cf\u7684\u7c7b\u578b\u9700\u8981\u5339\u914d\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u8f93\u5165\u7ec4\u4ef6\u5c5e\u6027",children:"\u8f93\u5165\u7ec4\u4ef6\u5c5e\u6027"}),"\n",(0,r.jsxs)(n.p,{children:["\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u548c\u5149\u6805\u5316\u5668\u751f\u6210\u7684\u7247\u6bb5\u6210\u4e3a\u7247\u6bb5\u51fd\u6570\u7684\u6bcf\u4e2a\u7247\u6bb5\u8f93\u5165\u3002",(0,r.jsx)(n.code,{children:"[[stage_in]]"})," \u5c5e\u6027\u53ef\u4ee5\u7ec4\u5408\u6bcf\u4e2a\u7247\u6bb5\u7684\u8f93\u5165\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u9876\u70b9\u51fd\u6570\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u9876\u70b9\u548c\u5b9e\u4f8b ID \u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u9876\u70b9\u51fd\u6570\u7684\u7f13\u51b2\u533a\u8fdb\u884c\u7d22\u5f15\u6765\u8bfb\u53d6\u6bcf\u4e2a\u9876\u70b9\u7684\u8f93\u5165\u3002\u8981\u7ec4\u88c5\u6bcf\u4e2a\u9876\u70b9\u7684\u8f93\u5165\u5e76\u5c06\u5b83\u4eec\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u9876\u70b9\u51fd\u6570\uff0c\u8bf7\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[stage_in]]"})," \u5c5e\u6027\u58f0\u660e\u8f93\u5165\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5185\u6838\u51fd\u6570\u901a\u8fc7\u4f7f\u7528\u7f51\u683c\u4e2d\u7684\u7ebf\u7a0b\u4f4d\u7f6e\u6216\u7ebf\u7a0b\u7ec4 ID \u4e2d\u7684\u7ebf\u7a0b\u4f4d\u7f6e\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u5185\u6838\u51fd\u6570\u7684\u7f13\u51b2\u533a\u6216\u7eb9\u7406\u8fdb\u884c\u7d22\u5f15\u6765\u8bfb\u53d6\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u8f93\u5165\u3002\u6b64\u5916\uff0c\u8981\u5c06\u6bcf\u4e2a\u7ebf\u7a0b\u8f93\u5165\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u5185\u6838\u51fd\u6570\uff0c\u8bf7\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[stage_in]]"})," \u5c5e\u6027\u58f0\u660e\u8f93\u5165\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u53ea\u80fd\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[stage_in]]"})," \u5c5e\u6027\u58f0\u660e\u9876\u70b9\u3001\u7247\u6bb5\u6216\u6838\u51fd\u6570\u7684\u4e00\u4e2a\u53c2\u6570\u3002\u5bf9\u4e8e\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[stage_in]]"})," \u5c5e\u6027\u58f0\u660e\u7684\u7528\u6237\u5b9a\u4e49\u7ed3\u6784\uff0c\u8be5\u7ed3\u6784\u7684\u6210\u5458\u53ef\u4ee5\u662f\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6807\u91cf\u6574\u6570\u6216\u6d6e\u70b9\u503c\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u6574\u6570\u6216\u6d6e\u70b9\u503c\u5411\u91cf\u3002"}),"\n",(0,r.jsxs)(n.li,{children:["\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u7684 ",(0,r.jsx)(n.code,{children:"interpolant<T,P>"})," \u503c\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0d\u80fd\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"stage_in"})," \u5c5e\u6027\u6765\u58f0\u660e\u538b\u7f29\u5411\u91cf\u3001\u77e9\u9635\u3001\u7ed3\u6784\u3001\u4f4d\u57df\u3001\u7c7b\u578b\u5f15\u7528\u6216\u6307\u9488\u3001\u6807\u91cf\u3001\u5411\u91cf\u6216\u77e9\u9635\u6570\u7ec4\u7684\u7ed3\u6784\u6210\u5458\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u793a\u4f8b",children:"\u9876\u70b9\u51fd\u6570\u8f93\u51fa\u793a\u4f8b"}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\u5982\u4f55\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"stage_in"})," \u5c5e\u6027\u4f20\u9012\u6bcf\u4e2a\u9876\u70b9\u7684\u8f93\u5165\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct VertexOutput {\n    float4 position [[position]];\n    float4 color;\n    float2 texcoord;\n};\n\nstruct VertexInput {\n    float4 position [[attribute(0)]];\n    float3 normal   [[attribute(1)]];\n    half4 color     [[attribute(2)]];\n    half2 texcoord  [[attribute(3)]];\n};\n\nconstexpr constant uint MAX_LIGHTS = 4;\n\nstruct LightDesc {\n    uint   num_lights;\n    float4 light_position[MAX_LIGHTS];\n    float4 light_color[MAX_LIGHTS];\n    float4 light_attenuation_factors[MAX_LIGHTS];\n};\n\nconstexpr sampler s = sampler(coord::normalized,\n                              address::clamp_to_zero,\n                              filter::linear);\n\nvertex VertexOutput render_vertex(VertexInput v_in [[stage_in]],\n                                  constant float4x4& mvp_matrix [[buffer(1)]],\n                                  constant LightDesc& lights [[buffer(2)]],\n                                  uint v_id [[vertex_id]]\n) {\n    VertexOutput v_out;\n    v_out.position = v_in.position * mvp_matrix;\n    v_out.color = do_lighting(v_in.position, v_in.normal, lights);\n    ...\n    return v_out;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u793a\u4f8b",children:"\u7247\u6bb5\u51fd\u6570\u8f93\u5165\u793a\u4f8b"}),"\n",(0,r.jsxs)(n.p,{children:["5.2.3.3 \u8282\u4e2d\u7684\u793a\u4f8b\u4e4b\u524d\u4ecb\u7ecd\u4e86 ",(0,r.jsx)(n.code,{children:"process_vertex"})," \u9876\u70b9\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4e3a\u6bcf\u4e2a\u9876\u70b9\u8fd4\u56de\u4e00\u4e2a ",(0,r.jsx)(n.code,{children:"VertexOutput"})," \u7ed3\u6784\u3002\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c",(0,r.jsx)(n.code,{children:"process_vertex"})," \u7684\u8f93\u51fa\u7ecf\u8fc7\u7ba1\u9053\u5316\uff0c\u6210\u4e3a\u540d\u4e3a ",(0,r.jsx)(n.code,{children:"render_pixel"})," \u7684\u7247\u6bb5\u51fd\u6570\u7684\u8f93\u5165\uff0c\u56e0\u6b64\u7247\u6bb5\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"[[stage_in]]"})," \u5c5e\u6027\u5e76\u4f7f\u7528\u4f20\u5165\u7684 ",(0,r.jsx)(n.code,{children:"VertexOutput"})," \u7c7b\u578b\u3002\uff08\u5728 ",(0,r.jsx)(n.code,{children:"render_pixel"})," \u4e2d\uff0c",(0,r.jsx)(n.code,{children:"imgA"})," \u548c ",(0,r.jsx)(n.code,{children:"imgB"})," 2D \u7eb9\u7406\u8c03\u7528\u5185\u7f6e\u51fd\u6570 ",(0,r.jsx)(n.code,{children:"sample"}),"\uff0c\u8be5\u51fd\u6570\u5728 6.12.3 \u8282\u4e2d\u4ecb\u7ecd\uff09\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct VertexOutput2 {\n    float4 position [[position]];\n    float4 color;\n    float2 texcoord;\n};\n\nstruct VertexInputData {\n    float4 position;\n    float3 normal;\n    float2 texcoord;\n};\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5185\u6838\u51fd\u6570\u6bcf\u7ebf\u7a0b\u8f93\u5165\u793a\u4f8b",children:"\u5185\u6838\u51fd\u6570\u6bcf\u7ebf\u7a0b\u8f93\u5165\u793a\u4f8b"}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"stage_in"})," \u5c5e\u6027\u4f20\u9012\u6bcf\u7ebf\u7a0b\u8f93\u5165\u3002\u5185\u6838\u51fd\u6570\u4e2d\u7684 ",(0,r.jsx)(n.code,{children:"stage_in"})," \u5c5e\u6027\u5141\u8bb8\u4f60\u5c06\u7528\u4e8e\u58f0\u660e\u51fd\u6570\u4e2d\u6bcf\u7ebf\u7a0b\u8f93\u5165\u7684\u6570\u636e\u7c7b\u578b\u4e0e\u7528\u4e8e\u5b58\u50a8\u6bcf\u7ebf\u7a0b\u8f93\u5165\u7684\u5b9e\u9645\u6570\u636e\u7c7b\u578b\u89e3\u8026\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"struct PerThreadInput {\n    float4 a [[attribute(0)]];\n    float3 b [[attribute(1)]];\n    half4 c  [[attribute(2)]];\n    half2 d  [[attribute(3)]];\n};\n\nkernel void my_kernel(PerThreadInput thread_input [[stage_in]],\n                      ...\n                      uint t_id [[thread_position_in_grid]]\n) {\n    // ...\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},11151:(e,n,i)=>{i.d(n,{Z:()=>s,a:()=>o});var r=i(67294);const t={},d=r.createContext(t);function o(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);