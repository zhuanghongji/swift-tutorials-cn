"use strict";(self.webpackChunkswift_tutorials_cn=self.webpackChunkswift_tutorials_cn||[]).push([[8432],{3905:(n,e,a)=>{a.d(e,{Zo:()=>s,kt:()=>M});var t=a(67294);function l(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}function i(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.push.apply(a,t)}return a}function r(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(Object(a),!0).forEach((function(e){l(n,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))}))}return n}function d(n,e){if(null==n)return{};var a,t,l=function(n,e){if(null==n)return{};var a,t,l={},i=Object.keys(n);for(t=0;t<i.length;t++)a=i[t],e.indexOf(a)>=0||(l[a]=n[a]);return l}(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(t=0;t<i.length;t++)a=i[t],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(n,a)&&(l[a]=n[a])}return l}var u=t.createContext({}),o=function(n){var e=t.useContext(u),a=e;return n&&(a="function"==typeof n?n(e):r(r({},e),n)),a},s=function(n){var e=o(n.components);return t.createElement(u.Provider,{value:e},n.children)},_="mdxType",f={inlineCode:"code",wrapper:function(n){var e=n.children;return t.createElement(t.Fragment,{},e)}},m=t.forwardRef((function(n,e){var a=n.components,l=n.mdxType,i=n.originalType,u=n.parentName,s=d(n,["components","mdxType","originalType","parentName"]),_=o(a),m=l,M=_["".concat(u,".").concat(m)]||_[m]||f[m]||i;return a?t.createElement(M,r(r({ref:e},s),{},{components:a})):t.createElement(M,r({ref:e},s))}));function M(n,e){var a=arguments,l=e&&e.mdxType;if("string"==typeof n||l){var i=a.length,r=new Array(i);r[0]=m;var d={};for(var u in e)hasOwnProperty.call(e,u)&&(d[u]=e[u]);d.originalType=n,d[_]="string"==typeof n?n:l,r[1]=d;for(var o=2;o<i;o++)r[o]=a[o];return t.createElement.apply(null,r)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},96669:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>u,contentTitle:()=>r,default:()=>M,frontMatter:()=>i,metadata:()=>d,toc:()=>o});var t=a(87462),l=(a(67294),a(3905));const i={},r="\u540c\u6b65\u548c SIMD \u7ec4\u529f\u80fd",d={unversionedId:"metal-shading-language-specification/synchronization-and-simd-group-functions/index",id:"metal-shading-language-specification/synchronization-and-simd-group-functions/index",title:"\u540c\u6b65\u548c SIMD \u7ec4\u529f\u80fd",description:"\u4f60\u53ef\u4ee5\u5728\u4ee5\u4e0b\u4f4d\u7f6e\u4f7f\u7528\u540c\u6b65\u548c SIMD \u7ec4\u529f\u80fd\uff1a",source:"@site/docs/metal-shading-language-specification/synchronization-and-simd-group-functions/index.mdx",sourceDirName:"metal-shading-language-specification/synchronization-and-simd-group-functions",slug:"/metal-shading-language-specification/synchronization-and-simd-group-functions/",permalink:"/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions/",draft:!1,editUrl:"https://github.com/zhuanghongji/swift-tutorials-cn/docs/metal-shading-language-specification/synchronization-and-simd-group-functions/index.mdx",tags:[],version:"current",lastUpdatedAt:1693182484,formattedLastUpdatedAt:"2023\u5e748\u670828\u65e5",frontMatter:{},sidebar:"metalshadinglanguagespecificationSidebar",previous:{title:"\u51e0\u4f55\u51fd\u6570",permalink:"/swift-tutorials-cn/docs/metal-shading-language-specification/geometric-functions/"},next:{title:"\u56fe\u5f62\u51fd\u6570",permalink:"/swift-tutorials-cn/docs/metal-shading-language-specification/graphics-functions/"}},u={},o=[{value:"6.9.1 \u7ebf\u7a0b\u7ec4\u548c SIMD \u7ec4\u540c\u6b65\u51fd\u6570",id:"691-\u7ebf\u7a0b\u7ec4\u548c-simd-\u7ec4\u540c\u6b65\u51fd\u6570",level:2},{value:"\u8868 6.12\u3002Metal \u6807\u51c6\u5e93\u4e2d\u7684\u540c\u6b65\u8ba1\u7b97\u51fd\u6570",id:"\u8868-612metal-\u6807\u51c6\u5e93\u4e2d\u7684\u540c\u6b65\u8ba1\u7b97\u51fd\u6570",level:2},{value:"\u8868 6.13\u3002\u5c4f\u969c\u51fd\u6570\u7684\u5185\u5b58\u6807\u5fd7\u679a\u4e3e\u503c",id:"\u8868-613\u5c4f\u969c\u51fd\u6570\u7684\u5185\u5b58\u6807\u5fd7\u679a\u4e3e\u503c",level:2},{value:"6.9.2 SIMD \u7ec4\u51fd\u6570",id:"692-simd-\u7ec4\u51fd\u6570",level:2},{value:"\u8868 6.14\u3002Metal \u6807\u51c6\u5e93\u4e2d\u7684 SIMD \u7ec4\u7f6e\u6362\u51fd\u6570",id:"\u8868-614metal-\u6807\u51c6\u5e93\u4e2d\u7684-simd-\u7ec4\u7f6e\u6362\u51fd\u6570",level:2}],s=(_="OrigninalPDF",function(n){return console.warn("Component "+_+" was not imported, exported, or provided by MDXProvider as global scope"),(0,l.kt)("div",n)});var _;const f={toc:o},m="wrapper";function M(n){let{components:e,...a}=n;return(0,l.kt)(m,(0,t.Z)({},f,a,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"\u540c\u6b65\u548c-simd-\u7ec4\u529f\u80fd"},"\u540c\u6b65\u548c SIMD \u7ec4\u529f\u80fd"),(0,l.kt)(s,{title:"6.9 Synchronization and SIMD-group Functions",mdxType:"OrigninalPDF"}),(0,l.kt)("p",null,"\u4f60\u53ef\u4ee5\u5728\u4ee5\u4e0b\u4f4d\u7f6e\u4f7f\u7528\u540c\u6b65\u548c SIMD \u7ec4\u529f\u80fd\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5185\u6838\u51fd\u6570 - \u7247\u6bb5\u51fd\u6570 - \u5185\u6838\u6216\u7247\u6bb5\u51fd\u6570\u8c03\u7528\u7684\u53ef\u89c1\u51fd\u6570")),(0,l.kt)("h2",{id:"691-\u7ebf\u7a0b\u7ec4\u548c-simd-\u7ec4\u540c\u6b65\u51fd\u6570"},"6.9.1 \u7ebf\u7a0b\u7ec4\u548c SIMD \u7ec4\u540c\u6b65\u51fd\u6570"),(0,l.kt)("p",null,"\u6807\u5934\u5b9a\u4e49\u4e86\u8868 6. 12 \u4e2d\u7684\u540c\u6b65\u51fd\u6570\uff0c\u5176\u4e2d\u5217\u51fa\u4e86\u5b83\u652f\u6301\u7684\u7ebf\u7a0b\u7ec4\u548c SIMD \u7ec4\u540c\u6b65\u51fd\u6570\u3002"),(0,l.kt)("h2",{id:"\u8868-612metal-\u6807\u51c6\u5e93\u4e2d\u7684\u540c\u6b65\u8ba1\u7b97\u51fd\u6570"},"\u8868 6.12\u3002Metal \u6807\u51c6\u5e93\u4e2d\u7684\u540c\u6b65\u8ba1\u7b97\u51fd\u6570"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"\u5185\u7f6e\u7ebf\u7a0b\u7ec4\u51fd\u6570\u8bf4\u660e")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"void threadgroup_barrier(mem_flags \u6807\u5fd7)")),(0,l.kt)("p",null,"``` \u6267\u884c\u5185\u6838\u3001\u7247\u6bb5\u3001\u7f51\u683c\u6216\u5bf9\u8c61\u7684\u7ebf\u7a0b\u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u9700\u8981\u6267\u884c\u6b64\u51fd\u6570\uff0c\u7136\u540e\u4efb\u4f55\u7ebf\u7a0b\u624d\u80fd\u5728 threadgroup_barrier \u4e4b\u5916\u7ee7\u7eed\u6267\u884c\u3002````"),(0,l.kt)("p",null,"``` void simdgroup_barrier(mem_flags flags) macOS\uff1a\u81ea Metal 2 \u8d77\u3002iOS\uff1a\u81ea Metal 1 .2 \u8d77\u3002````"),(0,l.kt)("p",null,"``` SIMD \u7ec4\u4e2d\u6267\u884c\u5185\u6838\u3001\u7247\u6bb5\u3001\u7f51\u683c\u6216\u5bf9\u8c61\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u9700\u8981\u6267\u884c\u6b64\u51fd\u6570\uff0c\u7136\u540e\u4efb\u4f55\u7ebf\u7a0b\u624d\u80fd\u7ee7\u7eed\u6267\u884c\u8d85\u51fa simdgroup_barrier \u7684\u64cd\u4f5c\u3002````"),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"barrier \u51fd\u6570"),"\uff08threadgroup_barrier \u6216 simdgroup_barrier\uff09\u5145\u5f53\u6267\u884c\u548c\u5185\u5b58\u5c4f\u969c\u3002\u6267\u884c\u5185\u6838\u7684\u7ebf\u7a0b\u7ec4\uff08\u6216 SIMD \u7ec4\uff09\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u9700\u8981\u9047\u5230 threadgroup_barrier\uff08\u6216 simdgroup_barrier\uff09\u51fd\u6570\u3002"),(0,l.kt)("p",null,"\u5982\u679c threadgroup_barrier\uff08\u6216 simdgroup_barrier\uff09\u4f4d\u4e8e\u6761\u4ef6\u8bed\u53e5\u5185\uff0c\u5e76\u4e14\u4efb\u4f55\u7ebf\u7a0b\u8fdb\u5165\u6761\u4ef6\u8bed\u53e5\u5e76\u6267\u884c\u5c4f\u969c\u51fd\u6570\uff0c\u5219\u7ebf\u7a0b\u7ec4\uff08\u6216 SIMD \u7ec4\uff09\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u9700\u8981\u8f93\u5165\u6761\u4ef6\u5e76\u6267\u884c\u5c4f\u969c\u51fd\u6570\u3002"),(0,l.kt)("p",null,"\u5982\u679c threadgroup_barrier\uff08\u6216 simdgroup_barrier\uff09\u4f4d\u4e8e\u5faa\u73af\u5185\uff0c\u5219\u5bf9\u4e8e\u5faa\u73af\u7684\u6bcf\u6b21\u8fed\u4ee3\uff0c\u7ebf\u7a0b\u7ec4\uff08\u6216 SIMD \u7ec4\uff09\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u9700\u8981\u5728\u4efb\u4f55\u7ebf\u7a0b\u7ee7\u7eed\u6267\u884c\u8d85\u51fa\u5c4f\u969c\u51fd\u6570\u4e4b\u524d\u6267\u884c\u5c4f\u969c\u51fd\u6570\u3002"),(0,l.kt)("p",null,"threadgroup_barrier\uff08\u6216 simdgroup_barrier\uff09\u51fd\u6570\u8fd8\u53ef\u4ee5\u5bf9\u5185\u5b58\u6805\u680f\u8fdb\u884c\u6392\u961f\uff08\u7528\u4e8e\u8bfb\u53d6\u548c\u5199\u5165\uff09\uff0c\u4ee5\u786e\u4fdd\u5bf9\u7ebf\u7a0b\u7ec4\u6216\u8bbe\u5907\u5185\u5b58\u7684\u5185\u5b58\u64cd\u4f5c\u7684\u6b63\u786e\u987a\u5e8f\u3002"),(0,l.kt)("p",null,"\u8868 6.13 \u63cf\u8ff0\u4e86 threadgroup_barrier \u548c simdgroup_barrier \u7684 mem_flags \u53c2\u6570\u7684\u4f4d\u5b57\u6bb5\u503c\u3002mem_flags \u53c2\u6570\u786e\u4fdd\u7ebf\u7a0b\u7ec4\u6216 simdgroup\uff08\u5bf9\u4e8e threadgroup_barrier \u6216 simdgroup_barrier\uff09\u4e2d\u7684\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5185\u5b58\u987a\u5e8f\u6b63\u786e\u3002"),(0,l.kt)("h2",{id:"\u8868-613\u5c4f\u969c\u51fd\u6570\u7684\u5185\u5b58\u6807\u5fd7\u679a\u4e3e\u503c"},"\u8868 6.13\u3002\u5c4f\u969c\u51fd\u6570\u7684\u5185\u5b58\u6807\u5fd7\u679a\u4e3e\u503c"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"mem_flags \u63cf\u8ff0")),(0,l.kt)("p",null,"``` mem_none \u8be5\u6807\u5fd7\u5c06 threadgroup_barrier \u6216 simdgroup_barrier \u8bbe\u7f6e\u4e3a\u4ec5\u5145\u5f53\u6267\u884c\u5c4f\u969c\uff0c\u5e76\u4e14\u4e0d\u5e94\u7528\u5185\u5b58\u6805\u680f\u3002````"),(0,l.kt)("p",null,"``` mem_device \u8be5\u6807\u5fd7\u786e\u4fdd GPU \u6b63\u786e\u5730\u5c06\u5185\u5b58\u64cd\u4f5c\u6392\u5e8f\u5230\u7ebf\u7a0b\u7ec4\u6216 simdgroup \u4e2d\u7ebf\u7a0b\u7684\u8bbe\u5907\u5185\u5b58\u3002````"),(0,l.kt)("p",null,"``` mem_threadgroup \u8be5\u6807\u5fd7\u786e\u4fdd GPU \u6b63\u786e\u5730\u5c06\u5185\u5b58\u64cd\u4f5c\u6392\u5e8f\u5230\u7ebf\u7a0b\u7ec4\u6216 simdgroup \u4e2d\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u7ec4\u5185\u5b58\u3002````"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"}," mem_texture macOS\uff1a\u81ea Metal 1 .2 \u8d77\u3002iOS\uff1a\u4ece Metal 2 \u5f00\u59cb\u3002")),(0,l.kt)("p",null,"``` \u8be5\u6807\u5fd7\u786e\u4fdd GPU \u6b63\u786e\u5730\u5bf9\u5177\u6709 read_write \u8bbf\u95ee\u9650\u5b9a\u7b26\u7684\u7eb9\u7406\u7684\u7ebf\u7a0b\u7ec4\u6216 simdgroup \u4e2d\u7684\u7ebf\u7a0b\u7684\u7eb9\u7406\u5185\u5b58\u8fdb\u884c\u5185\u5b58\u64cd\u4f5c\u6392\u5e8f\u3002````"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"mem_threadgroup_image \u5757")),(0,l.kt)("p",null,"``` \u8be5\u6807\u5fd7\u786e\u4fdd GPU \u6b63\u786e\u5730\u5c06\u5185\u5b58\u64cd\u4f5c\u6392\u5e8f\u5230\u7ebf\u7a0b\u7ec4\u6216 simdgroup \u4e2d\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u7ec4\u56fe\u50cf\u5757\u5185\u5b58\u3002````"),(0,l.kt)("p",null,"``` mem_object_data \u8be5\u6807\u5fd7\u786e\u4fdd GPU \u6b63\u786e\u5730\u5c06\u5185\u5b58\u64cd\u4f5c\u6392\u5e8f\u5230\u7ebf\u7a0b\u7ec4\u6216 simdgroup \u4e2d\u7ebf\u7a0b\u7684 object_data \u5185\u5b58\u3002````"),(0,l.kt)("h2",{id:"692-simd-\u7ec4\u51fd\u6570"},"6.9.2 SIMD \u7ec4\u51fd\u6570"),(0,l.kt)("p",null,"\u6807\u5934\u5b9a\u4e49\u5185\u6838\u548c\u7247\u6bb5\u51fd\u6570\u7684 SIMD \u7ec4\u51fd\u6570\u3002macOS \u652f\u6301 Metal 2 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u7684 SIMD \u7ec4\u51fd\u6570\uff0ciOS \u652f\u6301\u5927\u591a\u6570"),(0,l.kt)("p",null,"SIMD \u7ec4\u5728 Metal 2.2 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u8d77\u4f5c\u7528\u3002\u8868 6. 14 \u548c\u8868 6. 15 \u5217\u51fa\u4e86 SIMD \u7ec4\u51fd\u6570\u53ca\u5176\u5728 iOS \u548c macOS \u4e2d\u7684\u53ef\u7528\u6027\u3002\u8bf7\u53c2\u9605 Metal \u529f\u80fd\u96c6\u8868\u4ee5\u786e\u5b9a\u54ea\u4e9b GPU \u652f\u6301\u6bcf\u4e2a\u8868\u3002"),(0,l.kt)("p",null,"SIMD \u7ec4\u51fd\u6570\u5141\u8bb8 SIMD \u7ec4\u4e2d\u7684\u7ebf\u7a0b\uff08\u8bf7\u53c2\u9605\u7b2c 4.4.1 \u8282\uff09\u5171\u4eab\u6570\u636e\uff0c\u800c\u65e0\u9700\u4f7f\u7528\u7ebf\u7a0b\u7ec4\u5185\u5b58\u6216\u9700\u8981\u4efb\u4f55\u540c\u6b65\u64cd\u4f5c\uff08\u4f8b\u5982\u5c4f\u969c\uff09\u3002"),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"active")," \u7ebf\u7a0b\u662f\u6b63\u5728\u6267\u884c\u7684\u7ebf\u7a0b\u3002",(0,l.kt)("em",{parentName:"p"},"\u975e\u6d3b\u52a8"),"\u7ebf\u7a0b\u662f",(0,l.kt)("em",{parentName:"p"},"\u672a"),"\u6267\u884c\u7684\u7ebf\u7a0b\u3002\u4f8b\u5982\uff0c\u7531\u4e8e\u6d41\u63a7\u5236\u6216\u4efb\u52a1\u6ca1\u6709\u8db3\u591f\u7684\u5de5\u4f5c\u6765\u586b\u5145\u7ec4\uff0c\u7ebf\u7a0b\u53ef\u80fd\u4e0d\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u3002\u7ebf\u7a0b\u53ea\u9700\u4ece SIMD \u7ec4\u4e2d\u7684\u53e6\u4e00\u4e2a\u6d3b\u52a8\u7ebf\u7a0b\u8bfb\u53d6\u6570\u636e\u3002"),(0,l.kt)("p",null,"\u8f85\u52a9\u7ebf\u7a0b\u4e5f\u53ef\u4ee5\u662f",(0,l.kt)("em",{parentName:"p"},"active"),"\u548c",(0,l.kt)("em",{parentName:"p"},"inactive"),"\u3002\u4f8b\u5982\uff0c\u5982\u679c\u8f85\u52a9\u7ebf\u7a0b\u5b8c\u6210\u6267\u884c\uff0c\u5b83\u5c06\u53d8\u4e3a\u975e\u6d3b\u52a8\u8f85\u52a9\u7ebf\u7a0b\u3002SIMD \u7ec4\u51fd\u6570\u7684\u8f85\u52a9\u7ebf\u7a0b\u53ef\u4ee5\u662f\u6d3b\u52a8\u7684\u6216\u975e\u6d3b\u52a8\u7684\u3002\u4f7f\u7528 simd_is_helper_thread() \uff08\u53c2\u89c1\u8868 6. 14 \uff09\u68c0\u67e5\u7ebf\u7a0b\u662f\u5426\u4e3a\u8f85\u52a9\u7ebf\u7a0b\u3002"),(0,l.kt)("p",null,"\u8868 6. 14 \u4f7f\u7528\u5360\u4f4d\u7b26 T \u8868\u793a\u4efb\u4f55\u6574\u6570\u6216\u6d6e\u70b9\u7c7b\u578b\u7684\u6807\u91cf\u6216\u5411\u91cf\uff0c\u4f46\u4ee5\u4e0b\u60c5\u51b5\u9664\u5916\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5e03\u5c14 - \u65e0\u6548 - size_t - ptrdiff_t")),(0,l.kt)("p",null,"\u5bf9\u4e8e\u6309\u4f4d\u8fd0\u7b97\uff0cTi \u9700\u8981\u662f\u6574\u6570\u6807\u91cf\u6216\u5411\u91cf\u3002"),(0,l.kt)("p",null,"\u6709\u5173\u4f7f\u7528 SIMD \u7ec4\u51fd\u6570\u7684\u793a\u4f8b\uff0c\u8bf7\u53c2\u9605\u8868\u540e\u7684 6.9.2.1\u3002"),(0,l.kt)("h2",{id:"\u8868-614metal-\u6807\u51c6\u5e93\u4e2d\u7684-simd-\u7ec4\u7f6e\u6362\u51fd\u6570"},"\u8868 6.14\u3002Metal \u6807\u51c6\u5e93\u4e2d\u7684 SIMD \u7ec4\u7f6e\u6362\u51fd\u6570"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"\u5185\u7f6e SIMD \u7ec4\u51fd\u6570\u8bf4\u660e")),(0,l.kt)("p",null,"``` simd_vote simd_active_threads_mask() macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002````"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",0:!0,1:!0,className:"language-\u8fd4\u56de\u4ee3\u8868\u6d3b\u52a8\u7ebf\u7a0b\u7684",metastring:"simd_vote \u63a9\u7801\u3002\u8be5\u51fd\u6570\u76f8\u5f53\u4e8e simd_ballot (true)\uff0c\u5e76\u5c06\u8868\u793a\u6d3b\u52a8\u7ebf\u7a0b\u7684\u4f4d\u8bbe\u7f6e\u4e3a 1 \uff0c\u5c06\u4e0d\u6d3b\u52a8\u7ebf\u7a0b\u7684\u4f4d\u8bbe\u7f6e\u4e3a 0 \u3002",simd_vote:!0,"\u63a9\u7801\u3002\u8be5\u51fd\u6570\u76f8\u5f53\u4e8e":!0,simd_ballot:!0,"(true)\uff0c\u5e76\u5c06\u8868\u793a\u6d3b\u52a8\u7ebf\u7a0b\u7684\u4f4d\u8bbe\u7f6e\u4e3a":!0,"\uff0c\u5c06\u4e0d\u6d3b\u52a8\u7ebf\u7a0b\u7684\u4f4d\u8bbe\u7f6e\u4e3a":!0,"\u3002":!0},"\n``` bool simd_all(bool expr) ```\n\n``` macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002````\n\n``` \u5982\u679c\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u5c06 expr \u8ba1\u7b97\u4e3a true\uff0c\u5219\u8fd4\u56de true\u3002````\n\n``` bool simd_any(bool expr) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002````\n\n`` \u5982\u679c\u81f3\u5c11\u4e00\u4e2a\u6d3b\u52a8\u7ebf\u7a0b\u5c06 Expr \u8ba1\u7b97\u4e3a true\uff0c\u5219\u8fd4\u56de true\u3002````\n\n\n\n**\u5185\u7f6eSIMD\u7ec4\u529f\u80fd\u8bf4\u660e**\n\nsimd_vote simd_ballot (\u5e03\u5c14\u8868\u8fbe\u5f0f)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u8fd4\u56de\u4e00\u4e2a\u5305\u88c5\u7c7b\u578b - \u8bf7\u53c2\u9605 simd_vote \u793a\u4f8b - \u56f4\u7ed5 SIMD \u7ec4\u4e2d expr \u4e3a true \u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u5e03\u5c14\u8868\u8fbe\u5f0f\u6c42\u503c\u7684\u4f4d\u63a9\u7801\u3002\u8be5\u51fd\u6570\u5c06\u4e0e\u4e0d\u6d3b\u52a8\u7ebf\u7a0b\u5bf9\u5e94\u7684\u4f4d\u8bbe\u7f6e\u4e3a 0\u3002````\n\nT simd_broadcast(T \u6570\u636e, ushortbroadcast_lane_id)\n\nmacOS\uff1a\u81ea Metal 2 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u4eceSIMD \u901a\u9053ID \u7b49\u4e8ebroadcast_lane_id \u7684\u7ebf\u7a0b\u5e7f\u64ad\u6570\u636e\u3002\u8be5\u89c4\u8303\u6ca1\u6709\u5b9a\u4e49\u5f53broadcast_lane_id\u4e0d\u662f\u6709\u6548\u7684SIMD\u901a\u9053ID\u6216\u8005\u5bf9\u4e8eSIMD\u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u6765\u8bf4\u4e0d\u540c\u65f6\u7684\u884c\u4e3a\u3002````\n\nT simd_broadcast_first(T \u6570\u636e)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u5c06\u6570\u636e\u4ece SIMD \u7ec4\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6d3b\u52a8\u7ebf\u7a0b\uff08\u7d22\u5f15\u6700\u5c0f\u7684\u6d3b\u52a8\u7ebf\u7a0b\uff09\u5e7f\u64ad\u5230\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\nbool simd_is_first()\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u662f\u5f53\u524d SIMD \u7ec4\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6d3b\u52a8\u7ebf\u7a0b\uff08\u7d22\u5f15\u6700\u5c0f\u7684\u6d3b\u52a8\u7ebf\u7a0b\uff09\uff0c\u5219\u8fd4\u56de true\uff1b\u5426\u5219\u4e3a\u5047\u3002````\n\nT simd_shuffle(T \u6570\u636e, ushort simd_lane_id)\n\nmacOS\uff1a\u81ea Metal 2 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u4ece SIMD \u901a\u9053 ID \u4e3a simd_lane_id \u7684\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\u3002simd_lane_id \u9700\u8981\u662f\u6709\u6548\u7684 SIMD \u901a\u9053 ID\uff0c\u4f46\u4e0d\u5fc5\u5bf9\u4e8e SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u76f8\u540c\u3002````\n\nT simd_shuffle_and_fill_down(T \u6570\u636e, T \u586b\u5145\u6570\u636e, ushort \u589e\u91cf)\n\n\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 2.4 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de data \u6216 fill_data\uff0c\u5176 SIMD \u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684 SIMD \u901a\u9053 ID \u548c\u589e\u91cf\u4e4b\u548c\u3002\u5982\u679c\u603b\u548c\u5927\u4e8e SIMD \u7ec4\u5927\u5c0f\uff0c\u5219\u8be5\u51fd\u6570\u4f1a\u5c06 fill_data \u8f83\u4f4e\u589e\u91cf\u901a\u9053\u4e2d\u7684\u503c\u590d\u5236\u5230 data \u8f83\u9ad8\u589e\u91cf\u901a\u9053\u4e2d\u3002SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002````\n\n\n\n**\u5185\u7f6eSIMD\u7ec4\u529f\u80fd\u8bf4\u660e**\n\nT simd_shuffle_and_fill_down\uff08T \u6570\u636e\uff0cT \u586b\u5145\u6570\u636e\uff0cushort \u589e\u91cf\uff0cushort \u6a21\uff09\n\n\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 2.4 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u4e2d\u8fd4\u56de\u6bcf\u4e2a\u5411\u91cf\u7684 data \u6216 fill_data\uff0c\u5176 SIMD \u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684 SIMD \u901a\u9053 ID \u548c\u589e\u91cf\u4e4b\u548c\u3002\u5982\u679c\u603b\u548c\u5927\u4e8e\u6a21\u6570\uff0c\u5219\u8be5\u51fd\u6570\u5c06\u586b\u5145\u6570\u636e\u7684\u8f83\u4f4e\u589e\u91cf\u901a\u9053\u4e2d\u7684\u503c\u590d\u5236\u5230\u6570\u636e\u7684\u8f83\u9ad8\u589e\u91cf\u901a\u9053\u4e2d\u3002SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u6a21\u53c2\u6570\u5b9a\u4e49\u5c06 SIMD \u7ec4\u5206\u5272\u4e3a\u5355\u72ec\u5411\u91cf\u7684\u5411\u91cf\u5bbd\u5ea6\u3002````\n\nT simd_shuffle_and_fill_up(T \u6570\u636e, T \u586b\u5145\u6570\u636e, ushort \u589e\u91cf)\n\n\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 2.4 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de data \u6216 fill_data\uff0c\u5176 SIMD \u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684 SIMD \u901a\u9053 ID \u51cf\u53bb delta \u7684\u5dee\u503c\u3002\u5982\u679c\u5dee\u503c\u4e3a\u8d1f\uff0c\u5219\u8be5\u64cd\u4f5c\u5c06\u503c\u4ece fill_data \u7684\u4e0a\u90e8\u589e\u91cf\u901a\u9053\u590d\u5236\u5230 data \u7684\u4e0b\u90e8\u589e\u91cf\u901a\u9053\u3002SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002````\n\nT simd_shuffle_and_fill_up\uff08T \u6570\u636e\uff0cT \u586b\u5145\u6570\u636e\uff0cushort \u589e\u91cf\uff0cushort \u6a21\u6570\uff09\n\n\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 2.4 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u4e2d\u8fd4\u56de\u6bcf\u4e2a\u5411\u91cf\u7684 data \u6216 fill_data\uff0c\u5176 SIMD \u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684 SIMD \u901a\u9053 ID \u51cf\u53bb delta \u7684\u5dee\u503c\u3002\u5982\u679c\u5dee\u503c\u4e3a\u8d1f\uff0c\u5219\u8be5\u64cd\u4f5c\u5c06\u503c\u4ece fill_data \u7684\u4e0a\u90e8\u589e\u91cf\u901a\u9053\u590d\u5236\u5230 data \u7684\u4e0b\u90e8\u589e\u91cf\u901a\u9053\u3002SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u6a21\u53c2\u6570\u5b9a\u4e49\u5c06 SIMD \u7ec4\u5206\u5272\u4e3a\u5355\u72ec\u5411\u91cf\u7684\u5411\u91cf\u5bbd\u5ea6\u3002````\n\nT simd_shuffle_down(T \u6570\u636e\uff0cushort \u589e\u91cf)\n\nmacOS\uff1a\u81ea Metal 2 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684 SIMD \u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684 SIMD \u901a\u9053 ID \u548c\u589e\u91cf\u4e4b\u548c\u3002SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u6b64\u51fd\u6570\u4e0d\u4f1a\u4fee\u6539\u6570\u636e\u7684\u4e0a\u589e\u91cf\u901a\u9053\uff0c\u56e0\u4e3a\u5b83\u4e0d\u4f1a\u5c06\u503c\u5305\u88c5\u5728 SIMD \u7ec4\u5468\u56f4\u3002````\n\n\n\n**\u5185\u7f6eSIMD\u7ec4\u529f\u80fd\u8bf4\u660e**\n\nT simd_shuffle_rotate_down(T \u6570\u636e\uff0cushort \u589e\u91cf)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684 SIMD \u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684 SIMD \u901a\u9053 ID \u548c\u589e\u91cf\u4e4b\u548c\u3002SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u8be5\u51fd\u6570\u5c06\u503c\u5305\u88c5\u5728 SIMD \u7ec4\u5468\u56f4\u3002````\n\nT simd_shuffle_rotate_up(T \u6570\u636e\uff0cushort \u589e\u91cf)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684 SIMD \u901a\u9053 ID \u4e0e\u8c03\u7528\u65b9\u7684 SIMD \u901a\u9053 ID \u51cf\u53bb delta \u7684\u5dee\u503c\u3002SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u8be5\u51fd\u6570\u5c06\u503c\u5305\u88c5\u5728 SIMD \u7ec4\u5468\u56f4\u3002````\n\nT simd_shuffle_up(T \u6570\u636e\uff0cushort \u589e\u91cf)\n\nmacOS\uff1a\u81ea Metal 2 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684 SIMD \u901a\u9053 ID \u4e0e\u8c03\u7528\u65b9\u7684 SIMD \u901a\u9053 ID \u51cf\u53bb delta \u7684\u5dee\u503c\u3002SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u6b64\u51fd\u6570\u4e0d\u4f1a\u4fee\u6539\u6570\u636e\u7684\u8f83\u4f4e\u589e\u91cf\u901a\u9053\uff0c\u56e0\u4e3a\u5b83\u4e0d\u4f1a\u5c06\u503c\u5305\u88c5\u5728 SIMD \u7ec4\u5468\u56f4\u3002````\n\nTi simd_shuffle_xor(Ti \u503c\uff0cushort \u63a9\u7801)\n\nmacOS\uff1a\u81ea Metal 2 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684 SIMD \u901a\u9053 ID \u7b49\u4e8e\u8c03\u7528\u8005\u7684 SIMD \u901a\u9053 ID \u548c\u63a9\u7801\u7684\u6309\u4f4d\u5f02\u6216 (^)\u3002SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u7684\u63a9\u7801\u503c\u5fc5\u987b\u76f8\u540c\u3002````\n\n## \u8868 6.15\u3002Metal \u6807\u51c6\u5e93\u4e2d\u7684 SIMD \u7ec4\u5f52\u7ea6\u51fd\u6570\n\n**\u5185\u7f6eSIMD\u7ec4\u529f\u80fd\u8bf4\u660e**\n\n Ti simd_and(Ti \u6570\u636e)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002\n\n``` \u8fd4\u56de SIMD \u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u6309\u4f4d AND (&)\uff0c\u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230 SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n\n\n**\u5185\u7f6eSIMD\u7ec4\u529f\u80fd\u8bf4\u660e**\n\nbool simd_is_helper_thread()\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002\n\n``` \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u662f\u8f85\u52a9\u7ebf\u7a0b\uff0c\u5219\u8fd4\u56de true\uff1b\u5426\u5219\u4e3a\u5047\u3002\u4f60\u9700\u8981\u4ece\u7247\u6bb5\u51fd\u6570\u6216\u7247\u6bb5\u51fd\u6570\u8c03\u7528\u7684\u53e6\u4e00\u4e2a\u51fd\u6570\u4e2d\u8c03\u7528\u6b64\u51fd\u6570\uff1b\u5426\u5219\uff0c\u53ef\u80fd\u4f1a\u5f15\u53d1\u7f16\u8bd1\u65f6\u9519\u8bef\u3002````\n\n T simd_max(T \u6570\u636e)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002\n\n``` \u8fd4\u56de SIMD \u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e2d\u5177\u6709\u6700\u9ad8\u503c\u7684\u6570\u636e\uff0c\u5e76\u5c06\u8be5\u503c\u5e7f\u64ad\u5230 SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n T simd_min(T \u6570\u636e)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002\n\n``` \u8fd4\u56de SIMD \u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e2d\u6700\u4f4e\u503c\u7684\u6570\u636e\uff0c\u5e76\u5c06\u8be5\u503c\u5e7f\u64ad\u5230 SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n Ti simd_or(Ti \u6570\u636e)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002\n\n``` \u8fd4\u56de SIMD \u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e4b\u95f4\u6570\u636e\u7684\u6309\u4f4d OR (|)\uff0c\u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230 SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\nT simd_prefix_exclusive_product\uff08T \u6570\u636e\uff09\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002\n\n``` \u5bf9\u4e8e\u7ed9\u5b9a\u7ebf\u7a0b\uff0c\u8fd4\u56de SIMD \u7ec4\u4e2d\u7d22\u5f15\u8f83\u4f4e\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u7684\u4e58\u79ef\u3002\u7ec4\u4e2d\u7684\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u8fd4\u56de T(1)\u3002````\n\nT simd_prefix_exclusive_sum\uff08T \u6570\u636e\uff09\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002\n\n``` \u5bf9\u4e8e\u7ed9\u5b9a\u7ebf\u7a0b\uff0c\u8fd4\u56de SIMD \u7ec4\u4e2d\u7d22\u5f15\u8f83\u4f4e\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u4e4b\u548c\u3002\u7ec4\u4e2d\u7684\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u8fd4\u56de T(0)\u3002````\n\nT simd_prefix_inclusive_product\uff08T \u6570\u636e\uff09\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002\n\n``` \u5bf9\u4e8e\u7ed9\u5b9a\u7ebf\u7a0b\uff0c\u8fd4\u56de SIMD \u7ec4\u4e2d\u5177\u6709\u8f83\u4f4e\u6216\u76f8\u540c\u7d22\u5f15\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u7684\u4e58\u79ef\u3002````\n\nT simd_prefix_inclusive_sum\uff08T \u6570\u636e\uff09\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002\n\n``` \u5bf9\u4e8e\u7ed9\u5b9a\u7ebf\u7a0b\uff0c\u8fd4\u56de SIMD \u7ec4\u4e2d\u5177\u6709\u8f83\u4f4e\u6216\u76f8\u540c\u7d22\u5f15\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u4e4b\u548c\u3002````\n\n\n\n``\u5185\u7f6e SIMD \u7ec4\u51fd\u6570\u8bf4\u660e``\n\n``` T simd_product(T data) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002````\n\n``` \u8fd4\u56de SIMD \u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u7684\u4e58\u79ef\uff0c\u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230 SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n``` T simd_sum(T data) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002````\n\n``` \u8fd4\u56de SIMD \u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u4e4b\u548c\uff0c\u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230 SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n``` Ti simd_xor(Ti \u6570\u636e) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3 \u8d77\u3002````\n\n``` \u8fd4\u56de SIMD \u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e4b\u95f4\u6570\u636e\u7684\u6309\u4f4d\u5f02\u6216 (^)\uff0c\u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230 SIMD \u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n ## 6.9.2.1 \u793a\u4f8b\n\n\u4e3a\u4e86\u6f14\u793a\u968f\u673a\u64ad\u653e\u529f\u80fd\uff0c\u8bf7\u4ece\u8be5 SIMD \u7ec4\u7684\u521d\u59cb\u72b6\u6001\u5f00\u59cb\uff1a\n\n``SIMD \u901a\u9053 ID 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15``\n\n``` \u6570\u636e a b c d e f g h i j K l m nop ```\n\nsimd_shuffle_up() \u51fd\u6570\u5c06\u6bcf\u4e2a SIMD \u7ec4\u5411\u4e0a\u79fb\u52a8\u589e\u91cf\u7ebf\u7a0b\u3002\u4f8b\u5982\uff0c\u5f53 delta \u503c\u4e3a 2 \u65f6\uff0c\u51fd\u6570\uff1a\n\n- \u5c06 SIMD \u901a\u9053 ID \u4e0b\u79fb\u4e24\u4f4d - \u5c06\u4e0b\u9762\u7684\u4e24\u4e2a\u901a\u9053\u6807\u8bb0\u4e3a\u65e0\u6548\n\n``` \u8ba1\u7b97\u7684 SIMD \u901a\u9053 ID - 2 - 1 0 1 2 3 4 5 6 7 8 9 10 11 12 13 ```\n\n``` \u6709\u6548 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 ```\n\n``` \u6570\u636e a b a b c d e f g h i j k l m n ```\n\nsimd_shuffle_up() \u51fd\u6570\u662f\u4e00\u79cd\u975e\u5305\u88c5\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u5f71\u54cd\u8f83\u4f4e\u7684\u589e\u91cf\u901a\u9053\u3002\n\n\u7c7b\u4f3c\u5730\uff0csimd_shuffle_down() \u51fd\u6570\u5c06\u6bcf\u4e2a SIMD \u7ec4\u5411\u4e0b\u79fb\u52a8\u589e\u91cf\u7ebf\u7a0b\u3002\u4ece\u76f8\u540c\u7684\u521d\u59cb SIMD \u7ec4\u72b6\u6001\u5f00\u59cb\uff0c\u589e\u91cf\u503c\u4e3a 2 \uff0c\u8be5\u51fd\u6570\uff1a\n\n- \u5c06 SIMD \u901a\u9053 ID \u5411\u4e0a\u79fb\u52a8\u4e24\u4f4d - \u5c06\u4e0a\u9762\u7684\u4e24\u4e2a\u901a\u9053\u6807\u8bb0\u4e3a\u65e0\u6548\n\n``` \u8ba1\u7b97\u7684 SIMD \u901a\u9053 ID 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ```\n\n``` \u6709\u6548 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 ```\n\n``\u6570\u636e c def g h i j k l m no pop ``\n\n\n\nsimd_shuffle_down() \u51fd\u6570\u662f\u4e00\u79cd\u975e\u5305\u88c5\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u5f71\u54cd\u4e0a\u589e\u91cf\u901a\u9053\u3002\n\n\u4e3a\u4e86\u6f14\u793a shuffle-and-fill \u51fd\u6570\uff0c\u542f\u52a8\u8be5 SIMD \u7ec4\u7684\u521d\u59cb\u72b6\u6001\uff1a\n\n``SIMD \u901a\u9053 ID 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15``\n\n``` \u6570\u636e a b c d e f g h s t u v w x y z ```\n\n``` \u586b\u5145 fa fb fc fd fe ff fg fh fs ft fu fv fw fx fy fz ```\n\nsimd_shuffle_and_fill_up() \u51fd\u6570\u901a\u8fc7\u589e\u91cf\u7ebf\u7a0b\u5411\u4e0a\u79fb\u52a8\u6bcf\u4e2a SIMD \u7ec4\uff08\u7c7b\u4f3c\u4e8e simd_shuffle_up()\uff09\uff0c\u5e76\u901a\u8fc7\u5305\u88c5 SIMD \u901a\u9053 ID \u5c06\u4e0a\u586b\u5145\u901a\u9053\u7684\u503c\u5206\u914d\u7ed9\u4e0b\u6570\u636e\u901a\u9053\u3002\u4f8b\u5982\uff0c\u5f53 delta \u503c\u4e3a 2 \u65f6\uff0c\u51fd\u6570\uff1a\n\n- \u5c06 SIMD \u901a\u9053 ID \u4e0b\u79fb\u4e24\u4f4d - \u5c06\u4e0a\u9762\u4e24\u4e2a\u586b\u5145\u901a\u9053\u5206\u914d\u7ed9\u4e0b\u9762\u4e24\u4e2a\u6570\u636e\u901a\u9053\n\n``` \u8ba1\u7b97\u7684 SIMD \u901a\u9053 ID - 2 - 1 0 1 2 3 4 5 6 7 8 9 10 11 12 13 ```\n\n``` \u6570\u636e fy fz a b c d e f g h s t u v w x ```\n\n\u5e26\u6709\u6a21\u53c2\u6570\u7684 simd_shuffle_and_fill_up() \u51fd\u6570\u5c06 SIMD \u7ec4\u62c6\u5206\u4e3a\u5411\u91cf\uff0c\u6bcf\u4e2a\u5411\u91cf\u7684\u5927\u5c0f\u5747\u4ee5\u6a21\u4e3a\u6a21\uff0c\u5e76\u6309\u589e\u91cf\u7ebf\u7a0b\u79fb\u4f4d\u6bcf\u4e2a\u5411\u91cf\u3002\u4f8b\u5982\uff0c\u6a21\u503c\u4e3a 8 \u4e14\u589e\u91cf\u503c\u4e3a 2 \u65f6\uff0c\u51fd\u6570\uff1a\n\n- \u5c06 SIMD \u901a\u9053 ID \u4e0b\u79fb\u4e24\u4f4d - \u5c06\u586b\u5145\u4e2d\u6bcf\u4e2a\u5411\u91cf\u7684\u4e0a\u9762\u4e24\u4e2a\u901a\u9053\u5206\u914d\u7ed9\u6570\u636e\u4e2d\u6bcf\u4e2a\u5411\u91cf\u7684\u4e0b\u9762\u4e24\u4e2a\u901a\u9053\n\n``` \u8ba1\u7b97\u7684 SIMD \u901a\u9053 ID - 2 - 1 0 1 2 3 4 5 - 2 - 1 0 1 2 3 4 5 ```\n\n``` \u6570\u636e fg fh a b c d e f fy fz s t u v w x ```\n\nsimd_shuffle_and_fill_down() \u51fd\u6570\u901a\u8fc7\u589e\u91cf\u7ebf\u7a0b\u5411\u4e0b\u79fb\u52a8\u6bcf\u4e2a SIMD \u7ec4\uff08\u7c7b\u4f3c\u4e8e simd_shuffle_down()\uff09\uff0c\u5e76\u901a\u8fc7\u5305\u88c5 SIMD \u901a\u9053 ID \u5c06\u8f83\u4f4e\u586b\u5145\u901a\u9053\u4e2d\u7684\u503c\u5206\u914d\u7ed9\u8f83\u9ad8\u6570\u636e\u901a\u9053\u3002\u4f8b\u5982\uff0c\u5f53 delta \u503c\u4e3a 2 \u65f6\uff0c\u51fd\u6570\uff1a\n\n- \u5c06 SIMD \u901a\u9053 ID \u4e0a\u79fb\u4e24\u4f4d - \u5c06\u4e0b\u9762\u4e24\u4e2a\u586b\u5145\u901a\u9053\u5206\u914d\u7ed9\u4e0a\u9762\u4e24\u4e2a\u6570\u636e\u901a\u9053\n\n``` \u8ba1\u7b97\u7684 SIMD \u901a\u9053 ID 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ```\n\n``` \u6570\u636e c def g h s t u v w x y z fa fb ```\n\n\u5e26\u6709\u6a21\u53c2\u6570\u7684 simd_shuffle_and_fill_down() \u51fd\u6570\u5c06 SIMD \u7ec4\u62c6\u5206\u4e3a\u5411\u91cf\uff0c\u6bcf\u4e2a\u5411\u91cf\u7684\u5927\u5c0f\u5747\u4ee5\u6a21\u4e3a\u6a21\uff0c\u5e76\u6309\u589e\u91cf\u7ebf\u7a0b\u79fb\u4f4d\u6bcf\u4e2a\u5411\u91cf\u3002\u4f8b\u5982\uff0c\u6a21\u503c\u4e3a 8 \u4e14\u589e\u91cf\u503c\u4e3a 2 \u65f6\uff0c\u51fd\u6570\uff1a\n\n- \u5c06 SIMD \u901a\u9053 ID \u5411\u4e0a\u79fb\u52a8\u4e24\u4f4d\n\n\n\n- \u5c06\u586b\u5145\u4e2d\u6bcf\u4e2a\u5411\u91cf\u7684\u4e0b\u4e24\u4e2a\u6cf3\u9053\u5206\u914d\u7ed9\u6570\u636e\u4e2d\u6bcf\u4e2a\u5411\u91cf\u7684\u4e0a\u4e24\u4e2a\u6cf3\u9053\n\n``` \u8ba1\u7b97\u7684 SIMD \u901a\u9053 ID 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ```\n\n``` \u6570\u636e c def g h fa fb u v w x y z fs ft ```\n\n\u4e0b\u9762\u662f\u5982\u4f55\u4f7f\u7528\u8fd9\u4e9b SIMD \u51fd\u6570\u6267\u884c\u5f52\u7ea6\u64cd\u4f5c\u7684\u793a\u4f8b\uff1a\n\nkernel void reduce(const device int *input [[buffer(0)]], deviceatomic_int *output [[buffer(1)]], threadgroup int \\*ldata [[threadgroup(0)]], uint gid [[thread_position_in_grid ]], uint lit [[thread_position_in_threadgroup]], uint lsize [[threads_per_threadgroup]], uint simd_size [[threads_per_simdgroup]], uint simd_lane_id [[thread_index_in_simdgroup]], uint simd_group_id [[simdgroup_index_in_threadgroup]]) { // \u6267\u884c\u7b2c\u4e00\u7ea7\u7684\u51cf\u5c11\u3002// \u4ece\u8bbe\u5907\u5185\u5b58\u8bfb\u53d6\uff0c\u5199\u5165\u7ebf\u7a0b\u7ec4\u5185\u5b58\u3002int val = \u8f93\u5165[gid] + \u8f93\u5165[gid + lsize]; for (uint s=lsize/simd_size; s>simd_size; s/=simd_size) { // \u6267\u884c\u6bcf\u4e2a SIMD \u90e8\u5206\u7f29\u51cf\u3002for (uint offset=simd_size/2; offset>0; offset/=2) val += simd_shuffle_down(val, offset); // \u5c06\u6bcf\u4e2a SIMD \u90e8\u5206\u7f29\u51cf\u503c\u5199\u5165\u7ebf\u7a0b\u7ec4\u5185\u5b58\u3002if (simd_lane_id == 0) ldata[simd_group_id] = val; // \u7b49\u5f85\u6240\u6709\u90e8\u5206\u5f52\u7ea6\u5b8c\u6210\u3002threadgroup_barrier(mem_flags::mem_threadgroup);\n\nval = (\u76d6\u5b50 < s)? ldata[\u76d6\u5b50]\uff1a0\uff1b } // \u6267\u884c\u6700\u7ec8\u7684\u6bcfSIMD \u90e8\u5206\u7f29\u51cf\u6765\u8ba1\u7b97 // \u7ebf\u7a0b\u7ec4\u90e8\u5206\u7f29\u51cf\u7ed3\u679c\u3002for (uint offset=simd_size/2; offset>0; offset/=2) val += simd_shuffle_down(val, offset); // \u539f\u5b50\u66f4\u65b0\u5f52\u7ea6\u7ed3\u679c\u3002if (lid == 0)atomic_fetch_add_explicit(\u8f93\u51fa, val, memory_order_relaxed); }\n\n\n\nsimd_active_threads_mask \u548c simd_ballot \u51fd\u6570\u4f7f\u7528 simd_vote \u5305\u88c5\u7c7b\u578b\uff08\u89c1\u4e0b\u6587\uff09\uff0c\u5b83\u53ef\u4ee5\u663e\u5f0f\u8f6c\u6362\u4e3a\u5176\u7531 vote_t \u8868\u793a\u7684\u57fa\u7840\u7c7b\u578b\u3002\n\n\u7c7b simd_vote { \u516c\u5171\uff1a\u663e\u5f0f constexpr simd_vote(vote_t v = 0);\u663e\u5f0f constexpr \u8fd0\u7b97\u7b26 vote_t() const;\n\n// \u5982\u679c\u4e0e SIMD \u7ec4\u4e2d\u7684\u7ebf\u7a0b\u5bf9\u5e94\u7684\u6240\u6709\u4f4d\u5747\u5df2\u8bbe\u7f6e\uff0c\u5219\u8fd4\u56de true\u3002// \u4f60\u53ef\u4ee5\u4f7f\u7528 all() \u548c simd_ballot(expr) \u7684\u8fd4\u56de\u503c\u6765\u786e\u5b9a\u662f\u5426\u6240\u6709\u7ebf\u7a0b\u90fd\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u3002bool all() const;\n\n// \u5982\u679c\u8bbe\u7f6e\u4e86\u4e0e SIMD \u7ec4\u4e2d\u7684\u6709\u6548\u7ebf\u7a0b\u5bf9\u5e94\u7684\u4efb\u4f55\u4f4d\uff0c\u5219\u8fd4\u56de true\u3002// \u4f60\u53ef\u4ee5\u4f7f\u7528any() \u4e0esimd_ballot(expr) \u7684\u8fd4\u56de\u503c // \u6765\u786e\u5b9a\u662f\u5426\u81f3\u5c11\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u3002\u5e03\u5c14\u4efb\u4f55\uff08\uff09\u5e38\u91cf\uff1b\n\nprivate: // v \u4e2d\u7684\u4f4d i \u4ee3\u8868 // SIMD \u7ec4\u4e2d\u7d22\u5f15 i \u5904\u7ebf\u7a0b\u7684\u201c\u6295\u7968\u201d uint64_t v; };\n\n\u8bf7\u6ce8\u610f\uff0csimd_all(expr) \u4e0e simd_ballot(expr).all() \u4e0d\u540c\uff1a\n\n- \u5982\u679c\u6240\u6709 \\_active* \u7ebf\u7a0b\u5c06 expr \u8ba1\u7b97\u4e3a true\uff0c\u5219 simd*all(expr) \u8fd4\u56de true\u3002- \u5982\u679c\u6240\u6709\u7ebf\u7a0b \\_were* \u90fd\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u5e76\u4e14\u5c06 expr \u8ba1\u7b97\u4e3a true\uff0c\u5219 simd*ballot(expr).all() \u8fd4\u56de true\u3002\uff08simd_vote::all() \u4e0d\u4f1a\u67e5\u770b\u54ea\u4e9b\u7ebf\u7a0b\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u3002\uff09\n\n\u76f8\u540c\u7684\u903b\u8f91\u9002\u7528\u4e8e simd_any\u3001simd_vote::any() \u4ee5\u53ca\u7b2c 6.9.3 \u8282\u4e2d\u5217\u51fa\u7684\u7b49\u6548\u56db\u5143\u51fd\u6570\u3002\n\n\u5728 SIMD \u7ec4\u4e2d\u7ebf\u7a0b\u5c11\u4e8e 64 \u4e2a\u7684\u786c\u4ef6\u4e0a\uff0csimd_vote \u4e2d\u6700\u9ad8\u4f4d\u7684\u503c\u672a\u5b9a\u4e49\u3002\u7279\u522b\u662f\uff0c\u7531\u4e8e\u4f60\u53ef\u4ee5\u521d\u59cb\u5316\u8fd9\u4e9b\u4f4d\uff0c\u56e0\u6b64\u4e0d\u8981\u5047\u8bbe\u6700\u9ad8\u4f4d\u8bbe\u7f6e\u4e3a 0\u3002\n\n## 6.9.3 \u56db\u7ec4\u51fd\u6570\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u652f\u6301\u56db\u7ec4\u51fd\u6570\u3002\n\niOS\uff1a\u81ea Metal 2 \u8d77\u652f\u6301\u4e00\u4e9b\u56db\u7ec4\u51fd\u6570\uff0c\u5305\u62ecquad_broadcast\u3001quad_shuffle\u3001quad_shuffle_up\u3001quad_shuffle_down \u548cquad_shuffle_xor\u3002\n\n\u56db\u7ec4\u51fd\u6570\u662f\u4e00\u4e2a SIMD \u7ec4\u51fd\u6570\uff08\u53c2\u89c1\u7b2c 6.9.2 \u8282\uff09\uff0c\u6267\u884c\u5bbd\u5ea6\u4e3a\n\n4. _active_ \u548c _inactive_ \u7ebf\u7a0b\u672f\u8bed\u4e0e\u7b2c 6.9.2 \u8282\u4e2d\u7684\u76f8\u540c\u3002\n\n\n\n\u8f85\u52a9\u7ebf\u7a0b\u4ec5\u6267\u884c\u4ee5\u8ba1\u7b97\u7247\u6bb5\u7740\u8272\u5668\u4e2d\u56db\u7ec4\u7684\u68af\u5ea6\uff0c\u7136\u540e\u53d8\u4e3a\u975e\u6d3b\u52a8\u72b6\u6001\u3002\n\n\u5185\u6838\u548c\u7247\u6bb5\u51fd\u6570\u53ef\u4ee5\u8c03\u7528\u8868 6. 16 \u548c\u8868 6. 17 \u4e2d\u5217\u51fa\u7684\u56db\u5143\u7ec4\u51fd\u6570\u3002\u7ebf\u7a0b\u53ea\u80fd\u4ece\u56db\u5143\u7ec4\u4e2d\u7684\u53e6\u4e00\u4e2a\u6d3b\u52a8\u7ebf\u7a0b\u8bfb\u53d6\u6570\u636e\u3002\u8bf7\u53c2\u9605 Metal \u529f\u80fd\u96c6\u8868\u4ee5\u786e\u5b9a\u54ea\u4e9b GPU \u652f\u6301\u6bcf\u4e2a\u8868\u3002\n\n\u8868 6. 16 \u548c\u8868 6. 17 \u7684\u5360\u4f4d\u7b26 T \u8868\u793a\u4efb\u4f55\u6574\u6570\u6216\u6d6e\u70b9\u7c7b\u578b\u7684\u6807\u91cf\u6216\u5411\u91cf\uff0c\u4f46\u4ee5\u4e0b\u60c5\u51b5\u9664\u5916\uff1a\n\n- \u5e03\u5c14 - \u65e0\u6548 - size_t - ptrdiff_t\n\n\u5bf9\u4e8e\u6309\u4f4d\u8fd0\u7b97\uff0cT \u9700\u8981\u662f\u6574\u6570\u6807\u91cf\u6216\u5411\u91cf\u3002\n\n## \u8868 6.16\u3002Metal \u6807\u51c6\u5e93\u4e2d\u7684\u56db\u7ec4\u7f6e\u6362\u51fd\u6570\n\n```` \u5185\u7f6e\u56db\u7ec4\u529f\u80fd\u8bf4\u660e````\n\n```quad_votequad_ballot (bool expr) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002````\n\n``` \u8fd4\u56de\u4e00\u4e2a\u5305\u88c5\u5668\u7c7b\u578b - \u8bf7\u53c2\u9605quad_vote \u793a\u4f8b - \u56f4\u7ed5\u56db\u5143\u7ec4\u4e2d expr \u4e3a true \u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u5e03\u5c14\u8868\u8fbe\u5f0f\u6c42\u503c\u7684\u4f4d\u63a9\u7801\u3002\u8be5\u51fd\u6570\u5c06\u4e0e\u4e0d\u6d3b\u52a8\u7ebf\u7a0b\u5bf9\u5e94\u7684\u4f4d\u8bbe\u7f6e\u4e3a 0\u3002````\n\n``` Tquad_broadcast(T data, ushortbroadcast_lane_id) macOS\uff1a\u81ea Metal 2 \u4ee5\u6765\u3002iOS\uff1a\u81ea Metal 2 \u4ee5\u6765\u3002```\n\n``` \u4ece\u56db\u901a\u9053 ID \u4e3abroadcast_lane_id \u7684\u7ebf\u7a0b\u5e7f\u64ad\u6570\u636e\u3002Broadcast_lane_id \u7684\u503c\u5fc5\u987b\u662f\u6709\u6548\u7684\u56db\u901a\u9053 ID\uff0c\u8be5 ID \u5bf9\u4e8e\u56db\u7ec4\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u76f8\u540c\u3002````\n\n``` Tquad_broadcast_first(T data) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2 \u8d77\u3002````\n\n``` \u5c06\u6570\u636e\u4ece\u56db\u5143\u7ec4\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6d3b\u52a8\u7ebf\u7a0b\uff08\u7d22\u5f15\u6700\u5c0f\u7684\u6d3b\u52a8\u7ebf\u7a0b\uff09\u5e7f\u64ad\u5230\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n``` Tquad_shuffle(T data, ushortquad_lane_id) macOS\uff1a\u81ea Metal 2 \u4ee5\u6765\u3002iOS\uff1a\u81ea Metal 2 \u4ee5\u6765\u3002```\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684\u56db\u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684\u56db\u901a\u9053 ID \u548c\u589e\u91cf\u4e4b\u548c\u3002Quad_lane_id \u7684\u503c\u5fc5\u987b\u662f\u6709\u6548\u7684 Land ID\uff0c\u5e76\u4e14\u53ef\u80fd\u4e0e\u56db\u5143\u7ec4\u4e2d\u7684\u5176\u4ed6\u7ebf\u7a0b\u4e0d\u540c\u3002````\n\n\n\n**\u5185\u7f6e\u56db\u7ec4\u529f\u80fd\u8bf4\u660e**\n\nTquad_shuffle_and_fill_down\uff08T\u6570\u636e\uff0cT\u586b\u5145\u6570\u636e\uff0cushort\u589e\u91cf\uff09\n\n\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 2. 4.\n\n``` \u4ece\u56db\u901a\u9053 ID \u4e3a\u8c03\u7528\u8005\u7684\u56db\u901a\u9053 ID \u548c\u589e\u91cf\u4e4b\u548c\u7684\u7ebf\u7a0b\u8fd4\u56de data \u6216 fill_data\u3002\u5982\u679c\u603b\u548c\u5927\u4e8e\u56db\u5143\u7ec4\u5927\u5c0f\uff0c\u5219\u8be5\u51fd\u6570\u5c06\u586b\u5145_data \u7684\u8f83\u4f4e\u589e\u91cf\u901a\u9053\u4e2d\u7684\u503c\u590d\u5236\u5230\u6570\u636e\u7684\u8f83\u9ad8\u589e\u91cf\u901a\u9053\u4e2d\u3002\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002````\n\nTquad_shuffle_and_fill_down\uff08T\u6570\u636e\uff0cT\u586b\u5145\u6570\u636e\uff0cushort\u589e\u91cf\uff0cushort\u6a21\u6570\uff09\n\n\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 2. 4.\n\n``` \u4ece\u56db\u901a\u9053 ID \u4e3a\u8c03\u7528\u8005\u56db\u901a\u9053 ID \u548c\u589e\u91cf\u4e4b\u548c\u7684\u7ebf\u7a0b\u8fd4\u56de\u6bcf\u4e2a\u5411\u91cf\u7684 data \u6216 fill_data\u3002\u5982\u679c\u603b\u548c\u5927\u4e8e\u56db\u5143\u7ec4\u5927\u5c0f\uff0c\u5219\u8be5\u51fd\u6570\u5c06\u586b\u5145_data \u7684\u8f83\u4f4e\u589e\u91cf\u901a\u9053\u4e2d\u7684\u503c\u590d\u5236\u5230\u6570\u636e\u7684\u8f83\u9ad8\u589e\u91cf\u901a\u9053\u4e2d\u3002\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u6a21\u53c2\u6570\u5b9a\u4e49\u5c06\u56db\u5143\u7ec4\u5206\u5272\u6210\u5355\u72ec\u5411\u91cf\u7684\u5411\u91cf\u5bbd\u5ea6\u3002````\n\nTquad_shuffle_and_fill_up\uff08T\u6570\u636e\uff0cT\u586b\u5145\u6570\u636e\uff0cushort\u589e\u91cf\uff09\n\n\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 2. 4.\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de data \u6216 fill_data\uff0c\u5176\u56db\u901a\u9053 ID \u4e0e\u8c03\u7528\u8005\u7684\u56db\u901a\u9053 ID \u51cf\u53bb delta \u7684\u5dee\u503c\u3002\u5982\u679c\u5dee\u503c\u4e3a\u8d1f\uff0c\u5219\u8be5\u64cd\u4f5c\u5c06\u503c\u4ece fill_data \u7684\u4e0a\u90e8\u589e\u91cf\u901a\u9053\u590d\u5236\u5230 data \u7684\u4e0b\u90e8\u589e\u91cf\u901a\u9053\u3002\u5982\u679c\u5dee\u503c\u4e3a\u8d1f\uff0c\u8be5\u51fd\u6570\u4f1a\u5c06\u6570\u636e\u4ece fill_data \u6df7\u6d17\u5230\u8f83\u4f4e\u7684\u589e\u91cf\u901a\u9053\u4e2d\u3002\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002````\n\nTquad_shuffle_and_fill_up\uff08T\u6570\u636e\uff0cT\u586b\u5145\u6570\u636e\uff0cushort\u589e\u91cf\uff0cushort\u6a21\u6570\uff09\n\n\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\uff1a\u81ea Metal 2. 4.\n\n``` \u4ece\u7ebf\u7a0b\u4e2d\u8fd4\u56de\u6bcf\u4e2a\u5411\u91cf\u7684 data \u6216 fill_data \uff0c\u5176\u56db\u901a\u9053 ID \u4e0e\u8c03\u7528\u8005\u7684\u56db\u901a\u9053 ID \u51cf\u53bb delta \u7684\u5dee\u503c\u3002\u5982\u679c\u5dee\u503c\u4e3a\u8d1f\uff0c\u5219\u8be5\u64cd\u4f5c\u5c06\u503c\u4ece fill_data \u7684\u4e0a\u90e8\u589e\u91cf\u901a\u9053\u590d\u5236\u5230 data \u7684\u4e0b\u90e8\u589e\u91cf\u901a\u9053\u3002\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u6a21\u53c2\u6570\u5b9a\u4e49\u5c06\u56db\u5143\u7ec4\u5206\u5272\u6210\u5355\u72ec\u5411\u91cf\u7684\u5bbd\u5ea6\u3002````\n\n\n\n**\u5185\u7f6e\u56db\u7ec4\u529f\u80fd\u8bf4\u660e**\n\nTquad_shuffle_down\uff08T\u6570\u636e\uff0cushort\u589e\u91cf\uff09\n\nmacOS\uff1a\u81ea Metal 2 \u8d77\u3002iOS\uff1a\u81ea Metal 2 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684\u56db\u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684\u56db\u901a\u9053 ID \u548c\u589e\u91cf\u4e4b\u548c\u3002\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u8be5\u51fd\u6570\u4e0d\u4f1a\u4fee\u6539\u6570\u636e\u7684\u4e0a\u589e\u91cf\u901a\u9053\uff0c\u56e0\u4e3a\u5b83\u4e0d\u4f1a\u5c06\u503c\u5305\u88f9\u5728\u56db\u5143\u7ec4\u5468\u56f4\u3002````\n\nTquad_shuffle_rotate_down\uff08T\u6570\u636e\uff0cushort\u589e\u91cf\uff09\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2.\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684\u56db\u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684\u56db\u901a\u9053 ID \u548c\u589e\u91cf\u4e4b\u548c\u3002\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u8be5\u51fd\u6570\u5c06\u503c\u5305\u88f9\u5728\u56db\u5143\u7ec4\u5468\u56f4\u3002````\n\nTquad_shuffle_rotate_up\uff08T\u6570\u636e\uff0cushort\u589e\u91cf\uff09\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.2.\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684\u56db\u901a\u9053 ID \u4e0e\u8c03\u7528\u8005\u7684\u56db\u901a\u9053 ID \u51cf\u53bb delta \u7684\u5dee\u503c\u3002\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u8be5\u51fd\u6570\u5c06\u503c\u5305\u88f9\u5728\u56db\u5143\u7ec4\u5468\u56f4\u3002````\n\nTquad_shuffle_up\uff08T\u6570\u636e\uff0cushort\u589e\u91cf\uff09\n\nmacOS\uff1a\u81ea Metal 2 \u8d77\u3002iOS\uff1a\u81ea Metal 2 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684\u56db\u901a\u9053 ID \u4e0e\u8c03\u7528\u8005\u7684\u56db\u901a\u9053 ID \u51cf\u53bb delta \u7684\u5dee\u503c\u3002\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u7ebf\u7a0b\u7684 delta \u503c\u5fc5\u987b\u76f8\u540c\u3002\u6b64\u51fd\u6570\u4e0d\u4f1a\u4fee\u6539\u6570\u636e\u7684\u8f83\u4f4e\u589e\u91cf\u901a\u9053\uff0c\u56e0\u4e3a\u5b83\u4e0d\u4f1a\u5c06\u503c\u5305\u88f9\u5728\u56db\u5143\u7ec4\u5468\u56f4\u3002````\n\nTquad_shuffle_xor\uff08T\u503c\uff0cushort\u63a9\u7801\uff09\n\nmacOS\uff1a\u81ea Metal 2 \u8d77\u3002iOS\uff1a\u81ea Metal 2 \u8d77\u3002\n\n``` \u4ece\u7ebf\u7a0b\u8fd4\u56de\u6570\u636e\uff0c\u8be5\u7ebf\u7a0b\u7684\u56db\u901a\u9053 ID \u662f\u8c03\u7528\u8005\u7684\u56db\u901a\u9053 ID \u548c\u63a9\u7801\u7684\u6309\u4f4d\u5f02\u6216 (^)\u3002\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u7ebf\u7a0b\u7684 mask \u503c\u5fc5\u987b\u76f8\u540c\u3002````\n\n\n\n## \u8868 6.17\u3002Metal \u6807\u51c6\u5e93\u4e2d\u7684\u56db\u7ec4\u5f52\u7ea6\u51fd\u6570\n\n**\u5185\u7f6e\u56db\u7ec4\u529f\u80fd\u8bf4\u660e**\n\nquad_votequad_active_threads_mask()\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.\n\n``` \u8fd4\u56de\u4ee3\u8868\u6d3b\u52a8\u7ebf\u7a0b\u7684quad_vote \u63a9\u7801\u3002\u8be5\u51fd\u6570\u76f8\u5f53\u4e8equad_ballot(true)\uff0c\u5e76\u5c06\u8868\u793a\u6d3b\u52a8\u7ebf\u7a0b\u7684\u4f4d\u8bbe\u7f6e\u4e3a1\uff0c\u5c06\u4e0d\u6d3b\u52a8\u7ebf\u7a0b\u7684\u4f4d\u8bbe\u7f6e\u4e3a0\u3002\n\n \u5e03\u5c14\u56db\u5143\u5168\u90e8\uff08\u5e03\u5c14\u8868\u8fbe\u5f0f\uff09\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.\n\n``` \u5982\u679c\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u5c06 expr \u8ba1\u7b97\u4e3a true\uff0c\u5219\u8fd4\u56de true\u3002````\n\n Tquad_and(T\u6570\u636e)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.\n\n``` \u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e4b\u95f4\u6570\u636e\u7684\u6309\u4f4d\u4e0e (&) \u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230\u56db\u5143\u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n \u5e03\u5c14\u56db\u5143\u4efb\u610f\uff08\u5e03\u5c14\u8868\u8fbe\u5f0f\uff09\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.\n\n`` \u5982\u679c\u81f3\u5c11\u6709\u4e00\u4e2a\u6d3b\u52a8\u7ebf\u7a0b\u5c06 expr \u8ba1\u7b97\u4e3a true\uff0c\u5219\u8fd4\u56de true\u3002````\n\n boolquad_is_first()\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.\n\n``` \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u662f\u5f53\u524d\u56db\u5143\u7ec4\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6d3b\u52a8\u7ebf\u7a0b\uff08\u7d22\u5f15\u6700\u5c0f\u7684\u6d3b\u52a8\u7ebf\u7a0b\uff09\uff0c\u5219\u8fd4\u56de true\uff1b\u5426\u5219\u4e3a\u5047\u3002````\n\nboolquad_is_helper_thread()\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.\n\n``` \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u662f\u8f85\u52a9\u7ebf\u7a0b\uff0c\u5219\u8fd4\u56de true\uff1b\u5426\u5219\u4e3a\u5047\u3002\u4f60\u9700\u8981\u4ece\u7247\u6bb5\u51fd\u6570\u6216\u7247\u6bb5\u51fd\u6570\u8c03\u7528\u7684\u53e6\u4e00\u4e2a\u51fd\u6570\u4e2d\u8c03\u7528\u6b64\u51fd\u6570\uff1b\u5426\u5219\uff0c\u53ef\u80fd\u4f1a\u5f15\u53d1\u7f16\u8bd1\u65f6\u9519\u8bef\u3002````\n\n Tquad_max(T\u6570\u636e)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.\n\n``` \u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e2d\u5177\u6709\u6700\u9ad8\u503c\u7684\u6570\u636e\uff0c\u5e76\u5c06\u8be5\u503c\u5e7f\u64ad\u5230\u56db\u5143\u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n Tquad_min(T\u6570\u636e)\n\nmacOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.\n\n``` \u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e2d\u5177\u6709\u6700\u4f4e\u503c\u7684\u6570\u636e\uff0c\u5e76\u5c06\u8be5\u503c\u5e7f\u64ad\u5230\u56db\u5143\u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n\n\n```` \u5185\u7f6e\u56db\u7ec4\u529f\u80fd\u8bf4\u660e````\n\n``` T four_or(T data) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.``\n\n``` \u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e4b\u95f4\u6570\u636e\u7684\u6309\u4f4d\u6216 (|) \u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230\u56db\u5143\u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n``` Tquad_prefix_exclusive_product\uff08T \u6570\u636e\uff09macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.``\n\n``` \u5bf9\u4e8e\u7ed9\u5b9a\u7ebf\u7a0b\uff0c\u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u5177\u6709\u8f83\u4f4e\u7d22\u5f15\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u7684\u4e58\u79ef\u3002\u5bf9\u4e8e\u7ec4\u4e2d\u7684\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u8fd4\u56de T(1)\u3002````\n\n``` Tquad_prefix_exclusive_sum\uff08T \u6570\u636e\uff09macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.``\n\n``` \u5bf9\u4e8e\u7ed9\u5b9a\u7ebf\u7a0b\uff0c\u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u5177\u6709\u8f83\u4f4e\u7d22\u5f15\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u7684\u603b\u548c\u3002\u5bf9\u4e8e\u7ec4\u4e2d\u7684\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u8fd4\u56de T(0)\u3002````\n\n``` Tquad_prefix_inclusive_product\uff08T \u6570\u636e\uff09macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.``\n\n``` \u5bf9\u4e8e\u7ed9\u5b9a\u7ebf\u7a0b\uff0c\u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u5177\u6709\u8f83\u4f4e\u6216\u76f8\u540c\u7d22\u5f15\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u7684\u4e58\u79ef\u3002````\n\n``` Tquad_prefix_inclusive_sum\uff08T \u6570\u636e\uff09macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.``\n\n``` \u5bf9\u4e8e\u7ed9\u5b9a\u7ebf\u7a0b\uff0c\u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u5177\u6709\u8f83\u4f4e\u6216\u76f8\u540c\u7d22\u5f15\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u7684\u603b\u548c\u3002````\n\n``` T four_product(T data) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.``\n\n``` \u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u7684\u4e58\u79ef\uff0c\u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230\u56db\u5143\u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n``` T four_sum(T data) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.``\n\n``` \u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u7684\u6570\u636e\u8f93\u5165\u503c\u4e4b\u548c\uff0c\u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230\u56db\u5143\u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n``` T four_xor(T data) macOS\uff1a\u81ea Metal 2.1 \u8d77\u3002iOS\uff1a\u81ea Metal 2.3.``\n\n``` \u8fd4\u56de\u56db\u5143\u7ec4\u4e2d\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u4e4b\u95f4\u6570\u636e\u7684\u6309\u4f4d\u5f02\u6216 (^)\uff0c\u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230\u56db\u5143\u7ec4\u4e2d\u7684\u6240\u6709\u6d3b\u52a8\u7ebf\u7a0b\u3002````\n\n\u5728\u6838\u51fd\u6570\u4e2d\uff0c\u56db\u8fb9\u5f62\u9664\u4ee5 SIMD \u7ec4\u3002\u5728\u7247\u6bb5\u51fd\u6570\u4e2d\uff0c\u901a\u9053 ID \u8868\u793a 2 x 2 \u56db\u8fb9\u5f62\u4e2d\u7684\u7247\u6bb5\u4f4d\u7f6e\uff1a\n\n- \u6cf3\u9053 ID 0 \u662f\u5de6\u4e0a\u50cf\u7d20 - \u6cf3\u9053 ID 1 \u662f\u53f3\u4e0a\u50cf\u7d20\n\n\n\n- \u6cf3\u9053 ID 2 \u662f\u5de6\u4e0b\u50cf\u7d20 - \u6cf3\u9053 ID 3 \u662f\u53f3\u4e0b\u50cf\u7d20\n\n\u4e3a\u4e86\u6f14\u793a\u968f\u673a\u64ad\u653e\u529f\u80fd\uff0c\u8bf7\u4ece\u8be5\u56db\u5143\u7ec4\u7684\u521d\u59cb\u72b6\u6001\u5f00\u59cb\uff1a\n\n``` \u56db\u901a\u9053 ID 0 1 2 3 ```\n\n``` \u6570\u636e a b c d ```\n\nquad_shuffle_up() \u51fd\u6570\u5c06\u6bcf\u4e2a\u56db\u7ec4\u5411\u4e0a\u79fb\u52a8\u589e\u91cf\u7ebf\u7a0b\u3002\u4f8b\u5982\uff0c\u5f53 delta \u503c\u4e3a 2 \u65f6\uff0c\u51fd\u6570\uff1a\n\n- \u5c06\u56db\u901a\u9053 ID \u4e0b\u79fb\u4e24\u4f4d - \u5c06\u4e0b\u9762\u7684\u4e24\u4e2a\u901a\u9053\u6807\u8bb0\u4e3a\u65e0\u6548\n\n``` \u8ba1\u7b97\u7684\u56db\u901a\u9053 ID - 2 - 1 0 1 ```\n\n``` \u6709\u6548 0 0 1 1 ```\n\n``` \u6570\u636e a b a b ```\n\nquad_shuffle_up() \u51fd\u6570\u662f\u4e00\u4e2a\u975e\u5305\u88c5\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u5f71\u54cd\u8f83\u4f4e\u7684\u589e\u91cf\u901a\u9053\u3002\n\n\u7c7b\u4f3c\u5730\uff0cquad_shuffle_down() \u51fd\u6570\u5c06\u6bcf\u4e2a\u56db\u7ec4\u5411\u4e0b\u79fb\u52a8\u589e\u91cf\u7ebf\u7a0b\u3002\u4ece\u76f8\u540c\u7684\u521d\u59cb\u56db\u7ec4\u72b6\u6001\u5f00\u59cb\uff0c\u589e\u91cf\u4e3a 2 \uff0c\u51fd\u6570\uff1a\n\n- \u5c06\u56db\u901a\u9053 ID \u5411\u4e0a\u79fb\u52a8\u4e24\u4f4d - \u5c06\u4e0a\u9762\u7684\u4e24\u4e2a\u901a\u9053\u6807\u8bb0\u4e3a\u65e0\u6548\n\n`` \u8ba1\u7b97\u51fa\u7684\u56db\u901a\u9053 ID 2 3 4 5 ``\n\n``` \u6709\u6548 1 1 0 0 ```\n\n``` \u6570\u636e c d c d ```\n\nquad_shuffle_down() \u51fd\u6570\u662f\u4e00\u4e2a\u975e\u5305\u88c5\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u5f71\u54cd\u4e0a\u90e8 delta \u901a\u9053\u3002\n\n\u4e3a\u4e86\u6f14\u793a\u6d17\u724c\u548c\u586b\u5145\u529f\u80fd\uff0c\u542f\u52a8\u8be5\u56db\u5143\u7ec4\u7684\u521d\u59cb\u72b6\u6001\uff1a\n\n**Quad Lane ID** (^0 1 2 3) data a b c d fill fa fb fc fdquad_shuffle_and_fill_up() \u51fd\u6570\u901a\u8fc7 delta \u7ebf\u7a0b\u5411\u4e0a\u79fb\u52a8\u6bcf\u4e2a\u56db\u8fb9\u7ec4 \u2014 \u7c7b\u4f3c\u4e8equad_shuffle_up() \u2014 \u5e76\u4ece\u4e0a\u5c42\u5206\u914d\u503c\u901a\u8fc7\u5305\u88c5\u56db\u901a\u9053 ID \u5c06\u901a\u9053\u586b\u5145\u5230\u8f83\u4f4e\u7684\u6570\u636e\u901a\u9053\u3002\u4f8b\u5982\uff0c\u5f53 delta \u503c\u4e3a 2 \u65f6\uff0c\u51fd\u6570\uff1a\n\n- \u5c06\u56db\u8f66\u9053 ID \u5411\u4e0b\u79fb\u52a8\u4e24\u4f4d\n\n\n\n- \u5c06\u4e0a\u4e24\u9053\u586b\u5145\u5206\u914d\u7ed9\u4e0b\u4e24\u9053\u6570\u636e\n\n``` \u8ba1\u7b97\u7684\u56db\u901a\u9053 ID - 2 - 1 0 1 ```\n\n``` \u6570\u636e fc fd a b ```\n\n\u5e26\u6709\u6a21\u53c2\u6570\u7684quad_shuffle_and_fill_up()\u51fd\u6570\u5c06\u56db\u5143\u7ec4\u5206\u5272\u6210\u5411\u91cf\uff0c\u6bcf\u4e2a\u5411\u91cf\u7684\u5927\u5c0f\u90fd\u4ee5\u6a21\u4e3a\u6a21\uff0c\u5e76\u6309\u589e\u91cf\u7ebf\u7a0b\u79fb\u4f4d\u6bcf\u4e2a\u5411\u91cf\u3002\u4f8b\u5982\uff0c\u6a21\u503c\u4e3a 2 \u4e14\u589e\u91cf\u503c\u4e3a 1 \u65f6\uff0c\u8be5\u51fd\u6570\uff1a\n\n- \u5c06\u56db\u901a\u9053 ID \u4e0b\u79fb\u4e00\u4f4d - \u5c06\u586b\u5145\u4e2d\u6bcf\u4e2a\u5411\u91cf\u7684\u4e0a\u901a\u9053\u5206\u914d\u7ed9\u6570\u636e\u4e2d\u6bcf\u4e2a\u5411\u91cf\u7684\u4e0b\u901a\u9053\n\n``` \u8ba1\u7b97\u7684\u56db\u901a\u9053 ID - 1 0 - 1 0 ```\n\n``` \u6570\u636e fb a fd c ```\n\nquad_shuffle_and_fill_down() \u51fd\u6570\u901a\u8fc7\u589e\u91cf\u7ebf\u7a0b\u5c06\u6bcf\u4e2a\u56db\u7ec4\u5411\u4e0b\u79fb\u52a8\uff08\u7c7b\u4f3c\u4e8equad_shuffle_down()\uff09\uff0c\u5e76\u901a\u8fc7\u5305\u88c5\u56db\u901a\u9053 ID \u5c06\u8f83\u4f4e\u586b\u5145\u901a\u9053\u4e2d\u7684\u503c\u5206\u914d\u7ed9\u8f83\u9ad8\u6570\u636e\u901a\u9053\u3002\u4f8b\u5982\uff0c\u5f53 delta \u503c\u4e3a 2 \u65f6\uff0c\u51fd\u6570\uff1a\n\n- \u5c06\u56db\u901a\u9053 ID \u5411\u4e0a\u79fb\u52a8\u4e24\u4f4d - \u5c06\u4e0b\u9762\u4e24\u4e2a\u586b\u5145\u901a\u9053\u5206\u914d\u7ed9\u4e0a\u9762\u4e24\u4e2a\u6570\u636e\u901a\u9053\n\n`` \u8ba1\u7b97\u51fa\u7684\u56db\u901a\u9053 ID 2 3 4 5 ``\n\n``` \u6570\u636e c d fa fb ```\n\n\u5e26\u6709\u6a21\u53c2\u6570\u7684quad_shuffle_and_fill_down()\u51fd\u6570\u5c06\u56db\u5143\u7ec4\u5206\u5272\u6210\u5411\u91cf\uff0c\u6bcf\u4e2a\u5411\u91cf\u7684\u5927\u5c0f\u90fd\u4ee5\u6a21\u4e3a\u6a21\uff0c\u5e76\u6309\u589e\u91cf\u7ebf\u7a0b\u79fb\u4f4d\u6bcf\u4e2a\u5411\u91cf\u3002\u4f8b\u5982\uff0c\u6a21\u503c\u4e3a 2 \u4e14\u589e\u91cf\u503c\u4e3a 1 \u65f6\uff0c\u8be5\u51fd\u6570\uff1a\n\n- \u5c06\u56db\u901a\u9053 ID \u4e0a\u79fb\u4e00\u4f4d - \u5c06\u586b\u5145\u4e2d\u6bcf\u4e2a\u5411\u91cf\u7684\u4e0b\u901a\u9053\u5206\u914d\u7ed9\u6570\u636e\u4e2d\u6bcf\u4e2a\u5411\u91cf\u7684\u4e0a\u901a\u9053\n\n`` \u8ba1\u7b97\u51fa\u7684\u56db\u901a\u9053 ID 1 2 1 2 ``\n\n``` \u6570\u636e b fa d fc ```\n\nquad_ballot \u51fd\u6570\u4f7f\u7528quad_vote \u5305\u88c5\u7c7b\u578b\uff0c\u53ef\u4ee5\u663e\u5f0f\u8f6c\u6362\u4e3a\u5176\u57fa\u7840\u7c7b\u578b\u3002\uff08\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c\u8bf7\u6ce8\u610f\u4f7f\u7528 vote_t \u6765\u8868\u793a\u57fa\u7840\u7c7b\u578b XXX\u3002\uff09\n\n\n\n\u7c7bquad_vote { public: typedef XXX vote_t;\u663e\u5f0f constexprquad_vote(vote_t v = 0);\u663e\u5f0f constexpr \u8fd0\u7b97\u7b26 vote_t() const;\n\n// \u5982\u679c\u4e0e\u56db\u5143\u7ec4\u4e2d\u7684\u7ebf\u7a0b\u5bf9\u5e94\u7684\u6240\u6709\u4f4d\uff08\u5e95\u90e8\u56db\u4e2a\u4f4d\uff09\u5747\u5df2\u8bbe\u7f6e\uff0c\u5219\u8fd4\u56de true\u3002bool all() const;\n\n// \u5982\u679c\u8bbe\u7f6e\u4e86\u4e0e\u56db\u5143\u7ec4\u4e2d\u7684\u7ebf\u7a0b\u5bf9\u5e94\u7684\u4efb\u4f55\u4f4d\uff0c\u5219\u8fd4\u56de true\u3002\u5e03\u5c14\u4efb\u4f55\uff08\uff09\u5e38\u91cf\uff1b };\n\nquad_vote \u6784\u9020\u51fd\u6570\u5c4f\u853d\u4e86\u9876\u90e8\u4f4d\uff08\u5373\uff0c\u5e95\u90e8\u56db\u4e2a\u4f4d\u9664\u5916\uff09\u3002\u56e0\u6b64\uff0c\u5f53\u6295\u5c04\u5230 vote_t \u65f6\uff0c\u975e\u5e95\u90e8\u56db\u4f4d\u4fdd\u8bc1\u4e0d\u4f1a\u88ab\u8bbe\u7f6e\u3002\n")))}M.isMDXComponent=!0}}]);